//! license : MIT

/*
Copyright Vassilis Petroulias [DRDigit]

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

       http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
*/

/*
CryptoJS v3.1.2
code.google.com/p/crypto-js
(c) 2009-2013 by Jeff Mott. All rights reserved.
code.google.com/p/crypto-js/wiki/License
*/

/* ============== DO NOT ALTER ANYTHING BELOW THIS LINE ! ===============

AppMeasurement for JavaScript version: 1.5.1
Copyright 1996-2015 Adobe, Inc. All Rights Reserved
More info available at http://www.omniture.com
*/

/**
         * Loads the specified media. The following are general options for setting the video. Some players may have special setting like bitrate.
         * Please refer to the specific player and read the properties.
         * @method
         * @param {String} url the URL address of the media
         * @param {Object} [opts] the options for loading this media
         * @param {String} [opts.type] the media type format like "mp4","hls"
         * @param {String} [opts.drm] DRM to be used e.g "playready", "wmdrm", "widevine", "verimatrix"
         * @param {Object} [opts.player] the player to play the media
         * @param {String} [opts.drmUrl] (Widevine || Playready || Verimatrix || WMDRM) Set the DRM license url
         * @param {String} [opts.serviceProvider] (Verimatrix) Set the Verimatrix DRM Service provider Name
         * @param {String} [opts.iptvServerIp] (Verimatrix) Set the Verimatrix DRM IPTV Client server IP address
         * @param {String} [opts.webServerIp] (Verimatrix) Set the Verimatrix DRM  WebClient server IP address 
         * @param {String} [opts.customData] (Playready) Set the Playready DRM Custome Data if the platform is supported
         * @param {String} [opts.portal] (Widevine) Set the portal
         * @param {String} [opts.userData] (Widevine) Set the user data
         * @param {String} [opts.deviceId] (Widevine) Set the device id
         * @param {String} [opts.deviceType] (Widevine) Set the device type
         * @param {String} [opts.authCookiesUrl] (WMDRM) Set the url to get the authentication cookies (e.g LG and Samsung)
         * @param {String} [opts.cadUrl] (WMDRM) Set the cad url to generate the xml, then player will get the authentication (e.g Philips)
         * @param {String} [opts.swfUrl] (Flash) set the flash swf url
         * @param {String} [opts.streamName] (Flash) the streamName
         * @param {Boolean} [opts.liveStreaming] (Flash) to  indicate if it is liveStreaming. If it is live streaming, no time update
         * @param {Boolean} [opts.use3d] true if to use 3D
         * @param {String} [opts.type3d] the type of 3D
         * @param {Boolean} [opts.forceReload] to forceLoad even if the url is the same
         * @param {String} [opts.startBitrate] (HLS || HAS) To set the initial bitrate e.g 2600000
         * @param {Number} [opts.bitratesFrom] (HLS || HAS) the lowest bitrate setting
         * @param {Number} [opts.bitratesTo] (HLS || HAS) the highest bitrate setting
         * @throws {module:xdk-base/exception.ILLEGAL_ARGUMENT} The specified player cannot play the specified media
         * @throws {module:xdk-base/exception.ILLEGAL_ARGUMENT} None of the registered player can play the specified media
         * @memberof xdk-base/device/Media#
         */

/**
         * Preload a media for lesser bufferring time.
         *
         * @method
         * @param {String} url The media url
         * @param {Object} [opts] The options for loading
         * @param {xdk-base/device/interface/Player} [opts.player] The target player to do preloading
         * @param {String} [opts.type] the media type format like "mp4","hls"
         * @param {String} [opts.drm] DRM to be used e.g "playready", "wmdrm", "widevine"
         * @param {String} [opts.drmUrl] (Widevine || Playready || Verimatrix || WMDRM) Set the DRM license url
         * @param {String} [opts.customData] (Playready) Set the Playready DRM Custome Data if the platform is supported
         * @param {String} [opts.portal] (Widevine) Set the portal
         * @param {String} [opts.userData] (Widevine) Set the user data
         * @param {String} [opts.deviceId] (Widevine) Set the device id
         * @param {String} [opts.deviceType] (Widevine) Set the device type
         * @param {String} [opts.authCookiesUrl] (WMDRM) Set the url to get the authentication cookies (e.g LG and Samsung)
         * @param {String} [opts.cadUrl] (WMDRM) Set the cad url to generate the xml, then player will get the authentication (e.g Philips)
         * @param {String} [opts.swfUrl] (Flash) set the flash swf url
         * @param {String} [opts.streamName] (Flash) the streamName
         * @param {Boolean} [opts.liveStreaming] (Flash) to indicate if it is liveStreaming. If it is live streaming, no time update
         * @param {Boolean} [opts.use3d] true if to use 3D
         * @param {String} [opts.type3d] the type of 3D
         * @returns {String} The token for identifying the preloaded playback for playing
         * @throws {module:xdk-base/exception.ILLEGAL_ARGUMENT} The specified player cannot play the specified media
         * @throws {module:xdk-base/exception.ILLEGAL_ARGUMENT} None of the registered player can play the specified media
         * @memberof xdk-base/device/Media#
         */

/**
         * The license acquisition defer object
         * @private
         * @memberof xdk-base/device/shared/opif/DrmAgent#
         */

/**
         * The last license acquisition promise object in the queue
         * @private
         * @memberof xdk-base/device/shared/opif/DrmAgent#
         */

/**
         * Send the license request to the native drm agent.
         * @method
         * @param {String} laUrl The url of the license acquisition server
         * @param {String} [customData] The custom data
         * @returns {Promise.<Boolean>} Return true when the license acqiusition success
         * @throws {Promise.<ax/Exception>} Reject if any error occurs
         * @memberof xdk-base/device/shared/opif/DrmAgent#
         */

// the license acquisition resolved, resolve the individual promise

/**
         * The actual function to send DRM messages.
         * @protected
         * @method
         * @param {String} laUrl The url of the license acquisition server
         * @param {String} [customData] The custom data
         * @memberof xdk-base/device/shared/opif/DrmAgent#
         */

// license URL

/**
         * Callback to be called when the license acquisition is done.
         * This function will resolve the license acquisition defer.
         * @protected
         * @method
         * @memberof xdk-base/device/shared/opif/DrmAgent#
         */

/**
         * Callback to be called by the native drm agent when license acquisition fails.
         * This function will reject the license acquisition defer.
         * @protected
         * @method
         * @param {Number} errorState Error state code
         * @param {String} contentId
         * @param {String} drmSystemId The identifier of the drm system
         * @param {String} rightsIssuerUrl The url of the rights issuer
         * @memberof xdk-base/device/shared/opif/DrmAgent#
         */

/**
         * The license acquisition defer object
         * @private
         * @memberof ax/device/shared/opif/DrmAgent#
         */

/**
         * The last license acquisition promise object in the queue
         * @private
         * @memberof ax/device/shared/opif/DrmAgent#
         */

/**
         * Send the license request to the native drm agent.
         * @method
         * @param {String} laUrl The url of the license acquisition server
         * @param {String} [customData] The custom data
         * @returns {Promise.<Boolean>} Return true when the license acqiusition success
         * @throws {Promise.<ax/Exception>} Reject if any error occurs
         * @memberof tvedemo/ext/device/shared/opif/DrmAgent#
         */

/**
         * Playready only function, join domain. Defaults to current data set.
         * @function joinDomain
         * @param domainController {String} The URL to the domainController
         * @param dsId             {String} The id for the service
         * @param accountId        {String}
         * @param customData       {String} customdata to send in GET format (eg. assetID=123&license=false)
         * @param dsIdFormat       {String} The format of the dsId parameter
         * @return                 {void}
         */

/**
         * The actual function to send DRM messages.
         * @protected
         * @method
         * @param {String} laUrl The url of the license acquisition server
         * @param {String} [customData] The custom data
         * @memberof ax/device/shared/opif/DrmAgent#
         */

/**
         * Callback to be called when the license acquisition is done.
         * This function will resolve the license acquisition defer.
         * @protected
         * @method
         * @memberof ax/device/shared/opif/DrmAgent#
         */

/**
         * Callback to be called by the native drm agent when license acquisition fails.
         * This function will reject the license acquisition defer.
         * @protected
         * @method
         * @param {Number} errorState Error state code
         * @param {String} contentId 
         * @param {String} drmSystemId The identifier of the drm system
         * @param {String} rightsIssuerUrl The url of the rights issuer
         * @memberof ax/device/shared/opif/DrmAgent#
         */

/*! (C) 2016 Conviva, Inc. All rights reserved. Confidential and proprietary. */

// Accepts both old and new styles of license scope description.

//  If no license data of any kind is presented, we assume the content can be played.

// Here are some typical licenseDescriptions, mapped to chunk codes like 2B...

// If content is not licensed for here / this, then prohibit playback with a popup.

// license uri and custom data are both optional and independent to each other

// if license uri is available

function AppMeasurement(){var e=this;e.version="1.5.1";var t=window;t.s_c_in||(t.s_c_il=[],t.s_c_in=0),e._il=t.s_c_il,e._in=t.s_c_in,e._il[e._in]=e,t.s_c_in++,e._c="s_c";var i=t.AppMeasurement.zb;i||(i=null);var n,s,r=t;try{for(n=r.parent,s=r.location;n&&n.location&&s&&""+n.location!=""+s&&r.location&&""+n.location!=""+r.location&&n.location.host==s.host;)r=n,n=r.parent}catch(e){}e.ob=function(e){try{console.log(e)}catch(e){}},e.za=function(e){return""+parseInt(e)==""+e},e.replace=function(e,t,i){return!e||0>e.indexOf(t)?e:e.split(t).join(i)},e.escape=function(t){var i,n;if(!t)return t;for(t=encodeURIComponent(t),i=0;7>i;i++)n="+~!*()'".substring(i,i+1),0<=t.indexOf(n)&&(t=e.replace(t,n,"%"+n.charCodeAt(0).toString(16).toUpperCase()));return t},e.unescape=function(t){if(!t)return t;t=0<=t.indexOf("+")?e.replace(t,"+"," "):t;try{return decodeURIComponent(t)}catch(e){}return unescape(t)},e.fb=function(){var i,n=t.location.hostname,s=e.fpCookieDomainPeriods;if(s||(s=e.cookieDomainPeriods),n&&!e.cookieDomain&&!/^[0-9.]+$/.test(n)&&(s=s?parseInt(s):2,s=2<s?s:2,0<=(i=n.lastIndexOf(".")))){for(;0<=i&&1<s;)i=n.lastIndexOf(".",i-1),s--;e.cookieDomain=0<i?n.substring(i):n}return e.cookieDomain},e.c_r=e.cookieRead=function(t){t=e.escape(t);var i=" "+e.d.cookie,n=i.indexOf(" "+t+"="),s=0>n?n:i.indexOf(";",n);return t=0>n?"":e.unescape(i.substring(n+2+t.length,0>s?i.length:s)),"[[B]]"!=t?t:""},e.c_w=e.cookieWrite=function(t,i,n){var s,r=e.fb(),a=e.cookieLifetime;return i=""+i,a=a?(""+a).toUpperCase():"",n&&"SESSION"!=a&&"NONE"!=a&&((s=""!=i?parseInt(a||0):-60)?(n=new Date,n.setTime(n.getTime()+1e3*s)):1==n&&(n=new Date,s=n.getYear(),n.setYear(s+5+(1900>s?1900:0)))),t&&"NONE"!=a?(e.d.cookie=t+"="+e.escape(""!=i?i:"[[B]]")+"; path=/;"+(n&&"SESSION"!=a?" expires="+n.toGMTString()+";":"")+(r?" domain="+r+";":""),e.cookieRead(t)==i):0},e.G=[],e.ba=function(t,i,n){if(e.ta)return 0;e.maxDelay||(e.maxDelay=250);var s=0,r=(new Date).getTime()+e.maxDelay,a=e.d.visibilityState,o=["webkitvisibilitychange","visibilitychange"];if(a||(a=e.d.webkitVisibilityState),a&&"prerender"==a){if(!e.ca)for(e.ca=1,n=0;n<o.length;n++)e.d.addEventListener(o[n],function(){var t=e.d.visibilityState;t||(t=e.d.webkitVisibilityState),"visible"==t&&(e.ca=0,e.delayReady())});s=1,r=0}else n||e.l("_d")&&(s=1);return s&&(e.G.push({m:t,a:i,t:r}),e.ca||setTimeout(e.delayReady,e.maxDelay)),s},e.delayReady=function(){var t,i=(new Date).getTime(),n=0;for(e.l("_d")?n=1:e.na();0<e.G.length;){if(t=e.G.shift(),n&&!t.t&&t.t>i){e.G.unshift(t),setTimeout(e.delayReady,parseInt(e.maxDelay/2));break}e.ta=1,e[t.m].apply(e,t.a),e.ta=0}},e.setAccount=e.sa=function(t){var i,n;if(!e.ba("setAccount",arguments))if(e.account=t,e.allAccounts)for(i=e.allAccounts.concat(t.split(",")),e.allAccounts=[],i.sort(),n=0;n<i.length;n++)0!=n&&i[n-1]==i[n]||e.allAccounts.push(i[n]);else e.allAccounts=t.split(",")},e.foreachVar=function(t,i){var n,s,r,a,o="";for(r=s="",e.lightProfileID?(n=e.K,(o=e.lightTrackVars)&&(o=","+o+","+e.ga.join(",")+",")):(n=e.c,(e.pe||e.linkType)&&(o=e.linkTrackVars,s=e.linkTrackEvents,e.pe&&(r=e.pe.substring(0,1).toUpperCase()+e.pe.substring(1),e[r]&&(o=e[r].yb,s=e[r].xb))),o&&(o=","+o+","+e.A.join(",")+","),s&&o&&(o+=",events,")),i&&(i=","+i+","),s=0;s<n.length;s++)r=n[s],(a=e[r])&&(!o||0<=o.indexOf(","+r+","))&&(!i||0<=i.indexOf(","+r+","))&&t(r,a)},e.B=function(t,i,n,s,r){var a,o,l,c,d="",u=0;if("contextData"==t&&(t="c"),i){for(a in i)if(!(Object.prototype[a]||r&&a.substring(0,r.length)!=r)&&i[a]&&(!n||0<=n.indexOf(","+(s?s+".":"")+a+","))){if(l=!1,u)for(o=0;o<u.length;o++)a.substring(0,u[o].length)==u[o]&&(l=!0);if(!l&&(""==d&&(d+="&"+t+"."),o=i[a],r&&(a=a.substring(r.length)),0<a.length))if(0<(l=a.indexOf(".")))o=a.substring(0,l),l=(r||"")+o+".",u||(u=[]),u.push(l),d+=e.B(o,i,n,s,l);else if("boolean"==typeof o&&(o=o?"true":"false"),o){if("retrieveLightData"==s&&0>r.indexOf(".contextData."))switch(l=a.substring(0,4),c=a.substring(4),a){case"transactionID":a="xact";break;case"channel":a="ch";break;case"campaign":a="v0";break;default:e.za(c)&&("prop"==l?a="c"+c:"eVar"==l?a="v"+c:"list"==l?a="l"+c:"hier"==l&&(a="h"+c,o=o.substring(0,255)))}d+="&"+e.escape(a)+"="+e.escape(o)}}""!=d&&(d+="&."+t)}return d},e.hb=function(){var t,n,s,r,a,o,l,c,d="",u="",h="",_=r="";if(e.lightProfileID?(t=e.K,(u=e.lightTrackVars)&&(u=","+u+","+e.ga.join(",")+",")):(t=e.c,(e.pe||e.linkType)&&(u=e.linkTrackVars,h=e.linkTrackEvents,e.pe&&(r=e.pe.substring(0,1).toUpperCase()+e.pe.substring(1),e[r]&&(u=e[r].yb,h=e[r].xb))),u&&(u=","+u+","+e.A.join(",")+","),h&&(h=","+h+",",u&&(u+=",events,")),e.events2&&(_+=(""!=_?",":"")+e.events2)),e.visitor&&1.5<=parseFloat(e.visitor.version)&&e.visitor.getCustomerIDs){if(r=i,a=e.visitor.getCustomerIDs())for(n in a)Object.prototype[n]||(s=a[n],r||(r={}),s.id&&(r[n+".id"]=s.id),s.authState&&(r[n+".as"]=s.authState));r&&(d+=e.B("cid",r))}for(e.AudienceManagement&&e.AudienceManagement.isReady()&&(d+=e.B("d",e.AudienceManagement.getEventCallConfigParams())),n=0;n<t.length;n++){if(r=t[n],a=e[r],s=r.substring(0,4),o=r.substring(4),!a&&"events"==r&&_&&(a=_,_=""),a&&(!u||0<=u.indexOf(","+r+","))){switch(r){case"supplementalDataID":r="sdid";break;case"timestamp":r="ts";break;case"dynamicVariablePrefix":r="D";break;case"visitorID":r="vid";break;case"marketingCloudVisitorID":r="mid";break;case"analyticsVisitorID":r="aid";break;case"audienceManagerLocationHint":r="aamlh";break;case"audienceManagerBlob":r="aamb";break;case"authState":r="as";break;case"pageURL":r="g",255<a.length&&(e.pageURLRest=a.substring(255),a=a.substring(0,255));break;case"pageURLRest":r="-g";break;case"referrer":r="r";break;case"vmk":case"visitorMigrationKey":r="vmt";break;case"visitorMigrationServer":r="vmf",e.ssl&&e.visitorMigrationServerSecure&&(a="");break;case"visitorMigrationServerSecure":r="vmf",!e.ssl&&e.visitorMigrationServer&&(a="");break;case"charSet":r="ce";break;case"visitorNamespace":r="ns";break;case"cookieDomainPeriods":r="cdp";break;case"cookieLifetime":r="cl";break;case"variableProvider":r="vvp";break;case"currencyCode":r="cc";break;case"channel":r="ch";break;case"transactionID":r="xact";break;case"campaign":r="v0";break;case"latitude":r="lat";break;case"longitude":r="lon";break;case"resolution":r="s";break;case"colorDepth":r="c";break;case"javascriptVersion":r="j";break;case"javaEnabled":r="v";break;case"cookiesEnabled":r="k";break;case"browserWidth":r="bw";break;case"browserHeight":r="bh";break;case"connectionType":r="ct";break;case"homepage":r="hp";break;case"events":if(_&&(a+=(""!=a?",":"")+_),h)for(o=a.split(","),a="",s=0;s<o.length;s++)l=o[s],c=l.indexOf("="),0<=c&&(l=l.substring(0,c)),c=l.indexOf(":"),0<=c&&(l=l.substring(0,c)),0<=h.indexOf(","+l+",")&&(a+=(a?",":"")+o[s]);break;case"events2":a="";break;case"contextData":d+=e.B("c",e[r],u,r),a="";break;case"lightProfileID":r="mtp";break;case"lightStoreForSeconds":r="mtss",e.lightProfileID||(a="");break;case"lightIncrementBy":r="mti",e.lightProfileID||(a="");break;case"retrieveLightProfiles":r="mtsr";break;case"deleteLightProfiles":r="mtsd";break;case"retrieveLightData":e.retrieveLightProfiles&&(d+=e.B("mts",e[r],u,r)),a="";break;default:e.za(o)&&("prop"==s?r="c"+o:"eVar"==s?r="v"+o:"list"==s?r="l"+o:"hier"==s&&(r="h"+o,a=a.substring(0,255)))}a&&(d+="&"+r+"="+("pev"!=r.substring(0,3)?e.escape(a):a))}"pev3"==r&&e.e&&(d+=e.e)}return d},e.u=function(e){var t=e.tagName;return"undefined"!=""+e.Cb||"undefined"!=""+e.sb&&"HTML"!=(""+e.sb).toUpperCase()?"":(t=t&&t.toUpperCase?t.toUpperCase():"","SHAPE"==t&&(t=""),t&&(("INPUT"==t||"BUTTON"==t)&&e.type&&e.type.toUpperCase?t=e.type.toUpperCase():!t&&e.href&&(t="A")),t)},e.va=function(e){var t,i,n,s=e.href?e.href:"";return t=s.indexOf(":"),i=s.indexOf("?"),n=s.indexOf("/"),s&&(0>t||0<=i&&t>i||0<=n&&t>n)&&(i=e.protocol&&1<e.protocol.length?e.protocol:l.protocol?l.protocol:"",t=l.pathname.lastIndexOf("/"),s=(i?i+"//":"")+(e.host?e.host:l.host?l.host:"")+("/"!=h.substring(0,1)?l.pathname.substring(0,0>t?0:t)+"/":"")+s),s},e.H=function(t){var i,n,s=e.u(t),r="",a=0;return s&&(i=t.protocol,n=t.onclick,!t.href||"A"!=s&&"AREA"!=s||n&&i&&!(0>i.toLowerCase().indexOf("javascript"))?n?(r=e.replace(e.replace(e.replace(e.replace(""+n,"\r",""),"\n",""),"\t","")," ",""),a=2):"INPUT"==s||"SUBMIT"==s?(t.value?r=t.value:t.innerText?r=t.innerText:t.textContent&&(r=t.textContent),a=3):t.src&&"IMAGE"==s&&(r=t.src):r=e.va(t),r)?{id:r.substring(0,100),type:a}:0},e.Ab=function(t){for(var i=e.u(t),n=e.H(t);t&&!n&&"BODY"!=i;)(t=t.parentElement?t.parentElement:t.parentNode)&&(i=e.u(t),n=e.H(t));return n&&"BODY"!=i||(t=0),t&&(i=t.onclick?""+t.onclick:"",0<=i.indexOf(".tl(")||0<=i.indexOf(".trackLink("))&&(t=0),t},e.rb=function(){var i,n,s,r,a=e.linkObject,o=e.linkType,l=e.linkURL;if(e.ha=1,a||(e.ha=0,a=e.clickObject),a){for(i=e.u(a),n=e.H(a);a&&!n&&"BODY"!=i;)(a=a.parentElement?a.parentElement:a.parentNode)&&(i=e.u(a),n=e.H(a));if(n&&"BODY"!=i||(a=0),a){var c=a.onclick?""+a.onclick:"";(0<=c.indexOf(".tl(")||0<=c.indexOf(".trackLink("))&&(a=0)}}else e.ha=1;if(!l&&a&&(l=e.va(a)),l&&!e.linkLeaveQueryString&&0<=(s=l.indexOf("?"))&&(l=l.substring(0,s)),!o&&l){var d,u=0,h=0;if(e.trackDownloadLinks&&e.linkDownloadFileTypes)for(c=l.toLowerCase(),s=c.indexOf("?"),r=c.indexOf("#"),0<=s?0<=r&&r<s&&(s=r):s=r,0<=s&&(c=c.substring(0,s)),s=e.linkDownloadFileTypes.toLowerCase().split(","),r=0;r<s.length;r++)(d=s[r])&&c.substring(c.length-(d.length+1))=="."+d&&(o="d");if(e.trackExternalLinks&&!o&&(c=l.toLowerCase(),e.ya(c)&&(e.linkInternalFilters||(e.linkInternalFilters=t.location.hostname),s=0,e.linkExternalFilters?(s=e.linkExternalFilters.toLowerCase().split(","),u=1):e.linkInternalFilters&&(s=e.linkInternalFilters.toLowerCase().split(",")),s))){for(r=0;r<s.length;r++)d=s[r],0<=c.indexOf(d)&&(h=1);h?u&&(o="e"):u||(o="e")}}e.linkObject=a,e.linkURL=l,e.linkType=o,(e.trackClickMap||e.trackInlineStats)&&(e.e="",a&&(o=e.pageName,l=1,a=a.sourceIndex,o||(o=e.pageURL,l=0),t.s_objectID&&(n.id=t.s_objectID,a=n.type=1),o&&n&&n.id&&i&&(e.e="&pid="+e.escape(o.substring(0,255))+(l?"&pidt="+l:"")+"&oid="+e.escape(n.id.substring(0,100))+(n.type?"&oidt="+n.type:"")+"&ot="+i+(a?"&oi="+a:""))))},e.ib=function(){var t=e.ha,i=e.linkType,n=e.linkURL,s=e.linkName;if(i&&(n||s)&&(i=i.toLowerCase(),"d"!=i&&"e"!=i&&(i="o"),e.pe="lnk_"+i,e.pev1=n?e.escape(n):"",e.pev2=s?e.escape(s):"",t=1),e.abort&&(t=0),e.trackClickMap||e.trackInlineStats){var r,a,o,i={},n=0,l=e.cookieRead("s_sq"),c=l?l.split("&"):0,l=0;if(c)for(r=0;r<c.length;r++)a=c[r].split("="),s=e.unescape(a[0]).split(","),a=e.unescape(a[1]),i[a]=s;if(s=e.account.split(","),t||e.e){t&&!e.e&&(l=1);for(a in i)if(!Object.prototype[a])for(r=0;r<s.length;r++)for(l&&(o=i[a].join(","))==e.account&&(e.e+=("&"!=a.charAt(0)?"&":"")+a,i[a]=[],n=1),c=0;c<i[a].length;c++)(o=i[a][c])==s[r]&&(l&&(e.e+="&u="+e.escape(o)+("&"!=a.charAt(0)?"&":"")+a+"&u=0"),i[a].splice(c,1),n=1);if(t||(n=1),n){l="",r=2,!t&&e.e&&(l=e.escape(s.join(","))+"="+e.escape(e.e),r=1);for(a in i)!Object.prototype[a]&&0<r&&0<i[a].length&&(l+=(l?"&":"")+e.escape(i[a].join(","))+"="+e.escape(a),r--);e.cookieWrite("s_sq",l)}}}return t},e.jb=function(){if(!e.wb){var t,i,n=new Date,s=r.location,a=i=t="",o="",l="",c="1.2",d=e.cookieWrite("s_cc","true",0)?"Y":"N",u="",h="";if(n.setUTCDate&&(c="1.3",(0).toPrecision&&(c="1.5",n=[],n.forEach))){c="1.6",i=0,t={};try{i=new Iterator(t),i.next&&(c="1.7",n.reduce&&(c="1.8",c.trim&&(c="1.8.1",Date.parse&&(c="1.8.2",Object.create&&(c="1.8.5")))))}catch(e){}}t=screen.width+"x"+screen.height,a=navigator.javaEnabled()?"Y":"N",i=screen.pixelDepth?screen.pixelDepth:screen.colorDepth,o=e.w.innerWidth?e.w.innerWidth:e.d.documentElement.offsetWidth,l=e.w.innerHeight?e.w.innerHeight:e.d.documentElement.offsetHeight;try{e.b.addBehavior("#default#homePage"),u=e.b.Bb(s)?"Y":"N"}catch(e){}try{e.b.addBehavior("#default#clientCaps"),h=e.b.connectionType}catch(e){}e.resolution=t,e.colorDepth=i,e.javascriptVersion=c,e.javaEnabled=a,e.cookiesEnabled=d,e.browserWidth=o,e.browserHeight=l,e.connectionType=h,e.homepage=u,e.wb=1}},e.L={},e.loadModule=function(i,n){var s=e.L[i];if(!s){s=t["AppMeasurement_Module_"+i]?new t["AppMeasurement_Module_"+i](e):{},e.L[i]=e[i]=s,s.Na=function(){return s.Ra},s.Sa=function(t){(s.Ra=t)&&(e[i+"_onLoad"]=t,e.ba(i+"_onLoad",[e,s],1)||t(e,s))};try{Object.defineProperty?Object.defineProperty(s,"onLoad",{get:s.Na,set:s.Sa}):s._olc=1}catch(e){s._olc=1}}n&&(e[i+"_onLoad"]=n,e.ba(i+"_onLoad",[e,s],1)||n(e,s))},e.l=function(t){var i,n;for(i in e.L)if(!Object.prototype[i]&&(n=e.L[i])&&(n._olc&&n.onLoad&&(n._olc=0,n.onLoad(e,n)),n[t]&&n[t]()))return 1;return 0},e.mb=function(){var t=Math.floor(1e13*Math.random()),i=e.visitorSampling,n=e.visitorSamplingGroup,n="s_vsn_"+(e.visitorNamespace?e.visitorNamespace:e.account)+(n?"_"+n:""),s=e.cookieRead(n);if(i){if(s&&(s=parseInt(s)),!s){if(!e.cookieWrite(n,t))return 0;s=t}if(s%1e4>v)return 0}return 1},e.M=function(t,i){var n,s,r,a,o,l;for(n=0;2>n;n++)for(s=0<n?e.oa:e.c,r=0;r<s.length;r++)if(a=s[r],(o=t[a])||t["!"+a]){if(!i&&("contextData"==a||"retrieveLightData"==a)&&e[a])for(l in e[a])o[l]||(o[l]=e[a][l]);e[a]=o}},e.Ga=function(t,i){var n,s,r,a;for(n=0;2>n;n++)for(s=0<n?e.oa:e.c,r=0;r<s.length;r++)a=s[r],t[a]=e[a],i||t[a]||(t["!"+a]=1)},e.cb=function(e){var t,i,n,s,r,a,o=0,l="",c="";if(e&&255<e.length&&(t=""+e,0<(i=t.indexOf("?"))&&(a=t.substring(i+1),t=t.substring(0,i),s=t.toLowerCase(),n=0,"http://"==s.substring(0,7)?n+=7:"https://"==s.substring(0,8)&&(n+=8),0<(i=s.indexOf("/",n))&&(s=s.substring(n,i),r=t.substring(i),t=t.substring(0,i),0<=s.indexOf("google")?o=",q,ie,start,search_key,word,kw,cd,":0<=s.indexOf("yahoo.co")&&(o=",p,ei,"),o&&a)))){if((e=a.split("&"))&&1<e.length){for(n=0;n<e.length;n++)s=e[n],i=s.indexOf("="),0<i&&0<=o.indexOf(","+s.substring(0,i)+",")?l+=(l?"&":"")+s:c+=(c?"&":"")+s;l&&c?a=l+"&"+c:c=""}i=253-(a.length-c.length)-t.length,e=t+(0<i?r.substring(0,i):"")+"?"+a}return e},e.Ma=function(t){var i=e.d.visibilityState,n=["webkitvisibilitychange","visibilitychange"];if(i||(i=e.d.webkitVisibilityState),i&&"prerender"==i){if(t)for(i=0;i<n.length;i++)e.d.addEventListener(n[i],function(){var i=e.d.visibilityState;i||(i=e.d.webkitVisibilityState),"visible"==i&&t()});return!1}return!0},e.Y=!1,e.D=!1,e.Ta=function(){e.D=!0,e.i()},e.W=!1,e.Q=!1,e.Qa=function(t){e.marketingCloudVisitorID=t,e.Q=!0,e.i()},e.T=!1,e.N=!1,e.Ia=function(t){e.analyticsVisitorID=t,e.N=!0,e.i()},e.V=!1,e.P=!1,e.Ka=function(t){e.audienceManagerLocationHint=t,e.P=!0,e.i()},e.U=!1,e.O=!1,e.Ja=function(t){e.audienceManagerBlob=t,e.O=!0,e.i()},e.La=function(t){return e.maxDelay||(e.maxDelay=250),!e.l("_d")||(t&&setTimeout(function(){t()},e.maxDelay),!1)},e.X=!1,e.C=!1,e.na=function(){e.C=!0,e.i()},e.isReadyToTrack=function(){var t=!0,i=e.visitor;return e.Y||e.D||(e.Ma(e.Ta)?e.D=!0:e.Y=!0),!(e.Y&&!e.D)&&(i&&i.isAllowed()&&(e.W||e.marketingCloudVisitorID||!i.getMarketingCloudVisitorID||(e.W=!0,e.marketingCloudVisitorID=i.getMarketingCloudVisitorID([e,e.Qa]),e.marketingCloudVisitorID&&(e.Q=!0)),e.T||e.analyticsVisitorID||!i.getAnalyticsVisitorID||(e.T=!0,e.analyticsVisitorID=i.getAnalyticsVisitorID([e,e.Ia]),e.analyticsVisitorID&&(e.N=!0)),e.V||e.audienceManagerLocationHint||!i.getAudienceManagerLocationHint||(e.V=!0,e.audienceManagerLocationHint=i.getAudienceManagerLocationHint([e,e.Ka]),e.audienceManagerLocationHint&&(e.P=!0)),e.U||e.audienceManagerBlob||!i.getAudienceManagerBlob||(e.U=!0,e.audienceManagerBlob=i.getAudienceManagerBlob([e,e.Ja]),e.audienceManagerBlob&&(e.O=!0)),e.W&&!e.Q&&!e.marketingCloudVisitorID||e.T&&!e.N&&!e.analyticsVisitorID||e.V&&!e.P&&!e.audienceManagerLocationHint||e.U&&!e.O&&!e.audienceManagerBlob)&&(t=!1),e.X||e.C||(e.La(e.na)?e.C=!0:e.X=!0),e.X&&!e.C&&(t=!1),t)},e.k=i,e.o=0,e.callbackWhenReadyToTrack=function(t,n,s){var r;r={},r.Xa=t,r.Wa=n,r.Ua=s,e.k==i&&(e.k=[]),e.k.push(r),0==e.o&&(e.o=setInterval(e.i,100))},e.i=function(){var t;if(e.isReadyToTrack()&&(e.o&&(clearInterval(e.o),e.o=0),e.k!=i))for(;0<e.k.length;)t=e.k.shift(),t.Wa.apply(t.Xa,t.Ua)},e.Oa=function(t){var n,s,r=i,a=i;if(!e.isReadyToTrack()){if(n=[],t!=i)for(s in r={},t)r[s]=t[s];return a={},e.Ga(a,!0),n.push(r),n.push(a),e.callbackWhenReadyToTrack(e,e.track,n),!0}return!1},e.gb=function(){var t,i=e.cookieRead("s_fid"),n="",s="";t=8;var r=4;if(!i||0>i.indexOf("-")){for(i=0;16>i;i++)t=Math.floor(Math.random()*t),n+="0123456789ABCDEF".substring(t,t+1),t=Math.floor(Math.random()*r),s+="0123456789ABCDEF".substring(t,t+1),t=r=16;i=n+"-"+s}return e.cookieWrite("s_fid",i,1)||(i=0),i},e.t=e.track=function(i,n){var s,a=new Date,o="s"+Math.floor(a.getTime()/108e5)%10+Math.floor(1e13*Math.random()),l=a.getYear(),l="t="+e.escape(a.getDate()+"/"+a.getMonth()+"/"+(1900>l?l+1900:l)+" "+a.getHours()+":"+a.getMinutes()+":"+a.getSeconds()+" "+a.getDay()+" "+a.getTimezoneOffset());e.visitor&&(e.visitor.eb&&(e.authState=e.visitor.eb()),!e.supplementalDataID&&e.visitor.getSupplementalDataID&&(e.supplementalDataID=e.visitor.getSupplementalDataID("AppMeasurement:"+e._in,!e.expectSupplementalData))),e.l("_s"),e.Oa(i)||(n&&e.M(n),i&&(s={},e.Ga(s,0),e.M(i)),e.mb()&&(e.analyticsVisitorID||e.marketingCloudVisitorID||(e.fid=e.gb()),e.rb(),e.usePlugins&&e.doPlugins&&e.doPlugins(e),e.account&&(e.abort||(e.trackOffline&&!e.timestamp&&(e.timestamp=Math.floor(a.getTime()/1e3)),a=t.location,e.pageURL||(e.pageURL=a.href?a.href:a),e.referrer||e.Ha||(e.referrer=r.document.referrer),e.Ha=1,e.referrer=e.cb(e.referrer),e.l("_g")),e.ib()&&!e.abort&&(e.jb(),l+=e.hb(),e.qb(o,l),e.l("_t"),e.referrer=""))),i&&e.M(s,1)),e.abort=e.supplementalDataID=e.timestamp=e.pageURLRest=e.linkObject=e.clickObject=e.linkURL=e.linkName=e.linkType=t.s_objectID=e.pe=e.pev1=e.pev2=e.pev3=e.e=e.lightProfileID=0},e.tl=e.trackLink=function(t,i,n,s,r){return e.linkObject=t,e.linkType=i,e.linkName=n,r&&(e.j=t,e.q=r),e.track(s)},e.trackLight=function(t,i,n,s){return e.lightProfileID=t,e.lightStoreForSeconds=i,e.lightIncrementBy=n,e.track(s)},e.clearVars=function(){var t,i;for(t=0;t<e.c.length;t++)i=e.c[t],("prop"==i.substring(0,4)||"eVar"==i.substring(0,4)||"hier"==i.substring(0,4)||"list"==i.substring(0,4)||"channel"==i||"events"==i||"eventList"==i||"products"==i||"productList"==i||"purchaseID"==i||"transactionID"==i||"state"==i||"zip"==i||"campaign"==i)&&(e[i]=void 0)},e.tagContainerMarker="",e.qb=function(t,i){var n,s=e.trackingServer;n="";var r=e.dc,a="sc.",o=e.visitorNamespace;s?e.trackingServerSecure&&e.ssl&&(s=e.trackingServerSecure):(o||(o=e.account,s=o.indexOf(","),0<=s&&(o=o.substring(0,s)),o=o.replace(/[^A-Za-z0-9]/g,"")),n||(n="2o7.net"),r=r?(""+r).toLowerCase():"d1","2o7.net"==n&&("d1"==r?r="112":"d2"==r&&(r="122"),a=""),s=o+"."+r+"."+a+n),n=e.ssl?"https://":"http://",r=e.AudienceManagement&&e.AudienceManagement.isReady(),n+=s+"/b/ss/"+e.account+"/"+(e.mobile?"5.":"")+(r?"10":"1")+"/JS-"+e.version+(e.vb?"T":"")+(e.tagContainerMarker?"-"+e.tagContainerMarker:"")+"/"+t+"?AQB=1&ndh=1&pf=1&"+(r?"callback=s_c_il["+e._in+"].AudienceManagement.passData&":"")+i+"&AQE=1",e.ab(n),e.da()},e.ab=function(t){e.g||e.kb(),e.g.push(t),e.fa=e.r(),e.Fa()},e.kb=function(){e.g=e.nb(),e.g||(e.g=[])},e.nb=function(){var i,n;if(e.ka()){try{(n=t.localStorage.getItem(e.ia()))&&(i=t.JSON.parse(n))}catch(e){}return i}},e.ka=function(){var i=!0;return e.trackOffline&&e.offlineFilename&&t.localStorage&&t.JSON||(i=!1),i},e.wa=function(){var t=0;return e.g&&(t=e.g.length),e.v&&t++,t},e.da=function(){if(!e.v)if(e.xa=i,e.ja)e.fa>e.J&&e.Da(e.g),e.ma(500);else{var t=e.Va();0<t?e.ma(t):(t=e.ua())&&(e.v=1,e.pb(t),e.tb(t))}},e.ma=function(t){e.xa||(t||(t=0),e.xa=setTimeout(e.da,t))},e.Va=function(){var t;return!e.trackOffline||0>=e.offlineThrottleDelay?0:(t=e.r()-e.Ca,e.offlineThrottleDelay<t?0:e.offlineThrottleDelay-t)},e.ua=function(){if(0<e.g.length)return e.g.shift()},e.pb=function(t){if(e.debugTracking){var i="AppMeasurement Debug: "+t;t=t.split("&");var n;for(n=0;n<t.length;n++)i+="\n\t"+e.unescape(t[n]);e.ob(i)}},e.Pa=function(){return e.marketingCloudVisitorID||e.analyticsVisitorID},e.S=!1;var a;try{a=JSON.parse('{"x":"y"}')}catch(e){a=null}a&&"y"==a.x?(e.S=!0,e.R=function(e){return JSON.parse(e)}):t.$&&t.$.parseJSON?(e.R=function(e){return t.$.parseJSON(e)},e.S=!0):e.R=function(){return null},e.tb=function(i){var n,s,r;if(e.Pa()&&2047<i.length&&("undefined"!=typeof XMLHttpRequest&&(n=new XMLHttpRequest,"withCredentials"in n?s=1:n=0),n||"undefined"==typeof XDomainRequest||(n=new XDomainRequest,s=2),n&&e.AudienceManagement&&e.AudienceManagement.isReady()&&(e.S?n.pa=!0:n=0)),!n&&e.lb&&(i=i.substring(0,2047)),!n&&e.d.createElement&&e.AudienceManagement&&e.AudienceManagement.isReady()&&(n=e.d.createElement("SCRIPT"))&&"async"in n&&((r=(r=e.d.getElementsByTagName("HEAD"))&&r[0]?r[0]:e.d.body)?(n.type="text/javascript",n.setAttribute("async","async"),s=3):n=0),n||(n=new Image,n.alt=""),n.ra=function(){try{e.la&&(clearTimeout(e.la),e.la=0),n.timeout&&(clearTimeout(n.timeout),n.timeout=0)}catch(e){}},n.onload=n.ub=function(){if(n.ra(),e.$a(),e.Z(),e.v=0,e.da(),n.pa){n.pa=!1;try{var t=e.R(n.responseText);AudienceManagement.passData(t)}catch(e){}}},n.onabort=n.onerror=n.bb=function(){n.ra(),(e.trackOffline||e.ja)&&e.v&&e.g.unshift(e.Za),e.v=0,e.fa>e.J&&e.Da(e.g),e.Z(),e.ma(500)},n.onreadystatechange=function(){4==n.readyState&&(200==n.status?n.ub():n.bb())},e.Ca=e.r(),1==s||2==s){var a=i.indexOf("?");r=i.substring(0,a),a=i.substring(a+1),a=a.replace(/&callback=[a-zA-Z0-9_.\[\]]+/,""),1==s?(n.open("POST",r,!0),n.send(a)):2==s&&(n.open("POST",r),n.send(a))}else if(n.src=i,3==s){if(e.Aa)try{r.removeChild(e.Aa)}catch(e){}r.firstChild?r.insertBefore(n,r.firstChild):r.appendChild(n),e.Aa=e.Ya}n.abort&&(e.la=setTimeout(n.abort,5e3)),e.Za=i,e.Ya=t["s_i_"+e.replace(e.account,",","_")]=n,(e.useForcedLinkTracking&&e.F||e.q)&&(e.forcedLinkTrackingTimeout||(e.forcedLinkTrackingTimeout=250),e.aa=setTimeout(e.Z,e.forcedLinkTrackingTimeout))},e.$a=function(){if(e.ka()&&!(e.Ba>e.J))try{t.localStorage.removeItem(e.ia()),e.Ba=e.r()}catch(e){}},e.Da=function(i){if(e.ka()){e.Fa();try{t.localStorage.setItem(e.ia(),t.JSON.stringify(i)),e.J=e.r()}catch(e){}}},e.Fa=function(){if(e.trackOffline)for((!e.offlineLimit||0>=e.offlineLimit)&&(e.offlineLimit=10);e.g.length>e.offlineLimit;)e.ua()},e.forceOffline=function(){e.ja=!0},e.forceOnline=function(){e.ja=!1},e.ia=function(){return e.offlineFilename+"-"+e.visitorNamespace+e.account},e.r=function(){return(new Date).getTime()},e.ya=function(e){return e=e.toLowerCase(),0!=e.indexOf("#")&&0!=e.indexOf("about:")&&0!=e.indexOf("opera:")&&0!=e.indexOf("javascript:")},e.setTagContainer=function(t){var i,n,s;for(e.vb=t,i=0;i<e._il.length;i++)if((n=e._il[i])&&"s_l"==n._c&&n.tagContainerName==t){if(e.M(n),n.lmq)for(i=0;i<n.lmq.length;i++)s=n.lmq[i],e.loadModule(s.n);if(n.ml)for(s in n.ml)if(e[s])for(i in t=e[s],s=n.ml[s])!Object.prototype[i]&&("function"!=typeof s[i]||0>(""+s[i]).indexOf("s_c_il"))&&(t[i]=s[i]);if(n.mmq)for(i=0;i<n.mmq.length;i++)s=n.mmq[i],e[s.m]&&(t=e[s.m],t[s.f]&&"function"==typeof t[s.f]&&(s.a?t[s.f].apply(t,s.a):t[s.f].apply(t)));if(n.tq)for(i=0;i<n.tq.length;i++)e.track(n.tq[i]);n.s=e;break}},e.Util={urlEncode:e.escape,urlDecode:e.unescape,cookieRead:e.cookieRead,cookieWrite:e.cookieWrite,getQueryParam:function(i,n,s){var r;return n||(n=e.pageURL?e.pageURL:t.location),s||(s="&"),i&&n&&(n=""+n,0<=(r=n.indexOf("?"))&&(n=s+n.substring(r+1)+s,0<=(r=n.indexOf(s+i+"="))&&(n=n.substring(r+s.length+i.length+1),r=n.indexOf(s),0<=r&&(n=n.substring(0,r)),0<n.length)))?e.unescape(n):""}},e.A="supplementalDataID timestamp dynamicVariablePrefix visitorID marketingCloudVisitorID analyticsVisitorID audienceManagerLocationHint authState fid vmk visitorMigrationKey visitorMigrationServer visitorMigrationServerSecure charSet visitorNamespace cookieDomainPeriods fpCookieDomainPeriods cookieLifetime pageName pageURL referrer contextData currencyCode lightProfileID lightStoreForSeconds lightIncrementBy retrieveLightProfiles deleteLightProfiles retrieveLightData pe pev1 pev2 pev3 pageURLRest".split(" "),e.c=e.A.concat("purchaseID variableProvider channel server pageType transactionID campaign state zip events events2 products audienceManagerBlob tnt".split(" ")),e.ga="timestamp charSet visitorNamespace cookieDomainPeriods cookieLifetime contextData lightProfileID lightStoreForSeconds lightIncrementBy".split(" "),e.K=e.ga.slice(0),e.oa="account allAccounts debugTracking visitor trackOffline offlineLimit offlineThrottleDelay offlineFilename usePlugins doPlugins configURL visitorSampling visitorSamplingGroup linkObject clickObject linkURL linkName linkType trackDownloadLinks trackExternalLinks trackClickMap trackInlineStats linkLeaveQueryString linkTrackVars linkTrackEvents linkDownloadFileTypes linkExternalFilters linkInternalFilters useForcedLinkTracking forcedLinkTrackingTimeout trackingServer trackingServerSecure ssl abort mobile dc lightTrackVars maxDelay expectSupplementalData AudienceManagement".split(" ");for(n=0;250>=n;n++)76>n&&(e.c.push("prop"+n),e.K.push("prop"+n)),e.c.push("eVar"+n),e.K.push("eVar"+n),6>n&&e.c.push("hier"+n),4>n&&e.c.push("list"+n);n="latitude longitude resolution colorDepth javascriptVersion javaEnabled cookiesEnabled browserWidth browserHeight connectionType homepage".split(" "),e.c=e.c.concat(n),e.A=e.A.concat(n),e.ssl=0<=t.location.protocol.toLowerCase().indexOf("https"),e.charSet="UTF-8",e.contextData={},e.offlineThrottleDelay=0,e.offlineFilename="AppMeasurement.offline",e.Ca=0,e.fa=0,e.J=0,e.Ba=0,e.linkDownloadFileTypes="exe,zip,wav,mp3,mov,mpg,avi,wmv,pdf,doc,docx,xls,xlsx,ppt,pptx",e.w=t,e.d=t.document;try{e.lb="Microsoft Internet Explorer"==navigator.appName}catch(e){}e.Z=function(){e.aa&&(t.clearTimeout(e.aa),e.aa=i),e.j&&e.F&&e.j.dispatchEvent(e.F),e.q&&("function"==typeof e.q?e.q():e.j&&e.j.href&&(e.d.location=e.j.href)),e.j=e.F=e.q=0},e.Ea=function(){e.b=e.d.body,e.b?(e.p=function(i){var n,s,r,a,o;if(!(e.d&&e.d.getElementById("cppXYctnr")||i&&i["s_fe_"+e._in])){if(e.qa){if(!e.useForcedLinkTracking)return e.b.removeEventListener("click",e.p,!0),void(e.qa=e.useForcedLinkTracking=0);e.b.removeEventListener("click",e.p,!1)}else e.useForcedLinkTracking=0;e.clickObject=i.srcElement?i.srcElement:i.target;try{if(!e.clickObject||e.I&&e.I==e.clickObject||!(e.clickObject.tagName||e.clickObject.parentElement||e.clickObject.parentNode))e.clickObject=0;else{var l=e.I=e.clickObject;if(e.ea&&(clearTimeout(e.ea),e.ea=0),e.ea=setTimeout(function(){e.I==l&&(e.I=0)},1e4),r=e.wa(),e.track(),r<e.wa()&&e.useForcedLinkTracking&&i.target){for(a=i.target;a&&a!=e.b&&"A"!=a.tagName.toUpperCase()&&"AREA"!=a.tagName.toUpperCase();)a=a.parentNode;if(a&&(o=a.href,e.ya(o)||(o=0),s=a.target,i.target.dispatchEvent&&o&&(!s||"_self"==s||"_top"==s||"_parent"==s||t.name&&s==t.name))){try{n=e.d.createEvent("MouseEvents")}catch(e){n=new t.MouseEvent}if(n){try{n.initMouseEvent("click",i.bubbles,i.cancelable,i.view,i.detail,i.screenX,i.screenY,i.clientX,i.clientY,i.ctrlKey,i.altKey,i.shiftKey,i.metaKey,i.button,i.relatedTarget)}catch(e){n=0}n&&(n["s_fe_"+e._in]=n.s_fe=1,i.stopPropagation(),i.stopImmediatePropagation&&i.stopImmediatePropagation(),i.preventDefault(),e.j=i.target,e.F=n)}}}}}catch(t){e.clickObject=0}}},e.b&&e.b.attachEvent?e.b.attachEvent("onclick",e.p):e.b&&e.b.addEventListener&&(navigator&&(0<=navigator.userAgent.indexOf("WebKit")&&e.d.createEvent||0<=navigator.userAgent.indexOf("Firefox/2")&&t.MouseEvent)&&(e.qa=1,e.useForcedLinkTracking=1,e.b.addEventListener("click",e.p,!0)),e.b.addEventListener("click",e.p,!1))):setTimeout(e.Ea,30),e.Media=e.Integrate=void 0,e.loadModule("Media",e.Media),e.loadModule("Integrate",e.Integrate)},e.Ea()}function s_gi(e){var t,i,n,s,r,a=window.s_c_il,o=e.split(","),l=0;if(a)for(i=0;!l&&i<a.length;){if(t=a[i],"s_c"==t._c&&(t.account||t.oun))if(t.account&&t.account==e)l=1;else for(n=t.account?t.account:t.oun,n=t.allAccounts?t.allAccounts:n.split(","),s=0;s<o.length;s++)for(r=0;r<n.length;r++)o[s]==n[r]&&(l=1);i++}return l||(t=new AppMeasurement),t.setAccount?t.setAccount(e):t.sa&&t.sa(e),t}function s_pgicq(){var e,t,i,n=window,s=n.s_giq;if(s)for(e=0;e<s.length;e++)t=s[e],i=s_gi(t.oun),i.setAccount(t.un),i.setTagContainer(t.tagContainerName);n.s_giq=0}function AppMeasurement_Module_Media(e){var t=this;t.s=e,e=window,e.s_c_in||(e.s_c_il=[],e.s_c_in=0),t._il=e.s_c_il,t._in=e.s_c_in,t._il[t._in]=t,e.s_c_in++,t._c="s_m",t.list=[],t.open=function(e,i,n,s){var r,a={},o=new Date,l="";if(i||(i=-1),e&&n){if(t.list||(t.list={}),t.list[e]&&t.close(e),s&&s.id&&(l=s.id),l)for(r in t.list)!Object.prototype[r]&&t.list[r]&&t.list[r].R==l&&t.close(t.list[r].name);a.name=e,a.length=i,a.offset=0,a.e=0,a.playerName=t.playerName?t.playerName:n,a.R=l,a.C=0,a.a=0,a.timestamp=Math.floor(o.getTime()/1e3),a.k=0,a.u=a.timestamp,a.c=-1,a.n="",a.g=-1,a.D=0,a.I={},a.G=0,a.m=0,a.f="",a.B=0,a.L=0,a.A=0,a.F=0,a.l=!1,a.v="",a.J="",a.K=0,a.r=!1,a.H="",a.complete=0,a.Q=0,a.p=0,a.q=0,t.list[e]=a}},t.openAd=function(e,i,n,s,r,a,o,l){var c={};t.open(e,i,n,l),(c=t.list[e])&&(c.l=!0,c.v=s,c.J=r,c.K=a,c.H=o)},t.M=function(e){var i=t.list[e];t.list[e]=0,i&&i.monitor&&clearTimeout(i.monitor.interval)},t.close=function(e){t.i(e,0,-1)},t.play=function(e,i,n,s){var r=t.i(e,1,i,n,s);r&&!r.monitor&&(r.monitor={},r.monitor.update=function(){1==r.k&&t.i(r.name,3,-1),r.monitor.interval=setTimeout(r.monitor.update,1e3)},r.monitor.update())},t.click=function(e,i){t.i(e,7,i)},t.complete=function(e,i){t.i(e,5,i)},t.stop=function(e,i){t.i(e,2,i)},t.track=function(e){t.i(e,4,-1)},t.P=function(e,i){var n,s,r="a.media.",a=e.linkTrackVars,o=e.linkTrackEvents,l="m_i",c=e.contextData;if(i.l&&(r+="ad.",i.v&&(c["a.media.name"]=i.v,c[r+"pod"]=i.J,c[r+"podPosition"]=i.K),i.G||(c[r+"CPM"]=i.H)),i.r&&(c[r+"clicked"]=!0,i.r=!1),c["a.contentType"]="video"+(i.l?"Ad":""),c["a.media.channel"]=t.channel,c[r+"name"]=i.name,c[r+"playerName"]=i.playerName,0<i.length&&(c[r+"length"]=i.length),c[r+"timePlayed"]=Math.floor(i.a),0<Math.floor(i.a)&&(c[r+"timePlayed"]=Math.floor(i.a)),i.G||(c[r+"view"]=!0,l="m_s",t.Heartbeat&&t.Heartbeat.enabled&&(l=i.l?t.__primetime?"mspa_s":"msa_s":t.__primetime?"msp_s":"ms_s"),i.G=1),i.f&&(c[r+"segmentNum"]=i.m,c[r+"segment"]=i.f,0<i.B&&(c[r+"segmentLength"]=i.B),i.A&&0<i.a&&(c[r+"segmentView"]=!0)),!i.Q&&i.complete&&(c[r+"complete"]=!0,i.S=1),0<i.p&&(c[r+"milestone"]=i.p),0<i.q&&(c[r+"offsetMilestone"]=i.q),a)for(s in c)Object.prototype[s]||(a+=",contextData."+s);n=c["a.contentType"],e.pe=l,e.pev3=n;var d,u;if(t.contextDataMapping)for(s in e.events2||(e.events2=""),a&&(a+=",events"),t.contextDataMapping)if(!Object.prototype[s]){if(l=s.length>r.length&&s.substring(0,r.length)==r?s.substring(r.length):"","string"==typeof(n=t.contextDataMapping[s]))for(d=n.split(","),u=0;u<d.length;u++)n=d[u],"a.contentType"==s?(a&&(a+=","+n),e[n]=c[s]):"view"==l||"segmentView"==l||"clicked"==l||"complete"==l||"timePlayed"==l||"CPM"==l?(o&&(o+=","+n),"timePlayed"==l||"CPM"==l?c[s]&&(e.events2+=(e.events2?",":"")+n+"="+c[s]):c[s]&&(e.events2+=(e.events2?",":"")+n)):"segment"==l&&c[s+"Num"]?(a&&(a+=","+n),e[n]=c[s+"Num"]+":"+c[s]):(a&&(a+=","+n),e[n]=c[s]);else"milestones"!=l&&"offsetMilestones"!=l||(s=s.substring(0,s.length-1),c[s]&&t.contextDataMapping[s+"s"][c[s]]&&(o&&(o+=","+t.contextDataMapping[s+"s"][c[s]]),e.events2+=(e.events2?",":"")+t.contextDataMapping[s+"s"][c[s]]));c[s]&&(c[s]=0),"segment"==l&&c[s+"Num"]&&(c[s+"Num"]=0)}e.linkTrackVars=a,e.linkTrackEvents=o},t.i=function(e,i,n,s,r){var a,o,l,c,d,u={},h=(new Date).getTime()/1e3,_=t.trackVars,g=t.trackEvents,f=t.trackSeconds,p=t.trackMilestones,m=t.trackOffsetMilestones,v=t.segmentByMilestones,b=t.segmentByOffsetMilestones,S=1,y={};if(t.channel||(t.channel=t.s.w.location.hostname),(u=e&&t.list&&t.list[e]?t.list[e]:0)&&(u.l&&(f=t.adTrackSeconds,p=t.adTrackMilestones,m=t.adTrackOffsetMilestones,v=t.adSegmentByMilestones,b=t.adSegmentByOffsetMilestones),0>n&&(n=1==u.k&&0<u.u?h-u.u+u.c:u.c),0<u.length&&(n=n<u.length?n:u.length),0>n&&(n=0),u.offset=n,0<u.length&&(u.e=u.offset/u.length*100,u.e=100<u.e?100:u.e),
0>u.c&&(u.c=n),d=u.D,y.name=e,y.ad=u.l,y.length=u.length,y.openTime=new Date,y.openTime.setTime(1e3*u.timestamp),y.offset=u.offset,y.percent=u.e,y.playerName=u.playerName,y.mediaEvent=0>u.g?"OPEN":1==i?"PLAY":2==i?"STOP":3==i?"MONITOR":4==i?"TRACK":5==i?"COMPLETE":7==i?"CLICK":"CLOSE",2<i||i!=u.k&&(2!=i||1==u.k))){if(r||(s=u.m,r=u.f),i){if(1==i&&(u.c=n),(3>=i||5<=i)&&0<=u.g&&(S=!1,_=g="None",u.g!=n)){if(o=u.g,o>n&&(o=u.c)>n&&(o=n),l=p?p.split(","):0,0<u.length&&l&&n>=o)for(c=0;c<l.length;c++)(a=l[c]?parseFloat(""+l[c]):0)&&o/u.length*100<a&&u.e>=a&&(S=!0,c=l.length,y.mediaEvent="MILESTONE",u.p=y.milestone=a);if((l=m?m.split(","):0)&&n>=o)for(c=0;c<l.length;c++)(a=l[c]?parseFloat(""+l[c]):0)&&o<a&&n>=a&&(S=!0,c=l.length,y.mediaEvent="OFFSET_MILESTONE",u.q=y.offsetMilestone=a)}if(u.L||!r){if(v&&p&&0<u.length){if(l=p.split(","))for(l.push("100"),c=o=0;c<l.length;c++)(a=l[c]?parseFloat(""+l[c]):0)&&(u.e<a&&(s=c+1,r="M:"+o+"-"+a,c=l.length),o=a)}else if(b&&m&&(l=m.split(",")))for(l.push(""+(0<u.length?u.length:"E")),c=o=0;c<l.length;c++)((a=l[c]?parseFloat(""+l[c]):0)||"E"==l[c])&&((n<a||"E"==l[c])&&(s=c+1,r="O:"+o+"-"+a,c=l.length),o=a);r&&(u.L=!0)}(r||u.f)&&r!=u.f&&(u.F=!0,u.f||(u.m=s,u.f=r),0<=u.g&&(S=!0)),(2<=i||100<=u.e)&&u.c<n&&(u.C+=n-u.c,u.a+=n-u.c),(2>=i||3==i&&!u.k)&&(u.n+=(1==i||3==i?"S":"E")+Math.floor(n),u.k=3==i?1:i),!S&&0<=u.g&&3>=i&&(f=f||0)&&u.a>=f&&(S=!0,y.mediaEvent="SECONDS"),u.u=h,u.c=n}(!i||3>=i&&100<=u.e)&&(2!=u.k&&(u.n+="E"+Math.floor(n)),i=0,_=g="None",y.mediaEvent="CLOSE"),7==i&&(S=y.clicked=u.r=!0),(5==i||t.completeByCloseOffset&&(!i||100<=u.e)&&0<u.length&&n>=u.length-t.completeCloseOffsetThreshold)&&(S=y.complete=u.complete=!0),h=y.mediaEvent,"MILESTONE"==h?h+="_"+y.milestone:"OFFSET_MILESTONE"==h&&(h+="_"+y.offsetMilestone),u.I[h]?y.eventFirstTime=!1:(y.eventFirstTime=!0,u.I[h]=1),y.event=y.mediaEvent,y.timePlayed=u.C,y.segmentNum=u.m,y.segment=u.f,y.segmentLength=u.B,t.monitor&&4!=i&&t.monitor(t.s,y),t.Heartbeat&&t.Heartbeat.enabled&&0<=u.g&&(S=!1),0==i&&t.M(e),S&&u.D==d&&(e={contextData:{}},e.linkTrackVars=_,e.linkTrackEvents=g,e.linkTrackVars||(e.linkTrackVars=""),e.linkTrackEvents||(e.linkTrackEvents=""),t.P(e,u),e.linkTrackVars||(e["!linkTrackVars"]=1),e.linkTrackEvents||(e["!linkTrackEvents"]=1),t.s.track(e),u.F?(u.m=s,u.f=r,u.A=!0,u.F=!1):0<u.a&&(u.A=!1),u.n="",u.p=u.q=0,u.a-=Math.floor(u.a),u.g=n,u.D++)}return u},t.O=function(e,i,n,s,r){var a=0;e&&(!t.autoTrackMediaLengthRequired||i&&0<i)&&(t.list&&t.list[e]?a=1:1!=n&&3!=n||(t.open(e,i,"HTML5 Video",r),a=1),a&&t.i(e,n,s,-1,0))},t.attach=function(e){var i,n,s;e&&e.tagName&&"VIDEO"==e.tagName.toUpperCase()&&(t.o||(t.o=function(e,i,n){var s,r;t.autoTrack&&(s=e.currentSrc,(r=e.duration)||(r=-1),0>n&&(n=e.currentTime),t.O(s,r,i,n,e))}),i=function(){t.o(e,1,-1)},n=function(){t.o(e,1,-1)},t.j(e,"play",i),t.j(e,"pause",n),t.j(e,"seeking",n),t.j(e,"seeked",i),t.j(e,"ended",function(){t.o(e,0,-1)}),t.j(e,"timeupdate",i),(s=function(){e.paused||e.ended||e.seeking||t.o(e,3,-1),setTimeout(s,1e3)})())},t.j=function(e,t,i){e.attachEvent?e.attachEvent("on"+t,i):e.addEventListener&&e.addEventListener(t,i,!1)},void 0==t.completeByCloseOffset&&(t.completeByCloseOffset=1),void 0==t.completeCloseOffsetThreshold&&(t.completeCloseOffsetThreshold=1),t.Heartbeat={},t.N=function(){var e,i;if(t.autoTrack&&(e=t.s.d.getElementsByTagName("VIDEO")))for(i=0;i<e.length;i++)t.attach(e[i])},t.j(e,"load",t.N)}!function(e){"use strict";function t(e){var t;if(e=e||{},c(ye,e,!0),Ee=e.baseUrl||Ee,n(Ee,"/")||(Ee+="/"),e.paths){c(ke,e.paths,!0),Ce=[];for(t in ke)Ce.push(t);Ce.sort().reverse()}Te=1e3*(e.waitSeconds||10)}function i(e,t){return 0===e.indexOf(t)}function n(e,t){return-1!==e.indexOf(t,e.length-t.length)}function s(e,t){return a(e)?-1!==e.indexOf(t):me.call(e,t)}function r(e){return"[object Function]"===ve.call(e)}function a(e){return"[object Array]"===ve.call(e)}function o(e){return"[object Object]"===ve.call(e)}function l(e){return"string"==typeof e}function c(e,t,i){if(o(e)&&o(t)){var n;for(n in t)o(t[n])?e[n]=c(e[n]||{},t[n],i):!i&&s(e,n)||(e[n]=t[n]);return e}}function d(e){var t,n,s="";for(n in ke)i(e,ke[n])&&ke[n].length>s.length&&(t=n,s=ke[n]);return""!==s&&(e=e.replace(s,t)),e}function u(e){var t,i,n=e.length;for(t=0;t<n;t++)if("."===(i=e[t]))e.splice(t,1),t-=1;else if(".."===i){if(1===t&&(".."===e[2]||".."===e[0]))break;t>0&&(e.splice(t-1,2),t-=2)}}function h(e){var t,i,n,s=[];for(n in oe)if(oe.hasOwnProperty(n)){if(f(n))continue;for(t=oe[n].dependencies,i=t.length;i--;)if(t[i]===e){s.push(oe[n]);break}}return s}function _(){return re+ne++}function g(){return ae+se++}function f(e){return 0===e.indexOf(re)}function p(e){return e===ee||e===te||e===ie}function m(e,t,i){var n;if(t===ee)n=f(e)?j:$[e];else if(t===te)n=W(e);else{if(t!==ie)return!1;n={id:e}}return i.depModules[i.dependencies.indexOf(t)]=n,!0}function v(e){return(new Date).getTime()>e.timeLimit}function b(e){var t,i,n,a=oe[e];if(oe[e]&&(t=a.dependencies,!s(X,e))){if(v(a)){if(r(a.onFailure))return void a.onFailure(new Error("Required dependencies cannot be loaded for module "+e+" wait timeout reached!"));var o=[];for(i=t.length;i--;)n=t[i],he.test(n)||"complete"!==q[n]||s(X,n)?he.test(n)&&"complete"!==q[n]&&o.push(n):o.push(n);throw new Error("Required dependencies cannot be loaded for module "+e+" wait timeout reached! Possibliy one of the following: "+o.join(","))}var l=function(){setTimeout(function(){b(e)},ue)};for(i=t.length;i--;){if(n=t[i],"error"===q[n])return void delete oe[e];if(he.test(n)){if("complete"!==q[n])return void l()}else{if(!s(X,n)){if(m(e,n,a))continue;return void l()}if(void 0===a.depModules[i]){if(n.indexOf("!")>=0)return void l();a.depModules[i]=X[n]}}}a.onSuccess(a.depModules),y(e)}}function S(e){q[e]="complete",y(e)}function y(e){if(!he.test(e)){var t,i,n,s,r,a=h(e),o=a.length;for(e=d(e);o--;)if(t=a[o],t.started){for(i=t.dependencies,s=i.length,r=!0;s--;)if(n=i[s],!he.test(n)&&"complete"!==q[n]){r=!1;break}r&&b(t.moduleId)}}}function E(e){if(!s(Q,e)){var t=!1,i=Q.length-1;if(i>=0&&f(Q[i])){var n=Q[i],r=oe[n];r&&(oe[e]=r,r.moduleId=e,Q.pop(),Q.push(e),r.base=e,t=!0)}t||(X[e]={})}S(e)}function k(e,t,i,n){var s,a,o,l,c;for(s="Error loading module or script '"+e+'": '+t+", at line:"+n+" URL:"+i,"undefined"!=typeof console&&console.error(s),a=d(e),q[a]="error",o=h(a),c=o.length;c--;)l=o[c],r(l.onFailure)&&l.onFailure(new Error("Required dependencies cannot be loaded for module "+a+" wait timeout reached!"))}function C(e){var t=T(e);if(ce)try{importScripts(t),E(e)}catch(t){var i=t.stack.match(/(http:|https:).+\.\w+/gi),n=t.stack.match(/\d+:\d+/g);k(e,t.message,i[i.length-1],n[n.length-1])}else{var s=document.createElement("script");s.type="text/javascript",s.charset="utf-8",s.async=!0,s.onreadystatechange=s.onload=function(){s.readyState&&!fe.test(s.readyState)||(s.onload=s.onreadystatechange=null,s.onerror=null,E(e))},s.onerror=function(t,i,n){s.onload=s.onreadystatechange=null,s.onerror=null,k(e,t,i,n)},s.src=t,de.appendChild(s)}}function T(e){return he.test(e)?e:x(e)+".js"}function x(e){if(_e.test(e))return e;var t,n,s=e;for(t in Ce)if(n=Ce[t],i(s,n)){s=s.replace(n,ke[n]);break}return ge.test(s)||_e.test(s)||(s=Ee+s),s}function I(e){var t,i="",n=e;return t=e.indexOf("!"),t>-1&&(i=e.substring(0,t),n=e.substring(t+1,e.length)),{plugin:i,moduleId:n}}function w(e){return z[e]}function L(e,t,i,n){var s=e+"!"+t,r=O(e);!r.dynamic&&q[t]||(q[s]="loading",r.dynamic&&(z[s]=r.dynamic),r.load(t,i,function(e){X[s]=e,n.depModules[n.dependencies.indexOf(s)]=e,S(s)},c({onFailure:function(){"error"!==q[s]&&k(s,"Fail to load the resource "+s)}},ye)))}function A(e,i){var n,s,r,a=i&&i.split("/");return e&&"."===e.charAt(0)&&(i?(n=a.slice(0,a.length-1),s=e.split("/"),r=s.length-1,t.nodeIdCompat&&he.test(s[r])&&(s[r]=s[r].replace(he,"")),s=n.concat(s),u(s),e=s.join("/")):0===e.indexOf("./")&&(e=e.substring(2))),e}function D(t){var i,n,r,a,o,l,c=t.moduleId,d=t.dependencies;for(t.timeLimit=(new Date).getTime()+Te,r=d.length,n=0;n<r;n++)if(i=d[n],a=!1,i!==ee)if(s(X,i)&&i.indexOf("!")<0)t.depModules[n]=X[i];else{for(l in oe)if(oe[l].moduleId===i){a=!0,o=!0;break}a||he.test(i)&&"complete"===q[i]||("loading"!==q[i]&&"complete"!==q[i]?I(i).plugin?o=!0:(o=!0,q[i]="loading",e.amd.load(i)):o=!0)}else t.depModules[n]=$[c];o?b(c):t.onSuccess(t.depModules)}function P(t,i){var n=i;if(r(i)){if(i.__isExecuting)throw new Error("The module factory is executed while it is being executed. This is probably caused by circular dependency.");i.__isInternalWrapper&&(n=e.amd.executeFactory(t,i))}return n}function R(e,t){return t()}function O(e,t){var i;if(w(e)||p(e))return i=P(e,t);if(s(J,e)){if(i=X[e],i.__isInternalWrapper)return;return i}return void 0!==(i=t||X[e])?(X[e]=P(e,i),J.push(e),X[e]):void 0}function N(e,t){var i,n,s,r,a=[];for(i=0,n=e.length;i<n;i++)r=e[i],s=r===ee||r===te?t[i]:O(r,t[i]),a.push(s);return a}function M(t,i,n,s){if(!r(i))return i;var a=function(){a.__isExecuting=!0;var r=N(n,s),o=i.apply(e,r);return void 0===o&&(o=W(t)),o};return a.__isInternalWrapper=!0,a}function B(){var t,i,n,s,r,o=be.slice.call(arguments);if(l(o[0])){if(t=o.shift(),"complete"===q[t])return void("undefined"!=typeof console&&console.warn("### Unable to load the multiple module that module is loaded more than once: "+t))}else t=_();return i=a(o[0])?o.shift():[ee,te,ie],n=o.shift(),r=o.shift(),Q.push(t),q[t]||f(t)||(q[t]="complete"),$[t]=K(t),s=function(t,s){X[s]=e.amd.buildFactory(s,n,i,t)},U(t,i,t,s,r)}function F(e){e&&delete X[e]}function U(e,t,i,n,s){var o,l,c=[];a(t)||(t=[]),t.length>0&&(c[t.length-1]=void 0),o=function(t){var i=oe[e].moduleId;try{n(t,i)}catch(e){q[i]="error",r(ye.onError)?ye.onError(i,e):"undefined"!=typeof console&&(e.stack&&console.error(e.stack),console.error("### Unable to prepare module "+i+".\n\tError: "+e))}delete oe[e],delete oe[i]},l={base:i,moduleId:e,onSuccess:o,onFailure:s,dependencies:t,depModules:c},oe[e]=l;var d=function(){$[l.moduleId]=K(l.moduleId),l.started=!0,G(l)&&D(l)};f(e)?setTimeout(function(){d()},1):d()}function G(e){for(var t=e.base,i=e.dependencies,n=0,a=i.length;n<a;n++){var o=i[n],l=I(o);if(l.plugin){var c=d(A(l.plugin,t)),u=H(t);if(!s(X,c))return u([c],Se.bind(U,null,e.moduleId,i,t,e.onSuccess,e.onFailure)),!1;var h,_,g=O(c);h=r(g.normalize)?g.normalize(l.moduleId,Y(t)):d(A(l.moduleId,t)),_=c+"!"+h,i[n]=o=_,!X[_]||g.dynamic?L(c,h,u,e):e.depModules[n]=X[_]}else i[n]=d(A(o,t))}return!0}function H(e){return!e||f(e)?j:($[e]||($[e]=K(e)),$[e])}function V(e,t){var i=I(e);if(!i.plugin)return d(A(e,t));var n=d(A(i.plugin,t));if(!s(X,n))throw new Error("Cannot resolve resource id: plugin is not loaded.");var a,o=O(n);return a=r(o.normalize)?o.normalize(i.moduleId,Y(t)):d(A(i.moduleId,t)),n+"!"+a}function K(i){var n=function(n,c,d){var u,h,_,f,p=[],m=arguments.length;if(l(n)){if(_=V(n,i),!s(X,_))throw new Error("### Module '"+n+'" is not yet loaded!');var v,b=I(_);if(b.plugin&&(v=O(b.plugin),v.dynamic))throw new Error("require(String) cannot load dynamic resources.");if(void 0===(f=O(_)))throw new Error("### Module '"+n+'" is not yet loaded!');return f}if(1===m&&r(n)&&(c=n,n=[ee,te,ie]),a(n)&&r(c))return u=function(t){var i=N(n,t);c.apply(e,i)},U(g(),n,i,u,d);if(void 0!==i||!o(n)||1!==arguments.length){for(h=0;h<m;h++)p[h]=typeof arguments[h];throw new Error("The requested usage of require("+p.join(", ")+") is undefined")}t(n)};return n.toUrl=function(e){var t,n=e,s=e.lastIndexOf("."),r=e.split("/")[0],a="."===r||".."===r;-1!==s&&(!a||s>1)&&(t=e.substring(s,e.length),n=e.substring(0,s));var o=x(A(n,i))+(t||""),l=o.split("/");return"."===l[0]?(l=l.slice(1),u(l),l.splice(0,0,".")):u(l),l.join("/")},n}function Y(e){return function(i,n){var s,r,a;return n=n||e,i&&"."===i.charAt(0)&&(n?(s=n&&n.split("/"),r=s.slice(0,s.length-1),i=i.split("/"),a=i.length-1,t.nodeIdCompat&&he.test(name[a])&&(name[a]=name[a].replace(he,"")),i=r.concat(i),u(i),i=i.join("/")):0===i.indexOf("./")&&(i=i.substring(2))),i}}function W(e){return Z[e]||(Z[e]={}),Z[e]}var j,q={require:"complete",exports:"complete",module:"complete"},z={},Q=[],J=[],X={},$={},Z={},ee="require",te="exports",ie="module",ne=0,se=0,re="__anony-module-",ae="__require-",oe={},le="undefined"!=typeof window&&void 0!==window.document,ce=!le&&"undefined"!=typeof importScripts,de=ce?null:document.getElementsByTagName("head")[0],ue=100,he=/\.js$/,_e=/^(\/\/)|([^:]+:\/\/)/,ge=/^\/[^\/]+/,fe="PLAYSTATION 3"===navigator.platform?/^complete$/:/^(complete|loaded)$/,pe=Object.prototype,me=pe.hasOwnProperty,ve=pe.toString,be=Array.prototype,Se={},ye={},Ee="./",ke={},Ce=[],Te=1e4;Se.bind=function(e,t){var i=e,n=Array.prototype.slice.call(arguments,2);return function(){var e=n.concat(arguments);return i.apply(t,e)}},j=K(),e.amd&&e.amd.config&&t(e.amd.config),B.amd={},j.config=t,e.define||(e.define=B),e.undefine||(e.undefine=F),e.require||(e.require=j),e.amd||(e.amd={require:j,define:B,undefine:F,config:t,load:C,completeLoad:S,resolvePath:T,buildFactory:M,executeFactory:R})}(this),define("xdk-base/amd",function(){}),window.domReady=function(){"use strict";function e(){if(!i){i=!0;var e;for(e=0;e<n.length;e+=1)n[e](document)}}function t(e){return i?e(document):n.push(e),t}var i=!1,n=[];return document.addEventListener?(document.addEventListener("DOMContentLoaded",e,!1),window.addEventListener("load",e,!1),window.addEventListener("show",e,!1),window.onShow=e):window.attachEvent&&window.attachEvent("onload",e),"complete"===document.readyState&&e(),t}(),define("xdk-base/domReady",function(){}),require({paths:{"vdk-appGrid":"../dep/vdk-appGrid","vdk-lib-base64":"../dep/vdk-lib-base64","vdk-lib-moment":"../dep/vdk-lib-moment","vdk-message":"../dep/vdk-message","vdk-loading":"../dep/vdk-loading","xdk-base":"../dep/xdk-base","xdk-ax":"../dep/xdk-ax","xdk-ext-device-lg":"../dep/xdk-ext-device-lg","xdk-mouse":"../dep/xdk-mouse","xdk-ext-device-samsung":"../dep/xdk-ext-device-samsung","xdk-history":"../dep/xdk-history","xdk-ext-device-tizen":"../dep/xdk-ext-device-tizen","xdk-ui-animatedlabel":"../dep/xdk-ui-animatedlabel","xdk-ui-basic":"../dep/xdk-ui-basic","xdk-ui-input":"../dep/xdk-ui-input","xdk-ui-grid":"../dep/xdk-ui-grid","xdk-ext-device-playstation":"../dep/xdk-ext-device-playstation",image:"../dep/xdk-base/loader/image",json:"../dep/xdk-base/loader/json",css:"../dep/xdk-base/loader/css"}}),define("../dep/dep.config.js",function(){}),require({image:{map:{"../img":[]}}}),define("../dep/img.map.js",function(){}),require({baseUrl:"js",paths:{appmeasurement:"analytics/AppMeasurement",appmeasurementMedia:"analytics/AppMeasurement_Module_Media",cryptojs:"cryptojs/rollups","xdk-base/ajax":"./modules/ajax/ajax","tve/ext/ui/programguide":"storm/programguide","xdk-base/promise":"./modules/promise/promise","xdk-mouse/mouseHandler":"./tvedemo/ext/mouseHandler","xdk-ax/focusManager":"./tvedemo/ext/focusManager"},waitSeconds:60}),define("amd.config.js",function(){}),define("xdk-base/core",[],function(){"use strict";var e=1,t=function(e,t){this.name=e||"XDKCustomError",this.message=t||""};return{version:"2.6.3",buildNumber:"1462774903-66aafb6",root:function(){return"undefined"!=typeof window?window:null}(),createException:function(e,i){return t.prototype=new Error,t.prototype.constructor=t,new t(e,i)},getGuid:function(){return e++}}}),define("xdk-base/exception",{ILLEGAL_ARGUMENT:"ax:exception:illegal-argument",ILLEGAL_STATE:"ax:exception:illegal-state",INTERNAL:"ax:exception:internal",UNAUTHORIZED:"ax:exception:unauthorized",UNSUPPORTED_OPERATION:"ax:exception:unsupported-operation"}),define("xdk-base/jsGlobals",["exports"],function(e){"use strict";e.Array=Array,e.Object=Object}),define("xdk-base/util",["require","xdk-base/core","xdk-base/exception","xdk-base/jsGlobals"],function(e,t,i,n){"use strict";function s(e,t,i,n){for(var a=(n||0)-1,o=e.length,l=-1,c=[];++a<o;){var d=e[a];if(d&&"object"==typeof d&&"number"==typeof d.length&&(r.isArray(d)||r.isArguments(d))){t&&(d=s(d,t,i));var u=-1,h=d.length;for(c.length+=h;++u<h;)c[++l]=d[u]}else i||(c[++l]=d)}return c}var r={},a=n.Array,o=n.Object,l=function(){return e("xdk-base/promise")};!function(){var e;e=o.prototype.toString,r.extend=function(e,t,i){var n,s,r,a,o;for(o in t)s=e[o],r=t[o],e!==r&&(n=this.isArray(r),i&&r&&(n||this.isPlainObject(r))?(n?(n=!1,a=s&&this.isArray(s)?s:[]):a=s&&this.isPlainObject(t)?s:{},e[o]=this.extend(a,r,!0)):this.isUndefined(r)||(e[o]=r));return e},r.clone=function(e,t){return this.isArray(e)?this.extend([],e,t):this.extend({},e,t)},r.isUndefined=function(e){return void 0===e},r.isPlainObject=function(e){if(!e||"object"!=typeof e||e.nodeType)return!1;if(e.constructor&&!e.hasOwnProperty("constructor")&&!e.constructor.prototype.hasOwnProperty("isPrototypeOf"))return!1;var t;for(t in e);return void 0===t||e.hasOwnProperty(t)},r.isArray=a.isArray?a.isArray:function(t){return"[object Array]"===e.call(t)},r.isFunction=function(e){return"function"==typeof e||!1},r.isString=function(t){return"[object String]"===e.call(t)},r.isNumber=function(t){return"[object Number]"===e.call(t)},r.isNaN=function(e){return r.isNumber(e)&&e!==+e},r.isFinite=function(e){return isFinite(e)},r.isBoolean=function(t){return"[object Boolean]"===e.call(t)},r.isDate=function(t){return"[object Date]"===e.call(t)},r.isDOMElement=function(e){return!!e&&("object"==typeof e&&1===e.nodeType&&"object"==typeof e.style&&"object"==typeof e.ownerDocument&&"string"==typeof e.nodeName)},r.isEmpty=function(e){if(!this.isPlainObject(e))return!1;var t;for(t in e)if(e.hasOwnProperty(t))return!1;return!0},r.isNull=function(e){return null===e},r.isObject=function(e){return e===o(e)},r.isArguments=function(e){return r.has(e,"callee")},r.areObjectsEqual=function(e,t,i){if(!r.isPlainObject(e)||!r.isPlainObject(t))return!1;var n,s={},a=!1;1===i&&(a=!0);for(n in e){var o=e[n],l=t[n];if(r.isPlainObject(o)&&r.isPlainObject(l)){if(!a&&!r.areObjectsEqual(o,l,i-1))return!1}else if(r.isArray(o)&&r.isArray(l)){if(!a&&!r.areArraysEqual(o,l,i-1))return!1}else if(o!==l)return!1;s[n]=!0}for(n in t)if(!s[n])return!1;return!0},r.areArraysEqual=function(e,t,i){if(!r.isArray(e)||!r.isArray(t))return!1;var n=e.length,s=t.length,a=!1;if(n!==s)return!1;1===i&&(a=!0);for(var o=0;o<n;o++)if(r.isPlainObject(e[o])&&r.isPlainObject(t[o])){if(!a&&!r.areObjectsEqual(e[o],t[o],i-1))return!1}else if(r.isArray(e[o])&&r.isArray(t[o])){if(!a&&!r.areArraysEqual(e[o],t[o],i-1))return!1}else if(e[o]!==t[o])return!1;return!0},r.sort=function(e,n){function s(e,t){return e<t?-1:e>t?1:0}if(!r.isArray(e))throw t.createException(i.ILLEGAL_ARGUMENT,"arr parameter must be array");var a,o,l;return e.length<2?e:(n&&r.isFunction(n)||(n=s),a=Math.round(e.length/2),o=r.sort(e.slice(0,a),n),l=r.sort(e.slice(a,e.length),n),function(e,t,i){for(var n=[];e.length&&t.length;)i(e[0],t[0])<=0?n.push(e.shift()):n.push(t.shift());return e.length&&n.push.apply(n,e),t.length&&n.push.apply(n,t),n}(o,l,n))},r.shuffle=function(e){if(!r.isArray(e))throw t.createException(i.ILLEGAL_ARGUMENT,"arr parameter must be array");for(var n,s,a=e.length;0!==a;)s=Math.floor(Math.random()*a),a-=1,n=e[a],e[a]=e[s],e[s]=n;return e},r.sortByField=function(e,n,s){var a,o=1;if(!r.isArray(e))throw t.createException(i.ILLEGAL_ARGUMENT,"arr parameter must be array");if(s&&!r.isFunction(s))throw t.createException(i.ILLEGAL_ARGUMENT,"If wrapper is provided, must be a function");"-"===n[0]&&(o=-1,n=n.substr(1)),a=s&&r.isFunction(s)?function(e){if(!e.hasOwnProperty(n))throw t.createException(i.ILLEGAL_STATE,"Unable to sort, as "+n+" is not a property in the comparable array item");return s(e[n])}:function(e){if(!e.hasOwnProperty(n))throw t.createException(i.ILLEGAL_STATE,"Unable to sort, as "+n+" is not a property in the comparable array item");return e[n]};var l=function(e,t){return e=a(e),t=a(t),o*((e>t)-(t>e))};return r.sort(e,l)},r.sortByFields=function(e,n,s){function a(e){var n=1;return"-"===e[0]&&(n=-1,e=e.substr(1)),function(a,o){if(!a.hasOwnProperty(e)||!o.hasOwnProperty(e))throw t.createException(i.ILLEGAL_STATE,"Unable to sort, as "+e+" is not a property in the comparable array item");var l=a[e],c=o[e];return s&&r.isFunction(s)&&(l=s(a[e]),c=s(o[e])),(l<c?-1:l>c?1:0)*n}}function o(){return function(e,t){var i,s;for(s=0,i=0;0===i&&s<n.length;s++)i=a(n[s])(e,t);return i}}if(!r.isArray(e))throw t.createException(i.ILLEGAL_ARGUMENT,"array parameter must be a array");if(!r.isArray(n))throw t.createException(i.ILLEGAL_ARGUMENT,"Fields parameter must be a array");if(s&&!r.isFunction(s))throw t.createException(i.ILLEGAL_ARGUMENT,"If wrapper is provided, must be a function");return r.sort(e,o.apply(null,n))}}(),function(){var e,i;e=function(e,t){for(var i=e.length,n=t.length;n--;)e[i+n]=t[n];return e},i=function(t,i){return t=a.prototype.slice.call(t,0),e(t,i)},r.bind=function(e,t){if(r.isFunction(Function.prototype.bind))return Function.prototype.bind.apply(e,a.prototype.slice.call(arguments,1));if(arguments.length<2&&r.isUndefined(arguments[0]))return e;var n=e,s=a.prototype.slice.call(arguments,2);return function(){var e=i(s,arguments);return n.apply(t,e)}},r.argumentNames=function(e){var t=e.toString().match(/^[\s\(]*function[^(]*\(([^)]*)\)/)[1].replace(/\/\/.*?[\r\n]|\/\*(?:.|[\r\n])*?\*\//g,"").replace(/\s+/g,"").split(",");return 1!==t.length||t[0]?t:[]},function(){function e(e,i){if(e&&i){if(s[e])throw t.createException("Repeated id for deferred creation");return s[e]=i,s[e]}}function i(e){return s[e]}function n(e){s[e]=void 0}var s={};r.delay=function(i,s){var r,a=l().defer();return r=t.root.setTimeout(function(){return s&&n(s),a.resolve()},1e3*i),s&&e(s,{handle:r,deferred:a}),a.promise},r.defer=function(e){return r.delay(.01,e)},r.clearDelay=function(e){if(e){var t=i(e);t&&(clearTimeout(t.handle),t.deferred.reject("delay aborted"),n(e))}}}(),r.wrap=function(t,i){return function(){var n=e([r.bind(t,this)],arguments);return i.apply(this,n)}},r.methodize=function(t){if(t._methodized)return t._methodized;var i=t;return t._methodized=function(){var t=e([this],arguments);return i.apply(null,t)},t._methodized}}(),function(){r.insert=function(e,t,i){return r.isString(e)||(e=""+e),(r.isUndefined(t)||t<0||t>e.length)&&(t=e.length),i=r.isUndefined(i)?"":i,e.slice(0,t)+i+e.slice(t,e.length)},r.truncate=function(e,t,i){r.isString(e)||(e=""+e),t=r.isNumber(t)?t:30,i=r.isUndefined(i)?"...":i;var n=t<0?0:t;return e.length>t?e.slice(0,n)+i:String(e)},r.strip=function(e){return r.isString(e)||(e=""+e),e.replace(/^\s+/,"").replace(/\s+$/,"")},r.camelize=function(e){return r.isString(e)||(e=""+e),e.replace(/-+(.)?/g,function(e,t){return t?t.toUpperCase():""})},r.decamelize=function(e,t){return r.isString(e)||(e=""+e),t=t||"-",e.replace(/([a-z])([A-Z])/g,"$1"+t+"$2").toLowerCase()},r.empty=function(e){return r.isString(e)||(e=""+e),/^\s*$/.test(e)},r.startsWith=function(e,t){return!r.isUndefined(e)&&!r.isUndefined(t)&&(r.isString(e)||(e=""+e),r.isString(t)||(t=""+t),e.substr(0,t.length)===t)},r.encodeHTML=function(e){r.isString(e)||(e=""+e);var t="";return 0===e.length?"":(t=e.replace(/&/g,"&amp;"),t=t.replace(/</g,"&lt;"),t=t.replace(/>/g,"&gt;"),t=t.replace(/ /g,"&nbsp;"),t=t.replace(/\'/g,"'"),t=t.replace(/\"/g,"&quot;"),t=t.replace(/\n/g,"<br>"))},r.decodeHTML=function(e){r.isString(e)||(e=""+e);var t="";return 0===e.length?"":(t=e.replace(/&amp;/g,"&"),t=t.replace(/&lt;/g,"<"),t=t.replace(/&gt;/g,">"),t=t.replace(/&nbsp;/g," "),t=t.replace(/'/g,"'"),t=t.replace(/&quot;/g,'"'),t=t.replace(/<br>/g,"\n"))}}();var c=t.root,d=/^\s*null(\s)*$/,u={parse:function(e){if(c.JSON&&c.JSON.parse)return c.JSON.parse(e);if(r.isString(e)||r.isNumber(e)){if(d.test(e))return null;try{return new Function("var input = "+e+'; if (input === undefined || input === null) throw "Unexpected token"; return input;')()}catch(e){throw t.createException("JSONParseError","JSON parse Error")}}throw t.createException("JSONParseError","JSON parse Error")},stringify:function(e){if(c.JSON&&c.JSON.stringify)return c.JSON.stringify(e);var n,s,a,o,l=[];if(r.isDOMElement(e))throw t.createException(i.ILLEGAL_ARGUMENT,"Coverting DOM element to JSON");if(null===e)return"null";if(void 0!==e){if(r.isFunction(e.toJSON))return e.toJSON();if(r.isBoolean(e)||r.isNumber(e))return e.toString();if(r.isString(e))return'"'+e.replace(/"/g,'"')+'"';if(r.isArray(e)){var d="[";for(n=e.length,o=0;o<n;o++)s=this.stringify(e[o]),d+=(r.isUndefined(s)?null:s)+",";return d.substring(0,d.length-1)+"]"}if(r.isPlainObject(e)){for(a in e)s=this.stringify(e[a]),r.isUndefined(s)||l.push('"'+a.toString()+'":'+s);return"{"+l.join(",")+"}"}}}};return r.parse=u.parse,r.stringify=u.stringify,r.breaker={},function(){r.first=function(e){if(!r.isArray(e))throw t.createException("ArrayFirstError","Type is not an array");return e[0]},r.indexOf=function(e,i,n){if(!r.isArray(e))throw t.createException("ArrayIndexOfError","Type is not an array");if(r.isFunction(a.prototype.indexOf))return e.indexOf(i,n);n||(n=0);var s=e.length;for(n<0&&(n=s+n);n<s;n++)if(e[n]===i)return n;return-1},r.last=function(e){if(!r.isArray(e))throw t.createException("ArrayLastError","Type is not an array");return e[e.length-1]},r.lastIndexOf=function(e,i,n){if(!r.isArray(e))throw t.createException("ArrayLastError","Type is not an array");if(r.isFunction(a.prototype.lastIndexOf))return r.isUndefined(n)?e.lastIndexOf(i):e.lastIndexOf(i,n);n=r.isNumber(n)?(n<0?e.length+n:n)+1:e.length;var s=this.indexOf(e.slice(0,n).reverse(),i);return s<0?s:n-s-1},r.flatten=function(e,t){return s(e,t,!1)},r.size=function(e){if(!r.isArray(e))throw t.createException("ArraySizeError","Type is not an array");return e.length},r.remove=function(e,i,n){if(!r.isArray(e))throw t.createException("ArrayRemoveError","Type is not an array");if(i>=e.length||n&&n>=e.length)throw t.createException("ArrayRemoveError","Range is out of the array length");var s=e.slice((n||i)+1||e.length);return e.length=i<0?e.length+i:i,e.push.apply(e,s)},r.reduce=function(e,i,n){if(!r.isArray(e))throw t.createException("ArrayReduceError","Type is not an array");if(i=i||function(e){return e},0===e.length)return n;if(r.isFunction(a.prototype.reduce))return r.isUndefined(n)?e.reduce(i):e.reduce(i,n);if(!r.isFunction(i))throw t.createException("ArrayReduceError","iter is not a function");var s,o=0,l=e.length,c=!1;for(r.isUndefined(n)||(s=n,c=!0);l>o;++o)e.hasOwnProperty(o)&&(c?s=i(s,e[o],o,e):(s=e[o],c=!0));return s},r.reduceRight=function(e,i,n){if(!r.isArray(e))throw t.createException("ArrayReduceRightError","Type is not an array");if(i=i||function(e){return e},r.isFunction(a.prototype.reduceRight))return r.isUndefined(n)?e.reduceRight(i):e.reduceRight(i,n);if(!r.isFunction(i))throw t.createException("ArrayReduceRightError","iter is not a function");var s,o=e.length,l=o-1,c=!1;for(r.isUndefined(n)||(s=n,c=!0);-1<l;--l)e.hasOwnProperty(l)&&(c?s=i(s,e[l],l,e):(s=e[l],c=!0));return s},r.map=function(e,i,n){if(!r.isArray(e))throw t.createException("ArrayMapError","Type is not an array");if(i=i||function(e){return e},r.isFunction(a.prototype.map))return e.map(i,n);if(!r.isFunction(i))throw t.createException("ArrayMapError","iter is not a function");var s=[];return this.each(e,function(e,t){s.push(i.call(n,e,t))}),s},r.filter=function(e,i,n){if(!r.isArray(e))throw t.createException("ArrayFilterError","Type is not an array");if(i=i||function(e){return e},r.isFunction(a.prototype.filter))return e.filter(i,n);if(!r.isFunction(i))throw t.createException("ArrayFilterError","iter is not a function");var s=[];return this.each(e,function(t,r){i.call(n,t,r,e)&&s.push(t)}),s},r.findIndex=function(e,t,i){var n=-1,s=e?e.length:0;for(t=t||function(e){return e};++n<s;)if(t.call(i,e[n],n,e))return n;return-1},r.find=function(e,t,i){var n=r.findIndex(e,t,i);return n>-1?e[n]:void 0},r.some=function(e,i,n){if(!r.isArray(e))throw t.createException("ArraySomeError","Type is not an array");if(i=i||function(e){return e},r.isFunction(a.prototype.some))return e.some(i,n);if(!r.isFunction(i))throw t.createException("ArraySomeError","iter is not a function");var s=!1;return this.each(e,function(e,t){if(s=i.call(n,e,t))return r.breaker},this),s},r.pluck=function(e,t){var i=function(e){return null===t?void 0:e[t]};return r.map(e,i)},r.pick=function(e,t,i){var n,a={};if(null===e)return a;if(r.isFunction(t))for(n in e){var l=e[n];t.call(i,l,n,e)&&(a[n]=l)}else{var c=s(arguments,!1,!1,1);e=new o(e);for(var d=0,u=c.length;d<u;d++)(n=c[d])in e&&(a[n]=e[n])}return a}}(),function(){r.keys=function(e){var t,i=[];if(r.isFunction(o.keys))return o.keys(e);for(t in e)e.hasOwnProperty(t)&&i.push(t);return i},r.inspect=function(e){var t,i,n=this.keys(e),s=this.values(e),r=n.length;if(t="#<object:{",0===r)return t+"}>";for(i=0;i<r;i++)t=t+n[i]+":"+s[i]+", ";return t=t.substr(0,t.length-2)+"}>"},r.values=function(e){var t,i=[];for(t in e)i.push(e[t]);return i},r.toQueryString=function(e){var t,i=[];return t=function(e,t){return r.isUndefined(t)?e:e+"="+encodeURIComponent(null===t?"":String(t))},r.each(e,function(e){var n,s,a,o,l=encodeURIComponent(e.key),c=e.value;if(c&&"object"==typeof c){if(r.isArray(c)){for(n=0,s=c.length,o=[];n<s;n++)a=c[n],o.push(t(l,a));i=i.concat(o)}}else i.push(t(l,c))},this),i.join("&")},r.has=function(e,t){return null!==e&&hasOwnProperty.call(e,t)}}(),function(){var e=function(){if(r.isArray(arguments[0]))return!0;if(r.isPlainObject(arguments[0]))return!1;throw t.createException("Exception","No such related function of the type"+typeof arguments[0])};r.clear=function(t){var i,n,s,a,o;if(e(t))return s=t,s.length=0,s;for(i=t,n=0,o=r.keys(i),a=o.length;n<a;n++)delete i[o[n]];return i},r.each=function(i,n,s){var o,l,c,d,u,h,_;if(n=n||function(e){return e},!r.isFunction(n))throw t.createException("EachError","iter is not a function");if(e(i)){if(o=i,r.isFunction(a.prototype.some))return void o.some(function(){return n.apply(s,arguments)===r.breaker},s);for(l=0,c=o.length;l<c;l++)if(n.call(s,o[l],l,o)===r.breaker)return}else{_=i;for(d in _)if(u=_[d],h=[d,u],h.key=d,h.value=u,n.call(s,h)===r.breaker)return}},r.every=function(t,i,n){var s,a=!1;return i=i||function(e){return e},e(t)&&(a=!0,r.isFunction(t.every))?t.every(i,n):(s=!0,this.each(t,function(e,t){if(a||(e=e.value),!(s=s&&!!i.call(n,e,t,void 0)))return r.breaker},this),s)},r.contains=function(e,t){return null!==e&&(e.length!==+e.length&&(e=r.values(e)),r.indexOf(e,t)>=0)}}(),r}),define("xdk-base/Interface",["xdk-base/util","xdk-base/core"],function(e,t){"use strict";function i(e,i,n){if(!a)throw t.createException("PrivateConstructor","Use Interface.create instead");this.name=e,this.exts=i||[],this.methods=n||{}}function n(e){return e instanceof i}function s(){if(arguments.length<2)throw t.createException("InvalidArgument","intf.create called with "+arguments.length+"arguments, but expected at least 2.");var s,r,o,l,c,d,u,h=Array.prototype.slice.call(arguments);if(s=h.shift(),!e.isString(s))throw t.createException("InvalidArgument","intf.create: expects the first argument to be String");if(h.length>1){if(!(r=h.shift())||!e.isArray(r))throw t.createException("InvalidArgument","intf.create: expects the second argument of three provided as an array");for(c=0,d=r.length;c<d;c++)if(!n(r[c]))throw t.createException("InvalidArgument","intf.create: expects the first argument array contains only interfaces")}if(!(o=h.shift())||!e.isPlainObject(o))throw t.createException("InvalidArgument","intf.create: expects an Object for the last argument");return e.each(o,function(i){if(u=i.key,!e.isArray(i.value))throw t.createException("InvalidArgument","intf.create: expects method param list to be passed in as an array.");for(c=0,d=i.value.length;c<d;c++)if(!e.isString(i.value[c]))throw t.createException("InvalidArgument","intf.create: expects method param to be passed in as a string.")}),a=!0,l=new i(s,r,o),a=!1,l}function r(i,n){var s,a,o,l,c,d,u;if(n.exts)for(s=0,a=n.exts.length;s<a;s++)r(i,n.exts[s]);e.each(n.methods,function(s){for(u=s.key,o=s.value,d=i.prototype,l=!1;!l&&d;)d[u]&&e.isFunction(d[u])&&(c=d[u].isSuperWrapper?d[u].orig:d[u],
c.length>=n.methods[u].length&&(l=!0)),d=d.prototype;if(!l)throw t.createException("InterfaceViolation","intf.ensureImpl: object does not implement the "+n.name+" interface. Method "+n.printFn(u)+" was not found.")})}var a=!1;return i.prototype.toString=function(){var e,t="Interface "+this.name+" : { ";for(e in this.methods)t+=this.printFn(e);return t+=" }"},i.prototype.printFn=function(e){return e+"("+this.methods[e].join()+")"},i.create=s,i.ensureImpl=r,i}),define("xdk-base/class",["xdk-base/util","xdk-base/core","xdk-base/Interface","require"],function(e,t,i,n){"use strict";function s(){function i(){if(!(this instanceof i)){throw n("xdk-base/console").error("Please use 'new' operator! This is a class constructor function, it cannot be called directly!"),t.createException("IncorrectInvocation","Please use 'new' operator! This is a class constructor function, it cannot be called directly!")}g||(p(this,i.__defaults),this.init.apply(this,arguments))}var s,r=null,o=Array.prototype.slice.call(arguments),l=[],u=null,h=null;if(e.isFunction(o[0])&&(r=o.shift()),e.isArray(o[0])&&(l=o.shift()),u=o.shift(),!e.isPlainObject(u)&&!e.isFunction(u))throw s=n("xdk-base/console"),s.error("Static members parameter must be an object or a function!"),t.createException("IncorrectParam","Static members parameter must be an object or a function!");if(h=o.shift(),r?(f(i,r),g=!0,i.prototype=new r,g=!1,p(i.prototype,r.prototype)):f(i,a.methods),i._superclass=r,e.isFunction(u)&&(u=u.apply(null)),d(i,u),e.isFunction(h)&&(h=h.apply(null)),h&&(c(i,h),i.__defaults={},p(i.__defaults,i.prototype),p(i.__defaults,h)),!h)throw t.createException("IncorrectParam","Instance memebers are not provided!");return i.prototype.init||(i.prototype.init=m),i.prototype.constructor=i,e.isFunction(i.prototype.deinit)&&(i.prototype.destructor=i.prototype.deinit),i.intfs=l,e.isFunction(i.main)?i.main():i.main||(i.main=m),r&&r.intfs&&r.intfs.length>0&&(i.intfs=i.intfs.concat(r.intfs)),i}function r(t,i){function n(t){var s=!1;return e.each(t,function(t){return t===i?(s=!0,e.breaker):n(t.exts)?(s=!0,e.breaker):void 0}),s}for(var s=t,r=!1;s;){if(n(s.intfs,i)){r=!0;break}s=s._superclass}return r}var a,o,l,c,d,u,h,_=!0,g=!1,f=function(t,i){var n,s;for(n in i)s=i[n],e.isArray(s)?t[n]=s.slice():e.isPlainObject(s)?t[n]=e.clone(s,!0):t[n]=s},p=function(t,i){var n,s;for(n in i)s=i[n],e.isArray(s)?t[n]=s.slice():e.isPlainObject(s)&&(t[n]=e.clone(s,!0))},m=function(){},v=function(){var e=n("xdk-base/console"),t=n("xdk-base/core");throw e.error("Abstract function called!"),t.createException("AbstractMethodInvoked","Abstract method called! This method must be implemented in subclass!")};for(o in{toString:1})"toString"===o&&(_=!1);return c=function(t,i,n){var s,r,a,o,l,c,d=n?t._superclass:t._superclass&&t._superclass.prototype,u=e.keys(i);for(_&&(i.toString!==Object.prototype.toString&&u.push("toString"),i.valueOf!==Object.prototype.valueOf&&u.push("valueOf")),c=function(t,i){var n=function(){var n,s=this._super;return this._super=d[t],e.isFunction(this._super)||(this._super=m),n=i.apply(this,arguments),s?this._super=s:delete this._super,n};return n.isSuperWrapper=!0,n.orig=i,n},s=0,r=u.length;s<r;s++)a=u[s],o=i[a],d&&e.isFunction(o)&&(l=o,o=c(a,l),o.valueOf=e.bind(l.valueOf,l),o.toString=e.bind(l.toString,l)),n?t[a]=o:t.prototype[a]=o;return t},d=function(e,t){return c(e,t,!0)},l=function(){var e,t;if(e=s.apply(this,arguments),e._superclass,e.intfs)for(t=0;t<e.intfs.length;t++)i.ensureImpl(e,e.intfs[t]);return e.__abstract=!1,e},u=function(){var e=s.apply(this,arguments);return e.__abstract=!0,e},h=function(e){return e.__abstract},a={create:l,addMethods:c,addStaticMethods:d,abstractFn:v,hasImpl:r,createAbstract:u,isAbstract:h}}),define("xdk-base/QueryString",["xdk-base/class","xdk-base/util"],function(e,t){"use strict";return e.create({parse:function(e){if(!e||!t.isString(e))return{};var i,n,s,r,a={};for(i=e.split("&"),s=0,r=i.length;s<r;s++)(n=i[s].match(/^([^=]+)=?(.*)$/))&&(a[n[1]]=n[2]);return a}},{__parameters:[],__queryString:"",init:function(e){e||(e=window.location.href);var t;t=e.match(/^([^?]*)\?(.*)$/),this.__queryString=t?t[2]:"",this.__parameters=this.constructor.parse(this.__queryString)},getValue:function(e){return t.isString(this.__parameters[e])?this.__parameters[e]:null},getQueryString:function(e){if(!t.isObject(e))return this.__queryString;var i,n,s,r="";if(i=t.clone(this.__parameters),t.isObject(e.extendFrom)&&(i=t.extend(i,e.extendFrom)),t.isArray(e.exclude)){s=e.exclude;for(n in i)-1!==t.indexOf(s,n)&&i.hasOwnProperty(n)&&delete i[n]}for(n in i)r+=n+"="+i[n]+"&";return r.length>0&&(r=r.substring(0,r.length-1)),r},toObject:function(){return this.__parameters}})}),define("json",["xdk-base/util","xdk-base/QueryString"],function(e,t){"use strict";function i(){return new XMLHttpRequest}function n(e){return readFile(e)}function s(t){return e.parse(t)}function r(e){return 0===e.indexOf("empty:")||f.test(e)}function a(e,t,i,n){if(n=n||{},n.failover)return void e({});t(i)}function o(e,t,i,n){try{t(s(e))}catch(e){a(t,i,e,n)}}function l(e,t){return f.test(e)?e:t.toUrl(e)}function c(t){var i,n=t.split(p);return 1===n.length?{id:t,failover:!1,waitSeconds:v}:(i=d(n[0]),e.extend({id:n[1]},i))}function d(e){var i=t.parse(e);return i.failover="true"===i.failover,i.waitSeconds=parseInt(i.waitSeconds,10),isNaN(i.waitSeconds)&&(i.waitSeconds=v),i}function u(e,t,n,s){var r=i();r.onload=r.onreadystatechange=function(){if(4===r.readyState){r.onload=r.onreadystatechange=null;var e=r.status;0===e||e>=200&&e<300||304===e?o(r.responseText,t,n,s):a(t,n,r,s)}},r.timeout=1e3*(s.waitSeconds||v),r.ontimeout=function(){a(t,n,"Loading "+e+" timeout.",s)},r.open("GET",e),r.send()}function h(e,t,i,s){var a=c(e),o=l(a.id,t);if(r(e)||r(o))return void i();b=s,S[e]=n(o),i(S)}function _(t,i,n,s){var r=s&&e.isFunction(s.onFailure)?s.onFailure:m,a=c(t);u(l(a.id,i),n,r,a)}var g={dynamic:!1},f=/^(\/\/)|([^:]+:\/\/)/,p="|",m=function(){},v=8,b={},S={};return g.normalize=function(e,t){var i=e.split(p);return 1===i.length?t(e):i[0]+p+t(i[1])},g.load=function(e,t,i,n){n.isBuild?h(e,t,i,n):_(e,t,i,n)},g.write=function(e,t,i){if(!r(t)&&S[t]){var n,s=e+"!"+t,a=b.namespace?b.namespace+".":"";n="define('%MODULE_ID%',%MODULE_CONTENT%)".replace("%MODULE_ID%",s).replace("%MODULE_CONTENT%",S[t]),i.asModule(s,a+n)}},g}),define("json!failover=true|xdk.config.json",{"device.multiAudioTrackStgy":{"tvedemo/ext/device/samsung/SefPlayer":"xdk-ext-device-samsung/SefPlayerMultiAudioTracksStgy","tvedemo/ext/device/playstation/PSPlayer":"tvedemo/ext/device/playstation/PSPlayerMultiAudioTracksStgy","tvedemo/ext/device/tizen/AVPlayer":"tvedemo/ext/device/tizen/AVPlayerMultiAudioTracksStgy"},"device.packages":["xdk-ext-device-playstation"],"device.players":{lg:["tvedemo/ext/device/lg/LgPlayer"],workstation:["xdk-base/device/shared/Html5Player"],samsung:["tvedemo/ext/device/samsung/SefPlayer"],playstation:["tvedemo/ext/device/playstation/PSPlayer"],tizen:["tvedemo/ext/device/tizen/AVPlayer"]},"device.tracking":{playstation:{convivaPlayerName:"st",convivaLibraryURL:"js/analytics/ConvivaLivePass_PlayStation_WebMAF_2_86_0_22221.js",convivaEnableTouchstoneDebugging:!1}},"tve.appgrid":{api:"http://appgrid-api.cloud.accedo.tv",appKey:"5762aad668ffd501e7a86321"},"tve.ovp":{api:"http://share.tve.demo.accedo.tv/ovp/api/1.1"},approuter:{base:"tvedemo/ctrl",paths:{Blank:"storm/ctrl/Blank"}},"analytics.platform":"omniture","analytics.config":{conviva:{include:!0,env:"production",platforms:["playstation","samsung","tizen","lg"],convivaKey:{production:"8b32f9655e8cb16b9a0a3a02871869983a1944c2",test:"64449f67f642c456ad455eee8e5cd9a37ebd5418"}}},"analytics.debug":!1,"dev.proxy":!1,"dev.proxyPath":"http://192.168.2.224/proxy.php?url=","dev.proxyHosts":["storm-tst3.sky.de","test-skyonline.sky.de","skyonline.sky.de","ipad-live-1.sky.de"],"dev.replaceHost":!1,"dev.findHosts":["://skyonline.sky.de"],"dev.replaceHosts":["://test-skyonline.sky.de"],"app.name":"SkyOnline",version:"3.2.12",displayVersion:!1,environment:"production",WARNING:"Environment that we're working in / connecting to - 'production', or 'test' keys into data returned from AppGrid (so, data you can't see in this code repository; be cautious!)",dialogTimeLimit:{alert:10,confirm:30,task:60}}),define("xdk-base/config",["json!failover=true|xdk.config.json"],function(e){"use strict";var t=e;return{get:function(e,i){return void 0===e||null===e?t:t.hasOwnProperty(e)?t[e]:i},set:function(e,i){return null===e||void 0===e?0:void 0===i?(delete t[e],1):(t[e]=i,1)}}}),define("xdk-base/logger/loggerBase",["xdk-base/config"],function(e){"use strict";return{LV_DEBUG:0,LV_INFO:1,LV_LOG:2,LV_WARNING:3,LV_ERROR:4,level:e.get("console.lv",2),log:function(){if(!(this.level>this.LV_LOG)){var e=Array.prototype.slice.call(arguments);this._log(e.join(" "))}},debug:function(){if(!(this.level>this.LV_DEBUG)){var e=Array.prototype.slice.call(arguments);this._log("[DEBUG]: "+e.join(" "))}},info:function(){if(!(this.level>this.LV_INFO)){var e=Array.prototype.slice.call(arguments);this._log("[INFO]: "+e.join(" "))}},warn:function(){if(!(this.level>this.LV_WARNING)){var e=Array.prototype.slice.call(arguments);this._log("[WARN]: "+e.join(" "))}},error:function(){if(!(this.level>this.LV_ERROR)){var e=Array.prototype.slice.call(arguments);this._log("[ERROR]: "+e.join(" "))}},_log:null}}),define("xdk-base/logger/nativeLogger",["xdk-base/logger/loggerBase","xdk-base/core"],function(e,t){"use strict";var i=function(){},n=t.root;return(n.navigator&&n.navigator.userAgent).toLowerCase().indexOf("maple")>-1?(e._log=function(){var e=Array.prototype.slice.call(arguments),t=e.join(", ");alert&&alert(t)},e):n.console?n.console:{log:i,error:i,debug:i,info:i,warn:i}}),define("xdk-base/logger/onScreenLogger",["xdk-base/config","xdk-base/logger/loggerBase","require"],function(e,t,i){"use strict";var n,s,r,a=!1;s={messages:[],messageEle:null,maxLine:e.get("onscreenlogger.maxline",14),bgColor:e.get("onscreenlogger.bgcolor","green"),triggerKey:e.get("onscreenlogger.key","KEY_1"),dimension:e.get("onscreenlogger.dimension",{top:480,left:0,width:1280,height:240}),__init:function(){a||(a=!0,n=document.createElement("div"),n.setAttribute("id","logArea"),n.style.position="absolute",n.style.left=this.dimension.left+"px",n.style.top=this.dimension.top+"px",n.style.width=this.dimension.width+"px",n.style.height=this.dimension.height+"px",n.style.backgroundColor=this.bgColor,n.style.zIndex="99",n.style.opacity="0.5",n.style.overflow="hidden",this.messageEle=document.createElement("pre"),this.messageEle.style.margin="0 0 0 10px",n.appendChild(this.messageEle),domReady(function(){document.body.appendChild(n)}),this.show(),this.__setKey())},__setKey:function(){try{var e=i("xdk-base/Env").singleton(),t=i("xdk-base/device/vKey");e&&e.addEventListener(e.EVT_ONKEY,function(e){switch(e.id){case t[s.triggerKey].id:"none"===n.style.display?s.show():s.hide()}return!1})}catch(e){setTimeout(this.__setKey,500)}},_log:function(e){this.__init(),this.messages.unshift(e),this.messages.length>this.maxLine&&this.messages.pop(),this.messageEle.innerHTML=this.messages.join("\n")},hide:function(){n.style.display="none"},show:function(){n.style.display="block"},clear:function(){this.messages.length=0,this.messageEle.innerHTML=""}};for(r in t)s[r]||(s[r]=t[r]);return s}),define("xdk-base/logger/remoteLogger",["xdk-base/config","xdk-base/logger/loggerBase"],function(e,t){"use strict";var i,n,s,r=[];s=function(e,t){var i=new XMLHttpRequest;i.open("post",e,t.async),i.send(t.parameters)},i={url:e.get("remotelogger.url",""),logInterval:e.get("remotelogger.logInterval",10),async:e.get("remotelogger.async",!1),logFilePath:e.get("remotelogger.logFilePath","xdkLog.txt"),_timeInterval:null,__sendLog:function(){if(i.url&&!(r.length<1)){var e,t={msg:r,logPath:i.logFilePath};e=JSON&&JSON.stringify?JSON.stringify(t):i.__stringify(t),s(i.url,{parameters:e,async:i.async}),r=r.slice(r.length)}},__stringify:function(e){var t,n,s,r=[],a=0;if(null===e)return"null";if(e.toJSON&&"function"==typeof e.toJSON)return e.toJSON();if("boolean"==typeof e||"number"==typeof e)return e.toString();if("string"==typeof e)return'"'+e.replace(/"/g,'\\"')+'"';if("[object Array]"===Object.prototype.toString.call(e)){for(t=e.length;a<t;a++)n=i.__stringify(e[a]),void 0!==e&&r.push(n);return"["+r.join(",")+"]"}if(e){for(s in e)n=i.__stringify(e[s]),void 0!==e&&r.push('"'+s.toString()+'":'+n);return"{"+r.join(",")+"}"}return!1},_log:function(e){r.length>=500&&(r=r.slice(1)),r.push(e),this._timeInterval||(this._timeInterval=setInterval(this.__sendLog,1e3*this.logInterval))}};for(n in t)i[n]||(i[n]=t[n]);return i}),define("xdk-base/console",["xdk-base/config","xdk-base/logger/nativeLogger","xdk-base/logger/onScreenLogger","xdk-base/logger/remoteLogger","require"],function(e,t,i,n){"use strict";var s,r;return r=function(e){if(e)try{return e=require(e),void(s=e)}catch(e){s=t}s=t},r(e.get("console.logger",null)),s}),define("xdk-base/EventDispatcher",["xdk-base/class","xdk-base/util","xdk-base/console","xdk-base/core"],function(e,t,i,n){"use strict";return e.create({},{__eventCallbacks:{},__getEventHandlers:function(e){var i=this.__eventCallbacks[e];return i||t.isArray(i)||(i=[]),i},dispatchEvent:function(e,s,r){if(!e)throw n.createException("IncorrectParam","Failed to dispatch event due to no event type!");if(this.onDispatchEvent&&!this.onDispatchEvent(e,s))return i.log("Event blocked for type="+e+" data="+s),!1;var a,o,l,c=[],d=this.__getEventHandlers(e),u=!0;for(t.isUndefined(s)&&(s={}),o=0;o<d.length;o++){if(a=d[o],t.isFunction(a.handler))if(!0===r)try{l=a.handler.call(this,s)}catch(e){i.error(e.name+":"+e.message),e.stack&&i.error(e.stack)}else l=a.handler.call(this,s);a.once&&c.push(a),!1===l&&(u=!1)}for(o=0;o<c.length;o++)this.removeEventListener(e,c[o].handler);return u},addEventListener:function(e,i,s){if(!e||!i)throw n.createException("IncorrectParam","Failed to add event listener due to no event type or listener!");s||(s=!1);var r,a,o=this.__eventCallbacks[e];for(o&&t.isArray(o)||(o=[],this.__eventCallbacks[e]=o),a={handler:i,once:s},r=0;r<o.length;r++)if(o[r].handler===i)return this;return o.push(a),this},removeEventListener:function(e,t){var i,n=this.__eventCallbacks[e];if(!n)return this;if(!n.length)return delete this.__eventCallbacks[e],this;if(!t){for(i in n)this.removeEventListener(e,n[i].handler);return delete this.__eventCallbacks[e],this}for(i=0;i<n.length&&n[i].handler!==t;i++);return i<n.length&&n.splice(i,1),this},removeAllListeners:function(){var e;for(e in this.__eventCallbacks)this.removeEventListener(e);return this},deinit:function(){this.removeAllListeners()}})}),define("xdk-base/device/vKey",[],function(){"use strict";return{KEY_0:{id:"device:vkey:0",text:"0"},KEY_1:{id:"device:vkey:1",text:"1"},KEY_2:{id:"device:vkey:2",text:"2"},KEY_3:{id:"device:vkey:3",text:"3"},KEY_4:{id:"device:vkey:4",text:"4"},KEY_5:{id:"device:vkey:5",text:"5"},KEY_6:{id:"device:vkey:6",text:"6"},KEY_7:{id:"device:vkey:7",text:"7"},KEY_8:{id:"device:vkey:8",text:"8"},KEY_9:{id:"device:vkey:9",text:"9"},OK:{id:"device:vkey:ok"},UP:{id:"device:vkey:up"},DOWN:{id:"device:vkey:down"},LEFT:{id:"device:vkey:left"},RIGHT:{id:"device:vkey:right"},EXIT:{id:"device:vkey:exit"},BACK:{id:"device:vkey:back"},RED:{id:"device:vkey:red"},GREEN:{id:"device:vkey:green"},YELLOW:{id:"device:vkey:yellow"},BLUE:{id:"device:vkey:blue"},PLAY:{id:"device:vkey:play"},PLAY_PAUSE:{id:"device:vkey:playPause"},PAUSE:{id:"device:vkey:pause"},STOP:{id:"device:vkey:stop"},FF:{id:"device:vkey:ff"},RW:{id:"device:vkey:rw"},NEXT:{id:"device:vkey:next"},PREV:{id:"device:vkey:prev"}}}),define("xdk-base/device/playerRegistry",["xdk-base/util","require"],function(e,t){"use strict";var i=[];return{register:function(t,n){var s,r,a,o=t.getCapabilities(),l=o.type||["*"],c=o.drms||[],d={type:{},drm:{},player:null};e.isArray(l)||(l=[l]),e.isArray(c)||(c=[c]);for(a in l)(s=l[a])&&(d.type[s]=!0);for(a in c)(r=c[a])&&(d.drm[r]=!0);t.setId(n),d.id=n,d.player=t,i.push(d)},unregister:function(t){e.each(i,function(n,s){if(n.player===t)return t.reset(),i.splice(s,1),e.breaker})},deinit:function(){e.each(i,e.bind(function(e){this.unregister(e.player),e.player.deinit()},this))},getPlayerByClass:function(n){var s=t(n),r=null;return e.each(i,function(t){if(t.player.constructor===s)return r=t.player,e.breaker}),r},getPlayer:function(e){var t=this.getPlayers(e);return 0===t.length?null:t[0]},getPlayers:function(t){var n=[],s=t.type,r=t.drm;return s||r?(e.each(i,function(e){(s&&e.type[s]||"*"===s)&&(r&&e.drm[r]||!r)&&n.push(e.player),!s&&r&&e.drm[r]&&n.push(e.player)}),n):(e.each(i,function(e){n.push(e.player)}),n)}}}),define("xdk-base/device/interface/Player",["xdk-base/Interface"],function(e){"use strict";var t=e.create("Player",{getCapabilities:[],prepare:["opts"],reset:[],load:["mediaUrl","opts"],play:["opts"],stop:[],pause:[],resume:[],seek:["sec"],skip:["sec"],speed:["speed"],getPlaybackSpeed:[],setWindowSize:["param"],setFullscreen:[],getBitrates:[],getCurTime:[],getDuration:[],getId:[],setId:["id"]});t.PLAYBACK_STATE={PLAYING:"playing",PAUSED:"paused",STOPPED:"stopped"};var i={RENDER:"onRenderError",NETWORK:"onConnectionError",DRM:"onDRMError",GENERIC:"onUnknownError"};return t.PLAYBACK_ERRORS={RENDER:{FAILED:{evt:i.RENDER,code:1001,id:"player.error.render.failed",desc:"Stream Playback Generic Error"},ABORTED:{evt:i.RENDER,code:1002,id:"player.error.render.aborted",desc:"You aborted the video playback"},DECODE:{evt:i.RENDER,code:1003,id:"player.error.render.decode",desc:"Decoding error, The video playback was aborted due to a corruption problem or because the video used features your browser did not support."},CORRUPTED:{evt:i.RENDER,code:1004,id:"player.error.render.corrupted",desc:"Corrupted Stream Error"},UNSUPPORTED:{evt:i.RENDER,code:1005,id:"player.error.render.unsupported",desc:"Unsupported Video Format, The media resource indicated by the src attribute or assigned media provider object was not suitable."},DEVICE:{evt:i.RENDER,code:1006,id:"player.error.render.device",desc:"Device system Error, out of memory or other reason."},PLAYLIST:{evt:i.RENDER,code:1007,id:"player.error.render.playlist",desc:"Unrecognized play list or Play list is empty"}},NETWORK:{FAILED:{evt:i.NETWORK,code:2001,id:"player.error.network.failed",desc:"A network error caused the video download to fail part-way"},FILE:{evt:i.NETWORK,code:2002,id:"player.error.network.file",desc:"File is not found or network error while trying to load the file"},TIMEOUT:{evt:i.NETWORK,code:2003,id:"player.error.network.timeout",desc:"Network Timeout"},DISCONNECTED:{evt:i.NETWORK,code:2004,id:"player.error.network.disconnected",desc:"Network Disconnected"},PROTOCOL:{evt:i.NETWORK,code:2005,id:"player.error.network.protocol",desc:"Invalid Protocol"}},DRM:{FAILED:{evt:i.DRM,code:3001,id:"player.error.drm.failed",desc:"Authentication Failed, general message"},NOLICENCE:{evt:i.DRM,code:3002,id:"player.error.drm.nolicense",desc:"No License"},INVALID:{evt:i.DRM,code:3003,id:"player.error.drm.invalid",desc:"Invalid license"}},GENERIC:{UNKNOWN:{evt:i.GENERIC,code:4001,id:"player.error.generic.unknown",desc:"Unidentified Error on Playback"},LOAD:{evt:i.GENERIC,code:4002,id:"player.error.generic.load",desc:"Exception caught when trying to load the media"}}},t}),define("xdk-base/Thennable",["require","xdk-base/util"],function(e,t){"use strict";function i(e,t){this.pending=!0,this.obj=e,this.then=t}var n=function(){return e("./promise")};return i.prototype.reject=function(e){this.pending&&(this.pending=!1,this.rejecter(e))},i.prototype.fulfil=function(e){if(this.pending){if(this.pending=!1,n().isPromise(e))return void e.then(this.resolver,this.rejecter);try{i.handle(e,this.resolver,this.rejecter)||this.resolver(e)}catch(e){this.rejecter(e)}}},i.prototype.run=function(e,i){var n=this.obj,s=this.then;this.resolver=e,this.rejecter=i;try{s.call(n,t.bind(this.fulfil,this),t.bind(this.reject,this))}catch(e){this.reject(e)}},i.handle=function(e,s,r){if(!e)return!1;if(n().isPromise(e))return!1;if(!t.isFunction(e)&&!t.isPlainObject(e))return!1;var a=e.then;return!!t.isFunction(a)&&(new i(e,a).run(s,r),!0)},i}),define("xdk-base/promise",["xdk-base/core","require","exports","xdk-base/Thennable","xdk-base/util","xdk-base/exception","xdk-base/console"],function(e,t,i,n,s,r,a){"use strict";function o(){A.off.call(this,L.FULFILLED),A.off.call(this,L.REJECTED),A.off.call(this,L.PROGRESSED),A.off.call(this,L.CANCELLED),this._onCancel=null}function l(t,i){function n(e){this.isPending()&&(this._status.state=w.FULFILLED,this._status.value=e,I(s.bind(function(){A.fire.call(this,L.FULFILLED,e),o.call(this)},this)))}function a(e){this.isPending()&&(this._status.state=w.REJECTED,this._status.reason=e,I(s.bind(function(){A.fire.call(this,L.REJECTED,e),o.call(this)},this)))}function l(e){this.isPending()&&I(s.bind(function(){A.fire.call(this,L.PROGRESSED,e)},this))}if(!s.isFunction(t))throw e.createException(r.ILLEGAL_ARGUMENT,"task is not a Function");this._id=e.getGuid(),this._status={state:w.PENDING},this._activeThens=[],A.init.apply(this);var c=s.bind(n,this),d=s.bind(a,this),u=s.bind(l,this);try{t.call(this,c,d,u)}catch(e){d(e)}s.isFunction(i)&&(this._onCancel=s.bind(i,this))}function c(e,t){if(this.isPending()){if(t){var i=this._activeThens.indexOf(t);if(i>-1&&this._activeThens.splice(i,1),A.off.call(this,L.FULFILLED,t),A.off.call(this,L.REJECTED,t),A.off.call(this,L.PROGRESSED,t),this._activeThens.length>0)return}this._status.state=w.CANCELLED,this._onCancel(e),A.fire.call(this,L.CANCELLED),o.call(this)}}function d(e){return _(e)&&e.isPending()}function u(e){return!_(e)||e.isFulfilled()}function h(e){return _(e)&&e.isRejected()}function _(e){return e instanceof l}function g(e){return new l(function(t,i){t(e)})}function f(e){return new l(function(t,i){i(e)})}function p(e){return _(e)?e:g(e)}function m(){var e={};return e.promise=new l(function(t,i,n){e.fulfill=t,e.resolve=t,e.reject=i,e.notify=n},function(t){var i=e.onCancel;s.isFunction(i)&&i(t),e.onCancel=null}),e}function v(e,t){return S(e,void 0,t)}function b(e,t){return S(e,void 0,void 0,t)}function S(e,t,i,n,s){return p(e).then(t,i,n,s)}function y(e,t){return S(e,function(e){return S(t(),function(){return e})},function(e){return S(t(),function(){return f(e)})},null,function(){t()})}function E(e,t,n,s,r){var o,l;l=function(e){I(function(){if(i.onerror)i.onerror(e);else{if(e instanceof Error)throw e;a.warn(e)}})},o=t||n||s||r?S(e,t,n,s,r):e,v(o,l)}function k(e){return function(){function t(t,i){var n=t.then(function(n){e[i]=n,delete d[t.getId()],0==--c&&(r(e),s.clear(d))},function(e){a(e),s.clear(d)},function(e){o({index:i,value:e})});d[t.getId()]=n.getId()}function i(i,n,l){r=i,a=n,o=l,s.each(e,function(i,n){if(_(i)){if(h(i)&&a(i.inspect().reason),u(i))return void(e[n]=i.inspect().value);++c,t(i,n)}}),0===c&&r(e)}function n(t){s.each(e,function(e,i){_(e)&&e.isPending()&&(e.cancel(t,d[e.getId()]),delete d[e.getId()])})}var r,a,o,c=0,d={};return new l(i,n)}()}function C(e){return k(s.map(e,function(e){function t(){return e.inspect()}return _(e)||(e=p(e)),e.then(t,t)}))}function T(e){var t=m(),i=[];return S(e,function(e){s.each(e,function(e,n){_(e)||(e=p(e));var s=S(e,t.resolve,t.reject);i.push(s)})}),t.onCancel=function(e){s.each(i,function(t,i){t.cancel(e)})},t.promise}function x(e,t,i){return S(e,function(e){return k(e).then(function(e){return t.apply(void 0,e)},i)},i)}var I;i.nextTick=function(){function e(){for(;t.next;){t=t.next;var e=t.task;t.task=void 0;try{e()}catch(e){throw e}}n=!1}var t,i,n,s;return t={task:void 0,next:null},i=t,n=!1,I=function(e){i=i.next={task:e,next:null},n||(n=!0,s())},s=function(){setTimeout(e,0)},I}();var w={PENDING:"pending",FULFILLED:"fulfilled",REJECTED:"rejected",CANCELLED:"cancelled"},L={PROGRESSED:"progressed",FULFILLED:"fulfilled",REJECTED:"rejected",CANCELLED:"cancelled"},A={init:function(){this._listeners={}},on:function(e,t,i){this._listeners[e]=this._listeners[e]||{},this._listeners[e][t]=this._listeners[e][t]||[],this._listeners[e][t].push(i)},off:function(e,t){if(t&&this._listeners[e])return void delete this._listeners[e][t];delete this._listeners[e]},fire:function(e,t){var i=this._listeners[e];i&&s.each(i,function(e){for(var i=e.value,n=0;n<i.length;n++)i[n](t)})}};l.prototype.getId=function(){return this._id},l.prototype.then=function(e,t,i,r){var a=function(a){function o(r,o,l){function c(e,t,i){if(!s.isFunction(e))return void t(i);try{var l=e(i);if(l===this)return void o(new TypeError("promise's handler cannot return itself (same promise instance)"));if(_(l))return void(a=l.then(r,o));n.handle(l,r,o)||r(l)}catch(e){o(e)}}function d(e){if(!s.isFunction(i))return void l(e);try{var t=i(e);l(t)}catch(e){o(e)}}return a.isPending()?(A.on.call(a,L.FULFILLED,this.getId(),s.bind(c,this,e,r)),A.on.call(a,L.REJECTED,this.getId(),s.bind(c,this,t,o)),void A.on.call(a,L.PROGRESSED,this.getId(),d)):a.isFulfilled()?void I(s.bind(c,this,e,r,a.inspect().value)):a.isRejected()?void I(s.bind(c,this,t,o,a.inspect().reason)):void 0}function c(e){a.cancel(e,this.getId())}function d(){u.cancel(),s.isFunction(r)&&I(r)}var u=new l(o,c);return a.isPending()&&A.on.call(a,L.CANCELLED,u.getId(),d),u}(this);return this._activeThens.push(a.getId()),a},l.prototype.inspect=function(){return this._status},l.prototype.isPending=function(){return this._status.state===w.PENDING},l.prototype.isFulfilled=function(){return this._status.state===w.FULFILLED},l.prototype.isRejected=function(){return this._status.state===w.REJECTED},l.prototype.isCancelled=function(){return this._status.state===w.CANCELLED},l.prototype.cancel=c,i.Promise=l,i.promise=function(e){return new l(e)},i.isPending=d,i.isFulfilled=u,i.isRejected=h,i.isPromise=_,i.fulfill=g,i.reject=f,i.resolve=p,i.defer=m,i.fail=v,l.prototype.fail=function(e){return v(this,e)},i.progress=b,l.prototype.progress=function(e){return b(this,e)},i.when=S,l.prototype.complete=function(e){return y(this,e)},i.complete=y,i.done=E,l.prototype.done=function(e,t,i,n){return E(this,e,t,i,n)},i.all=k,i.allSettled=C,i.race=T,l.prototype.spread=function(e,t){return x(this,e,t)},i.spread=x}),define("xdk-base/device/interface/DevicePackage",["xdk-base/Interface"],function(e){"use strict";return e.create("DevicePackage",{setup:["onDeviceLoaded"],getId:[],getDefaultPlayer:[]})}),define("xdk-base/device/AbstractDevicePackage",["xdk-base/class","xdk-base/core","xdk-base/console","xdk-base/device/playerRegistry","xdk-base/device/interface/Player","xdk-base/util","xdk-base/config","xdk-base/promise","require","xdk-base/device/interface/DevicePackage"],function(e,t,i,n,s,r,a,o,l,c){"use strict";var d={STORAGE:"Storage",STORAGE_HANDLE:"storage",MEDIA_PLAYER:"Media",MEDIA_PLAYER_HANDLE:"media",TV_KEY:"TvKey",TV_KEY_HANDLE:"tvkey",ID:"Id",ID_HANDLE:"id",CONSOLE:"Console",CONSOLE_HANDLE:"console",SYSTEM:"System",SYSTEM_HANDLE:"system"},u=e.createAbstract([c],{STORAGE:d.STORAGE,STORAGE_HANDLE:d.STORAGE_HANDLE,MEDIA_PLAYER:d.MEDIA_PLAYER,MEDIA_PLAYER_HANDLE:d.MEDIA_PLAYER_HANDLE,TV_KEY:d.TV_KEY,TV_KEY_HANDLE:d.TV_KEY_HANDLE,ID:d.ID,ID_HANDLE:d.ID_HANDLE,CONSOLE:d.CONSOLE,CONSOLE_HANDLE:d.CONSOLE_HANDLE,SYSTEM:d.SYSTEM,SYSTEM_HANDLE:d.SYSTEM_HANDLE,BASIC_INTERFACES:[{name:d.STORAGE,handle:d.STORAGE_HANDLE},{name:d.MEDIA_PLAYER,handle:d.MEDIA_PLAYER_HANDLE},{name:d.TV_KEY,handle:d.TV_KEY_HANDLE},{name:d.ID,handle:d.ID_HANDLE},{name:d.SYSTEM,handle:d.SYSTEM_HANDLE}],_onDeviceReady:null,_shouldSetup:!1,prepare:function(e){u._onDeviceReady=e}},{__onDeviceReady:null,__interfaceTypes:{},__device:{},init:function(e){return this.__onDeviceReady=e,i.info("init of abstractDevicePackage"),this},setup:function(e){if(this._shouldSetup)return this.__onDeviceReady=e,i.info("set up abstractDevicePackage"),t.root.onunload=this.deinit,this},addInterfaceType:function(e,t,i){this.__interfaceTypes[e]={handle:t,interfaceObj:i},this.__device[t]=i},getInterface:function(e){return this.__interfaceTypes[e]?this.__interfaceTypes[e].interfaceObj:null},getId:e.abstractFn,ready:function(e){if(e=e||{},this.__onDeviceReady&&r.isFunction(this.__onDeviceReady))return void this.__onDeviceReady(this.__device,e);u._onDeviceReady(this.__device,e)},_preparePlayerList:function(e){e()},getDefaultPlayer:function(){return[]},_getDefaultPlayer:function(){return[]},deinit:function(){var e=l("xdk-base/device");i.info("[XDK] DOM Unloaded"),n.deinit(),e.deinit()}});return u}),define("xdk-base/interface/DeviceHandler",["xdk-base/Interface"],function(e){"use strict";return e.create("DeviceHandler",{onDeviceDetect:["platform"],onDeviceLoad:["launchData"],onDevicePause:[],onDeviceResume:[],onDeviceUnload:[],onDeviceKey:[]})}),define("xdk-base/device/basicInterfaces",[],function(){"use strict";return{STORAGE:"storage",MEDIA_PLAYER:"media",TV_KEY:"tvkey",ID:"id",SYSTEM:"system"}}),define("xdk-base/device",["xdk-base/config","xdk-base/console","xdk-base/core","xdk-base/util","xdk-base/device/AbstractDevicePackage","xdk-base/device/vKey","require","xdk-base/class","xdk-base/interface/DeviceHandler","xdk-base/exception","xdk-base/device/interface/Player","xdk-base/promise","xdk-base/device/playerRegistry","xdk-base/device/basicInterfaces"],function(e,t,i,n,s,r,a,o,l,c,d,u,h,_){"use strict";var g,f,p,m,v,b=!1,S=!1,y=!1,E=null,k=function(s,r){var l,g,v;if(S=!0,n.each(_,function(e){v=e.value,g=s[v],g||t.error("Basic interface not implemented in device package:name="+v),A[v]=g}),clearTimeout(m),A.tvkey.initKeyHandling(function(){return!1}),l=e.get("device.players",!1),l&&l[p.getId()]?l=l[p.getId()]:(p.getDefaultPlayer&&(l=p.getDefaultPlayer()),0===l.length&&p._getDefaultPlayer&&(l=p._getDefaultPlayer())),l.length>0)return void a(l,function(){var s,_=[];s=function(n,s){if(!o.hasImpl(n,d))throw i.createException(c.ILLEGAL_ARGUMENT,"Player does not implement ax/device/interface/Player: "+f);var r,g,f,m,v,b,S=[];f=l[s];try{r=new n(p)}catch(e){return void t.warn("[XDK] Fail to load the player : "+f+" : "+e.name)}h.register(r,f),g=e.get("device.multiAudioTrackStgy",null),g&&g[f]&&(S.push(g[f]),t.info("[XDK] Multi Audio Track exist "+g+" for "+f)),m=e.get("device.subtitleStgy",null),m&&m[f]&&(v=m[f],v.internal&&(t.info("[XDK] Loading the internal player strategy "+v.internal),S.push(v.internal)),v.external&&(t.info("[XDK] Loading the external player strategy "+v.external),S.push(v.external))),0!==S.length&&(b=u.defer(),_.push(b.promise),a(S,function(){t.info("[XDK] Loading the player strategies"),b.resolve()},function(){throw i.createException(c.ILLEGAL_ARGUMENT,"Unable to load the player related strategies. Please check the paths.")}))},n.each(Array.prototype.slice.call(arguments),s),u.all(_).then(n.bind(f,this,r)).done()},function(){throw i.createException(c.UNSUPPORTED_OPERATION,"Unable to load the player list. Please check the paths.")});f(r)},C=function(){throw clearTimeout(m),t.error("Initialize device package timeout!"),i.createException(c.UNSUPPORTED_OPERATION,"Initialize device package timeout!")},T=function(t){var i,s=e.get("device.initTimeout",1e4);if(m=setTimeout(C,s),!t)return void x("Device package reference not found.");t.prepare&&t.prepare(k),i=n.wrap(k,function(e,t){n.delay().then(n.bind(e,A,t))}),p=new t(i),p.setup(function(){A.platform=p.getId(),k.apply(null,arguments)})},x=function(e){throw t.error("Device package is unable to load due to: "+e.message),i.createException(c.UNSUPPORTED_OPERATION,"Device package is unable to load due to: "+e.message)},I=function(){y||(E||(E="xdk-base/device/workstation"),y=!0,g(E),a([E+"/DevicePackage"],T,x))},w=function(){var t=e.get("device.target-platform",null),s=e.get("device.packages",["xdk-base/device/workstation"]),r=[];if(S)return void(n.isFunction(f)&&f());if(t)return E=t,void n.defer().then(I).done()
;if(!n.isArray(s)||0===s.length)throw i.createException(c.ILLEGAL_ARGUMENT,"device.packages should be an array:"+s+" and should not be empty");n.each(s,function(e){r.push(e+"/detection")}),a(r,function(){n.each(Array.prototype.slice.call(arguments),n.bind(function(e,t){if(e)return E=s[t],n.breaker})),n.defer().then(I).done()},function(e){throw i.createException(c.UNSUPPORTED_OPERATION,"Unable to load detection from the provided packages list: "+s.toString(),". Please check your detection file. Stack: "+e.stack)})},L=function(){b||(b=!0,t.info("[XDK] DOM loaded"),A.bootstrap())},A={id:null,system:null,media:null,tvkey:null,storage:null,vKey:r,init:function(e){if(!o.hasImpl(e.constructor,l))throw i.createException(c.ILLEGAL_ARGUMENT,"[XDK] Not a valid device handler.");v=e,domReady(L)},_bootstrap:function(e,i){g=e.platformDetecetedCb||function(e){t.log("platform detected"+e)},f=e.inited,n.isFunction(i)&&(x=i),w()},bootstrap:function(){var e=this.getDeviceHandler();g=n.bind(e.onDeviceDetect,e),f=n.bind(e.onDeviceLoad,e),w()},getDeviceHandler:function(){return v},deinit:function(e){n.isFunction(e)&&e(),this.getDeviceHandler().onDeviceUnload()}};return A}),define("xdk-base/Env",["xdk-base/class","xdk-base/EventDispatcher","xdk-base/console","xdk-base/device/vKey","xdk-base/util","xdk-base/device","xdk-base/core","xdk-base/interface/DeviceHandler"],function(e,t,i,n,s,r,a,o){"use strict";var l,c;return l=e.create(t,[o],{singleton:function(){return c||(c=new l),c}},{EVT_ONDETECT:"env:device:ondetect",EVT_ON_PLATFORM_DETECTED:"env:device:ondetect",EVT_ONLOAD:"env:onload",EVT_ONUNLOAD:"env:onunload",EVT_ONKEY:"env:onkey",EVT_ON_MOUSE_WHEEL:"env:onmousewheel",EVT_ONPAUSE:"env:onpause",EVT_ONRESUME:"env:onresume",__ready:!1,__deviceReady:!1,resolution:null,__notBlockedKeysList:{},__isBlockingKeys:!1,__hasMouse:!1,__isBlockingMouse:!1,__launchData:null,isLoaded:function(){return this.__deviceReady},blockMouse:function(){this.__isBlockingMouse=!0},unblockMouse:function(){this.__isBlockingMouse=!1},isBlockingMouse:function(){return this.__isBlockingMouse},blockKeys:function(){this.__isBlockingKeys=!0},unblockKeys:function(){this.__isBlockingKeys=!1},isBlockingKeys:function(){return this.__isBlockingKeys},addNotBlockedKey:function(e){var t;if(s.isString(e))this.__notBlockedKeysList[e]=!0;else for(t in e)this.__notBlockedKeysList[e[t]]=!0},setWhitelist:function(e){this.__notBlockedKeysList=e},removeWhitelistedKey:function(e){delete this.__notBlockedKeysList[e]},dispatchEvent:function(e,t){return this.__isBlockingKeys&&e===this.EVT_ONKEY&&!this.__notBlockedKeysList[t.id]?(i.debug("Key blocked by env."),!1):this._super(e,t)},addEventListener:function(e,t,i){return e===this.EVT_ONLOAD&&this.__deviceReady?(t(this.__launchData),this):this._super(e,t,i)},hasMouse:function(){return r.system.hasMouse()},init:function(){this.addNotBlockedKey([n.EXIT.id,n.STOP.id]),r.init(this),this._super()},_onDeviceInited:function(){this.__deviceReady=!0,this.resolution=r.system.getDisplayResolution(),i.info("[XDK] env ready"),this.dispatchEvent(this.EVT_ONLOAD)},onDeviceLoad:function(e){e=e||{},e.isPaused=e.isPaused||!1,e.deeplinkData=e.deeplinkData||null,this.__deviceReady=!0,this.__launchData=e,this.resolution=r.system.getDisplayResolution(),i.info("[XDK] env ready from "+e.isPaused),i.info("[XDK] deeplink data: "+e.deeplinkData),this.dispatchEvent(this.EVT_ONLOAD,e)},onDeviceKey:function(e,t){var i=l.singleton();t=t||"device",e&&i.dispatchEvent(i.EVT_ONKEY,s.extend({source:t},e))},_onload:function(){this.__ready||(i.info("[XDK] DOM loaded"),this.__ready=!0,r._bootstrap&&r._bootstrap({inited:s.bind(this._onDeviceInited,this),platformDetecetedCb:s.bind(this._onPlatformDetected,this)}))},onDeviceUnload:function(){i.info("[XDK] Application unload"),this.__launchData=null,this._onunload()},_onunload:function(){this.__ready=!1,this.__deviceReady=!1,this.dispatchEvent(this.EVT_ONUNLOAD)},onDeviceDetect:function(e){i.info("[XDK] device detected  "+e),this.dispatchEvent(this.EVT_ONDETECT,e)},_onPlatformDetected:function(e){this.onDeviceDetect(e)},onDevicePause:function(){i.info("[XDK] Application pause"),this.dispatchEvent(this.EVT_ONPAUSE)},onDeviceResume:function(){i.info("[XDK] Application resume"),this.dispatchEvent(this.EVT_ONRESUME)}}),l.singleton(),l}),define("xdk-ax/evt/DualEventDispatcher",["xdk-base/class","xdk-base/EventDispatcher"],function(e,t){"use strict";return e.create(t,{},{__capturingCallbacks:{},__bubblingCallbacks:{},__switchMode:function(e){this.__eventCallbacks=e?this.__capturingCallbacks:this.__bubblingCallbacks},dispatchEvent:function(e,t,i){return i=!!i,this.__switchMode(i),this._super(e,t)},addEventListener:function(e,t,i,n){return i=!!i,this.__switchMode(i),this._super(e,t,n)},removeEventListener:function(e,t,i){return i=!!i,this.__switchMode(i),this._super(e,t)},removeAllListeners:function(){return this.__switchMode(!1),this._super(),this.__switchMode(!0),this._super(),this}})}),define("xdk-ax/evt/Event",["xdk-base/class","xdk-base/util","xdk-base/console"],function(e,t,i){"use strict";return e.create({},{_isPropagationStopped:!1,_isDefaultPrevented:!1,_defaultAction:null,target:null,type:"",init:function(e,n,s,r){var a;this.type=e,this.target=n,this._defaultAction=r;for(a in s)t.isUndefined(this[a])||i.warn("Data parameter have collision with some event class members! They will be ignored!"),this[a]=s[a]},_setDefaultAction:function(e){this._defaultAction=e},preventDefault:function(){this._isDefaultPrevented=!0},isDefaultPrevented:function(){return this._isDefaultPrevented},stopPropagation:function(){this._isPropagationStopped=!0},isPropagationStopped:function(){return this._isPropagationStopped},performDefaultAction:function(){this._defaultAction&&this._defaultAction(this)}})}),define("xdk-ax/evt/type",{SHOWN:"ui:evt:shown",HIDDEN:"ui:evt:hidden",DETACH:"ui:evt:detach",DETACHED_FROM_DOM:"ui:evt:detachDOM",ATTACH:"ui:evt:attach",ATTACHED_TO_DOM:"ui:evt:attachDOM",ATTACHED_TO_CONTROLLER:"ui:evt:attach-controller",DETACHED_FROM_CONTROLLER:"ui:evt:detach-controller",FOCUS:"ui:evt:focus",BLUR:"ui:evt:blur",KEY:"ui:evt:key",OPEN:"ui:evt:open",CLOSE:"ui:evt:close",CLICK:"ui:evt:click",MOUSEOVER:"ui:evt:mouseover",CANCEL:"ui:evt:cancel",CONFIRM:"ui:evt:confirm",SCROLL:"ui:evt:scroll",SELECTION_CHANGED:"ui:evt:selection-changed",TEXT_CHANGED:"ui:evt:text-changed",VALUE_CHANGED:"ui:evt:value-changed",MOVED:"ui:evt:moved",SCROLLED_TO_TOP:"ui:evt:scroll-to-top",SCROLLED_TO_BOTTOM:"ui:evt:scroll-to-bottom",ACTIVED:"ui:evt:actived",INACTIVED:"ui:evt:inactived",DRAG_MOVING:"ui:evt:drag-moving",DRAG_RELEASE:"ui:evt:drag-release",INDICATOR_UPDATED:"ui:evt:indicator-updated",SCROLLED_INDICATOR:"ui:evt:scrolled-indicator",SCROLLED_PERCENTAGE:"ui:evt:scrolled-percentage",CHANNEL_CHANGED:"device:evt:channel-changed",ANIM_ITERATION_ENDED:"ui:evt:anim-iteration-ended"}),define("xdk-ax/iterator/interface/Iterator",["xdk-base/Interface"],function(e){"use strict";return e.create("Iterator",{next:[],hasNext:[]})}),define("xdk-ax/iterator/BubblingCompIt",["xdk-base/class","xdk-ax/iterator/interface/Iterator","xdk-base/core"],function(e,t,i){"use strict";return e.create([t],{},{__curComp:null,init:function(e){this.__curComp=e},next:function(){this.__curComp||i.createException("NoSuchElement","No more element is available for current iteraion!");var e=this.__curComp;return this.__curComp=this.__curComp.getParent(),e},hasNext:function(){return!!this.__curComp}})}),define("xdk-ax/iterator/CapturingCompIt",["xdk-base/class","xdk-ax/iterator/interface/Iterator","xdk-base/core"],function(e,t,i){"use strict";return e.create([t],{},{__compArr:[],init:function(e){for(var t=e;t;)this.__compArr.push(t),t=t.getParent()},next:function(){return this.__compArr.length||i.createException("NoSuchElement","No more element is available for current iteraion!"),this.__compArr.pop()},hasNext:function(){return!!this.__compArr.length}})}),define("xdk-ax/iterator/DFSCompIt",["xdk-base/class","xdk-ax/iterator/interface/Iterator","xdk-base/core"],function(e,t,i){"use strict";return e.create([t],{},{__compArr:[],init:function(e){this._include(e)},_include:function(e){if(e.isLeaf())return void this.__compArr.unshift(e);var t,i=e.getChildren();for(t in i)this._include(i[t]);this.__compArr.unshift(e)},next:function(){return this.__compArr.length||i.createException("NoSuchElement","No more element is available for current iteraion!"),this.__compArr.pop()},hasNext:function(){return!!this.__compArr.length}})}),define("xdk-ax/evt/eventManager",["xdk-ax/evt/Event","xdk-ax/evt/type","xdk-ax/iterator/BubblingCompIt","xdk-ax/iterator/CapturingCompIt","xdk-ax/iterator/DFSCompIt"],function(e,t,i,n,s){"use strict";var r={};return r[t.ATTACH]={bubblingIt:s},r[t.ATTACHED_TO_DOM]={bubblingIt:s},r[t.DETACH]={bubblingIt:s},r[t.DETACHED_FROM_DOM]={bubblingIt:s},{trigger:function(t,s,a){a=a||{};var o,l,c,d;if(r[t]?(o=r[t].capturingIt,l=r[t].bubblingIt,o=o?new o(s):null,l=l?new l(s):null):(o=new n(s),l=new i(s)),c=new e(t,s,a,a.defaultAction),o)for(;!c.isPropagationStopped()&&o.hasNext();)d=o.next(),!1===d.dispatchEvent(t,c,!0)&&(c.stopPropagation(),c.preventDefault());if(l)for(;!c.isPropagationStopped()&&l.hasNext();)d=l.next(),!1===d.dispatchEvent(t,c,!1)&&(c.stopPropagation(),c.preventDefault());c.isDefaultPrevented()||c.performDefaultAction()}}}),define("xdk-base/Element",["xdk-base/class","xdk-base/core","xdk-base/console","xdk-base/util","xdk-base/device"],function(e,t,i,n,s){"use strict";var r,a=function(){var e=navigator.userAgent.toLowerCase();return-1!==e.indexOf("maple")&&-1!==e.indexOf("5.1")}(),o=function(){var e=document.getElementsByTagName("script")[0];return!(!e.classList||!e.classList.add)}(),l=function(){this.returnValue=!1},c=function(){this.cancelBubble=!0},d=function(e){return e.preventDefault||(e.preventDefault=l),e.stopPropagation&&(e.stopPropagation=c),e},u={mouseenter:"mouseover",mouseleave:"mouseout"},h=function(e,t){return u[e]?function(i){for(var n=i.relatedTarget,s=i.type;n&&n!==this._dom;)try{n=n.parentNode}catch(e){break}n!==this._dom&&(i.type=e,t.apply(this,arguments),i.type=s)}:null};return r=e.create({getById:function(e){var t=document.getElementById(e);return t&&n.isDOMElement(t)?new r(t):null}},{_dom:null,__events:null,__origDisplayStyle:"",init:function(e,t,i){n.isDOMElement(e)?this._dom=e:this._dom=document.createElement(e),n.isPlainObject(t)&&this.attr(t),i&&(i&&n.isDOMElement(i)&&(i=new r(i)),i.append(this._dom))},getHTMLElement:function(){return this._dom},getParent:function(){var e=this._dom.parentNode;return e?new r(e):null},detach:function(){if(!this._dom)return this;var e=this._dom.parentNode;return e&&e.removeChild(this._dom),null,e=null,this},show:function(){var e=this._dom.style.display;return"none"!==e?(this.__origDisplayStyle=e,this):(this._dom.style.display=this.__origDisplayStyle,this)},hide:function(){var e=this._dom.style.display;return"none"!==e&&(this.__origDisplayStyle=e),this._dom.style.display="none",this},toggle:function(){return"none"===this._dom.style.display?(this.show(),!0):(this.hide(),!1)},addEventListener:function(e,i,s){var r,a,o=this._dom,l=this.__events,c=e,d=i;return s=!!s,u[c]&&(e=u[c],i=h(c,i)),i=n.bind(i,this),d.$$guid||(d.$$guid=t.getGuid()),l||(this.__events=l={}),r=l[c],r||(r=l[c]={},c===e&&o["on"+e]&&(r[0]={},r[0][!1]=[o["on"+e]])),r[d.$$guid]=r[d.$$guid]||{},a=r[d.$$guid],a[s]=a[s]||[],a[s].push(i),o.addEventListener?o.addEventListener(e,i,s):o["on"+e]=n.bind(this._handleEvent,this),this},_handleEvent:function(e){var t,i,n,s,r=!0,a=e.type;e=e||d(window.event),t=this.__events[a],u[a]&&(t=t.concat(this.__events[u[a]]));for(n in t){i=t[n][(!1).toString()];for(s in i)this.$$handleEvent=i[s],!1===this.$$handleEvent(e)&&(r=!1)}return r},removeEventListener:function(e,t,i){var n,s,r,a,o=this._dom,l=this.__events,c=null,d=t,h=e;if(!e){if(!l)return this;for(s in l)this.removeEventListener(s);return this.__events=null,this}if(!t){if(!l)return this;n=l[e];for(r in n)for(a in n[r])for(;n[r]&&n[r][a]&&n[r][a].length;)this.removeEventListener(e,{$$guid:r},a===(!0).toString());return delete l[e],this}return i=!!i,l&&l[e]&&l[e][t.$$guid]&&l[e][t.$$guid][i]&&(c=l[e][t.$$guid][i],d=c.pop(),h=u[e]||e,0===c.length&&(delete l[e][t.$$guid][i],l[e][t.$$guid][!i]&&0!==l[e][t.$$guid][!i].length||delete l[e][t.$$guid])),o.removeEventListener&&o.removeEventListener(h,d,i),this},removeAllListeners:function(){return this.__events?(this.removeEventListener(),this):this},removeChild:function(e){return n.isDOMElement(e)||(e=e.getHTMLElement()),e.parentNode!==this._dom?(i.warn("unable to remove the non children node"),this):(n.isFunction(this._dom.removeChild)?this._dom.removeChild(e):n.each(Array.prototype.slice.call(this._dom.childNodes,0),function(t){if(t===e){this._dom.removeChild(t);null}},this),this)},removeAll:function(){for(var e=this._dom.childNodes[0];e;)this.removeChild(e),e=this._dom.childNodes[0];return this},append:function(e){return n.isDOMElement(e)?this._dom.appendChild(e):this._dom.appendChild(e.getHTMLElement()),this},appendTo:function(e){return n.isDOMElement(e)?e.appendChild(this._dom):e.append(this),this},insertBefore:function(e,t){var i,s;return i=n.isDOMElement(e)?e:e.getHTMLElement(),s=n.isDOMElement(t)?t:t.getHTMLElement(),this._dom.insertBefore(s,i),this},insertAfter:function(e,t){var i,s;return i=n.isDOMElement(e)?e:e.getHTMLElement(),s=n.isDOMElement(t)?t:t.getHTMLElement(),this._dom.lastChild===i?this._dom.appendChild(s):this._dom.insertBefore(s,i.nextSibling),this},replaceChild:function(e,t){var i,s,r;return i=n.isDOMElement(e)?e:e.getHTMLElement(),s=n.isDOMElement(t)?t:t.getHTMLElement(),this._dom.lastChild===i?(this._dom.removeChild(i),this._dom.appendChild(s)):(r=i.nextSibling,this._dom.removeChild(i),this._dom.insertBefore(s,r)),this},prepend:function(e){return n.isDOMElement(e)?this._dom.insertBefore(e,this._dom.firstChild):this._dom.insertBefore(e.getHTMLElement(),this._dom.firstChild),this},prependTo:function(e){return n.isDOMElement(e)?e.insertBefore(this._dom,e.childNodes[0]):e.prepend(this),this},isAttached:function(){return null!==this.getHTMLElement().parentNode},removeAttr:function(e){return this.hasAttr(e)&&this._dom.removeAttribute(e),this},removeStyle:function(e){return this.css(e)&&(this._dom.style[e]="",delete this._dom.style[e]),this},hasAttr:function(e){return this._dom.hasAttribute?this._dom.hasAttribute(e):!n.isUndefined(this._dom[e])},__getStyleText:function(){return n.isUndefined(this._dom.style.cssText)?this._dom.getAttribute("style"):this._dom.style.cssText},__setStyleText:function(e){n.isUndefined(this._dom.style.cssText)?this._dom.setAttribute("style",e):this._dom.style.cssText=e},__setStyle:function(e){var t,i,s,r=this.__getStyleText()||"",o=r,l=!r,c=[];if(a){for(t in e)e.hasOwnProperty(t)&&(this._dom.style[t]=e[t]);return this}for(t in e)e.hasOwnProperty(t)&&(t=n.camelize(t),i=n.decamelize(t,"-")+":"+e[t]+";",l?o+=i:n.isNull(this._dom.style[t])||n.isUndefined(this._dom.style[t])||""===this._dom.style[t]?o=i+o:c.push(t));this.__setStyleText(o);for(s in c)t=c[s],this._dom.style[t]=e[t];return this},__getStyle:function(e){e="float"===e?"cssFloat":n.camelize(e);var t=null;return this._dom.currentStyle&&(t=this._dom.currentStyle[e]),t||(t=this._dom.style[e]),"opacity"===e?t?parseFloat(t):1:"auto"===t?null:t},cumulativeOffset:function(){var e=0,t=0,i=this._dom;if(i.parentNode)do{e+=i.offsetTop||0,t+=i.offsetLeft||0,i=i.offsetParent}while(i);return{x:t,y:e}},addClass:function(e){return n.isArray(e)?n.each(e,function(e){this.addClass(e)},this):n.isString(e)&&(e=e.replace(/\s+/g," ").replace(/^\s/,"").replace(/\s$/,""),e.indexOf(" ")>=0?n.each(e.split(" "),function(e){this.addClass(e)},this):o?this._dom.classList.add(e):this.hasClass(e)||(this._dom.className+=(this._dom.className?" ":"")+e)),this},hasClass:function(e){if(o)return this._dom.classList.contains(e);var t=this._dom.className;return t.length>0&&(t===e||new RegExp("(^|\\s)"+e+"(\\s|$)").test(t))},removeClass:function(e){if(o)return this._dom.classList.remove(e),this;var t=this._dom.className.replace(new RegExp("(^|\\s+)"+e+"(\\s+|$)")," ");return t=n.strip(t),this._dom.className=t,this},setClass:function(e){return this._dom.className=n.strip(e),this},setInnerText:function(e){return n.isUndefined(this._dom.innerText)?n.isUndefined(this._dom.textContent)?i.warn("fail to set Text"+e):this._dom.textContent=e:this._dom.innerText=e,s.system&&s.system.redraw(this._dom),this},setInnerHTML:function(e){return this._dom.innerHTML=e,s.system&&s.system.redraw(this._dom),this},getInnerText:function(){return n.isUndefined(this._dom.innerText)?n.isUndefined(this._dom.textContent)?void i.warn("Fail to get innerText!"):this._dom.textContent:this._dom.innerText},getInnerHTML:function(){return this._dom.innerHTML},_findUltimateAncestor:function(){for(var e=this._dom;e.parentNode;)e=e.parentNode;return e},isInDOMTree:function(){return this._findUltimateAncestor().body===t.root.document.body},discard:function(){this.detach(),this.removeAllListeners(),this._dom=null},deinit:function(){this.discard()},attr:function(e,i){var s;if(n.isUndefined(e))throw t.createException("elementAttrError","Undefined attribute name");if(n.isPlainObject(e)){for(s in e)this.attr(s,e[s]);return this}return n.isUndefined(i)?n.isFunction(this._dom.getAttribute)?this._dom.getAttribute(e):null:n.isString(i)||n.isNumber(i)?(this._dom.setAttribute(e,i),this):("style"===e&&n.isPlainObject(i)&&this.css(i),this)},css:function(e,i){if(n.isUndefined(e))throw t.createException("elementCssError","Undefined css name");if(n.isPlainObject(e))return e.display&&("none"===e.display?this.__origDisplayStyle=this._dom.style.display:this.__origDisplayStyle=i),this.__setStyle(e),this;if(n.isUndefined(i))return this.__getStyle(e);if("display"===e&&("none"===i?this.hide():(this.__origDisplayStyle=i,this._dom.style.display=this.__origDisplayStyle)),n.isString(i)||n.isNumber(i)){var s={};return s[e]=i,this.__setStyle(s),this}return this},toggleClass:function(e){return this.hasClass(e)?this.removeClass(e):this.addClass(e)}})}),define("xdk-ax/mvc/Model",["xdk-base/class","xdk-base/EventDispatcher","xdk-base/util"],function(e,t,i){"use strict";return e.create(t,{defaults:{}},{_attrs:{},_changed:{},init:function(e,t){this._attrs=i.clone(this.constructor.defaults,!0),i.extend(this._attrs,e),this._super()},changedAttrs:function(){var e={},t=this;return i.each(this._changed,function(i){e[i.key]=t._attrs[i.key]}),e},get:function(e){return this._attrs[e]},set:function(e,t){var n=this;return i.isPlainObject(e)?(i.each(e,function(e){n.set(e.key,e.value)}),this):(this.__updateAttr(e,t),this)},unset:function(e){return this.has(e)?(this.set(e),this):this},has:function(e){return this._attrs.hasOwnProperty(e)},clear:function(){var e=this;return i.each(this._attrs,function(t){e.unset(t.key,t.value)}),this},attributes:function(){return this._attrs},on:function(e,t){this.addEventListener(e,t,!1)},once:function(e,t){this.addEventListener(e,t,!0)},off:function(e,t){this.removeEventListener(e,t)},__updateAttr:function(e,t){var n,s,r=this._attrs[e];t!==r&&(i.isUndefined(t)?delete this._attrs[e]:this._attrs[e]=t,this._changed[e]=!0,n="change:"+e,s={attr:e,type:"change",oldVal:r,newVal:t},this.dispatchEvent(n,s),this.dispatchEvent("change",s))}})}),define("xdk-ax/mvc/ModelRef",["xdk-base/class","xdk-ax/mvc/Model","xdk-base/core"],function(e,t,i){"use strict";return e.create({},{_model:null,_attr:null,init:function(e,n){if(!(e instanceof t&&n))throw i.createException("IncorrectParam","Incorrect parameter when trying to create a ModelRef instance!");this._model=e,this._attr=n},getModel:function(){return this._model},getAttr:function(){return this._attr},getVal:function(){return this._model.get(this._attr)}})}),define("xdk-ax/Component",["xdk-base/class","xdk-ax/evt/DualEventDispatcher","xdk-ax/evt/eventManager","xdk-base/util","xdk-ax/evt/type","xdk-ax/evt/Event","xdk-base/core","xdk-base/Element","xdk-base/device","xdk-ax/mvc/ModelRef","xdk-base/exception","xdk-base/console"],function(e,t,i,n,s,r,a,o,l,c,d,u){"use strict";return e.create(t,{PLACE_BEFORE:"before",PLACE_AFTER:"after",PLACE_APPEND:"append",PLACE_PREPEND:"prepend"},{_disabled:!1,_hidden:!1,_ancestorHidden:!1,_inDOMTree:!1,_parent:null,_root:null,_controller:null,_opts:null,__wrappedListeners:{},__visibilityModelRef:null,__visibilityListener:null,init:function(e){var t,i;e=e||{},e.root=e.root||new o("div"),this._super(e),this._root=e.root,this._root&&(this._root.getHTMLElement().__comp=this),this._parent=e.parent,this._opts=n.clone(e,!0),this._root&&this._parent&&(t=e.placement?e.placement:this.PLACE_APPEND,i=e.marker?e.marker:void 0,this._parent.attach(this,t,i)),e.id&&this.setId(e.id),e.css&&this._root.addClass(e.css),n.isUndefined(e.visible)||this.setVisibility(e.visible),this.postInit()},postInit:function(){var e=this._opts.style;e&&e.display&&"none"===e.display.toLowerCase()&&this.hide()},deinit:function(){this.detach(),this._super(),delete this._root.getHTMLElement().__comp,this._root.deinit(),this._root=null},isClickable:function(){return this.getOption("clickable",!1)},isDisabled:function(){return this._disabled},disable:function(){return this._disabled=!0,this._root.addClass("disabled"),this},enable:function(){return this._disabled=!1,this._root.removeClass("disabled"),this},isHidden:function(){return this._hidden},isAncestorHidden:function(){return this._ancestorHidden},_updateAncestorHidden:function(){var e=this.getParent();if(!e)return void(this._ancestorHidden=!1);this._ancestorHidden=e.isAncestorHidden()||e.isHidden()},_updateInDOMTree:function(e){this._inDOMTree=e},show:function(){return this.setVisibility(!0)},hide:function(){return this.setVisibility(!1)},toggle:function(){return this.isHidden()?this.setVisibility(!0):this.setVisibility(!1)},addClass:function(e){return this._root?(this._root.addClass(e),this):this},removeClass:function(e){return this._root?(this._root.removeClass(e),this):this},setId:function(e){n.startsWith(e,"#")?e.length>1&&(this._root.id=e.substr(1),this._root.attr("id",this._root.id)):this._root.id=e},getId:function(){return this._root.id||null},find:function(e){return this.getId()===e?this:null},isAncestorOf:function(e){return e.isDescendantOf(this)},isDescendantOf:function(e){return!!this._parent&&(this._parent===e||this._parent.isDescendantOf(e))},getOption:function(e,t){var i=this._opts[e];return n.isUndefined(i)&&(i=t),i},setOption:function(e,t){return this._opts[e]=t,this},getRoot:function(){return this._root},getParent:function(){return this._parent},attachController:function(e){this._controller=e},detachController:function(){this._controller=null},getAttachedController:function(){return this._controller},getController:function(){if(!this._controller){var e=this.getParent();return e?e.getController():null}return this._controller},getRootController:function(){for(var e=[],t=this.getParent();t;)e.push(t),t=t.getParent();for(;e.length;)if(t=e.shift(),t.getAttachedController())return t.getAttachedController();return null},detach:function(){return this._parent?(this._parent.detach(this),this):this},setActive:function(e){var t=this.getParent();t&&(t.setActiveChild(this),!0!==e&&t!==e&&t.setActive(e))},isActive:function(e){var t=this.getParent();return!(!t||!e&&t&&!t.isActive())&&t.isChildActive(this)},isLeaf:function(){return!0},__getMappedDOMEvent:function(e){switch(e){case s.CLICK:if("wiiu"===l.platform&&nwf){var t=nwf.display.DisplayManager.getInstance();if(window===t.getTVDisplay().window)return!1}return"click";case s.MOUSEOVER:return"mouseover"}return!1},addEventListener:function(e,t,i,o){var l,c,d=this.__getMappedDOMEvent(e);return d?(i=!!i,l=function(a){for(var l=this.getHTMLElement().__comp,d=a.target,u=d.__comp;!u;)d=d.parentNode,u=d.__comp;if(e===s.CLICK)for(;!u.isClickable();){if(u===l)return;u=u.getParent()}c=new r(e,u),n.bind(t,l)(c),o&&l.removeEventListener(e,t,i),a.stopPropagation(),a.preventDefault()},this._root.addEventListener(d,l,i),t.$$guid||(t.$$guid=a.getGuid()),this.__wrappedListeners[d]||(this.__wrappedListeners[d]={}),this.__wrappedListeners[d][t.$$guid]||(this.__wrappedListeners[d][t.$$guid]={}),this.__wrappedListeners[d][t.$$guid][i]||(this.__wrappedListeners[d][t.$$guid][i]=[]),this.__wrappedListeners[d][t.$$guid][i].push(l),this._super(e,t,i,o)):this._super(e,t,i,o)},removeEventListener:function(e,t,i){var n,s=this.__getMappedDOMEvent(e);return s?(i=!!i,this.__wrappedListeners&&this.__wrappedListeners[s]&&this.__wrappedListeners[s][t.$$guid]&&this.__wrappedListeners[s][t.$$guid][i]&&this.__wrappedListeners[s][t.$$guid][i].length?(n=this.__wrappedListeners[s][t.$$guid][i].pop(),this._root.removeEventListener(s,n,i),this._super(e,t,i)):this._super(e,t,i)):this._super(e,t,i)},removeAllListeners:function(){return this.__wrappedListeners={},this._root.removeAllListeners(),this._super()},setVisibility:function(e){return this.__visibilityModelRef&&this.__visibilityListener&&(this.__visibilityModelRef.getModel().off("change:"+this.__visibilityModelRef.getAttr(),this.__visibilityListener),this.__visibilityModelRef=null),e instanceof c&&(this.__visibilityListener||(this.__visibilityListener=n.bind(function(e){this.__setVisible(e.newVal)},this)),e.getModel().on("change:"+e.getAttr(),this.__visibilityListener),this.__visibilityModelRef=e,e=this.__visibilityModelRef.getVal()),this.__setVisible(e)},__setVisible:function(e){var t;if("boolean"!=typeof e){var n=this.getOption("id",void 0);u.warn("[Component] Expecting boolean value for visibility"+(n?" on component "+n:"")+"; actual: "+e)}return this._hidden=!e,this._hidden?(this._root.hide(),t=s.HIDDEN):(this._root.show(),t=s.SHOWN),this._updateAncestorHidden(),i.trigger(t,this,{hidden:this._hidden}),this}})}),define("xdk-ax/mvc/view",["xdk-base/core","xdk-ax/Component","xdk-base/util"],function(e,t,i){"use strict";return{_templateRenderHooks:{},hookTemplateRenderer:function(t,n){if(!i.isString(t))throw e.createException("IncorrectParam","Template hook attribute (hookAttr) should be a string : "+t);if(!i.isFunction(n))throw e.createException("IncorrectParam","Template hook helper (helperFn) should be a function : "+n);if(this._templateRenderHooks[t])throw e.createException("TemplateRenderHelperTaken","Template helper for hook ("+t+") is already taken.");this._templateRenderHooks[t]=n},render:function(n,s){if(i.isFunction(n)&&(n=n(s)),!i.isPlainObject(n))throw e.createException("ViewTemplateInvalid","View template is incorrect: "+i.stringify(n));if(!i.isFunction(n.klass))throw e.createException("ViewTemplateInvalid","Trying to create an unknown type. Template: "+i.stringify(n));if(!(n.klass.prototype instanceof t))throw e.createException("ViewTemplateInvalid","View template root must be a component! Template:"+i.stringify(n));var r,a,o,l,c,d;if(a=i.clone(n),delete a.klass,delete a.children,r=new n.klass(a),i.isArray(n.children)&&n.children.length)for(l=n.children.length,o=0;o<l;o++){if(d=null,c=n.children[o],!i.isPlainObject(c))throw e.createException("ViewTemplateInvalid","Sub-view template rendering has failed for: "+n.children[o]);if(i.each(this._templateRenderHooks,function(n){if(!i.isUndefined(c[n.key])){if(!((d=this._templateRenderHooks[n.key](c))instanceof t))throw e.createException("UnexpectedViewTemplateHelperResponse","View template helper did not return a Component: "+d);return r.attach(d),i.breaker}},this),!d){if(!(c.klass.prototype instanceof t))throw e.createException("ViewTemplateInvalid","Sub-view template contains unknown class! Sub-view template: "+i.stringify(c));d=this.render(c,!0),r.attach(d)}}return r}}}),define("xdk-ax/mvc/Controller",["xdk-base/class","xdk-base/core","xdk-base/util","xdk-ax/mvc/view","xdk-base/console","xdk-base/promise"],function(e,t,i,n,s,r){"use strict";n.hookTemplateRenderer("controller",function(e){var i=e.controller;if(!i.prototype instanceof a)throw t.createException("IncorrectAttribute","Controller attribute should be a Sub-Class of Controller");return n=(new i).getView()});var a=e.create({},{_view:null,_subControllers:[],_parentController:null,__id:null,deinit:function(){this._view.deinit(),this._view=null},setView:function(e){if(this._view)throw t.createException("ViewAlreadySet","This controller already has a view set, it is not supposed to be overwritten!");this._view=e,this._view.attachController(this);var n=this._extraSubController(),s=this;i.each(n,function(e){s._addSubController(e)})},_extraSubController:function(e,t){!e&&this._view&&(e=this._view),t||(t=[]);var i,n,s,r,a=e.getAttachedController();if(e!==this._view&&a)return t.push(a),t;if(e.isLeaf())return t;for(i=e.getChildren(),r=i.length,s=0;s<r;s++)n=i[s],t=this._extraSubController(n,t);return t},getView:function(){return this._view},getId:function(){return this.__id||(this.__id=""+t.getGuid()),this.__id},getControllerByClass:function(e){if(this instanceof e)return this;var t,i,n=this._subControllers.length;for(t=0;t<n;t++)if(i=this._subControllers[t].getControllerByClass(e))return i;return!1},_setupSubtree:function(e){var t,n,s,a,o,l=0,c=this._subControllers.length,d=[],u=!1;for(o=this.setup(e),r.isPromise(o)&&(u=!0);l<c;l++)t=this._subControllers[l],n=t.getId(),s=e&&e.subContexts&&e.subContexts[n]?e.subContexts[n]:{},u?d.push(o.then(function(){return t._setupSubtree(s)})):d.push(t._setupSubtree(s));return a=d.length>0?r.all(d):o,this.postSetup?a&&u?a.then(i.bind(function(){this.postSetup(e)},this)):r.resolve(this.postSetup(e)):r.isPromise(a)?a:r.resolve()},setup:function(e){s.debug("controller set up"+e)},_resetSubtree:function(){for(var e=0,t=this._subControllers.length;e<t;e++)this._subControllers[e]._resetSubtree();this.reset()},reset:function(){},_addSubController:function(e){return this._subControllers.indexOf(e)>0?(s.warn(e.getId()+" is already a sub-controller of "+this.getId()),!1):(this._subControllers.push(e),e._parentController=this,!0)},_removeSubController:function(e){var t=this._subControllers.indexOf(e);return!(t<0)&&(this._subControllers.splice(t,1),!0)},getSubControllers:function(){return this._subControllers},getSubController:function(e){if(i.isNumber(e))return this._subControllers[e];var t,n,s=this._subControllers.length;for(n=0;n<s;n++)if((t=this._subControllers[n])instanceof e)return t;for(n=0;n<s;n++)if(t=this._subControllers[n].getSubController())return t;return null},getParentController:function(){return this._parentController},getContextTree:function(){for(var e,t=this.getContext(),i=null,n=0,s=this._subControllers.length;n<s;n++)e=this._subControllers[n],(i=e.getContextTree())&&(t=t||{},t.subContexts=t.subContexts||{},t.subContexts[e.getId()]=i);return t},getContext:function(){return null}});return a}),define("xdk-ax/Container",["xdk-base/class","xdk-ax/Component","xdk-base/core","xdk-ax/evt/eventManager","xdk-base/util","xdk-ax/evt/type","xdk-base/console"],function(e,t,i,n,s,r,a){"use strict";var o=e.create(t,{},{_children:[],__activeness:[],init:function(e){this._super(e)},deinit:function(){var e,t=this._children.slice(0),i=t.length;for(e=0;e<i;e++)t[e].deinit();this._super()},postInit:function(){if(this._super(),this._opts.children&&s.isArray(this._opts.children)){var e,t=0,i=this._opts.children.length;if(!(i<=0))for(;t<i;t++)e=this._opts.children[t],this.attach(e)}},find:function(e){if(this.getId()===e)return this;var t,i,n=this._children.length;for(t=0;t<n;t++)if(i=this._children[t].find(e))return i;return null},getChildren:function(){return this._children.slice(0)},attach:function(e,t,l){if(s.indexOf(this._children,e)>=0)return a.warn("Child is already attached to container"),this;t||(t=o.PLACE_APPEND);var c=l?s.indexOf(this._children,l):this._children.length-1;switch(t){case o.PLACE_APPEND:this._children.push(e);break;case o.PLACE_PREPEND:this._children.unshift(e);break;case o.PLACE_BEFORE:if(c<0)throw i.createException("IncorrectParam","The insert place marker component must be a child of this container!");this._children.splice(c,0,e);break;case o.PLACE_AFTER:
if(c<0)throw i.createException("IncorrectParam","The insert place marker component must be a child of this container!");this._children.splice(c+1,0,e)}return this._doAttach(e,t,l),this.__activeness.push(e),e._parent=this,e._updateAncestorHidden(),this._root.isInDOMTree()&&e._updateInDOMTree(!0),n.trigger(r.ATTACH,e),this._root.isInDOMTree()&&n.trigger(r.ATTACHED_TO_DOM,e),this},_doAttach:function(e,t,i){switch(t){case o.PLACE_APPEND:this._root.append(e.getRoot());break;case o.PLACE_PREPEND:this._root.prepend(e.getRoot());break;case o.PLACE_BEFORE:this._root.insertBefore(i.getRoot(),e.getRoot());break;case o.PLACE_AFTER:this._root.insertAfter(i.getRoot(),e.getRoot())}},replace:function(e,t){if(t!==e){var a=s.indexOf(this._children,e),o=s.indexOf(this.__activeness,e),l=this._root.isInDOMTree();if(a<0)throw i.createException("IncorrectParam","The replace target component must be a child of this container!");this._children.splice(a,1,t),this.__activeness.splice(o,1,t),this._doReplace(e,t),t._parent=this,e._parent=null,t._updateAncestorHidden(),l&&t._updateInDOMTree(!0),n.trigger(r.ATTACH,t),l&&n.trigger(r.ATTACHED_TO_DOM,t),e._updateAncestorHidden(),l&&e._updateInDOMTree(!1),n.trigger(r.DETACH,e),l&&n.trigger(r.DETACHED_FROM_DOM,e)}},_doReplace:function(e,t){this._root.replaceChild(e.getRoot(),t.getRoot())},detach:function(e){if(!e)return this._super();var t,a=s.indexOf(this._children,e);if(a<0)throw i.createException("IncorrectParam","The detach target component must be a child of this container!");return this._children.splice(a,1),t=s.indexOf(this.__activeness,e),this.__activeness.splice(t,1),e.getRoot().detach(),e._parent=null,e._updateAncestorHidden(),this._root.isInDOMTree()&&e._updateInDOMTree(!1),n.trigger(r.DETACH,e),this._root.isInDOMTree()&&n.trigger(r.DETACHED_FROM_DOM,e),this},detachAll:function(){for(var e=this._children.length;e--;)this._children[e].detach();this._children=[]},setActiveChild:function(e){e instanceof t||(e=this.find(e));var a=s.indexOf(this.__activeness,e);if(a<0)throw i.createException("IncorrectParam","The target component must be a child of this container!");0!==a&&(this.__activeness.splice(a,1),this.__activeness.unshift(e),n.trigger(r.INACTIVED,this.__activeness[1]),n.trigger(r.ACTIVED,this.__activeness[0]))},getActiveChildren:function(){return this.__activeness.slice(0)},getActiveChild:function(e){return s.isUndefined(e)&&(e=0),e<0||e>this.__activeness.length-1?null:this.__activeness[e]},getActiveLeaf:function(){for(var e=this;!e.isLeaf();)e=e.getActiveChild();return e},isChildActive:function(e){return e===this.__activeness[0]},_updateAncestorHidden:function(){this._super(),s.each(this._children,function(e){e._updateAncestorHidden()})},_updateInDOMTree:function(e){this._super(e),s.each(this._children,function(t){t._updateInDOMTree(e)})},isLeaf:function(){return 0===this._children.length}});return o}),define("xdk-ax/mvc/ControllerManager",["xdk-base/core","xdk-base/class","xdk-base/EventDispatcher","xdk-ax/mvc/Controller","xdk-base/promise","xdk-base/util","xdk-base/exception","require"],function(e,t,i,n,s,r,a,o){"use strict";var l,c;return l=t.create(i,{EVT_REPLACED:"ui:ctrlMgr:replaced",EVT_OPENED:"ui:ctrlMgr:opened",EVT_CLOSED:"ui:ctrlMgr:closed",singleton:function(){return c||(c=new l),c}},{replace:function(t,i,l){var c,d,u,h,_,g;if(c=o("xdk-ax/mvc/AppRoot").singleton(),!(t instanceof n)){if(!(t.prototype instanceof n))return s.reject(e.createException(a.ILLEGAL_ARGUMENT,"Fail to get the current controller instance."));t=c.getControllerByClass(t)}if(!(i instanceof n)){if(!(i.prototype instanceof n))return s.reject(e.createException(a.ILLEGAL_ARGUMENT,"Replacement controller is not a Controller class!"));i=new i}return d=t.getView(),u=i.getView(),h=t.getParentController(),d&&u?(_=d.getParent())?(l=l||{},g=l.context||{},_.replace(d,u),h&&(h._removeSubController(t),h._addSubController(i)),t._resetSubtree(),i._setupSubtree(g).then(r.bind(function(){return this.dispatchEvent(this.constructor.EVT_REPLACED,{exist:t,replacement:i,options:l}),i},this))):s.reject(e.createException(a.ILLEGAL_ARGUMENT,"Controller to be replaced is not attached to a parent!")):s.reject(e.createException(a.ILLEGAL_ARGUMENT,"One of the controllers does not have a view!"))},open:function(t,i,o){var l,c,d;if(o=o||{},l=o.context||{},i instanceof n&&(i=i.getView()),!i)return s.reject(e.createException(a.ILLEGAL_ARGUMENT,"Fail to find the container to open a new controller."));if(!(t instanceof n)){if(!(t.prototype instanceof n))return s.reject(e.createException(a.ILLEGAL_ARGUMENT,"Fail to get the controller instance when opening controller."));t=new t}return c=t.getView(),d=i.getController(),c?(i.attach(c),d&&d._addSubController(t),t._setupSubtree(l).then(r.bind(function(){return this.dispatchEvent(this.constructor.EVT_OPENED,{controller:t,container:i,options:o}),t},this))):s.reject(e.createException(a.ILLEGAL_ARGUMENT,"Fail to get the view from the controller instance."))},close:function(t,i){var r,l,c,d;if(i=i||{},r=o("xdk-ax/mvc/AppRoot").singleton(),!(t instanceof n)){if(!(t.prototype instanceof n))return s.reject(e.createException(a.ILLEGAL_ARGUMENT,"Fail to get the controller instance when closing controller."));t=r.getControllerByClass(t)}return l=t.getView(),c=t.getParentController(),l?(d=l.getParent())?(c&&c._removeSubController(t),l.detach(),t._resetSubtree(),this.dispatchEvent(this.constructor.EVT_CLOSED,{controller:t,container:d,options:i}),s.resolve()):s.reject(e.createException(a.ILLEGAL_ARGUMENT,"The controller instance to be closed is not attached to a parent!")):s.reject(e.createException(a.ILLEGAL_ARGUMENT,"Fail to get the view from the controller instance."))}}),l.singleton(),l}),define("xdk-ax/iterator/BFSCompIt",["xdk-base/class","xdk-ax/iterator/interface/Iterator","xdk-base/core"],function(e,t,i){"use strict";return e.create([t],{},{__compArr:[],init:function(e){this._include(e)},_include:function(e){if(!e.isLeaf()){var t,i=e.getChildren();for(t in i)this.__compArr.unshift(i[t]);for(t in i)this._include(i[t])}},next:function(){return this.__compArr.length||i.createException("NoSuchElement","No more element is available for current iteraion!"),this.__compArr.pop()},hasNext:function(){return!!this.__compArr.length}})}),define("xdk-ax/iterator/AFSCompIt",["xdk-base/class","xdk-ax/iterator/interface/Iterator","xdk-base/core"],function(e,t,i){"use strict";return e.create([t],{},{__compArr:[],init:function(e){this._include(e)},_include:function(e){if(e.isLeaf())return void this.__compArr.unshift(e);var t,i=e.getActiveChildren();for(t=0;t<i.length;t++)this._include(i[t]);this.__compArr.unshift(e)},next:function(){return this.__compArr.length||i.createException("NoSuchElement","No more element is available for current iteraion!"),this.__compArr.pop()},hasNext:function(){return!!this.__compArr.length}})}),define("xdk-ax/focusManager",["xdk-ax/Component","xdk-base/util","xdk-ax/evt/eventManager","xdk-ax/evt/type","xdk-base/device/vKey","xdk-base/console","xdk-base/config","xdk-ax/iterator/BFSCompIt","xdk-ax/iterator/AFSCompIt","xdk-ax/Container","xdk-base/core","xdk-base/exception"],function(e,t,i,n,s,r,a,o,l,c,d,u){"use strict";function h(e){for(var t;!t&&(e=e.getParent());)t=e.getOption("forwardFocus");return t}function _(e){var t,i,n;if(e.isLeaf())return null;for(n=e.getChildren(),i=0;i<n.length;i++)if(t=n[i],S(t))return t;return null}function g(e,t){var i,n,s,r=null;if(e.isLeaf())return null;for(s=e.getChildren(),n=0;n<s.length;n++)if(i=s[n],r=p(i,t))return r;return r}function f(t){var i=t._lastFocusChild;return i instanceof e&&t.isAncestorOf(i)&&S(i)?(r.info("Using last focus for forward focus"),i):(r.info("Find the next level focusable item"),_(t))}var p,m,v,b,S,y,E,k,C=null,T=null,x=null,I=null,w=null;return p=function(i,n){if(!i)return null;if(S(i))return i;var s,r;if(!0===(s=i.getOption("forwardFocus")))(r=f(i))||(r=g(i,!0));else{if(!1===s)return null;t.isUndefined(s)?n?r=g(i,n):!0===(s=h(i))&&((r=f(i))||(r=g(i,!0))):r=s}return r&&t.isString(r)&&(r=i.find(r)),r&&r instanceof e?S(r)?r:p(r):null},E=function(e){return e._focused||!1},y=function(e){return e._root.hasClass("focus-trail")||!t.isUndefined(e._focusTrail)&&e._focusTrail},S=function(e){return!!(e.isAncestorHidden()&&e.isFocusableHidden&&e.isFocusableHidden())||!(e._disabled||e.isHidden()||e.isAncestorHidden())&&e.getOption("focusable",!1)},k=function(e){return e._lastFocused},m=function(e){e=e||T.getView();for(var t,i=0,n=null,s=new l(e);s.hasNext();)t=s.next(),S(t)?i<k(t)&&(n=t,i=k(t)):t=t.getParent();return i?n:null},function(){C.focus(m(),{noActive:!0})},v=function(e,t){var s,r=I.getParent();for(e.removeClass("focused"),e._focused=!1;r;)C.isCompFocusTrailOn(r)?r.removeClass("focus-trail"):r._focusTrail=!1,r=r.getParent();t&&(s={relatedTarget:t}),i.trigger(n.BLUR,I,s),x=I,I=null},b=function(e,t,s){var a,o=e.getParent();for(I=e,e.getRoot().addClass("focused"),e._focused=!0,e._lastFocused=(new Date).getTime();o;)C.isCompFocusTrailOn(o)?o.getRoot().addClass("focus-trail"):o._focusTrail=!0,!0===o.getOption("forwardFocus")&&(o._lastFocusChild=e),o=o.getParent();s&&s.noActive||I.setActive(),r.info("[FocusMgr] focused on component "+I+" with id'"+I.getId()+"'"),t&&(a={relatedTarget:t}),i.trigger(n.FOCUS,I,a)},C={FOCUS_UP:1,FOCUS_DOWN:2,FOCUS_LEFT:4,FOCUS_RIGHT:8,_setRootController:function(e){T=e},setFocusRoot:function(e){if(e&&!(e instanceof c))throw d.createException(u.ILLEGAL_ARGUMENT,"Focus root should be an instance of xdk-ax/Container");this._focusRoot=e,r.info("[focusManager] focus root is set to ["+(e?e.getId():e)+"]")},getFocusRoot:function(){return this._focusRoot},_isComponentOutsideFocusRoot:function(e){return this._focusRoot&&!(e.isDescendantOf(this._focusRoot)||e===this._focusRoot)},setReserveFocus:function(e){w=e},getReserveFocus:function(e){return w},focus:function(i,n){if(n=n||{},!i)return I&&v(I),!0;var s,a=!!n.skipForwardFocus,o=null,l=I;if(i.getOption("focusable")){if(t.isFunction(i.onRequestFocus)&&(s=i.onRequestFocus()),t.isString(s)&&(s=i.find(s)),s instanceof e)return C.focus(s);if(s)return!0}else if(!a)return o=p(i),o instanceof e?o===i?(r.warn("[focusManager] forward focus is the same as the original component, abort focus process."),!1):C.focus(o):(r.warn("[focusManger] no valid forward focus, abort focus process."),!1);return this._isComponentOutsideFocusRoot(i)?(r.warn("[focusManager] the requested focus target ["+i.getId()+"] is out of the focus root ["+this._focusRoot.getId()+"]"),!1):S(i)?(I&&!E(i)&&v(I,i),b(i,l,n),!0):(r.warn("Delegated component is not Focusable! Component ID: "+i.getId()),!1)},getCurFocus:function(){return I||null},directionalFocusChangeByKey:function(e,t){var i=!1;switch(e.id){case s.UP.id:i=this.directionalFocusChange(C.FOCUS_UP,t);break;case s.DOWN.id:i=this.directionalFocusChange(C.FOCUS_DOWN,t);break;case s.LEFT.id:i=this.directionalFocusChange(C.FOCUS_LEFT,t);break;case s.RIGHT.id:i=this.directionalFocusChange(C.FOCUS_RIGHT,t)}return i},directionChangeByKey:function(e,t){var i=!1;switch(e.id){case s.UP.id:i=this.directionChange(C.FOCUS_UP,t);break;case s.DOWN.id:i=this.directionChange(C.FOCUS_DOWN,t);break;case s.LEFT.id:i=this.directionChange(C.FOCUS_LEFT,t);break;case s.RIGHT.id:i=this.directionChange(C.FOCUS_RIGHT,t)}return i},directionalFocusChange:function(e,t){return!!this.directionChange(e,t)},directionChange:function(i,n){if(n&&!this.isCompChildFocused(n))return r.warn("Directional focus change is not possible!"),!1;n=n||T.getView();var s,a,o;if(!I){if(!(s=m()))return!1;if(this.focus(s))return s}for(o=I,i===C.FOCUS_UP?i="nextUp":i===C.FOCUS_DOWN?i="nextDown":i===C.FOCUS_LEFT?i="nextLeft":i===C.FOCUS_RIGHT&&(i="nextRight");o&&o!==n;){if(this._isComponentOutsideFocusRoot(o))return r.warn("[focusManager] abort direction check: the parent component ["+o.getId()+"] is out of the focus root ["+this._focusRoot.getId()+"]"),!1;if(a=o.getOption(i),t.isFunction(a)&&(a=a.call(I),r.debug("directional focus callback return value: "+a)),!0===a)return a;if(!1===a||t.isUndefined(a))o=o.getParent();else{if(null===a)return!0;if(t.isString(a)){s=n.find(a),s||n===T.getView()||(s=T.getView().find(a));break}if(a instanceof e){s=a;break}o=o.getParent()}}return!!s&&(this.focus(s)?s:void 0)},ensureFocus:function(){return!!I||!!x&&this.focus(x)},setCompFocusTrail:function(e,i){return t.isBoolean(i)&&(e._enableTrail=i),e._enableTrail},resetCompFocusTrail:function(e){return e._enableTrail=void 0,e._enableTrail},isCompFocusTrailOn:function(e){return e&&t.isUndefined(e._enableTrail)?a.get("ui.focus.enableTrail",!0):!!e._enableTrail},getLastActiveFocus:m,isCompFocused:E,isCompChildFocused:y,isCompFocusable:S,getCompLastFocusedTime:k}}),define("css",[],function(){"use strict";function e(e,t){-1===e.indexOf(".css")&&(e+=".css");var n=document.createElement("link");n.type="text/css",n.rel="stylesheet",n.href=e,i.appendChild(n),t(e)}var t={dynamic:!1,pluginBuilder:"xdk-base/loader/cssBuilder"},i=document.getElementsByTagName("head")[0];return t.load=function(t,i,n){e(i.toUrl(t),function(e){n(e)})},t}),define("css!xdk-ax/mvc/css/AppRoot",[],function(){}),define("xdk-ax/mvc/AppRoot",["xdk-base/class","xdk-ax/mvc/Controller","xdk-base/core","xdk-base/Env","xdk-ax/Container","xdk-base/promise","xdk-base/util","xdk-base/device/vKey","xdk-ax/evt/type","xdk-ax/evt/eventManager","xdk-base/device","xdk-ax/mvc/ControllerManager","xdk-ax/focusManager","xdk-base/exception","require","css","css!./css/AppRoot"],function(e,t,i,n,s,r,a,o,l,c,d,u,h,_,g){"use strict";var f,p,m=n.singleton(),v=u.singleton();return f=e.create(t,{singleton:function(){return p||(p=new f),p}},{_envLoaded:!1,_keyActions:{},init:function(){this._super();var e=this;m.addEventListener(m.EVT_ONLOAD,function(){e._onEnvLoad()})},_onEnvLoad:function(){this._envLoaded=!0;var e,t=this,n=new s({id:"#TVArea"}),r=d.system.getDisplayResolution();n.getRoot().appendTo(i.root.document.body),n.addClass(d.platform),n.addClass("_"+r.width+"x"+r.height),this.setView(n),h._setRootController(this),e=a.bind(function(e){if(!this._keyActions[e.id]||!this._keyActions[e.id](e))switch(e.id){case o.EXIT.id:d.system.exit();break;case o.UP.id:case o.DOWN.id:case o.LEFT.id:case o.RIGHT.id:h.directionChangeByKey(e,this.getView());break;case o.OK.id:e.target.isClickable()&&c.trigger(l.CLICK,e.target);break;default:return}},this),m.addEventListener(m.EVT_ONKEY,function(i){var n=g("xdk-ax/focusManager").getCurFocus();n=n||t.getView(),c.trigger(l.KEY,n,a.extend({source:i.source,defaultAction:e},i))})},setDefaultKeyAction:function(e,t){a.isArray(e)||(e=[e]),a.each(e,function(e){if(this._keyActions[e])throw i.createException("KeyactionAlreadyRegisterd","Key ("+e+") is already set");this._keyActions[e]=t},this)},setMainController:function(e,t){if(!this._envLoaded)return r.reject(i.createException(_.ILLEGAL_STATE,"AppRoot is waiting for environment to load, therefore it is not ready!"));t=t||{};var n,s;return(n=this.getView().getActiveChild())?(s=n.getController(),v.replace(s,e,t)):(t.appRootFirstController=!0,v.open(e,this,t))},getParentController:function(){return null}}),f.singleton(),f}),define("xdk-base/ajax",["xdk-base/core","xdk-base/util","xdk-base/promise","xdk-base/console","xdk-base/config"],function(e,t,i,n,s){function r(e){var t=navigator.userAgent.toLowerCase();return(-1===t.indexOf("maple 5.1")||"delete"!==e)&&(!(t.indexOf("aquosbrowser")>-1||t.indexOf("ipad;")>-1)||"delete"!==e&&"put"!==e)}function a(e){return!s.get("ajax-method-override",!0)||!!~["get","post","delete","put"].indexOf(e)}function o(t,i){if(t&&i){if(f[t])throw e.createException("Repeated id for deferred creation");return f[t]=i,f[t]}}function l(e){return f[e]}function c(e){f[e]=void 0}function d(){try{return new XMLHttpRequest}catch(e){}}function u(){try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(e){}}function h(){try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}}function _(){return d()||u()||h()||!1}function g(s,l){function d(){var e=this.readyState;e>1&&(4!==e||!C)&&u.apply(this)}function u(){var e,i,s,r,a=this.readyState;try{if(4===a&&!T){if(b&&(clearTimeout(b),b=null),C=!0,e=this.status,!0,i=this.responseText,(s=this.getResponseHeader("content-type"))&&s.toLowerCase().indexOf("json")>-1)try{this.responseJSON=t.parse(i)}catch(e){n.info("Unable to parse JSON")}p&&(r={},r.response=this.response||"",r.responseText=this.responseText||"",r.responseType=this.responseType||"",r.responseJSON=this.responseJSON||"",r.responseXML=this.responseXML||"",r.readyState=this.readyState||null,r.status=this.status,r.statusText=this.statusText||"",function(e){r.getAllResponseHeaders=function(){return e};var i;r.getResponseHeader=function(n){return n?(i||(i={},e&&t.each(e.split("\n"),function(e){var t=e.indexOf(":");if(!(t<0)){var n=e.substr(0,t).toLowerCase();i[n]=e.substr(t+1)}})),n=n.toLowerCase(),n in i?i[n]:null):null}}(this.getAllResponseHeaders())),e>=200&&e<300||304===e?v.resolve(r||this):(!1,v.reject({transport:r||this,type:"failure"})),h()}}catch(e){v.reject({transport:r||this,ex:e,type:"exception"}),h(),n.error(e)}}function h(){S&&S.id&&c(S.id),k&&(k.destroy&&k.destroy(),k.onreadystatechange=null,k=null,delete k)}function g(){n.info("abort the transport"),T=!0;try{k.abort()}catch(e){T=null}b&&(clearTimeout(b),b=null),h()}function f(){n.info("abort the transport"),g(),v.reject({transport:k,type:"abort"})}function m(){var s,a;v=i.defer();try{k.open(S.method.toUpperCase(),x,S.async),k.onreadystatechange=d,!1,s=S.requestHeaders||{};for(a in s)n.info(a+" - "+s[a]),k.setRequestHeader(a,s[a]);if(S.withCredentials){var o=function(){return g(),n.warn("withCredentials is not supported in this browser"),i.reject({transport:k,ex:e.createException("withCredentials is not supported in this browser"),type:"exception"})};if(!("withCredentials"in k))return o();try{k.withCredentials=!0}catch(e){return o()}}if(E=null,t.isUndefined(S.postBody)?t.isUndefined(y)||(E=y):E=S.postBody,!r(S.method))return g(),n.info("unsupport method in this device"+S.method),i.reject({transport:k,ex:e.createException("unsupport method in this device"),type:"exception"});b=setTimeout(function(){g(),v.reject({transport:k,type:"failure"}),h(),b=null},1e3*S.timeOut),E?k.send(E):k.send()}catch(e){v.reject({transport:k,ex:e,type:"exception"}),n.error(e.stack)}return v.promise}l=l||{};var v,b,S,y,E,k=null,C=!1,T=!1,x=s;l.timeOut=t.isNumber(l.timeOut)?l.timeOut:30,t.isFunction(l.toObject)&&(l=l.toObject()),S={method:"get",async:!0,checkContentType:!1,parameters:""},t.extend(S,l),S.method=S.method.toLowerCase(),k=_(),S.id&&o(S.id,this),y=t.isString(S.parameters)?S.parameters:t.toQueryString(S.parameters),a(S.method)||(y+=(y?"&":"")+"_method="+S.method,S.method="post"),y&&"get"===S.method&&t.isString(y)&&y.length>0&&(x+=(x.indexOf("?")>0?"&":"?")+y),this.abort=f,this.send=m}var f={},p=function(){return-1!==navigator.userAgent.toLowerCase().indexOf("maple")||"undefined"!=typeof tizen}();return{request:function(e,t){return new g(e,t).send()},abort:function(e){var t=l(e);t&&t.abort()}}}),define("xdk-base/ax",["xdk-base/core","xdk-base/Element","xdk-base/class","xdk-base/config","xdk-base/device","xdk-base/Env","xdk-base/util","xdk-base/console","xdk-base/ajax","xdk-base/promise"],function(e,t,i,n,s,r,a,o,l,c){"use strict";var d={},u=r.singleton();return d.core=e,d.Element=t,d.klass=i,d.config=n,d.sEnv=u,d.util=a,d.ajax=l,d.promise=c,d.console=o,u.addEventListener(u.EVT_ONLOAD,function(){d.platform=s.platform,d.vKey=s.vKey,d.id=s.id,d.system=s.system,d.storage=s.storage,d.media=s.media}),d}),define("xdk-ax/mediator",["xdk-base/EventDispatcher","xdk-base/util"],function(e,t){"use strict";var i=new e;return{publish:function(e,t){i.dispatchEvent.apply(i,[e,t,!0])},subscribe:t.bind(i.addEventListener,i),unsubscribe:t.bind(i.removeEventListener,i)}}),define("tve/TVEError",["xdk-base/class"],function(e){return e.create(Error,{FACILITY:{CONFIGURATION_SERVICE:11,USER_SETTINGS_SERVICE:12,ANALYTICS_SERVICE:13,STATUS_SERVICE:14,RESOURCE_SERVICE:15,LOG_SERVICE:16,AD_MEDIATE:21,PLAYBACK_SERVICE:22,VOD_CONTENT_SERVICE:40,LINEAR_CONTENT_SERVICE:41,AUTHENTICATION_SERVICE:43,LINEAR_MANAGER:50,VOD_MANAGER:51,NAVIGATION_MANAGER:52,GENERAL:90},ERROR:{NOT_FOUND:1,NETWORK:2,INTERNAL:3,UNAUTHORIZED:4,INVALID:5,STORAGE:6}},{init:function(e,t,i,n){this.__facility=e,this.__errorCode=t,this.__cause=n||null,this.__code=1e3*this.__facility+this.__errorCode,this.message=i,this.name=this.__code.toString()},getFacility:function(){return this.__facility},getErrorCode:function(){return this.__errorCode},getCode:function(){return this.__code},getMessage:function(){return this.message},getCause:function(){return this.__cause}})}),define("css!xdk-ui-basic/css/Layout",[],function(){}),define("xdk-ui-basic/Layout",["xdk-base/class","xdk-ax/Container","xdk-ax/focusManager","xdk-ax/evt/type","xdk-base/device/vKey","xdk-base/util","css!./css/Layout"],function(e,t,i,n,s,r){"use strict";return e.create(t,{VERTICAL:1,HORIZONTAL:2},{_rows:[],init:function(e){r.isBoolean(e.autoNavigation)||(e.autoNavigation=!0),e.alignment||(e.alignment=this.constructor.HORIZONTAL),r.isUndefined(e.width)&&(e.width=e.children?e.children.length:10),this._super(e),this._root.addClass("wgt-layout"),e.alignment===this.constructor.HORIZONTAL?this._root.addClass("align-h"):this._root.addClass("align-v")},postInit:function(){this._super(),this._opts.autoNavigation&&this.addEventListener(n.KEY,this._keyHandler)},__redraw:function(){var e,t,i,n,s,r;for(n=this._children,s=this._opts.width,this._rows.length=0,this.getRoot().removeAll(),this.__refresh(),i=0;i<n.length;i++)e=Math.floor(i/s),t=i%s,e>0?(r=this._rows[t][e-1],this._root.insertAfter(r.getRoot(),n[i].getRoot())):this._root.append(n[i].getRoot())},__refresh:function(e){r.isUndefined(e)&&(e=0);var t,i,n,s,a=this._opts.width,o=this._opts.alignment,l=this._children.slice(0);for(s=e;s<l.length;s++)n=l[s],o===this.constructor.HORIZONTAL?(t=Math.floor(s/a),i=s%a):(i=Math.floor(s/a),t=s%a),this.__updateChild(n,t,i)},__updateChild:function(e,t,i){var n;return n=this._opts.alignment===this.constructor.HORIZONTAL?this._opts.width-1:(i+1)*this._opts.width+t>=this._children.length?i:Math.floor((this._children.length-1)/this._opts.width),e.removeClass("row-begin"),e.removeClass("row-end"),this._rows[t]||(this._rows[t]=[]),this._rows[t][i]=e,e.getRoot().css({float:"left"}),e.getRoot().css({clear:"none"}),0===i&&(e.addClass("row-begin"),e.getRoot().css({clear:"left"})),i===n&&e.addClass("row-end"),e},_doAttach:function(e,i,n){var s,a,o,l,c,d,u,h=this._opts.width,_=this._opts.alignment;if(a=r.indexOf(this._children,e),_===this.constructor.HORIZONTAL?(l=Math.floor(a/h),o=a%h):(o=Math.floor(a/h),l=a%h),this.__updateChild(e,l,o),u=this._children,this.getRoot().isInDOMTree()&&(d=this.getRoot().getHTMLElement().nextSibling,c=this.getRoot().getParent(),c.removeChild(this.getRoot())),_===this.constructor.HORIZONTAL){switch(i){case t.PLACE_APPEND:this._root.append(e.getRoot());break;case t.PLACE_PREPEND:this._root.prepend(e.getRoot());break;case t.PLACE_BEFORE:this._root.insertBefore(n.getRoot(),e.getRoot());break;case t.PLACE_AFTER:this._root.insertAfter(n.getRoot(),e.getRoot())}a+1<u.length&&this.__refresh(a+1)}else this.__refresh(),i===t.PLACE_APPEND?o>0?(s=this._rows[l][o-1],this._root.insertAfter(s.getRoot(),e.getRoot())):this._root.append(e.getRoot()):this.__redraw();c&&(d?c.insertBefore(d,this.getRoot()):c.append(this.getRoot()))},detach:function(e){if(!e)return this._super();var t,i,n=r.indexOf(this._children,e),s=this._super(e);return this._opts.alignment===this.constructor.HORIZONTAL?(this.__refresh(n),this._rows[this._rows.length-1].splice([this._rows[this._rows.length-1].length-1],1),0===this._rows[this._rows.length-1].length&&this._rows.splice(this._rows.length-1,1),s):(this.getRoot().isInDOMTree()&&(i=this.getRoot().getHTMLElement().previousSibling,t=this.getRoot().getParent(),t.removeChild(this.getRoot())),this.__redraw(),t&&(i?t.insertAfter(i,this.getRoot()):t.append(this.getRoot())),s)},getAlignment:function(){return this._opts.alignment},_keyHandler:function(e){if(this._opts.autoNavigation){var t,n,a,o,l,c,d,u=e.id,h=this._opts.width,_=this._opts.alignment;switch(u){case s.UP.id:case s.DOWN.id:case s.LEFT.id:case s.RIGHT.id:t=i.directionChangeByKey(e,this);break;default:return}if(t)return!1;for(n=i.getCurFocus(),o=n,a=o.getParent();a&&a!==this;)o=a,a=o.getParent();if(a)for(l=r.indexOf(this._children,o);l>=0;){switch(_===this.constructor.HORIZONTAL?(c=Math.floor(l/h),d=l%h):(d=Math.floor(l/h),c=l%h),e.id){case s.UP.id:c--;break;case s.DOWN.id:c++;break;case s.LEFT.id:d--;break;case s.RIGHT.id:d++}if(this._opts.connectRows&&(_===this.constructor.HORIZONTAL&&(d>=h||d<0)?(c+=Math.floor(d/h),d=(d%h+h)%h):(c>=h||c<0)&&(d+=Math.floor(c/h),c=(c%h+h)%h)),!this._rows[c]||!this._rows[c][d])return;if(i.focus(this._rows[c][d]))return!1;l=r.indexOf(this._children,this._rows[c][d])}}}})}),define("xdk-ui-basic/Label",["xdk-base/class","xdk-ax/Component","xdk-base/Element","xdk-base/util","xdk-ax/mvc/ModelRef","xdk-base/console"],function(e,t,i,n,s,r){"use strict";return e.create(t,{},{_lastModelRef:null,_modelListener:null,init:function(e){e.text=e.text||"",e.root=new i("div"),e.root.addClass("wgt-label"),this._super(e),this.setText(e.text,!!e.isPureText)},deinit:function(){this._lastModelRef&&this._modelListener&&(this._lastModelRef.getModel().off("change:"+this._lastModelRef.getAttr(),this._modelListener),this._lastModelRef=null),this._modelListener=null,this._super()},_isPureText:!1,setText:function(e,t){this._lastModelRef&&this._modelListener&&(this._lastModelRef.getModel().off("change:"+this._lastModelRef.getAttr(),this._modelListener),this._lastModelRef=null),t=!!t,this._isPureText=t;var i=n.bind(function(e){this._isPureText?this.getRoot().setInnerText(e):this.getRoot().setInnerHTML(e)},this);e instanceof s&&(this._modelListener||(this._modelListener=n.bind(function(e,t){var n=t.newVal;void 0!==n&&null!==n||(r.warn("[Label] Text"+(e?" of label "+e:"")+" binded to the model value is changing to an undesired data type/value: "+n),n=""),i(n)},null,this.getOption("id",void 0))),e.getModel().on("change:"+e.getAttr(),this._modelListener),this._lastModelRef=e,e=e.getVal()),i(e)},getText:function(){return this._isPureText?this.getRoot().getInnerText():this.getRoot().getInnerHTML()}})}),define("css!xdk-ui-basic/css/Button",[],function(){}),define("xdk-ui-basic/Button",["xdk-base/class","xdk-ax/Container","xdk-ui-basic/Label","xdk-base/Element","css!./css/Button"],function(e,t,i,n){"use strict";return e.create(t,{},{_label:null,init:function(e){e.focusable=!0,e.clickable=!0,e.text=e.text||"",e.root=e.root||new n("div"),this._super(e),this.getRoot().addClass("wgt-button"),this._label=new i({text:e.text,isPureText:!!e.isPureText,parent:this})},setText:function(e,t){this._label.setText(e||"",!!t)},getText:function(){return this._label.getText()}})}),define("css!xdk-ui-basic/css/Dialog",[],function(){}),define("xdk-ui-basic/Dialog",["xdk-base/class","xdk-ax/Container","xdk-ax/focusManager","xdk-ui-basic/Layout","xdk-ui-basic/Button","xdk-ui-basic/Label","xdk-base/util","xdk-ax/evt/type","xdk-base/console","xdk-base/device/vKey","require","css!./css/Dialog"],function(e,t,i,n,s,r,a,o,l,c,d){"use strict";return e.create(t,{},{_headerComp:null,_contentComp:null,_footerComp:null,_overlay:null,_view:null,_container:null,_isOpen:!1,_buttons:null,_lastFocus:null,init:function(e){e=e||{},e.focusable=!1,a.isUndefined(e.forwardFocus)&&(e.forwardFocus=!0),e.dialogCss=e.dialogCss||"",this._super(e),this._root.addClass("wgt-dialog"),!1!==e.modal&&(this._root.addClass("wgt-dialog-modal"),this._overlay=new t({parent:this,css:"wgt-dialog-overlay"})),!1!==e.horizontalFooter&&(e.horizontalFooter=!0),this._headerComp=new t({css:"wgt-dialog-header",nextDown:a.bind(function(){return this._contentComp},this)}),this._contentComp=new t({css:"wgt-dialog-content",nextUp:a.bind(function(){return this._headerComp},this),nextDown:a.bind(function(){return this._footerComp},this)}),this._footerComp=new t({css:"wgt-dialog-footer",nextUp:a.bind(function(){return this._contentComp},this)}),this._container=new t({type:t,parent:this,css:"wgt-dialog-container "+e.dialogCss,children:[this._headerComp,this._contentComp,this._footerComp]});var i,c,d=this,u=e.header,h=e.content,_=e.footer;a.isString(e.title)&&(u=new r({text:e.title,isPureText:e.isPureText})),u&&this._headerComp.attach(u),a.isString(h)&&(h=new r({text:e.content,isPureText:e.isPureText})),h?(this._contentComp.attach(h),this._contentComp.setOption("forwardFocus",h),this.setOption("forwardFocus",this._contentComp)):l.info("Dialog widget: content is set to empty!"),e.closeText&&(e.buttons=e.buttons||[],e.buttons.push({text:e.closeText,click:function(){this.close()}})),!_&&e.buttons&&e.buttons.length&&(i=[],a.each(e.buttons,function(t){c=new s({text:t.text,isPureText:e.isPureText}),c.addEventListener(o.CLICK,a.bind(t.click,d)),i.push(c)}),_=new n({alignment:e.horizontalFooter?n.HORIZONTAL:n.VERTICAL,fowardFocus:!0,children:i}),_.setOption("forwardFocus",i[0]),this._buttons=i),_&&(this._footerComp.attach(_),this._footerComp.setOption("forwardFocus",_),this.setOption("forwardFocus",this._footerComp)),!1!==e.autoOpen&&this.open(),this.addEventListener(o.KEY,this._keyHandler)},attachToHeader:function(e,t,i){this._headerComp.attach(e,t,i)},attachToContent:function(e,t,i){this._contentComp.attach(e,t,i)},attachToFooter:function(e,t,i){this._footerComp.attach(e,t,i)},open:function(){var e=this._opts.parent;e=e||(this.getRootController()||d("xdk-ax/mvc/AppRoot").singleton()).getView(),e.attach(this),this._isOpen=!0,this.dispatchEvent(o.OPEN),this._buttons&&this._buttons.length?(this._lastFocus=i.getCurFocus(),i.focus(this)):this.setActive()},close:function(){this.detach(),this._isOpen=!1,this.dispatchEvent(o.CLOSE),this._lastFocus&&(i.focus(this._lastFocus),this._lastFocus=null)},_keyHandler:function(e){if(!1===this._opts.closeOnBack)return!0;switch(e.id){case c.UP.id:case c.DOWN.id:case c.LEFT.id:case c.RIGHT.id:return i.directionalFocusChangeByKey(e,this),!1;case c.BACK.id:return this.close(),!1;default:return}}})}),define("fix/Dialog",["xdk-base/class","xdk-ui-basic/Dialog","xdk-base/device","xdk-base/device/vKey","xdk-base/console","xdk-base/util","xdk-base/core","xdk-base/config","xdk-ax/focusManager"],function(e,t,i,n,s,r,a,o,l){var c=[];return e.create(t,{},{init:function(e){c.push(l.getCurFocus()),s.warn("Using custom Dialog component, careful if the original one gets updated!"),this._super(e);var t="samsung"===i.platform||"workstation"===i.platform;this._timerEnabled=!(!t||e.disableAutoclose)},_keyHandler:function(e){return!1===this._opts.closeOnBack||(e.id===n.BACK.id||e.id===n.EXIT.id?!this._isOpen||(this.close(),!1):this._super(e))},_initAutoCloseTimer:function(e){this._timerEnabled&&e>0&&(this._timerId="dialogTimer-"+a.getGuid(),r.delay(e,this._timerId).then(r.bind(function(){this._clearAutoCloseTimer(),this.close()},this)))},_clearAutoCloseTimer:function(){this._timerEnabled&&this._timerId&&(r.clearDelay(this._timerId),this._timerId=null)},close:function(){this._isOpen&&(this._clearAutoCloseTimer(),l.focus(c.pop()),this._super())}})}),define("tvedemo/wgt/AlertDialog",["xdk-base/class","fix/Dialog","xdk-base/util","xdk-ax/Container","xdk-ax/evt/type","xdk-ui-basic/Button","xdk-ui-basic/Label","xdk-ax/focusManager","xdk-base/device/vKey","xdk-base/config"],function(e,t,i,n,s,r,a,o,l,c){var d=0;return e.create(t,{},{init:function(e){e=e||{},e.title=e.title||"Attention";var t=new r({css:"wgt-alertdialog-button",text:e.buttonText||"OK"});e.content=new n({forwardFocus:t,children:[new a({css:"wgt-dialog-message",text:e.message}),t]}),e.forwardFocus=t,this._super(e),this.addClass("wgt-alertdialog"),t.addEventListener(s.CLICK,i.bind(this.close,this)),d=c.get("dialogTimeLimit",null).alert,this._initAutoCloseTimer(d)},_keyHandler:function(e){return e.id!==l.BACK.id&&e.id!==l.OK.id&&(this._clearAutoCloseTimer(),this._initAutoCloseTimer(d)),this._super(e)
},open:function(){this._super(),this._lastFocus=o.getCurFocus(),this.setOption("forwardFocus",this.getOption("content")),o.focus(this)},close:function(){o.focus(this._lastFocus),this._super(),this.deinit();var e=o.getReserveFocus();e&&(o.focus(e),o.setReserveFocus(null))}})}),define("tvedemo/wgt/ConfirmDialog",["xdk-base/class","fix/Dialog","xdk-base/util","xdk-ax/Container","xdk-ax/focusManager","xdk-ax/evt/type","xdk-ui-basic/Layout","xdk-ui-basic/Button","xdk-ui-basic/Label","xdk-base/device/vKey","xdk-base/config"],function(e,t,i,n,s,r,a,o,l,c,d){"use strict";var u=0;return e.create(t,{POSITIVE:1,NEGATIVE:2,VERTICAL_BUTTON_LAYOUT:1,HORIZONTAL_BUTTON_LAYOUT:2},{init:function(e){e=e||{},e.title=e.title||"Confirmation";var t=new o({css:"wgt-confirmdialog-button positive",text:e.positiveText||"Yes"}),c=new o({css:"wgt-confirmdialog-button negative",text:e.negativeText||"No"}),h=t;e.defaultOption===this.constructor.NEGATIVE&&(h=c),e.content=new n({forwardFocus:h,children:[new l({css:"wgt-dialog-message",text:e.message,id:"message"}),new a({css:"wgt-confirmdialog-button-container",forwardFocus:h,id:"buttonContainer",nextUp:null,alignment:e.buttonLayout||this.constructor.HORIZONTAL_BUTTON_LAYOUT,children:[t,c]})]}),this._super(e),this.addClass("wgt-confirmdialog"),i.isFunction(e.positiveAction)?(this._positiveAction=i.bind(function(){try{this.close()}catch(e){}e.positiveAction()},this),t.addEventListener(r.CLICK,this._positiveAction)):t.addEventListener(r.CLICK,i.bind(function(){this.close()},this)),i.isFunction(e.negativeAction)?(this._negativeAction=i.bind(function(){try{this.close()}catch(e){}e.negativeAction()},this),c.addEventListener(r.CLICK,this._negativeAction)):c.addEventListener(r.CLICK,i.bind(function(){this.close()},this)),this.setOption("forwardFocus",h),this._lastFocus=s.getCurFocus(),s.focus(h);var _=d.get("dialogTimeLimit",null),g="search-dialog"===this._opts.dialogCss||"pin-dialog"===this._opts.dialogCss||"resume-dialog"===this._opts.dialogCss||"session-dialog"===this._opts.dialogCss;u=g?0:_.confirm,this._initAutoCloseTimer(u)},_keyHandler:function(e){return!0!==this._opts.doNegativeActionOnClose||e.id!==c.BACK.id&&e.id!==c.EXIT.id?(e.id!==c.BACK.id&&(this._clearAutoCloseTimer(),this._initAutoCloseTimer(u)),this._super(e)):(!0===this._opts.invertBackKey?this._positiveAction():this._negativeAction(),!1)},close:function(){this._opts.skipFocusRestore&&(this._lastFocus=null),this._super(),this.deinit()}})}),define("css!xdk-ui-input/css/Keyboard",[],function(){}),define("xdk-ui-input/Keyboard",["xdk-base/class","xdk-base/console","xdk-base/util","xdk-base/Element","xdk-ui-basic/Button","xdk-ax/evt/type","xdk-ax/Container","xdk-ax/focusManager","xdk-base/device","xdk-base/Env","xdk-ax/Component","css!./css/Keyboard"],function(e,t,i,n,s,r,a,o,l,c,d){"use strict";var u=c.singleton();return e.create(a,{DEFAULT:"default"},{__keyMaps:{},__containers:{},__navMaps:{},__mapId:null,__focusPosition:{},onEdge:null,onHandler:null,__curRow:0,__curCol:0,init:function(e){e.focusPosition=e.focusPosition||[0,0],e.keyMaps=e.keyMaps||{},e.forwardFocus=e.useLastFocus||void 0,e.root=new n("div",{class:"wgt-keyboard"}),this._super(e),this.__curRow=e.focusPosition[0],this.__curCol=e.focusPosition[1],i.each(e.keyMaps,i.bind(function(e){this.addKeyMap(e.key,e.value)},this)),this.addEventListener(r.KEY,i.bind(this._keyHandler,this),!0),this.addEventListener(r.CLICK,i.bind(this._keyHandler,this)),e.defaultMap?this.switchKeyMap(e.defaultMap):this.__keyMaps.default?this.switchKeyMap("default"):t.warn("no default maps")},getFocusPosition:function(e){return i.isUndefined(e)?this.__focusPosition[this.getMapId()]:this.__focusPosition[e]},getFocusedKey:function(e){return this.getKey(this.getFocusPosition(e))},setFocusPosition:function(e,t){var i=t[0]||0,n=t[1]||0;this.__focusPosition[e]=[i,n]},addKeyMap:function(e,i){var n=this.__initKeyMap(i);this.__keyMaps[e]&&t.warn("Specific key map "+e+" is already exist."),this.__keyMaps[e]=n.map,this.__containers[e]=n.container,this.__focusPosition[e]=n.defaultFocus,n.container.addClass("wgt-keyboard-container-"+e),this.__navMaps[e]=this.__initNavMap(i,n.map),this.setFocusPosition(e,this.__focusPosition[e])},removeKeyMap:function(e){if(this.getMapId()===e)return void t.warn("unable to remove the current displayMap");delete this.__keyMaps[e],delete this.__containers[e],delete this.__navMaps[e],delete this.__focusPosition[e]},switchKeyMap:function(e){return this.__keyMaps[e]&&this.__containers[e]&&this.__navMaps[e]?(this.detach(this.__containers[this.__mapId]),this.__mapId=e,this.attach(this.__containers[this.__mapId]),t.info("Switch successfully"+e),this.setOption("forwardFocus",this.getKey(this.getFocusPosition(e))),o.isCompChildFocused(this)&&o.focus(this),!0):(t.warn("Unable to load the id "+e+" as it is not exist"),!1)},__initKeyMap:function(e){var t,n,s,r=[],o=[0,0],l=new a;return i.each(e,function(a,c){r[c]=[],i.each(a,function(d,u){d.defaultFocus&&(o=[c,u]),t=this.__initKey(d),0===u&&t.addClass("row-begin"),u===a.length-1&&t.addClass("row-end"),r[c][u]=t,n=e[c][u],i.isString(n)&&(s=n,n={},e[c][u]=n,n.display=s),n.colSpan=n.colSpan||1,n.rowSpan=n.rowSpan||1,l.attach(t,null,null)},this)},this),{map:r,container:l,defaultFocus:o}},__initKey:function(e){var n;if(i.isString(e)||e&&!(e.display instanceof d))n=this.__createButton(e);else{if(!(e.display instanceof d))return void t.warn("unable to construct or assign the key into the keyboad");n=e.display,e.css&&n.addClass(e.css)}return n.addClass("wgt-keyboard-comp"),i.isUndefined(e.rowSpan)||n.addClass("rowSpan-"+e.rowSpan),i.isUndefined(e.colSpan)||n.addClass("colSpan-"+e.colSpan),n},__createButton:function(e){var n,r;return e?(i.isString(e)?(n=new s({text:e,isPureText:!0}),n.getRoot().setClass("")):e&&(r=e.display,n=new s({text:r,isPureText:!0}),e.css&&n.getRoot().setClass(e.css),e.disable&&n.disable()),n||(t.warn("unable to create the obj"+e),null)):(t.warn("unable to create the button without any setting"),null)},__initNavMap:function(e,t){var n,s,r,a,o,l=[];return i.each(e,function(c,d){l[d]||(l[d]=[]),i.each(c,function(i,c){for(r=i.rowSpan||1,a=i.colSpan||1,o=!1,e[d][c].__y=d,t[d][c].__keyboard_config=e[d][c],n=0;n<l[d].length;n++)if(!l[d][n]){l[d][n]=t[d][c],e[d][c].__x=n,o=!0;break}if(o||(l[d].push(t[d][c]),e[d][c].__x=l[d].length-1,o=!0),s=e[d][c].__x,r>1)if(a>1)for(n=1;n<r;n++)for(l[d+n]||(l[d+n]=[]),n=s;n<a;n++)l[d][n]=t[d][c];else for(n=1;n<r;n++)l[d+n]||(l[d+n]=[]),l[d+n][s]=t[d][c];else if(a>1)for(n=1;n<a;n++)l[d][s+n]||(l[d][s+n]=t[d][c])})}),l},_keyHandler:function(e){var i,n,s,a,c,d,h,_=l.vKey,g=e.id,f=null;if(i=o.getCurFocus()){if(n=this.__curRow,s=this.__curCol,(s>i.__keyboard_config.__x+i.__keyboard_config.colSpan-1||s<i.__keyboard_config.__x)&&(s=i.__keyboard_config.__x),(n>i.__keyboard_config.__y+i.__keyboard_config.rowSpan-1||n<i.__keyboard_config.__y)&&(n=i.__keyboard_config.__y),this.setFocusPosition(this.getMapId(),[n,s]),e.type===r.KEY&&g===_.OK.id||e.type===r.CLICK)return this.__focusPosition[this.getMapId()]=[n,s],h=this.getKeyInfo([n,s]),h.keyId&&this.onHandler?!1!==(d=this.onHandler(h.keyId,this.getKey([n,s])))&&(u.dispatchEvent(u.EVT_ONKEY,{id:h.keyId,text:d||void 0,source:"soft-keyboard"}),!1):(u.dispatchEvent(u.EVT_ONKEY,{id:h.display,text:h.input||h.display,source:"soft-keyboard"}),!1);if(g!==_.DOWN.id&&g!==_.UP.id&&g!==_.LEFT.id&&g!==_.RIGHT.id);else{for(;;){switch(g){case _.DOWN.id:f=f||"nextDown",n++;break;case _.UP.id:n--,f=f||"nextUp";break;case _.LEFT.id:s--,f=f||"nextLeft";break;case _.RIGHT.id:s++,f=f||"nextRight"}if(!(a=this.getKey([n,s]))||s<0||n<0)break;if(a&&a!==i&&o.isCompFocusable(a)){c=a;break}}if(c)return this.__curRow=n,this.__curCol=s,this.__focusPosition[this.getMapId()]=[n,s],o.focus(c),e.preventDefault(),!1;if(t.info("reach edge of the keyboard and dedicate to developer to handle"),this.onEdge&&!1===(d=this.onEdge(f,this.getFocusPosition())))return e.preventDefault(),!1}}},getKeyInfo:function(e){return this.getKey(e).__keyboard_config},getKey:function(e){return this.__getChildByNaviMap(e)},__getChildByNaviMap:function(e){return this.__getChildByMap(this.__navMaps,e)},__getChildByKeyMap:function(e){return this.__getChildByMap(this.__keyMaps,e)},__getChildByMap:function(e,t){var i,n=t[0],s=t[1];return n<0||s<-1?null:(i=e[this.getMapId()])&&i.length<=n?null:(i=e[this.getMapId()][n],-1===s&&(s=e[this.getMapId()][n].length-1),i&&i.length<=s?null:(i=e[this.getMapId()][n][s])||null)},getMapId:function(){return this.__mapId}})}),define("xdk-ui-input/interface/InputImpl",["xdk-base/Interface"],function(e){"use strict";return e.create("InputImpl",{insertChar:["char","insertPos"],backspace:[],del:[],setMaxLength:["length"],getMaxLength:[],getText:[],setText:["text"],clearText:[],moveCursor:["direction"],setCursorPos:["pos"],startInput:[],stopInput:[],isCapturing:[]})}),define("css!xdk-ui-input/css/InputDivImpl",[],function(){}),define("xdk-ui-input/InputDivImpl",["xdk-base/class","xdk-base/Element","xdk-base/util","xdk-base/device","xdk-ax/evt/type","xdk-base/core","./interface/InputImpl","css!./css/InputDivImpl"],function(e,t,i,n,s,r,a){"use strict";return e.create([a],{},{__oldSamsung:"samsung"===n.platform&&n.id.getFirmwareYear()<=2011,__inputFieldWidth:null,__wrapper:null,__wrapperCopy:null,__cursor:null,__cursorPosition:null,__cursorLeftPosition:null,__labelText:null,__labelTextCopy:null,__wrapperLeft:null,__inputState:!1,__passwordTimer:null,__initEnvOnKey:!1,__maxLength:20,__isPassword:!1,__passwordChar:null,__hideTimeout:0,__widgetInstance:null,__placeHolder:null,__placeHolderDiv:null,init:function(e){e=e||{},e.root.addClass("wgt-input-div"),this.setMaxLength(i.isNumber(e.maxLength)?e.maxLength:20),this.__isPassword=e.isPassword||!1,this.__passwordChar=e.passwordChar||"*",this.__hideTimeout=e.hideTimeout||0,this.__placeHolder=e.placeHolder||"",this.__labelText=e.text||"",this.__cursorPosition=this.__labelText.length,this.__widgetInstance=e.widgetInstance,this.container=new t("div"),this.container.addClass("container"),this.__wrapper=new t("pre"),this.__wrapper.addClass("wrapper"),this.__wrapperCopy=new t("pre"),this.__wrapperCopy.addClass("wrapperCopy"),this.__cursor=new t("div"),this.__cursor.addClass("cursor"),this.__cursor.css({visibility:"hidden"}),e.root.append(this.container),this.container.append(this.__wrapper),this.container.append(this.__wrapperCopy),this.container.append(this.__cursor),""!==this.__placeHolder&&(this.__placeHolderDiv=new t("div"),this.__placeHolderDiv.addClass("placeholder"),this.__placeHolderDiv.setInnerText(this.__placeHolder),this.__labelText.length>0&&this.__placeHolderDiv.hide(),this.container.append(this.__placeHolderDiv)),this.setText(e.text,!0)},insertChar:function(e,t){if(this.__inputState&&e&&!(this.__labelText.length>=this.getMaxLength())){t=i.isUndefined(t)?this.__cursorPosition:t;var n=this.getText();n=i.insert(n,t,e),this.__cursorPosition=this.__cursorPosition+e.length,this.setText(n,void 0,!0),this.updateLeft("add"),this.updateCursorPosition()}},backspace:function(){if(this.__inputState&&!(this.__cursorPosition<=0)){var e=this.getText(),t="";1===this.__cursorPosition?e.length>1&&(t=e.slice(this.__cursorPosition,e.length)):e.length>1&&(t=e.slice(0,this.__cursorPosition-1)+e.slice(this.__cursorPosition,e.length)),this.__cursorPosition--,this.setText(t,void 0,!0),this.updateLeft("del"),this.updateCursorPosition()}},del:function(){if(this.__inputState){var e=this.getText(),t="";this.__cursorPosition>=e.length||(t=this.__cursorPosition===e.length-1?e.slice(0,e.length-1):e.slice(0,this.__cursorPosition)+e.slice(this.__cursorPosition+1,e.length),this.setText(t,void 0,!0))}},setMaxLength:function(e){this.__maxLength=e},getMaxLength:function(){return this.__maxLength},getText:function(){return this.__labelText},setText:function(e,t,n){if(!i.isUndefined(e)){e||(e="");var a,o,l,c,d,u,h=e!==this.__labelText,_="",g="";if(e.length>this.getMaxLength()?this.__cursorPosition=this.getMaxLength():n||(this.__cursorPosition=e.length),e=i.truncate(e,this.getMaxLength(),""),this.__isPassword){for(c=e.length>this.__labelText.length,d=this.__hideTimeout>0&&c&&!t,this.__labelText=e,a=this.__labelText.length,this.__passwordTimer&&(i.clearDelay(this.__passwordTimer),this.__passwordTimer=null),o=0;o<this.__cursorPosition-1;o++)_+=this.__passwordChar,g+=this.__passwordChar;for(!d&&this.__cursorPosition>0?(_+=this.__passwordChar,g+=this.__passwordChar):(_+=e[this.__cursorPosition-1],g+=e[this.__cursorPosition-1]),o=0;o<a-this.__cursorPosition;o++)_+=this.__passwordChar;this.__setElementText(this.__wrapper,_),this.__setElementText(this.__wrapperCopy,g),u=i.bind(function(){for(_="",g="",o=0;o<a;o++)_+=this.__passwordChar;for(o=0;o<this.__cursorPosition;o++)g+=this.__passwordChar;this.__setElementText(this.__wrapper,_),this.__setElementText(this.__wrapperCopy,g),this.updateCursorPosition(),this.__passwordTimer=null},this),d?(this.__passwordTimer=r.getGuid(),i.delay(this.__hideTimeout,this.__passwordTimer).then(u)):u()}else this.__setElementText(this.__wrapper,e),0===this.__cursorPosition?this.__setElementText(this.__wrapperCopy,""):(l=i.truncate(e,this.__cursorPosition,""),this.__setElementText(this.__wrapperCopy,l));this.__labelText=e,this.__labelTextCopy=i.truncate(this.__labelText,this.__cursorPosition,""),n||this.updateCursorPosition(),h&&(this.__placeHolderDiv&&(this.__labelText.length>0?this.__placeHolderDiv.hide():this.__placeHolderDiv.show()),this.__widgetInstance&&this.__widgetInstance.dispatchEvent(s.TEXT_CHANGED,this.__labelText))}},__setElementText:function(e,i){var n;e.setInnerText(i),i.length>0&&e===this.__wrapperCopy&&this.__oldSamsung&&(n=new t("span"),n.setInnerText("t"),e.append(n))},clearText:function(){this.setText("")},updateLeft:function(e){this.wrapperWidth=this.__wrapper.getHTMLElement().clientWidth,this.__wrapperLeft=this.__wrapper.getHTMLElement().offsetLeft,this.wrapperCopyWidth=this.__wrapperCopy.getHTMLElement().clientWidth,this.wrapperCopyLeft=this.__wrapperCopy.getHTMLElement().offsetLeft;var t,n,s;this.__oldSamsung&&this.__cursorPosition>0&&(n=this.__wrapperCopy.getHTMLElement(),s=n.lastChild,this.wrapperCopyWidth-=s.clientWidth),this.__inputFieldWidth||(this.__inputFieldWidth=this.container.getHTMLElement().clientWidth),this.wrapperWidth>=this.__inputFieldWidth&&this.__cursorPosition===this.__labelText.length?t=this.__inputFieldWidth-this.wrapperWidth:this.wrapperWidth>=this.__inputFieldWidth?"del"===e&&this.wrapperWidth+this.__wrapperLeft<=this.__inputFieldWidth&&(t=this.__inputFieldWidth-this.wrapperWidth):t=0,i.isUndefined(t)||this.updateLeftByCursor(t)},updateLeftByCursor:function(e){this.__wrapper.css({left:e+"px"}),this.__wrapperCopy.css({left:e+"px"}),this.__wrapperLeft=e},updateCursorPosition:function(){var e,t,i,n,s;if(0===this.__cursorPosition)return this.__cursor.css({left:"0px"}),void this.updateLeftByCursor(0);s=this.__wrapperCopy.getHTMLElement().offsetLeft,t=0,this.wrapperCopyWidth=this.__wrapperCopy.getHTMLElement().offsetWidth,this.__oldSamsung&&this.__cursorPosition>0&&(i=this.__wrapperCopy.getHTMLElement(),n=i.lastChild,this.wrapperCopyWidth-=n.clientWidth),e=this.wrapperCopyWidth+s,e>this.__inputFieldWidth-1?(t=this.__inputFieldWidth-1,this.updateLeftByCursor(this.__inputFieldWidth-this.wrapperCopyWidth)):e>0?t=e:(t=0,this.updateLeftByCursor(-this.wrapperCopyWidth)),this.__cursor.css({left:t+"px"}),this.__cursorLeftPosition=t},moveCursor:function(e){this.__inputState&&("left"===e.toLowerCase()?this.setCursorPos(this.__cursorPosition-1):"right"===e.toLowerCase()&&this.setCursorPos(this.__cursorPosition+1))},setCursorPos:function(e){e>this.getText().length?e=this.getText().length:e<0&&(e=0),this.__cursorPosition!==e&&(this.__cursorPosition=e,0===this.__cursorPosition?this.__labelTextCopy="":this.__isPassword?this.__labelTextCopy=i.truncate(this.__wrapper.getInnerText(),this.__cursorPosition,""):this.__labelTextCopy=i.truncate(this.__labelText,this.__cursorPosition,""),this.__setElementText(this.__wrapperCopy,this.__labelTextCopy),this.updateCursorPosition())},startInput:function(){this.__inputState=!0,this.__inputFieldWidth||(this.__inputFieldWidth=this.container.getHTMLElement().clientWidth,this.updateLeft("add"),this.updateCursorPosition()),this.__cursor.css({visibility:"visible"})},stopInput:function(){this.__inputState=!1,this.__cursor.css({visibility:"hidden"})},isCapturing:function(){return this.__inputState},deinit:function(){this.container.deinit(),this.__wrapper.deinit(),this.__wrapperCopy.deinit(),this.__cursor.deinit()}})}),define("xdk-base/device/shared/keyboardVKey",["xdk-base/device/vKey"],function(e){"use strict";return{A:{id:"device:kb-vkey:A",text:"A"},B:{id:"device:kb-vkey:B",text:"B"},C:{id:"device:kb-vkey:C",text:"C"},D:{id:"device:kb-vkey:D",text:"D"},E:{id:"device:kb-vkey:E",text:"E"},F:{id:"device:kb-vkey:F",text:"F"},G:{id:"device:kb-vkey:G",text:"G"},H:{id:"device:kb-vkey:H",text:"H"},I:{id:"device:kb-vkey:I",text:"I"},J:{id:"device:kb-vkey:J",text:"J"},K:{id:"device:kb-vkey:K",text:"K"},L:{id:"device:kb-vkey:L",text:"L"},M:{id:"device:kb-vkey:M",text:"M"},N:{id:"device:kb-vkey:N",text:"N"},O:{id:"device:kb-vkey:O",text:"O"},P:{id:"device:kb-vkey:P",text:"P"},Q:{id:"device:kb-vkey:Q",text:"Q"},R:{id:"device:kb-vkey:R",text:"R"},S:{id:"device:kb-vkey:S",text:"S"},T:{id:"device:kb-vkey:T",text:"T"},U:{id:"device:kb-vkey:U",text:"U"},V:{id:"device:kb-vkey:V",text:"V"},W:{id:"device:kb-vkey:W",text:"W"},X:{id:"device:kb-vkey:X",text:"X"},Y:{id:"device:kb-vkey:Y",text:"Y"},Z:{id:"device:kb-vkey:Z",text:"Z"},A_LOWER:{id:"device:kb-vkey:a",text:"a"},B_LOWER:{id:"device:kb-vkey:b",text:"b"},C_LOWER:{id:"device:kb-vkey:c",text:"c"},D_LOWER:{id:"device:kb-vkey:d",text:"d"},E_LOWER:{id:"device:kb-vkey:e",text:"e"},F_LOWER:{id:"device:kb-vkey:f",text:"f"},G_LOWER:{id:"device:kb-vkey:g",text:"g"},H_LOWER:{id:"device:kb-vkey:h",text:"h"},I_LOWER:{id:"device:kb-vkey:i",text:"i"},J_LOWER:{id:"device:kb-vkey:j",text:"j"},K_LOWER:{id:"device:kb-vkey:k",text:"k"},L_LOWER:{id:"device:kb-vkey:l",text:"l"},M_LOWER:{id:"device:kb-vkey:m",text:"m"},N_LOWER:{id:"device:kb-vkey:n",text:"n"},O_LOWER:{id:"device:kb-vkey:o",text:"o"},P_LOWER:{id:"device:kb-vkey:p",text:"p"},Q_LOWER:{id:"device:kb-vkey:q",text:"q"},R_LOWER:{id:"device:kb-vkey:r",text:"r"},S_LOWER:{id:"device:kb-vkey:s",text:"s"},T_LOWER:{id:"device:kb-vkey:t",text:"t"},U_LOWER:{id:"device:kb-vkey:u",text:"u"},V_LOWER:{id:"device:kb-vkey:v",text:"v"},W_LOWER:{id:"device:kb-vkey:w",text:"w"},X_LOWER:{id:"device:kb-vkey:x",text:"x"},Y_LOWER:{id:"device:kb-vkey:y",text:"y"},Z_LOWER:{id:"device:kb-vkey:z",text:"z"},SPACE:{id:"device:kb-vkey:space",text:" "},TILDE:{id:"device:kb-vkey:~",text:"~"},BACK_QUOTE:{id:"device:kb-vkey:`",text:"`"},EXC:{id:"device:kb-vkey:!",text:"!"},AT:{id:"device:kb-vkey:@",text:"@"},HASH:{id:"device:kb-vkey:#",text:"#"},DOLLAR:{id:"device:kb-vkey:$",text:"$"},PERCENT:{id:"device:kb-vkey:%",text:"%"},CARET:{id:"device:kb-vkey:^",text:"^"},AMP:{id:"device:kb-vkey:&",text:"&"},STAR:{id:"device:kb-vkey:*",text:"*"},OPEN_PAREN:{id:"device:kb-vkey:(",text:"("},CLOSE_PAREN:{id:"device:kb-vkey:)",text:")"},MINUS:{id:"device:kb-vkey:-",text:"-"},UNDERSCORE:{id:"device:kb-vkey:_",text:"_"},EQUALS:{id:"device:kb-vkey:=",text:"="},PLUS:{id:"device:kb-vkey:+",text:"+"},OPEN_BRACKET:{id:"device:kb-vkey:[",text:"["},OPEN_BRACE:{id:"device:kb-vkey:{",text:"{"},CLOSE_BRACKET:{id:"device:kb-vkey:]",text:"]"},CLOSE_BRACE:{id:"device:kb-vkey:}",text:"}"},BACK_SLASH:{id:"device:kb-vkey:\\",text:"\\"},PIPE:{id:"device:kb-vkey:|",text:"|"},SEMICOLON:{id:"device:kb-vkey:;",text:";"},COLON:{id:"device:kb-vkey::",text:":"},SINGLE_QUOTE:{id:"device:kb-vkey:'",text:"'"},QUOTE:{id:'device:kb-vkey:"',text:'"'},COMMA:{id:"device:kb-vkey:,",text:","},LESS:{id:"device:kb-vkey:<",text:"<"},PERIOD:{id:"device:kb-vkey:.",text:"."},GREATER:{id:"device:kb-vkey:>",text:">"},SLASH:{id:"device:kb-vkey:/",text:"/"},QUESTION:{id:"device:kb-vkey:?",text:"?"},BACKSPACE:{id:"device:kb-vkey:backspace"},TAB:{id:"device:kb-vkey:tab"},INSERT:{id:"device:kb-vkey:insert"},DELETE:{id:"device:kb-vkey:delete"},HOME:{id:"device:kb-vkey:home"},END:{id:"device:kb-vkey:end"},PAGE_UP:{id:"device:kb-vkey:page-up"},PAGE_DOWN:{id:"device:kb-vkey:page-down"},ESCAPE:{id:"device:kb-vkey:escape"},UP:e.UP,DOWN:e.DOWN,LEFT:e.LEFT,RIGHT:e.RIGHT,PAUSE:e.PAUSE,OK:e.OK,KEY_0:e.KEY_0,KEY_1:e.KEY_1,KEY_2:e.KEY_2,KEY_3:e.KEY_3,KEY_4:e.KEY_4,KEY_5:e.KEY_5,KEY_6:e.KEY_6,KEY_7:e.KEY_7,KEY_8:e.KEY_8,KEY_9:e.KEY_9}}),define("xdk-base/device/shared/browser/keyMap",["xdk-base/device/shared/keyboardVKey","xdk-base/util"],function(e,t){"use strict";var i,n,s,r,a;for(i={VKey:{},keyCode:{UP:38,DOWN:40,LEFT:37,RIGHT:39,OK:13}},s={VKey:{},keyCode:{UP:38,DOWN:40,LEFT:37,RIGHT:39,OK:13,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,PAUSE:19,TAB:9,INSERT:45,DELETE:46,BACKSPACE:8,ESCAPE:27}},n={VKey:{},keyCode:{SPACE:32,EXC:33,HASH:35,DOLLAR:36,PERCENT:37,AMP:38,SINGLE_QUOTE:39,OPEN_PAREN:40,CLOSE_PAREN:41,STAR:42,PLUS:43,COMMA:44,MINUS:45,PERIOD:46,SLASH:47,COLON:58,SEMICOLON:59,LESS:60,EQUALS:61,GREATER:62,QUESTION:63,AT:64,OPEN_BRACKET:91,BACK_SLASH:92,CLOSE_BRACKET:93,CARET:94,UNDERSCORE:95,BACK_QUOTE:96,OPEN_BRACE:123,PIPE:124,CLOSE_BRACE:125,TILDE:126}},t.each(i.keyCode,function(t){i.VKey[t.value]=e[t.key]}),t.each(n.keyCode,function(t){n.VKey[t.value]=e[t.key]}),t.each(s.keyCode,function(t){s.VKey[t.value]=e[t.key]}),r=65;r<=90;r++)n.VKey[r]=e[String.fromCharCode(r)],n.keyCode[String.fromCharCode(r)]=r;for(r=97;r<=122;r++)n.VKey[r]=e[String.fromCharCode(r).toUpperCase()+"_LOWER"],n.keyCode[String.fromCharCode(r).toUpperCase()+"_LOWER"]=r;for(r=48;r<=57;r++)a="KEY_"+(r-48),n.VKey[r]=e[a],n.keyCode[a]=r,i.keyCode[a]=r,i.VKey[r]=e[a];return{REMOTE:i,KEYBOARD_KEY:s,KEYBOARD_CHAR:n}}),define("css!xdk-ui-input/css/InputNativeImpl",[],function(){}),define("xdk-ui-input/InputNativeImpl",["xdk-base/class","xdk-base/Element","xdk-base/util","xdk-base/device","xdk-base/console","xdk-ax/evt/type","xdk-base/device/shared/browser/keyMap","xdk-base/core","./interface/InputImpl","css!./css/InputNativeImpl"],function(e,t,i,n,s,r,a,o,l){"use strict";return e.create([l],{},{__oldSamsung:"samsung"===n.platform&&n.id.getFirmwareYear()<=2011,__cursorPosition:null,__labelText:null,__inputState:!1,__passwordTimer:null,__initEnvOnKey:!1,__maxLength:20,__isPassword:!1,__passwordChar:null,__hideTimeout:0,__widgetInstance:null,__input:null,__element:null,__placeHolder:null,__isSetPlaceHolder:!1,init:function(e){var r,o,l,c,d,u,h=this,_=a.KEYBOARD_KEY.keyCode.UP,g=a.KEYBOARD_KEY.keyCode.DOWN,f=a.KEYBOARD_KEY.keyCode.LEFT,p=a.KEYBOARD_KEY.keyCode.RIGHT,m=a.KEYBOARD_KEY.keyCode.INSERT,v=a.KEYBOARD_KEY.keyCode.DELETE,b=a.KEYBOARD_KEY.keyCode.HOME,S=a.KEYBOARD_KEY.keyCode.END,y=a.KEYBOARD_KEY.keyCode.PAGE_UP,E=a.KEYBOARD_KEY.keyCode.PAGE_DOWN,k=a.KEYBOARD_KEY.keyCode.TAB,C=a.KEYBOARD_KEY.keyCode.BACKSPACE;switch(e=e||{},e.root.addClass("wgt-input-native"),this.setMaxLength(i.isNumber(e.maxLength)?e.maxLength:20),this.__isPassword=e.isPassword||!1,this.__passwordChar=e.passwordChar||"*",this.__hideTimeout=e.hideTimeout||0,this.__placeHolder=e.placeHolder||"",this.__labelText=e.text||"",this.__cursorPosition=this.__labelText.length,this.__widgetInstance=e.widgetInstance,this.container=new t("div"),this.container.addClass("container"),this.__input=new t("input"),this.__input.addClass("wgt-input-native-ele"),e.root.append(this.container),this.container.append(this.__input),this.__element=this.__input.getHTMLElement(),this.setText(e.text,!0),u=function(e){switch(e.keyCode){case _:case g:case f:case p:case m:case v:case b:case S:case y:case E:case k:case C:return!0;default:return!1}},r=function(e){return s.info("inputNativeImpl: mouse click; inputState: "+h.__inputState),i.defer().then(function(){h.__isSetPlaceHolder?h.setCursorPos(0):h.__updateCursorPosition(),h.startInput()}).done(),!0},o=function(e){return s.info("inputNativeImpl: mouse out; inputState: "+h.__inputState),h.stopInput(),!0},l=function(e){try{e.preventDefault()}catch(e){e.returnValue=!1}return!0},d=function(e){if(u(e)){s.info("inputNativeImpl: blocking text edit key:"+e.keyCode);try{e.preventDefault()}catch(e){e.returnValue=!1}}return!0},n.platform){case"samsung":if(2010===n.id.getFirmwareYear()){s.debug("inputNativeImpl: samsung 2010 device detected, using special handler"),c=function(e){s.debug("inputNativeImpl: samsung workaround handler in action...");try{e.preventDefault()}catch(e){e.returnValue=!1}return h.setText(h.__value,h.__cursorPosition),!0},this.__input.addEventListener("keydown",c);break}default:this.container.addEventListener("mousedown",r),this.container.addEventListener("mouseout",o),this.__input.addEventListener("keydown",d),this.__input.addEventListener("keypress",l)}},__addPlaceHolder:function(){this.__isSetPlaceHolder=!0,this.__element.value=this.__placeHolder,this.__input.addClass("placeholder"),this.__setRealCursorPos()},__removePlaceHolder:function(){this.__isSetPlaceHolder=!1,this.__element.value="",this.__input.removeClass("placeholder")},insertChar:function(e,t){if(this.__inputState&&e&&!(this.__labelText.length>=this.__maxLength)){t=i.isUndefined(t)?this.__cursorPosition:t;var s=this.getText();s=i.insert(s,t,e),this.__cursorPosition=this.__cursorPosition+e.length,this.setText(s,void 0,!0),"windows"===n.platform?(this.setCursorPos(this.__cursorPosition-1),this.setCursorPos(this.__cursorPosition+1)):this.__updateCursorPosition(),this.__element.blur(),this.__element.focus()}},backspace:function(){if(this.__inputState&&!(this.__cursorPosition<=0)){var e=this.getText(),t="";1===this.__cursorPosition?e.length>1&&(t=e.slice(this.__cursorPosition,e.length)):e.length>1&&(t=e.slice(0,this.__cursorPosition-1)+e.slice(this.__cursorPosition,e.length)),this.__cursorPosition--,this.setText(t,void 0,!0),this.__updateCursorPosition(),this.__setRealCursorPos()}},del:function(){if(this.__inputState){var e=this.getText(),t="";this.__cursorPosition>=e.length||(t=this.__cursorPosition===e.length-1?e.slice(0,e.length-1):e.slice(0,this.__cursorPosition)+e.slice(this.__cursorPosition+1,e.length),this.setText(t,void 0,!0),this.__setRealCursorPos())}},setMaxLength:function(e){this.__maxLength=e},getMaxLength:function(){return this.__maxLength},getText:function(){return this.__labelText},setText:function(e,t,n){if(!i.isUndefined(e)){e||(e=""),null!==this.__placeHolder&&""===this.getText()&&""!==e&&this.__removePlaceHolder();var s,a,l,c,d,u=e!==this.__labelText,h="";if(e.length>this.__maxLength?this.__cursorPosition=this.__maxLength:n||(this.__cursorPosition=e.length),e=i.truncate(e,this.__maxLength,""),this.__isPassword){for(l=e.length>this.__labelText.length,c=this.__hideTimeout>0&&l&&!t,this.__labelText=e,s=this.__labelText.length,this.__passwordTimer&&(i.clearDelay(this.__passwordTimer),this.__passwordTimer=null),a=0;a<this.__cursorPosition-1;a++)h+=this.__passwordChar;for(!c&&this.__cursorPosition>0?h+=this.__passwordChar:e.length>0&&this.__cursorPosition-1<e.length&&(h+=e[this.__cursorPosition-1]),a=0;a<s-this.__cursorPosition;a++)h+=this.__passwordChar;this.__setElementText(h),d=i.bind(function(){for(h="",a=0;a<this.__labelText.length;a++)h+=this.__passwordChar;this.__setElementText(h),this.__updateCursorPosition(),this.__passwordTimer=null},this),c?(this.__passwordTimer=o.getGuid(),i.delay(this.__hideTimeout,this.__passwordTimer).then(d).done()):d()}else this.__setElementText(e);this.__labelText=e,this.__labelTextCopy=i.truncate(this.__labelText,this.__cursorPosition,""),n||this.__updateCursorPosition(),u&&this.__widgetInstance&&this.__widgetInstance.dispatchEvent(r.TEXT_CHANGED,this.__labelText),null!==this.__placeHolder&&""===e&&this.__addPlaceHolder()}},__setElementText:function(e){e=i.truncate(e,this.__maxLength,""),this.__isPassword||(this.__labelText=e),this.__element.value=e,this.__inputState&&(this.__element.blur(),this.__element.focus()),this.__setRealCursorPos()},clearText:function(){this.setText("")},__updateCursorPosition:function(){if(!this.__isSetPlaceHolder){var e,t=this.__element,i=0;return t.selectionStart||"0"===String(t.selectionStart)?(s.debug("InputNativeImpl: element has selectionStart"),i=t.selectionStart):document.getSelection&&(s.debug("InputNativeImpl: document has getSelection()"),t.focus(),e=document.getSelection().createRange(),e.moveStart("character",-t.value.length),i=e.text.length),this.__cursorPosition=i,s.debug("InputNativeImpl: __updateCursorPos() reports cursor position is "+i),i}},moveCursor:function(e){this.__inputState&&("left"===e.toLowerCase()?this.setCursorPos(this.__cursorPosition-1):"right"===e.toLowerCase()&&this.setCursorPos(this.__cursorPosition+1))},setCursorPos:function(e){e>this.getText().length?e=this.getText().length:e<0&&(e=0),this.__cursorPosition!==e&&(this.__cursorPosition=e,this.__setRealCursorPos())},startInput:function(){this.__element.focus(),this.__inputState=!0,this.__inputStateFirstOn&&(this.__inputStateFirstOn=!1,this.setCursorPos(this.__cursorPosition)),i.defer().then(i.bind(this.__setRealCursorPos,this)).done()},__setRealCursorPos:function(){var e,t=this.__cursorPosition,i=this.__element;if(this.__oldSamsung)s.debug("InputNativeImpl: samsung 2011 or 2010 device detected"),i.focus(),i.selectionStart=t;else if(i.setSelectionRange){try{i.setSelectionRange(t+0,t+0)}catch(e){s.debug("inputNativeImpl: setSelectionRange() error:"+e.message)}i.blur(),i.focus()}else i.createTextRange&&(s.debug("inputNativeImpl: element has createTextRange()"),e=i.createTextRange(),e.collapse(!0),e.moveEnd("character",t),e.moveStart("character",t),e.select())},stopInput:function(){this.__element.blur(),this.__inputState=!1},isCapturing:function(){return this.__inputState},deinit:function(){this.container.deinit(),this.__input.deinit()}})}),define("xdk-ui-input/interface/InputDisplay",["xdk-base/Interface"],function(e){"use strict";return e.create("InputDisplay",{insertChar:["char","insertPos"],backspace:[],del:[],setMaxLength:["length"],getMaxLength:[],getText:[],setText:["text"],clearText:[],moveCursor:["direction"],setCursorPos:["pos"],startInput:[],stopInput:[],isCapturing:[]})}),define("xdk-ui-input/InputBase",["xdk-base/class","./interface/InputDisplay","xdk-base/Element","xdk-base/device","xdk-base/util","./InputDivImpl","./InputNativeImpl","xdk-base/Env","xdk-ax/evt/type","xdk-ax/Component"],function(e,t,i,n,s,r,a,o,l,c){"use strict";return e.create(c,[t],{},{__impl:null,__initEnvOnKey:!1,__bindedOnKey:null,__blockedKeyList:[],init:function(e){switch(e=e||{},e.text=e.text||"",e.isPassword=e.isPassword||!1,e.focusable=e.focusable||!1,e.placeHolder=e.placeHolder||"",s.isUndefined(e.clickable)&&(e.clickable=!0),e.passwordChar=e.passwordChar||"*",e.hideTimeout=e.hideTimeout||0,e.root=new i("div"),e.widgetInstance=this,s.isUndefined(e.useNative)&&(e.useNative=!0),n.platform){case"tizen":case"toshiba":case"ps3":case"playstation":case"sony":case"panasonic":case"humax":case"wiiu":case"tcl":case"hisense":case"amazon":case"android":case"sharp":case"opera":case"webos":e.useNative=!1;break;case"samsung":if(n.id.getFirmwareYear()<=2011){e.useNative=!1;break}}this.__bindedOnKey=s.bind(function(e){return this.__blockedKeyList.indexOf(e.id)>-1||(this.isCapturing()&&e.text&&this.insertChar(e.text),!0)},this),this._super(e)},addBlockedKey:function(e){var t=[];s.isString(e)?t.push(e):s.isArray(e)&&(t=e),s.each(t,s.bind(function(e){-1===this.__blockedKeyList.indexOf(e)&&this.__blockedKeyList.push(e)},this))},removeBlockedKey:function(e){var t=[];s.isString(e)?t.push(e):s.isArray(e)&&(t=e),s.each(t,s.bind(function(e){var t=this.__blockedKeyList.indexOf(e);t>-1&&this.__blockedKeyList.splice(t,1)},this))},setBlockedKey:function(e){this.__blockedKeyList=[],this.addBlockedKey(e)},insertChar:function(e,t){this.__impl.insertChar(e,t)},backspace:function(){this.__impl.backspace()},del:function(){this.__impl.del()},setMaxLength:function(e){this.__impl.setMaxLength(e)},getMaxLength:function(){return this.__impl.getMaxLength()},getText:function(){
return this.__impl.getText()},setText:function(e){this.__impl.setText(e)},clearText:function(){this.__impl.clearText()},setSelection:function(){this.getRoot().addClass("selected")},removeSelection:function(){this.getRoot().removeClass("selected")},isSelected:function(){return this.getRoot().hasClass("selected")},moveCursor:function(e){this.__impl.moveCursor(e)},setCursorPos:function(e){var t=this.getText().length;e>t?e=t:e<0&&(e=0),this.__impl.setCursorPos(e)},startInput:function(){if(this.getRoot().addClass("input"),this.__impl.startInput(),!this.__initEnvOnKey){var e=o.singleton();e.addEventListener(e.EVT_ONKEY,this.__bindedOnKey),this.__initEnvOnKey=!0}},stopInput:function(){this.getRoot().removeClass("input"),this.__impl.stopInput();var e=o.singleton();e.removeEventListener(e.EVT_ONKEY,this.__bindedOnKey),this.__initEnvOnKey=!1},isInput:function(){return this.isCapturing()},isCapturing:function(){return this.__impl.isCapturing()},deinit:function(){this.stopInput(),this._super(),this.__impl.deinit()}})}),define("xdk-ui-input/Input",["xdk-base/class","xdk-base/Element","xdk-base/device","xdk-base/util","./InputDivImpl","./InputNativeImpl","xdk-base/Env","xdk-ax/evt/type","xdk-ui-input/InputBase"],function(e,t,i,n,s,r,a,o,l){"use strict";return e.create(l,{},{init:function(e){e=e||{},e.maxLength=n.isNumber(e.maxLength)?e.maxLength:20,e.css=e.css?e.css+" wgt-input":"wgt-input",this._super(e),e.root.addClass("wgt-input"),e.useNative?this.__impl=new r(e):this.__impl=new s(e)}})}),define("tvedemo/ext/ui/input/Input",["xdk-ui-input/Input","xdk-base/class","xdk-ui-input/interface/InputDisplay","xdk-base/Element","xdk-base/device","xdk-base/util","xdk-ui-input/InputDivImpl","xdk-ui-input/InputNativeImpl","xdk-base/Env","xdk-ax/evt/type","xdk-ax/Component"],function(e,t,i,n,s,r,a,o,l,c,d){"use strict";return t.create(e,{},{init:function(e){switch(e=e||{},s.platform){case"lg":e.useNative=!1}e.useNative=!1,this._super(e)}})}),define("xdk-ui-basic/Image",["xdk-base/class","xdk-ax/Component","xdk-base/Element","xdk-base/util","xdk-ax/mvc/ModelRef","xdk-base/promise"],function(e,t,i,n,s,r){"use strict";return e.create(t,{},{__setSrcDeferred:null,__imageNode:null,__loadHandlerRef:null,__errorHandlerRef:null,__url:null,__alt:null,__errorImg:null,__errorCallback:null,__counter:0,__lastModelRef:{src:null,alt:null,errorImg:null},__modelListener:{src:null,alt:null,errorImg:null},init:function(e){e=e||{},e.src=e.src||"data:image/gif;base64,R0lGODlhAQABAID/AMDAwAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==",e.alt=e.alt||"",e.errorImg=e.errorImg||"",e.root=new i("img"),this._super(e),this.__imageNode=this.getRoot().getHTMLElement(),this.__loadHandlerRef=n.bind(this.__loadHandler,this),this.__errorHandlerRef=n.bind(this.__errorHandler,this),this.setSrc(e.src),this.setAlt(e.alt),this.setErrorImg(e.errorImg),this.__addEvents()},setSrc:function(e){return this.__setSrcDeferred&&(this.__setSrcDeferred.promise.cancel("Set another source and cancel the previous image."),this.__setSrcDeferred=null),this.__setSrcDeferred=r.defer(),this.__modelHandling("src",n.bind(this.__setSrcFunc,this),e),this.__setSrcDeferred.promise},__addEvents:function(){this.__imageNode.addEventListener("error",this.__errorHandlerRef),this.__imageNode.addEventListener("load",this.__loadHandlerRef)},__removeEvents:function(){this.__imageNode.removeEventListener("error",this.__errorHandlerRef),this.__imageNode.removeEventListener("load",this.__loadHandlerRef)},__errorHandler:function(e){this.__setSrcDeferred.reject({message:"Error in image loading",evt:e})},__loadHandler:function(e){this.__setSrcDeferred.resolve({message:"image loaded",evt:e})},__setSrcFunc:function(e){this.__url=e,this.getRoot().attr("src",e),this.__counter=0},getSrc:function(){return this.__url},setAlt:function(e){this.__modelHandling("alt",n.bind(this.__setAltFunc,this),e)},__setAltFunc:function(e){this.__alt=e,this.getRoot().attr("alt",e)},getAlt:function(){return this.__alt},setErrorCallback:function(e){e&&n.isFunction(e)&&(this.__errorCallback=e,this.getRoot().getHTMLElement().onerror=this.__errorCallback,this.__errorImg=null,this.__counter=0)},resetErrorCallback:function(){this.__counter=0,this.__errorCallback=null,this.__errorImg?this.getRoot().getHTMLElement().onerror=n.bind(function(){this.__counter||(this.getRoot().attr("src",this.__errorImg),this.__counter++)},this):this.getRoot().getHTMLElement().onerror=null},setErrorImg:function(e){this.__modelHandling("errorImg",n.bind(this.__setErrorImgFunc,this),e)},__setErrorImgFunc:function(e){e&&(this.__errorImg=e),this.resetErrorCallback()},__modelHandling:function(e,t,i){this.__lastModelRef[e]&&this.__modelListener[e]&&(this.__lastModelRef[e].getModel().off("change:"+this.__lastModelRef[e].getAttr(),this.__modelListener[e]),this.__lastModelRef[e]=null),!n.isString(i)&&i instanceof s&&(this.__lastModelRef[e]=i,this.__modelListener[e]||(this.__modelListener[e]=function(e){t(e.newVal)}),i.getModel().on("change:"+i.getAttr(),this.__modelListener[e]),i=i.getVal()),t(i)},deinit:function(){this.getRoot().getHTMLElement().onerror=null,this.__removeEvents(),this.getRoot().attr("src",""),this.__setSrcDeferred&&(this.__setSrcDeferred.promise.cancel("Deinit the image"),this.__setSrcDeferred=null),this.__imageNode=null,this.__loadHandlerRef=null,this.__errorHandlerRef=null,this._super()}})}),define("storm/wgt/Image",["xdk-base/class","xdk-ui-basic/Image","xdk-base/util","xdk-base/promise"],function(e,t,i,n){"use strict";return e.create(t,{},{init:function(e){this._super(e),e.placeHolder=e.placeHolder||"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAAlwSFlzAAALEwAACxMBAJqcGAAAAA1JREFUCNdjYGBgMAYAADgANNF/knAAAAAASUVORK5CYII=",this._opts=e,this.setErrorCallback(i.bind(this.fallback,this)),this.setSrc(e.src)},setSrc:function(e){return this.getRoot()?this._super(e):n.resolve()},fallback:function(){this.resetErrorCallback(),this.getRoot().getHTMLElement().style.visibility="hidden";var e,t=i.bind(function(){this.getRoot().getHTMLElement().style.visibility="visible"},this),n=i.bind(function(){return this.setSrc(this._opts.placeHolder).then(t)},this);return e=this._opts.placeHolderPromise?this._opts.placeHolderPromise().then(i.bind(function(e){return this.setSrc(e).then(t,n)},this)):n(),e.then(i.bind(function(){this.setErrorCallback(this.fallback)},this))}})}),define("tvedemo/wgt/ImageButton",["xdk-base/class","xdk-ax/Container","xdk-base/Element","storm/wgt/Image","xdk-ui-basic/Label","xdk-base/util","xdk-ax/evt/type"],function(e,t,i,n,s,r,a){"use strict";return e.create(t,{},{__image:null,__text:null,init:function(e){e.focusable=!0,e.clickable=!0,e.root=e.root||new i("div"),e.src=e.src||"",e.isPureText=e.isPureText||!1,this._super(e),this.getRoot().addClass("wgt-imageButton"),this.__image=new n({css:"image",src:e.src,parent:this,placeHolder:e.placeHolder,placeHolderPromise:e.placeHolderPromise}),e.text&&(this.__label=this.__createLabel(e.text,e.isPureText))},__createLabel:function(e,t){return new s({text:e,css:"text",isPureText:t,parent:this})},setText:function(e,t){this.__text||(this.__text=this.__createLabel(e,t)),this.__text.setText(e,t)},getText:function(){return this.__text?this.__text.getText():null},setSrc:function(e){this.__image.setSrc(e)},fallback:function(){this.__image.fallback()},getSrc:function(){return this.__image.getSrc()},inactivate:function(){this._inactivated=!0,this.addClass("button-inactivated"),this.disable()},activate:function(){this._inactivated=!1,this.removeClass("button-inactivated"),this.enable()},isInactive:function(){return this._inactivated},onDispatchEvent:function(e){return e!==a.CLICK||!this._inactivated}})}),define("tvedemo/wgt/Keyboard",["xdk-base/class","xdk-base/Env","xdk-ax/Container","xdk-base/Element","xdk-ui-input/Keyboard","tvedemo/ext/ui/input/Input","xdk-ui-basic/Label","xdk-ui-basic/Layout","tvedemo/wgt/ImageButton","xdk-base/device","xdk-base/util","xdk-ax/mvc/view","xdk-ax/evt/type","xdk-base/console","xdk-base/core","xdk-base/config","xdk-base/promise"],function(e,t,i,n,s,r,a,o,l,c,d,u,h,_,g,f,p){"use strict";var m=t.singleton(),v={ENTER:"keyboard:enter",SEARCH:"keyboard:search",DELETE:"keyboard:delete",LEFT_ARROW:"keyboard:left-arrow",RIGHT_ARROW:"keyboard:right-arrow",CAPS_TO_SMALL:"keyboard:FromABCToabc",SMALL_TO_CAPS:"keyboard:FromabcToABC",NUMBER_TO_SMALLABC:"keyboard:FromNumberToabc",NUMBER_TO_ABC:"keyboard:FromNumberToABC",ABC_TO_NUMBER:"keyboard:FromABCToNumber",SMALLABC_TO_NUMBER:"keyboard:FromabcToNumber",ABC:"keyboard:ABC"};return e.create(i,{},{init:function(e){e.css=e.css||"overlay-keyboard",this._super(e),this.__keyboardReadyDefer=p.defer(),this.opts=e,"samsung"===c.platform&&c.id.getFirmwareYear()>2011?amd.require(["$MANAGER_WIDGET/Common/IME_XT9/ime.js","$MANAGER_WIDGET/Common/IME_XT9/inputCommon/ime_input.js"],d.bind(function(){_.log("Keyboard require succeeded"),this._setupSamsungKeyboard(e),this.__keyboardReadyDefer.resolve("Requires are satisfied")},this),function(e){_.log("Keyboard require failed: "+e),this.__keyboardReadyDefer.reject()}):(this._createKeyboard(e),this.__keyboardReadyDefer.resolve("Immediately resolved")),this.hide()},getReadyPromise:function(){return this.__keyboardReadyDefer.promise},_onCloseCallback:function(){_.log("on keyboard close")},_onTextChange:function(){_.log("text changed")},setOnTextChange:function(e){this._onTextChange=e},setOnClose:function(e){this._onCloseCallback=e},onClose:function(){this.hideKeyboard()},_createKeyboard:function(e){e=e||{};var t=void 0===e.maxLength?100:e.maxLength,n=void 0!==e.isPassword&&e.isPassword,a=void 0===e.inputCss?"keyboard-input":e.inputCss,o="keyboard-input"===a?"onscreen-keyboard":"onscreen-"+a,c=u.render({klass:i,id:"keyboardContainer",css:"keyboard-container",forwardFocus:!0,children:[{klass:r,id:"input",css:a,maxLength:t,isPassword:n,clickable:!1,focusable:!1},{klass:s,id:"kb",css:o,keyMaps:{default:[["1","2","3","4","5","6","7","8","9","0","","-",{display:new l({src:"img/keyboard/delete.png",id:"#keyDelete"}),keyId:"keyboard:delete"}],["q","w","e","r","t","z","u","i","o","p","","*","'",'"'],["a","s","d","f","g","h","j","k","l","","","@","\\","/"],["y","x","c","v","b","n","m",",",".",":",";","~","$","%"],["(",")","<",">","[","]","{","}","#","&","_","|","!","?"],[{display:"Leertaste",input:" ",colSpan:7},{display:"Eingabe",keyId:"keyboard:search",colSpan:5},{display:new l({src:"img/keyboard/left-arrow.png"}),keyId:"keyboard:left-arrow"},{display:new l({src:"img/keyboard/right-arrow.png"}),keyId:"keyboard:right-arrow"}]],capital:[["1","2","3","4","5","6","7","8","9","0","",{display:new l({src:"img/keyboard/delete.png",id:"#keyDelete"}),keyId:"keyboard:delete"}],["Q","W","E","R","T","Z","U","I","O","P","","^","*"],["A","S","D","F","G","H","J","K","L","","","~","@"],["Y","X","C","V","B","N","M",",",".","?","!","-",{display:new l({src:"img/keyboard/enter.png"}),keyId:"keyboard:enter"}],[{display:"abc",keyId:"keyboard:FromABCToabc"},{display:"12#",keyId:"keyboard:FromABCToNumber"},{display:"Leertaste",input:" ",colSpan:2},{display:"search",keyId:"keyboard:search",colSpan:2},{display:new l({src:"img/keyboard/left-arrow.png"}),keyId:"keyboard:left-arrow"},{display:new l({src:"img/keyboard/right-arrow.png"}),keyId:"keyboard:right-arrow"}]],number:[["0","1","2","3","4"],["5","6","7","8","9"],[{display:"Eingabe",keyId:"keyboard:search",colSpan:4},{display:new l({src:"img/keyboard/delete.png",id:"#keyDelete"}),keyId:"keyboard:delete"}]]}}]});this.attach(c),this.keyboard=c.find("kb"),this.keyboardInputField=c.find("input"),this.keyboard.onEdge=function(e,t){return _.log(arguments),"nextDown"===e},this.keyboardInputField.__impl.addEventListener=void 0,this._setupKeyboardHandling()},showSuggestions:function(e){_.log("show suggestions"),"samsung"===c.platform&&this.imeBox.showAutoCompletePopup(e)},showKeyboard:function(e){this.imeBox?(this.keyboardInputField&&e.text&&(this.keyboardInputField.value=e.text),this.imeBox.onShow()):(void 0!==e.keyMap&&this.keyboard.switchKeyMap(e.keyMap),this.show(),this.keyboardInputField&&e.text&&this.keyboardInputField.setText(e.text))},hideKeyboard:function(){this.imeBox?(document.getElementById("samsungTextInputField").value="",this.imeBox.onClose(),m.removeEventListener(m.EVT_ONUNLOAD,d.bind(function(){this.imeBox.onClose()},this))):(this.keyboardInputField.setText(""),this.hide())},setInputName:function(e){"samsung"===c.platform&&(this.imeBox.inputTitle=e)},_setupSamsungKeyboard:function(e){var t=document.getElementById("samsungTextInputField");t&&t.parentNode.removeChild(t);var i=e.type?e.type:"text",s="password"===i?4:f.get("samsungMaxInputLength",100);t=new n("input",{id:"samsungTextInputField",css:"samsungTextInputField",type:i,maxlength:s},g.root.document.body),t=t.getHTMLElement(),this.imeBox=new IMEShell_Common,m.addEventListener(m.EVT_ONUNLOAD,d.bind(function(){this.imeBox.onClose()},this)),this.imeBox.inputTitle=this.opts.inputTitle||"Input Title",this.imeBox.inputboxID="samsungTextInputField",this.imeBox.setUseShowHidePasswordMenu(!1),this.keyboardInputField=t,this.imeBox.onKeyPressFunc=d.bind(function(e,t,i){switch(_.log("ONKEYPRESSFUNC: "+e+", "+t),e){case 29443:this._onCloseCallback(t),this.hideKeyboard();break;case 222:this.hideKeyboard();break;case 88:case 45:this.hideKeyboard(),this._onCloseCallback(!1)}},this),this.imeBox.onCompleteFunc=function(e){_.log("onCompleteFunc: "+e)},this.imeBox.onTextChangeFunc=d.bind(function(e){_.log("onTextChangeFunc: "+e),this._onTextChange&&this._onTextChange(e)},this),this.imeBox.onClose()},_setupKeyboardHandling:function(){this.keyboardInputField.startInput(),this.keyboard.onHandler=d.bind(function(e){switch(e){case v.ENTER:case v.SEARCH:this._onCloseCallback(this.keyboardInputField.getText()),this.onClose();break;case v.DELETE:this.keyboardInputField.backspace();break;case v.LEFT_ARROW:this.keyboardInputField.moveCursor("left");break;case v.RIGHT_ARROW:this.keyboardInputField.moveCursor("right");break;case v.FromABCToabc:this.keyboard.setFocusPosition("default",[5,0]),this.keyboard.switchKeyMap("default");break;case v.SMALL_TO_CAPS:this.keyboard.setFocusPosition("capital",[5,0]),this.keyboard.switchKeyMap("capital");break;case v.NUMBER_TO_SMALLABC:this.keyboard.setFocusPosition("default",[5,1]),this.keyboard.switchKeyMap("default");break;case v.NUMBER_TO_ABC:this.keyboard.setFocusPosition("capital",[5,0]),this.keyboard.switchKeyMap("capital");break;case v.ABC_TO_NUMBER:case v.SMALLABC_TO_NUMBER:this.keyboard.setFocusPosition("number",[5,1]),this.keyboard.switchKeyMap("number");break;case v.ABC:this.keyboard.switchKeyMap("capital")}return!1},this),this.addEventListener(h.KEY,d.bind(function(e){if(this.keyboardInputField.startInput(),"device:vkey:back"===e.id)return this._onCloseCallback(!1),this.onClose(),!1},this)),this.addEventListener(h.FOCUS,d.bind(function(){this.keyboardInputField.startInput()},this)),this.addEventListener(h.BLUR,d.bind(function(){this.keyboardInputField.stopInput()},this))}})}),define("tvedemo/wgt/input/TizenInputNativeImpl",["xdk-base/class","xdk-base/Element","xdk-base/util","xdk-base/device","xdk-base/console","xdk-ax/evt/type","xdk-base/device/shared/browser/keyMap","xdk-base/core","xdk-ui-input/interface/InputImpl","css!xdk-ui-input/css/InputNativeImpl"],function(e,t,i,n,s,r,a,o,l){"use strict";return e.create([l],{},{_onStartInput:"tizen-on-startinput",__oldSamsung:"samsung"===n.platform&&n.id.getFirmwareYear()<=2011,__cursorPosition:null,__labelText:null,__inputState:!1,__passwordTimer:null,__initEnvOnKey:!1,__maxLength:20,__isPassword:!1,__passwordChar:null,__hideTimeout:0,__widgetInstance:null,__input:null,__element:null,__placeHolder:null,__isSetPlaceHolder:!1,init:function(e){var n,r,o,l=this,c=a.KEYBOARD_KEY.keyCode.UP,d=a.KEYBOARD_KEY.keyCode.DOWN,u=(a.KEYBOARD_KEY.keyCode.LEFT,a.KEYBOARD_KEY.keyCode.RIGHT,a.KEYBOARD_KEY.keyCode.INSERT),h=(a.KEYBOARD_KEY.keyCode.DELETE,a.KEYBOARD_KEY.keyCode.HOME),_=a.KEYBOARD_KEY.keyCode.END,g=a.KEYBOARD_KEY.keyCode.PAGE_UP,f=a.KEYBOARD_KEY.keyCode.PAGE_DOWN,p=a.KEYBOARD_KEY.keyCode.TAB,m=(a.KEYBOARD_KEY.keyCode.BACKSPACE,{});e=e||{},e.root.addClass("wgt-input-native"),e.maxLength&&(m.maxlength=e.maxLength),this.setMaxLength(i.isNumber(e.maxLength)?e.maxLength:20),this.__isPassword=e.isPassword||!1,this.__passwordChar=e.passwordChar||"*",this.__hideTimeout=e.hideTimeout||0,this.__placeHolder=e.placeHolder||"",this.__labelText=e.text||"",this.__cursorPosition=this.__labelText.length,this.__widgetInstance=e.widgetInstance,this.container=new t("div"),this.container.addClass("container"),m.type=!0===e.isPassword?"password":"text",this.__input=new t("input",m),this.__input.addClass("wgt-input-native-ele"),e.root.append(this.container),this.container.append(this.__input),this.__element=this.__input.getHTMLElement(),this.setText(e.text,!0),o=function(e){switch(e.keyCode){case c:case d:case u:case h:case _:case g:case f:case p:return!0;default:return!1}},n=function(e){try{e.preventDefault()}catch(e){e.returnValue=!1}return!0},r=function(e){if(o(e))s.info("inputNativeImpl: blocking text edit key:"+e.keyCode),e.preventDefault(),e.stopPropagation();else switch(e.keyCode){case 46:l.setText("");break;case 8:l.backspace();break;case 32:l.insertChar(" ");break;case 37:l.moveCursor("left");break;case 39:l.moveCursor("right");break;case 65385:case 65376:s.log("Key code : "+e.keyCode),e.preventDefault(),l.stopInput();break;default:s.log("Key code : "+e.keyCode)}return!0},this.__input.addEventListener("keydown",r),this.__input.addEventListener("keypress",n),this.onStartInputEventBind=i.bind(this.onStartInputEvent,this),this.addOnStartInputHandler(),this.__element.onfocus=i.bind(this.startInput,this)},__addPlaceHolder:function(){this.__isSetPlaceHolder=!0,this.__element.value=this.__placeHolder,this.__input.addClass("placeholder"),this.__setRealCursorPos()},__removePlaceHolder:function(){this.__isSetPlaceHolder=!1,this.__element.value="",this.__input.removeClass("placeholder")},insertChar:function(e,t){this.__element.value=this.__element.value+e},backspace:function(){var e=this.__element.value,t=this.__element.selectionStart,i=t-1;t>0&&(this.__element.value=e.substr(0,this.__element.selectionStart-1)+e.substr(this.__element.selectionStart,e.length),this.__element.setSelectionRange(i,i))},del:function(){},setMaxLength:function(e){this.__maxLength=e},getMaxLength:function(){return this.__maxLength},getText:function(){return this.__element.value},setText:function(e,t,n){e=i.truncate(e,this.__maxLength,""),this.__isPassword||(this.__labelText=e),this.__element.value=e},__setElementText:function(e){e=i.truncate(e,this.__maxLength,""),this.__isPassword||(this.__labelText=e),this.__element.value=e,this.__inputState&&(this.__element.blur(),this.__element.focus()),this.__setRealCursorPos()},clearText:function(){this.setText("")},__updateCursorPosition:function(){},moveCursor:function(e){var t,i,n=1;switch(e){case"left":n=-1;break;case"right":n=1}t=this.__element.value.length,(i=this.__element.selectionStart+n)>=0&&i<=t&&this.__element.setSelectionRange(i,i)},getTVArea:function(){return require("xdk-ax/mvc/AppRoot").singleton().getView()},setCursorPos:function(e){},animateTVAreaUp:function(){this.getTVArea().addClass("tizen-keyboard-visible")},animateTVAreaDown:function(){this.getTVArea().removeClass("tizen-keyboard-visible")},addOnStartInputHandler:function(){require("xdk-base/Env").singleton().addEventListener(this._onStartInput,this.onStartInputEventBind)},onStartInputEvent:function(){this.__element.onblur=function(){}},dispatchStartInputEvent:function(){require("xdk-base/Env").singleton().dispatchEvent(this._onStartInput)},startInput:function(){if(!0===this.__inputState)return void s.info("Tizen native input - Already in inputstate no need to focus it.");this.dispatchStartInputEvent(),this.__element.onblur=i.bind(this.stopInput,this),this.__inputState=!0,this.__element.focus(),this.animateTVAreaUp()},__setRealCursorPos:function(){},stopInput:function(){if(!1===this.__inputState)return void s.info("Tizen native input - Not in inputstate no need to blur it.");this.animateTVAreaDown(),this.__element.blur(),this.__inputState=!1},isCapturing:function(){return this.__inputState},deinit:function(){require("xdk-base/Env").singleton().removeEventListener(this._onStartInput,this.onStartInputEventBind),this.container.deinit(),this.__input.deinit()}})}),define("tvedemo/wgt/input/Input",["xdk-base/class","xdk-base/Element","xdk-base/device","xdk-base/util","xdk-ui-input/InputDivImpl","xdk-ui-input/InputNativeImpl","xdk-base/Env","xdk-ax/evt/type","xdk-ui-input/InputBase","xdk-base/device/vKey","tvedemo/wgt/input/TizenInputNativeImpl"],function(e,t,i,n,s,r,a,o,l,c,d){"use strict";return e.create(l,{},{CLICK:"input-field-click",KEY:"input-field-key",init:function(e){e=e||{},e.maxLength=n.isNumber(e.maxLength)?e.maxLength:20,e.css=e.css?e.css+" wgt-input":"wgt-input",this._super(e),e.root.addClass("wgt-input"),"tizen"===i.platform?this.__impl=new d(e):e.useNative?this.__impl=new r(e):this.__impl=new s(e),this._clickEventBind=n.bind(this._clickEvent,this),this._keyEventBind=n.bind(this._keyEvent,this),this.addInputListeners()},_clickEvent:function(){"tizen"===i.platform?this.__impl.startInput():this.dispatchEvent(this.CLICK)},_keyEvent:function(e){switch(e.id){case c.KEY_0.id:case c.KEY_1.id:case c.KEY_2.id:case c.KEY_3.id:case c.KEY_4.id:case c.KEY_5.id:case c.KEY_6.id:case c.KEY_7.id:case c.KEY_8.id:case c.KEY_9.id:"tizen"===i.platform?this.__impl.startInput():this.dispatchEvent(this.KEY,e)}},addInputListeners:function(){this.addEventListener(o.CLICK,this._clickEventBind),this.addEventListener(o.KEY,this._keyEventBind)},removeInputListeners:function(){this.removeEventListener(o.CLICK,this._clickEventBind),this.removeEventListener(o.KEY,this._keyEventBind)}})}),define("tvedemo/wgt/InputDialog",["xdk-base/class","xdk-base/util","xdk-ax/Container","xdk-ax/Component","xdk-ax/focusManager","xdk-ax/evt/type","xdk-ui-basic/Layout","tvedemo/wgt/ConfirmDialog","tvedemo/wgt/Keyboard","tvedemo/wgt/input/Input","xdk-base/device","xdk-base/device/vKey","xdk-base/console"],function(e,t,i,n,s,r,a,o,l,c,d,u,h){"use strict";return e.create(o,{},{doNegativeActionOnBack:!1,init:function(e){e=e||{},e.title=e.title||"",e.message=e.message||"",e.positiveText=e.positiveText||"",e.negativeText=e.negativeText||"",e.maxLength=e.maxLength||32,e.keyMap=e.keyMap||"default",e.positiveAction=t.bind(function(){e.finishedTextInput&&e.finishedTextInput(this._inputField.getText())},this),e.negativeAction=t.bind(function(){e.canceledTextInput&&e.canceledTextInput()},this),this._lastFocus=s.getCurFocus(),this._super(e),this._inputField=new c({css:"wgt-input-dialog-input-field",isPassword:e.isPassword||!1,maxLength:e.maxLength,focusable:!0,nextDown:"buttonContainer"}),t.isUndefined(this._inputField.__impl.removeAllListeners)&&(this._inputField.__impl.removeAllListeners=function(){h.warn("Stub removeAllListeners() invoked")}),this.__boundInputClick=t.bind(function(){this._keyboard=new l({id:"keyboard",type:e.isPassword?"password":"text",forwardFocus:!0,maxLength:e.maxLength,isPassword:e.isPassword,inputCss:e.inputCss}),this._input=this._inputField,this._keyboard.getReadyPromise().then(t.bind(function(){this._keyboard.setInputName(e.title),this._keyboard.showKeyboard({text:this._input.getText(),keyMap:e.keyMap}),s.focus(this._keyboard),this._keyboardOnClose(),(this.getRootController().getView()||amd.require("xdk-ax/mvc/AppRoot").singleton().getView()).attach(this._keyboard)},this),function(e){h.warn("Input dialog: Keyboard cannot be ready due to "+e)})},this),this.__boundInputKey=t.bind(this._fieldKeyHandler,this,this.__boundInputClick),this._inputField.addEventListener(this._inputField.KEY,this.__boundInputKey),this._inputField.addEventListener(this._inputField.CLICK,this.__boundInputClick);var i=this._contentComp.find("buttonContainer");i.setOption("nextUp",this._inputField),e.content.attach(this._inputField,n.PLACE_BEFORE,i),this.addClass("wgt-inputdialog"),this.setOption("forwardFocus",this._inputField),this._inputField.__impl.updateLeft&&this._inputField.__impl.updateLeft(),s.focus(this._inputField)},_fieldKeyHandler:function(e,t){switch(h.log(t),t.id){case u.KEY_0.id:case u.KEY_1.id:case u.KEY_2.id:case u.KEY_3.id:case u.KEY_4.id:case u.KEY_5.id:case u.KEY_6.id:case u.KEY_7.id:case u.KEY_8.id:case u.KEY_9.id:e()}},_keyboardOnClose:function(){this._keyboard.setOnClose(t.bind(function(e){this._keyboardClosed=!0,!1!==e&&this._input.setText(e),this._keyboard.removeAllListeners(),this._keyboard.detach(),this._input.__impl.__input&&this._input.__impl.__input.getHTMLElement().blur();var t=this._contentComp.find("buttonContainer");s.focus(t)},this))},close:function(){s.focus(this._lastFocus),this._super()},reset:function(){this._inputField.removeEventListener(this._inputField.KEY,this.__boundInputKey),this._inputField.removeEventListener(this._inputField.CLICK,this.__boundInputClick),this._inputField.removeInputListeners(),this._negativeAction=null,this._positiveAction=null}})}),define("xdk-ax/iterator/DFSCtrlIt",["xdk-base/class","xdk-ax/iterator/interface/Iterator","xdk-base/core"],function(e,t,i){"use strict";return e.create([t],{},{__ctrlArr:[],init:function(e){this._include(e)},_include:function(e){var t,i=e.getSubControllers();this.__ctrlArr.unshift(e);for(t in i)this._include(i[t])},next:function(){return this.__ctrlArr.length||i.createException("NoSuchElement","No more element is available for current iteraion!"),this.__ctrlArr.pop()},hasNext:function(){return!!this.__ctrlArr.length}})}),define("xdk-history/HistoryManager",["xdk-base/core","xdk-base/class","xdk-base/util","xdk-base/EventDispatcher","xdk-ax/mvc/Controller","xdk-ax/mvc/ControllerManager","xdk-ax/mvc/AppRoot","xdk-ax/iterator/DFSCtrlIt","xdk-base/device/vKey","xdk-base/console","xdk-base/exception","xdk-base/promise","xdk-ax/focusManager"],function(e,t,i,n,s,r,a,o,l,c,d,u,h){"use strict";var _,g,f=a.singleton(),p=r.singleton();return _=t.create(n,{DEFAULT_BACK_KEYS:[l.BACK.id],EVT_HISTORY_BACK:"ui:history:back",singleton:function(){return g||(g=new _),g}},{_backKeys:null,_history:[],init:function(){this._super(),this.setBackKeys(this.constructor.DEFAULT_BACK_KEYS)},activate:function(){var e=this;f.setDefaultKeyAction(this._backKeys,function(t){e.back()}),p.addEventListener(p.constructor.EVT_REPLACED,function(t){t.options.__doHistoryBack||e._push({front:t.exist,frontContext:t.exist.getContextTree(),controller:t.replacement,options:t.options})}),p.addEventListener(p.constructor.EVT_OPENED,function(t){t.options.__doHistoryBack||t.options.appRootFirstController||e._push({front:null,controller:t.controller,options:t.options})}),p.addEventListener(p.constructor.EVT_CLOSED,function(t){t.options.__doHistoryBack||e._push({front:t.controller,frontContext:t.controller.getContextTree(),controller:null,container:t.container,options:t.options})})},_setCtrlNav:function(e,t){e.__navigation=t},_getCtrlNav:function(e){return e.__navigation},_clearCtrlNav:function(e){e&&(e.__navigation=null,delete e.__navigation)},_removeSkippedHistory:function(e,t){for(var n,s,r=new o(e),a=[],l=this._getCtrlNav(e);r.hasNext();)s=r.next(),this._getCtrlNav(s)&&a.push(this._getCtrlNav(s));return i.each(a,function(s){this._clearCtrlNav(s.controller),-1!==(n=i.indexOf(this._history,s))&&(i.remove(this._history,n),(t||s.controller!==e)&&s.front&&this._removeSkippedHistory(s.front,!0))},this),l},_doHistoryBack:function(e,t){t=t||{},t.historyBack=!0;var n=function(e){i.each(e,function(e){e.value.historyBack=!0,e.value.subContexts&&n(e.value.subContexts)})};return e.front&&(i.isPlainObject(e.frontContext)&&(t=i.extend(e.frontContext,t)),t.subContexts&&n(t.subContexts)),this._changeController(e,t).complete(function(){var t;t=e.options.historyFocus?e.options.historyFocus:null,!function(e){return e&&e.getRoot()&&e.getRoot().isInDOMTree()}(t)?h.focus(h.getLastActiveFocus()):h.focus(t)})},_changeController:function(t,i){return t.front&&t.controller?p.replace(t.controller,t.front,{context:i,__doHistoryBack:!0}):t.front?t.container?p.open(t.front,t.container,{context:i,__doHistoryBack:!0}):u.reject(e.createException(d.INTERNAL,"When doing History back to the previous controller, it fails to find the container to open")):p.close(t.controller,{__doHistoryBack:!0})},_push:function(e){var t,i;if(e.options&&e.options.historySkip){if(!e.front||!e.controller)return void c.warn("cannot skip history on open and close controller");if(!(i=this._removeSkippedHistory(e.front))||!i.front)return;e.front=i.front}e.controller&&this._setCtrlNav(e.controller,e),!1===e.options.controllerCache&&e.front&&(e.front=e.front.constructor,this._history.length>0&&(t=this._history[this._history.length-1],t.controller=t.controller.constructor)),this._history.push(e)},back:function(t){t=t||{};var n,r,a,o,l,d;if(i.isUndefined(t.ctrl))n=1;else{if(l=t.ctrl,!l.prototype instanceof s)throw e.createException("IncorrectParam","first arugment should be either a Number or a Controller Subclass.");for(o=this._history.length-1;o>=0;o--){if(this._history[o].front instanceof l){n=this._history.length-o;break}if(0===o)return u.reject(!1)}}if(-1===n&&(n=this._history.length),!this._history.length||n>this._history.length)return u.reject(!1);if(n>1){for(a=this._history.splice(this._history.length-n+1,n-1),o=a.length-1;o>=0;o--)c.info("history manager multiback from "+o),d=d?d.then(i.bind(this._doHistoryBack,this,a[o])):this._doHistoryBack(a[o]);a.splice(0,a.length),c.info(this._history)}return r=this._history.pop(),d=d?d.then(i.bind(this._doHistoryBack,this,r,t.context)):this._doHistoryBack(r,t.context),d.then(i.bind(this.dispatchEvent,this,this.constructor.EVT_HISTORY_BACK,r))},setBackKeys:function(e){this._backKeys=e},clear:function(){i.each(this._history,function(e){this._clearCtrlNav(e.controller)},this),i.clear(this._history)},getHistoryStack:function(){return i.clone(this._history)}}),_.singleton(),_}),define("tvedemo/mgr/sHistoryManager",["xdk-base/core","xdk-base/class","xdk-base/util","xdk-base/EventDispatcher","xdk-ax/mvc/Controller","xdk-ax/mvc/ControllerManager","xdk-ax/mvc/AppRoot","xdk-ax/iterator/DFSCtrlIt","xdk-base/device/vKey","xdk-base/console","xdk-history/HistoryManager","xdk-base/promise","xdk-ax/focusManager"],function(e,t,i,n,s,r,a,o,l,c,d,u,h){"use strict";var _=a.singleton(),g=r.singleton(),f=d.singleton();return new(t.create(f.constructor,{},{init:function(){this.setBackKeys(this.constructor.DEFAULT_BACK_KEYS)},_doHistoryBack:function(e,t){t=t||{},t.historyBack=!0;var n=function(e){i.each(e,function(e){e.value.historyBack=!0,e.value.subContexts&&n(e.value.subContexts)})};return e.front&&(t=i.extend(e.frontContext,t),t.subContexts&&n(t.subContexts)),this._changeController(e,t).then(function(){u.resolve(t.setupPending)}).complete(function(){var t;t=e.options.historyFocus?e.options.historyFocus:null,!function(e){return e&&e.getRoot()&&e.getRoot().isInDOMTree()}(t)?h.focus(h.getLastActiveFocus()):h.focus(t)})},activate:function(){var e=this;_.setDefaultKeyAction(this._backKeys,function(){e.back()}),g.addEventListener(g.constructor.EVT_REPLACED,function(t){t.options.__doHistoryBack||e._push({front:t.exist,frontContext:t.exist.getContextTree(),controller:t.replacement,options:t.options})}),g.addEventListener(g.constructor.EVT_OPENED,function(t){t.options.__doHistoryBack||t.options.appRootFirstController||e._push({front:null,frontContext:t.options.frontContext,controller:t.controller,options:t.options})}),g.addEventListener(g.constructor.EVT_CLOSED,function(t){t.options.__doHistoryBack||e._push({front:t.controller,frontContext:t.controller.getContextTree(),controller:null,options:t.options})})}}))}),define("xdk-ui-basic/interface/Scrollable",["xdk-base/Interface"],function(e){"use strict";return e.create("Scrollable",{registerMediator:["mediator"],unregisterMediator:["mediator"],unregisterAllMediator:[]})}),
define("xdk-ui-basic/AbstractScrollable",["xdk-ui-basic/interface/Scrollable","xdk-base/class","xdk-ax/Container","xdk-ax/evt/type","xdk-base/console","xdk-base/util","xdk-base/core"],function(e,t,i,n,s,r,a){"use strict";return t.createAbstract(i,[e],{},{__mediator:[],registerMediator:function(e){if(!e.setScrollable)throw a.createException("IncorrectParam","Incorrect mediator implementation or not a proper mediator!");e.setScrollable(this)},unregisterMediator:function(e){if(!e.setScrollable)throw a.createException("IncorrectParam","Incorrect mediator implementation or not a proper mediator!");var t=r.indexOf(this.__mediator,e);t>-1&&(this.__mediator.splice(t,1),e.unsetScrollable(this))},unregisterAllMediator:function(){r.each(this.__mediator,r.bind(function(e){this.unregisterMediator(e)},this))},dispatchScrolledInfo:function(e,t,i){var r={start:e||0,length:t||1,total:i||1};s.info(r),this.dispatchEvent(n.SCROLLED_INDICATOR,r)},dispatchScrolledUpdate:function(e){this.dispatchEvent(n.SCROLLED_PERCENTAGE,e)},update:function(e,t){s.warn("update is not implemented in Scrollable Object")}})}),define("xdk-ui-basic/interface/Indicator",["xdk-base/Interface"],function(e){"use strict";return e.create("Indicator",{update:["percent"],set:["start","length","total"]})}),define("xdk-ui-basic/AbstractIndicator",["xdk-ui-basic/interface/Indicator","xdk-base/class","xdk-ax/Component","xdk-ax/evt/type","xdk-base/console"],function(e,t,i,n,s){"use strict";return t.createAbstract(i,[e],{},{update:function(e){s.warn("update is not implemented in Indicator Object")},set:function(e,t,i){s.warn("set is not implemented in Indicator Object")},dispatchIndicatorUpdate:function(e,t){var i={};i.reverse=e||!1,i.percent=t||0,this.dispatchEvent(n.INDICATOR_UPDATED,i)}})}),define("css!xdk-ui-basic/css/Scrollbar",[],function(){}),define("xdk-ui-basic/Scrollbar",["xdk-base/class","xdk-base/util","xdk-base/Element","xdk-base/console","xdk-ui-basic/AbstractIndicator","css!./css/Scrollbar"],function(e,t,i,n,s){"use strict";return e.create(s,{VERTICAL:1,HORIZONTAL:2},{_track:null,_nodeTable:null,_vertical:!0,_trackTopTd:null,_nodeTopTd:null,_nodeMiddleTd:null,_nodeBottomTd:null,_trackTopping:!0,__previousPosition:0,init:function(e){e.orientation||(e.orientation=this.constructor.VERTICAL),e.trackTopping||(this._trackTopping=e.trackTopping),e.trackTopping||(this._trackTopping=e.trackTopping),this._super(e);var t,n,s,r,a,o,l,c,d;this.getRoot().addClass("wgt-scrollbar"),e.orientation===this.constructor.HORIZONTAL?(this._vertical=!1,this.getRoot().addClass("wgt-scrollbar-h")):this.getRoot().addClass("wgt-scrollbar-v"),this._trackTable=new i("table",{cellpadding:"0",cellspacing:"0",width:"100%"}),this._trackTable.addClass("track"),t=new i("tr"),this._trackTopTd=new i("td"),this._trackTopTd.addClass("trackTop"),this._vertical&&(a=new i("tr"),r=new i("tr")),n=new i("td"),n.addClass("trackMiddle"),s=new i("td"),s.addClass("trackBottom"),this._nodeTable=new i("table",{cellpadding:"0",cellspacing:"0"}),this._nodeTable.addClass("nodeTable"),l=new i("tr"),this._vertical&&l.addClass("nodeTopTr"),this._nodeTopTd=new i("td"),this._nodeTopTd.addClass("nodeTop"),this._vertical&&(c=new i("tr"),c.addClass("nodeMiddleTr"),d=new i("tr"),d.addClass("nodeBottomTr")),o=new i("td"),o.addClass("nodeMiddle"),this._nodeBottomTd=new i("td"),this._nodeBottomTd.addClass("nodeBottom"),t.append(this._trackTopTd),this._vertical?(a.append(n),r.append(s)):(t.append(n),t.append(s)),this._trackTable.append(t),this._vertical&&(this._trackTable.append(a),this._trackTable.append(r)),l.append(this._nodeTopTd),this._vertical?(c.append(o),d.append(this._nodeBottomTd)):(l.append(o),l.append(this._nodeBottomTd)),this._nodeTable.append(l),this._vertical&&(this._nodeTable.append(c),this._nodeTable.append(d)),this.getRoot().append(this._trackTable),this.getRoot().append(this._nodeTable)},set:function(e,i,s){e+i>s&&(i=s-e);var r=function(){var t,r,a,o,l,c,d,u,h=this._trackTable.getHTMLElement(),_=this._nodeTable.getHTMLElement().style,g=this._trackTopTd.getHTMLElement(),f=this._nodeTopTd.getHTMLElement(),p=this._nodeBottomTd.getHTMLElement();this._vertical?(t=h.scrollHeight-(this._trackTopping?2*g.scrollHeight:0),r=h.scrollTop,a=Math.ceil(t*i/s)+(this._trackTopping?2*g.scrollHeight:0),a=Math.max(f.scrollHeight+p.scrollHeight,a),o=s===i?0:Math.ceil(r+(this._trackTopping?g.scrollHeight:0)+e/(s-i)*(t-a)),n.info("trackHeight: "+t+" trackY: "+r+" nodeHeight: "+a+" nodeY: "+o),_.height=a+"px",_.top=o+"px",this.__nodeHeight=a,this.__trackHeight=t):(l=h.scrollWidth-(this._trackTopping?2*g.scrollWidth:0),c=h.scrollLeft,d=Math.ceil(l*i/s)+(this._trackTopping?2*g.scrollWidth:0),d=Math.max(f.scrollWidth+p.scrollWidth,d),u=s===i?0:Math.ceil(c+(this._trackTopping?g.scrollWidth:0)+e/(s-i)*(l-d)),_.left=u+"px",_.width=d+"px",this.__nodeWidth=d,this.__trackWidth=l),this._nodeTable.css("tableLayout","fixed"),"none"!==this.getRoot().css("display")&&this.show()};t.defer().then(t.bind(r,this)).done()},update:function(e){if(e<0||e>1)return void n.warn("percentage should be within 0 to 1");this._vertical?this._nodeTable.css("top",(this.__trackHeight-this.__nodeHeight)*e+"px"):this._nodeTable.css("left",(this.__trackWidth-this.__nodeWidth)*e+"px")}})}),define("fix/Scrollbar",["xdk-base/class","xdk-base/console","xdk-base/util","xdk-ui-basic/Scrollbar"],function(e,t,i,n){"use strict";return e.create(n,{},{init:function(e){t.warn("Using custom Scrollbar component, careful if the original one gets updated!"),this._super(e)},set:function(e,n,s,r,a){var o=n;e+n>s&&(n=s-e);var l=function(){var i,l,c,d,u,h,_,g,f=this._trackTable.getHTMLElement(),p=this._nodeTable.getHTMLElement().style,m=this._trackTopTd.getHTMLElement();this._vertical?(i=(a||f.scrollHeight)-(this._trackTopping?2*m.scrollHeight:0),l=f.scrollTop,c=Math.ceil(o*Math.min(1,o/s)),d=s===n?0:Math.ceil(l+(this._trackTopping?m.scrollHeight:0)+e/(s-n)*(i-c)),t.info("trackHeight: "+i+" trackY: "+l+" nodeHeight: "+c+" nodeY: "+d),p.height=c+"px",p.top=d+"px",this.__nodeHeight=c,this.__trackHeight=i):(u=(r||f.scrollWidth)-(this._trackTopping?2*m.scrollWidth:0),h=f.scrollLeft,_=Math.ceil(o*Math.min(1,o/s)),g=s===n?0:Math.ceil(h+(this._trackTopping?m.scrollWidth:0)+e/(s-n)*(u-_)),p.left=g+"px",p.width=_+"px",this.__nodeWidth=_,this.__trackWidth=u),this._nodeTable.css("tableLayout","fixed"),"none"!==this.getRoot().css("display")&&this.show()};i.defer().then(i.bind(l,this)).done()}})}),amd.define("xdk-base/cssUtil",["xdk-base/promise","xdk-base/console"],function(e,t){"use strict";return{addCss:function(t){var i=e.defer();return domReady(function(){try{var e=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");n.type="text/css",n.styleSheet?n.styleSheet.cssText=t:n.appendChild(document.createTextNode(t)),e.appendChild(n),i.resolve(n)}catch(e){i.reject(e)}}),i.promise},removeCssNode:function(e){e&&e.parentNode?e.parentNode.removeChild(e):t.warn("[cssUtil] node is not a valid HTMLStyleElement, or is not in DOM")},appendCss:function(e,i){i?i.styleSheet?i.styleSheet.cssText+=e:i.appendChild(document.createTextNode(e)):t.warn("[cssUtil] node is not a valid HTMLStyleElement")}}}),define("xdk-base/cssUtil",function(){}),define("xdk-ui-basic/ScrollingMediator",["xdk-base/class","xdk-ax/evt/DualEventDispatcher","xdk-ui-basic/interface/Scrollable","xdk-base/console","xdk-ax/evt/type","xdk-base/util","xdk-ui-basic/interface/Indicator"],function(e,t,i,n,s,r,a){"use strict";return e.create(t,{},{__indicator:[],__scrollableComp:null,__scrollable:[],__emitScrolledPercentHandler:null,__emitIndicatorInfoHandler:null,__emitUpdatedHandler:null,init:function(e){this._super(e),this.__emitScrolledPercentHandler=r.bind(this.__emitScrolledPercent,this),this.__emitIndicatorInfoHandler=r.bind(this.__emitIndicatorInfo,this),this.__emitUpdatedHandler=r.bind(this.__emitUpdated,this)},registerIndicator:function(e){e.addEventListener(s.INDICATOR_UPDATED,this.__emitUpdatedHandler),this.__indicator.push(e)},setScrollable:function(t){if(!e.hasImpl(t.constructor,i))return void n.warn("scrollable does not implement scrollable interface");this.__scrollableComp&&(n.warn("scrollable exists, replace with new scrollable"),this.unsetScrollable()),t.addEventListener(s.SCROLLED_PERCENTAGE,this.__emitScrolledPercentHandler),t.addEventListener(s.SCROLLED_INDICATOR,this.__emitIndicatorInfoHandler),this.__scrollableComp=t},__emitIndicatorInfo:function(e){var t,i,n;t=e.start||0,i=e.length||1,n=e.total||1,r.each(this.__indicator,function(e){e.set&&e.set(t,i,n)})},__emitScrolledPercent:function(e){r.each(this.__indicator,function(t){t.update&&t.update(e)})},unregisterIndicator:function(e){var t;(t=r.indexOf(this.__indicator,e))>-1&&(e.removeEventListener(s.INDICATOR_UPDATED,this.__emitUpdatedHandler),this.__indicator.splice(t,1))},unsetScrollable:function(){var e=this.__scrollableComp;e&&(e.removeEventListener(s.SCROLLED_PERCENTAGE,this.__emitScrolledPercentHandler),e.removeEventListener(s.SCROLLED_INDICATOR,this.__emitIndicatorInfoHandler),this.__scrollableComp=null)},unregisterAllIndicators:function(){r.each(this.__indicator,r.bind(function(e){this.unregisterIndicator(e)},this))},unregisterAll:function(){this.unregisterAllIndicators(),this.unsetScrollable(),this.unregisterScrollables()},registerScrollable:function(e){e.addEventListener(s.SCROLLED_PERCENTAGE,this.__emitScrolledPercentHandler),e.addEventListener(s.SCROLLED_INDICATOR,this.__emitIndicatorInfoHandler),this.__scrollable.push(e)},unregisterScrollable:function(e){var t;(t=r.indexOf(this.__scrollable,e))>-1&&(e.removeEventListener(s.SCROLLED_PERCENTAGE,this.__emitScrolledPercentHandler),e.removeEventListener(s.SCROLLED_INDICATOR,this.__emitIndicatorInfoHandler),this.__scrollable.splice(t,1))},__emitUpdated:function(e){var t,i;t=e.reverse||!1,i=e.percent||0,r.each(this.__scrollable,function(e){e.update&&e.update(t,i)}),this.__scrollableComp&&this.__scrollableComp.update&&this.__scrollableComp.update(t,i)},unregisterScrollables:function(){r.each(this.__scrollable,r.bind(function(e){this.unregisterScrollable(e)},this))}})}),define("tvedemo/wgt/ScrollLabel",["xdk-base/class","xdk-ui-basic/AbstractScrollable","xdk-base/util","xdk-ui-basic/Label","fix/Scrollbar","xdk-base/Element","xdk-ax/evt/type","xdk-base/cssUtil","xdk-ui-basic/ScrollingMediator","xdk-base/console","xdk-base/device/vKey"],function(e,t,i,n,s,r,a,o,l,c,d){"use strict";return o.addCss(".wgt-scrollLabel .container{                        position: absolute;                        overflow:hidden;                    }                    .wgt-scrollLabel .text{                        position:absolute;                        top:0px;                    }"),e.create(t,{},{__label:null,__labelContainer:null,__scrollbar:null,__inited:!1,__containerHeight:0,__labelHeight:0,__scrollable:!1,__maxStep:0,__stepSize:0,__focused:!1,init:function(e){var t,o=new l;e=e||{},e.focusable=!0,e.root=new r("div"),t=e.text||"",this.__stepSize=e.scrollStep||50,this._super(e),this.getRoot().addClass("wgt-scrollLabel"),this.__labelContainer=new r("div").addClass("container"),this.getRoot().append(this.__labelContainer),this.__label=new n({parent:this}),this.__label.getRoot().setClass("text"),this.__scrollbar=new s({css:"scrollbar",parent:this}),this.setText(t),this.__attachToDomRef=i.bind(this.__attachToDom,this),this.addEventListener(a.ATTACHED_TO_DOM,this.__attachToDomRef),this.__detachFromDomRef=i.bind(this.__detachFromDom,this),this.addEventListener(a.DETACHED_FROM_DOM,this.__detachFromDomRef),this._onFocusRef=i.bind(this._onFocus,this),this.addEventListener(a.FOCUS,this._onFocusRef),this._onBlurRef=i.bind(this._onBlur,this),this.addEventListener(a.BLUR,this._onBlurRef),o.registerIndicator(this.__scrollbar),o.setScrollable(this),this.addEventListener(a.KEY,i.bind(this._onKey,this)),this.getRoot().addEventListener("mousewheel",i.bind(this._onScrollWheel,this)),this.__inited=!0},_onFocus:function(e){this.__focused=!0},_onBlur:function(e){this.__focused=!1},_onScrollWheel:function(e){if(this.__focused){var t=e||window.event;(t.detail?-120*t.detail:t.wheelDelta)>0?this.__scrollbar._opts.orientation===s.HORIZONTAL?this.scroll(!0):this.scroll(!1):this.__scrollbar._opts.orientation===s.HORIZONTAL?this.scroll(!1):this.scroll(!0)}},_onKey:function(e){switch(e.id){case d.UP.id:return!this.scroll(!1);case d.DOWN.id:return!this.scroll(!0)}return!0},setText:function(e){this.__label.setText(e),this.__inited&&(this.__updateSize(),this._scrollTo(0))},getText:function(){return this.__label.getText()},scroll:function(e){if(!this.__scrollable)return void c.info("Abort the scroll: The content is fit into the label, no scroll is needed.");var t,n=parseInt(this.__label.getRoot().getHTMLElement().offsetTop,10),s=this.__stepSize;if(e=!!i.isUndefined(e)||e,(t=n+(e?-s:s))>=0){if(n>=0)return!1;this._scrollTo(0)}else if(t>this.__maxStep)this._scrollTo(t);else{if(n===this.__maxStep)return!1;this._scrollTo(this.__maxStep)}return!0},setFocusable:function(e){if(this.__scrollable)return void(!1===this.getOption("focusable")&&this.setOption("focusable",!0));var t=!!e;this.setOption("focusable",t)},__getPosition:function(){return parseInt(this.__label.getRoot().getHTMLElement().offsetTop,10)},_scrollTo:function(e){if(this.__getPosition()===e)return void c.info("Abort the scroll: Label is at target position.");this.__label.getRoot().css("top",e+"px"),this.dispatchScrolledInfo(-e,this.__containerHeight,this.__labelHeight),this.__processing=!0},__attachToDom:function(){this.__updateSize()},_doAttach:function(e,i,s){if(this.__inited)return void c.info("Unavailable to append more children after inited.");var r=this._root;switch(e instanceof n&&(r=this.__labelContainer),i){case t.PLACE_APPEND:r.append(e.getRoot());break;case t.PLACE_PREPEND:r.prepend(e.getRoot());break;case t.PLACE_BEFORE:r.insertBefore(s.getRoot(),e.getRoot());break;case t.PLACE_AFTER:r.insertAfter(s.getRoot(),e.getRoot())}},__updateSize:function(){this.__labelHeight=this.__label.getRoot().getHTMLElement().offsetHeight,this.__containerHeight=this.__labelContainer.getHTMLElement().offsetHeight,this.__labelHeight>this.__containerHeight?(this.__scrollable=!0,this.__scrollbar.show(),this.dispatchScrolledInfo(0,this.__containerHeight,this.__labelHeight)):(this.__scrollable=!1,this.__scrollbar.hide(),this.dispatchScrolledInfo(0,this.__containerHeight,this.__containerHeight)),this.__maxStep=-(this.__labelHeight-this.__containerHeight)},__detachFromDom:function(){this.removeEventListener(a.ATTACHED_TO_DOM,this.__attachToDomRef),this.removeEventListener(a.DETACHED_FROM_DOM,this.__detachFromDomRef)}})}),define("css!xdk-ui-basic/css/Checkbox",[],function(){}),define("xdk-ui-basic/Checkbox",["xdk-base/class","xdk-ax/Component","xdk-base/Element","xdk-ax/evt/type","xdk-base/util","css!./css/Checkbox"],function(e,t,i,n,s){"use strict";return e.create(t,{},{_value:!1,_image:null,init:function(e){e.focusable=!0,e.clickable=!0,this._super(e),this.getRoot().addClass("wgt-checkbox"),this._value=!!e.checked,this._image=new i("span"),this._value&&this._image.addClass("checked"),this.getRoot().append(this._image),this.addEventListener(n.CLICK,s.bind(function(){this.toggle()},this))},toggle:function(){this.check(!this._value)},check:function(e){var t=s.isUndefined(e)||!!e;t&&!this._value?this._image.addClass("checked"):!t&&this._value&&this._image.removeClass("checked"),this._value=t,this.dispatchEvent(n.VALUE_CHANGED,this._value)},uncheck:function(){this.check(!1)},getValue:function(){return this._value}})}),define("lib/moment",[],function(){function e(e,t){return function(i){return a(e.call(this,i),t)}}function t(){}function i(e){m(e),s(this,e)}function n(e){var t=h(e),i=t.year||0,n=t.month||0,s=t.week||0,r=t.day||0,a=t.hour||0,o=t.minute||0,l=t.second||0,c=t.millisecond||0;this._input=e,this._milliseconds=+c+1e3*l+6e4*o+36e5*a,this._days=+r+7*s,this._months=+n+12*i,this._data={},this._bubble()}function s(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return t.hasOwnProperty("toString")&&(e.toString=t.toString),t.hasOwnProperty("valueOf")&&(e.valueOf=t.valueOf),e}function r(e){return e<0?Math.ceil(e):Math.floor(e)}function a(e,t){for(var i=e+"";i.length<t;)i="0"+i;return i}function o(e,t,i,n){var s,r,a=t._milliseconds,o=t._days,l=t._months;a&&e._d.setTime(+e._d+a*i),(o||l)&&(s=e.minute(),r=e.hour()),o&&e.date(e.date()+o*i),l&&e.month(e.month()+l*i),a&&!n&&J.updateOffset(e),(o||l)&&(e.minute(s),e.hour(r))}function l(e){return"[object Array]"===Object.prototype.toString.call(e)}function c(e){return"[object Date]"===Object.prototype.toString.call(e)||e instanceof Date}function d(e,t,i){var n,s=Math.min(e.length,t.length),r=Math.abs(e.length-t.length),a=0;for(n=0;n<s;n++)(i&&e[n]!==t[n]||!i&&_(e[n])!==_(t[n]))&&a++;return a+r}function u(e){if(e){var t=e.toLowerCase().replace(/(.)s$/,"$1");e=Le[e]||Ae[t]||t}return e}function h(e){var t,i,n={};for(i in e)e.hasOwnProperty(i)&&(t=u(i))&&(n[t]=e[i]);return n}function _(e){var t=+e,i=0;return 0!==t&&isFinite(t)&&(i=t>=0?Math.floor(t):Math.ceil(t)),i}function g(e,t){return new Date(Date.UTC(e,t+1,0)).getUTCDate()}function f(e){return p(e)?366:365}function p(e){return e%4==0&&e%100!=0||e%400==0}function m(e){var t;e._a&&-2===e._pf.overflow&&(t=e._a[ee]<0||e._a[ee]>11?ee:e._a[te]<1||e._a[te]>g(e._a[Z],e._a[ee])?te:e._a[ie]<0||e._a[ie]>23?ie:e._a[ne]<0||e._a[ne]>59?ne:e._a[se]<0||e._a[se]>59?se:e._a[re]<0||e._a[re]>999?re:-1,e._pf._overflowDayOfYear&&(t<Z||t>te)&&(t=te),e._pf.overflow=t)}function v(e){e._pf={empty:!1,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:!1,invalidMonth:null,invalidFormat:!1,userInvalidated:!1,iso:!1}}function b(e){return null==e._isValid&&(e._isValid=!isNaN(e._d.getTime())&&e._pf.overflow<0&&!e._pf.empty&&!e._pf.invalidMonth&&!e._pf.nullInput&&!e._pf.invalidFormat&&!e._pf.userInvalidated,e._strict&&(e._isValid=e._isValid&&0===e._pf.charsLeftOver&&0===e._pf.unusedTokens.length)),e._isValid}function S(e){return e?e.toLowerCase().replace("_","-"):e}function y(e,i){return i.abbr=e,ae[e]||(ae[e]=new t),ae[e].set(i),ae[e]}function E(e){delete ae[e]}function k(e){var t,i,n,s,r=0,a=function(e){if(!ae[e]&&oe)try{require("./lang/"+e)}catch(e){}return ae[e]};if(!e)return J.fn._lang;if(!l(e)){if(i=a(e))return i;e=[e]}for(;r<e.length;){for(s=S(e[r]).split("-"),t=s.length,n=S(e[r+1]),n=n?n.split("-"):null;t>0;){if(i=a(s.slice(0,t).join("-")))return i;if(n&&n.length>=t&&d(s,n,!0)>=t-1)break;t--}r++}return J.fn._lang}function C(e){return e.match(/\[[\s\S]/)?e.replace(/^\[|\]$/g,""):e.replace(/\\/g,"")}function T(e){var t,i,n=e.match(ue);for(t=0,i=n.length;t<i;t++)Oe[n[t]]?n[t]=Oe[n[t]]:n[t]=C(n[t]);return function(s){var r="";for(t=0;t<i;t++)r+=n[t]instanceof Function?n[t].call(s,e):n[t];return r}}function x(e,t){return e.isValid()?(t=I(t,e.lang()),De[t]||(De[t]=T(t)),De[t](e)):e.lang().invalidDate()}function I(e,t){function i(e){return t.longDateFormat(e)||e}var n=5;for(he.lastIndex=0;n>=0&&he.test(e);)e=e.replace(he,i),he.lastIndex=0,n-=1;return e}function w(e,t){switch(e){case"DDDD":return fe;case"YYYY":case"GGGG":case"gggg":return pe;case"YYYYY":case"GGGGG":case"ggggg":return me;case"S":case"SS":case"SSS":case"DDD":return ge;case"MMM":case"MMMM":case"dd":case"ddd":case"dddd":return be;case"a":case"A":return k(t._l)._meridiemParse;case"X":return Ee;case"Z":case"ZZ":return Se;case"T":return ye;case"SSSS":return ve;case"MM":case"DD":case"YY":case"GG":case"gg":case"HH":case"hh":case"mm":case"ss":case"M":case"D":case"d":case"H":case"h":case"m":case"s":case"w":case"ww":case"W":case"WW":case"e":case"E":return _e;default:return new RegExp(M(N(e.replace("\\",""))))}}function L(e){var t=(Se.exec(e)||[])[0],i=(t+"").match(xe)||["-",0,0],n=60*i[1]+_(i[2]);return"+"===i[0]?-n:n}function A(e,t,i){var n,s=i._a;switch(e){case"M":case"MM":null!=t&&(s[ee]=_(t)-1);break;case"MMM":case"MMMM":n=k(i._l).monthsParse(t),null!=n?s[ee]=n:i._pf.invalidMonth=t;break;case"D":case"DD":null!=t&&(s[te]=_(t));break;case"DDD":case"DDDD":null!=t&&(i._dayOfYear=_(t));break;case"YY":s[Z]=_(t)+(_(t)>68?1900:2e3);break;case"YYYY":case"YYYYY":s[Z]=_(t);break;case"a":case"A":i._isPm=k(i._l).isPM(t);break;case"H":case"HH":case"h":case"hh":s[ie]=_(t);break;case"m":case"mm":s[ne]=_(t);break;case"s":case"ss":s[se]=_(t);break;case"S":case"SS":case"SSS":case"SSSS":s[re]=_(1e3*("0."+t));break;case"X":i._d=new Date(1e3*parseFloat(t));break;case"Z":case"ZZ":i._useUTC=!0,i._tzm=L(t);break;case"w":case"ww":case"W":case"WW":case"d":case"dd":case"ddd":case"dddd":case"e":case"E":e=e.substr(0,1);case"gg":case"gggg":case"GG":case"GGGG":case"GGGGG":e=e.substr(0,2),t&&(i._w=i._w||{},i._w[e]=t)}}function D(e){var t,i,n,s,r,a,o,l,c,d,u=[];if(!e._d){for(n=R(e),e._w&&null==e._a[te]&&null==e._a[ee]&&(r=function(t){return t?t.length<3?parseInt(t,10)>68?"19"+t:"20"+t:t:null==e._a[Z]?J().weekYear():e._a[Z]},a=e._w,null!=a.GG||null!=a.W||null!=a.E?o=j(r(a.GG),a.W||1,a.E,4,1):(l=k(e._l),c=null!=a.d?V(a.d,l):null!=a.e?parseInt(a.e,10)+l._week.dow:0,d=parseInt(a.w,10)||1,null!=a.d&&c<l._week.dow&&d++,o=j(r(a.gg),d,c,l._week.doy,l._week.dow)),e._a[Z]=o.year,e._dayOfYear=o.dayOfYear),e._dayOfYear&&(s=null==e._a[Z]?n[Z]:e._a[Z],e._dayOfYear>f(s)&&(e._pf._overflowDayOfYear=!0),i=H(s,0,e._dayOfYear),e._a[ee]=i.getUTCMonth(),e._a[te]=i.getUTCDate()),t=0;t<3&&null==e._a[t];++t)e._a[t]=u[t]=n[t];for(;t<7;t++)e._a[t]=u[t]=null==e._a[t]?2===t?1:0:e._a[t];u[ie]+=_((e._tzm||0)/60),u[ne]+=_((e._tzm||0)%60),e._d=(e._useUTC?H:G).apply(null,u)}}function P(e){var t;e._d||(t=h(e._i),e._a=[t.year,t.month,t.day,t.hour,t.minute,t.second,t.millisecond],D(e))}function R(e){var t=new Date;return e._useUTC?[t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate()]:[t.getFullYear(),t.getMonth(),t.getDate()]}function O(e){e._a=[],e._pf.empty=!0;var t,i,n,s,r,a=k(e._l),o=""+e._i,l=o.length,c=0;for(n=I(e._f,a).match(ue)||[],t=0;t<n.length;t++)s=n[t],i=(w(s,e).exec(o)||[])[0],i&&(r=o.substr(0,o.indexOf(i)),r.length>0&&e._pf.unusedInput.push(r),o=o.slice(o.indexOf(i)+i.length),c+=i.length),Oe[s]?(i?e._pf.empty=!1:e._pf.unusedTokens.push(s),A(s,i,e)):e._strict&&!i&&e._pf.unusedTokens.push(s);e._pf.charsLeftOver=l-c,o.length>0&&e._pf.unusedInput.push(o),e._isPm&&e._a[ie]<12&&(e._a[ie]+=12),!1===e._isPm&&12===e._a[ie]&&(e._a[ie]=0),D(e),m(e)}function N(e){return e.replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(e,t,i,n,s){return t||i||n||s})}function M(e){return e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}function B(e){var t,i,n,r,a;if(0===e._f.length)return e._pf.invalidFormat=!0,void(e._d=new Date(NaN));for(r=0;r<e._f.length;r++)a=0,t=s({},e),v(t),t._f=e._f[r],O(t),b(t)&&(a+=t._pf.charsLeftOver,a+=10*t._pf.unusedTokens.length,t._pf.score=a,(null==n||a<n)&&(n=a,i=t));s(e,i||t)}function F(e){var t,i=e._i,n=ke.exec(i);if(n){for(e._pf.iso=!0,t=4;t>0;t--)if(n[t]){e._f=Ce[t-1]+(n[6]||" ");break}for(t=0;t<4;t++)if(Te[t][1].exec(i)){e._f+=Te[t][0];break}Se.exec(i)&&(e._f+="Z"),O(e)}else e._d=new Date(i)}function U(e){var t=e._i,i=le.exec(t);void 0===t?e._d=new Date:i?e._d=new Date(+i[1]):"string"==typeof t?F(e):l(t)?(e._a=t.slice(0),D(e)):c(t)?e._d=new Date(+t):"object"==typeof t?P(e):e._d=new Date(t)}function G(e,t,i,n,s,r,a){var o=new Date(e,t,i,n,s,r,a);return e<1970&&o.setFullYear(e),o}function H(e){var t=new Date(Date.UTC.apply(null,arguments));return e<1970&&t.setUTCFullYear(e),t}function V(e,t){if("string"==typeof e)if(isNaN(e)){if("number"!=typeof(e=t.weekdaysParse(e)))return null}else e=parseInt(e,10);return e}function K(e,t,i,n,s){return s.relativeTime(t||1,!!i,e,n)}function Y(e,t,i){var n=$(Math.abs(e)/1e3),s=$(n/60),r=$(s/60),a=$(r/24),o=$(a/365),l=n<45&&["s",n]||1===s&&["m"]||s<45&&["mm",s]||1===r&&["h"]||r<22&&["hh",r]||1===a&&["d"]||a<=25&&["dd",a]||a<=45&&["M"]||a<345&&["MM",$(a/30)]||1===o&&["y"]||["yy",o];return l[2]=t,l[3]=e>0,l[4]=i,K.apply({},l)}function W(e,t,i){var n,s=i-t,r=i-e.day();return r>s&&(r-=7),r<s-7&&(r+=7),n=J(e).add("d",r),{week:Math.ceil(n.dayOfYear()/7),year:n.year()}}function j(e,t,i,n,s){var r,a,o=new Date(Date.UTC(e,0)).getUTCDay();return i=null!=i?i:s,r=s-o+(o>n?7:0),a=7*(t-1)+(i-s)+r+1,{year:a>0?e:e-1,dayOfYear:a>0?a:f(e-1)+a}}function q(e){var t=e._i,n=e._f;return void 0===e._pf&&v(e),null===t?J.invalid({nullInput:!0}):("string"==typeof t&&(e._i=t=k().preparse(t)),J.isMoment(t)?(e=s({},t),e._d=new Date(+t._d)):n?l(n)?B(e):O(e):U(e),new i(e))}function z(e,t){J.fn[e]=J.fn[e+"s"]=function(e){var i=this._isUTC?"UTC":"";return null!=e?(this._d["set"+i+t](e),J.updateOffset(this),this):this._d["get"+i+t]()}}function Q(e,t){J.duration.fn["as"+e]=function(){return+this/t}}for(var J,X,$=Math.round,Z=0,ee=1,te=2,ie=3,ne=4,se=5,re=6,ae={},oe="undefined"!=typeof module&&module.exports,le=/^\/?Date\((\-?\d+)/i,ce=/(\-)?(?:(\d*)\.)?(\d+)\:(\d+)(?:\:(\d+)\.?(\d{3})?)?/,de=/^(-)?P(?:(?:([0-9,.]*)Y)?(?:([0-9,.]*)M)?(?:([0-9,.]*)D)?(?:T(?:([0-9,.]*)H)?(?:([0-9,.]*)M)?(?:([0-9,.]*)S)?)?|([0-9,.]*)W)$/,ue=/(\[[^\[]*\])|(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|mm?|ss?|S{1,4}|X|zz?|ZZ?|.)/g,he=/(\[[^\[]*\])|(\\)?(LT|LL?L?L?|l{1,4})/g,_e=/\d\d?/,ge=/\d{1,3}/,fe=/\d{3}/,pe=/\d{1,4}/,me=/[+\-]?\d{1,6}/,ve=/\d+/,be=/[0-9]*['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+|[\u0600-\u06FF\/]+(\s*?[\u0600-\u06FF]+){1,2}/i,Se=/Z|[\+\-]\d\d:?\d\d/i,ye=/T/i,Ee=/[\+\-]?\d+(\.\d{1,3})?/,ke=/^\s*\d{4}-(?:(\d\d-\d\d)|(W\d\d$)|(W\d\d-\d)|(\d\d\d))((T| )(\d\d(:\d\d(:\d\d(\.\d+)?)?)?)?([\+\-]\d\d:?\d\d|Z)?)?$/,Ce=["YYYY-MM-DD","GGGG-[W]WW","GGGG-[W]WW-E","YYYY-DDD"],Te=[["HH:mm:ss.SSSS",/(T| )\d\d:\d\d:\d\d\.\d{1,3}/],["HH:mm:ss",/(T| )\d\d:\d\d:\d\d/],["HH:mm",/(T| )\d\d:\d\d/],["HH",/(T| )\d\d/]],xe=/([\+\-]|\d\d)/gi,Ie="Date|Hours|Minutes|Seconds|Milliseconds".split("|"),we={Milliseconds:1,Seconds:1e3,Minutes:6e4,Hours:36e5,Days:864e5,Months:2592e6,Years:31536e6},Le={ms:"millisecond",s:"second",m:"minute",h:"hour",d:"day",D:"date",w:"week",W:"isoWeek",M:"month",y:"year",DDD:"dayOfYear",e:"weekday",E:"isoWeekday",gg:"weekYear",GG:"isoWeekYear"},Ae={dayofyear:"dayOfYear",isoweekday:"isoWeekday",isoweek:"isoWeek",weekyear:"weekYear",isoweekyear:"isoWeekYear"},De={},Pe="DDD w W M D d".split(" "),Re="M D H h m s w W".split(" "),Oe={M:function(){return this.month()+1},MMM:function(e){return this.lang().monthsShort(this,e)},MMMM:function(e){return this.lang().months(this,e)},D:function(){return this.date()},DDD:function(){return this.dayOfYear()},d:function(){return this.day()},dd:function(e){return this.lang().weekdaysMin(this,e)},ddd:function(e){return this.lang().weekdaysShort(this,e)},dddd:function(e){return this.lang().weekdays(this,e)},w:function(){return this.week()},W:function(){return this.isoWeek()},YY:function(){return a(this.year()%100,2)},YYYY:function(){return a(this.year(),4)},YYYYY:function(){return a(this.year(),5)},gg:function(){return a(this.weekYear()%100,2)},gggg:function(){return this.weekYear()},ggggg:function(){return a(this.weekYear(),5)},GG:function(){return a(this.isoWeekYear()%100,2)},GGGG:function(){return this.isoWeekYear()},GGGGG:function(){return a(this.isoWeekYear(),5)},e:function(){return this.weekday()},E:function(){return this.isoWeekday()},a:function(){return this.lang().meridiem(this.hours(),this.minutes(),!0)},A:function(){return this.lang().meridiem(this.hours(),this.minutes(),!1)},H:function(){return this.hours()},h:function(){return this.hours()%12||12},m:function(){return this.minutes()},s:function(){return this.seconds()},S:function(){return _(this.milliseconds()/100)},SS:function(){return a(_(this.milliseconds()/10),2)},SSS:function(){return a(this.milliseconds(),3)},SSSS:function(){return a(this.milliseconds(),3)},Z:function(){var e=-this.zone(),t="+";return e<0&&(e=-e,t="-"),t+a(_(e/60),2)+":"+a(_(e)%60,2)},ZZ:function(){var e=-this.zone(),t="+";return e<0&&(e=-e,t="-"),t+a(_(10*e/6),4)},z:function(){return this.zoneAbbr()},zz:function(){return this.zoneName()},X:function(){return this.unix()}},Ne=["months","monthsShort","weekdays","weekdaysShort","weekdaysMin"];Pe.length;)X=Pe.pop(),Oe[X+"o"]=function(e,t){return function(i){return this.lang().ordinal(e.call(this,i),t)}}(Oe[X],X);for(;Re.length;)X=Re.pop(),Oe[X+X]=e(Oe[X],2);for(Oe.DDDD=e(Oe.DDD,3),s(t.prototype,{set:function(e){var t,i;for(i in e)t=e[i],"function"==typeof t?this[i]=t:this["_"+i]=t},_months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),months:function(e){return this._months[e.month()]},_monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),monthsShort:function(e){return this._monthsShort[e.month()]},monthsParse:function(e){var t,i,n;for(this._monthsParse||(this._monthsParse=[]),t=0;t<12;t++)if(this._monthsParse[t]||(i=J.utc([2e3,t]),n="^"+this.months(i,"")+"|^"+this.monthsShort(i,""),this._monthsParse[t]=new RegExp(n.replace(".",""),"i")),this._monthsParse[t].test(e))return t},_weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdays:function(e){return this._weekdays[e.day()]},_weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysShort:function(e){return this._weekdaysShort[e.day()]},_weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),weekdaysMin:function(e){return this._weekdaysMin[e.day()]},weekdaysParse:function(e){var t,i,n;for(this._weekdaysParse||(this._weekdaysParse=[]),t=0;t<7;t++)if(this._weekdaysParse[t]||(i=J([2e3,1]).day(t),n="^"+this.weekdays(i,"")+"|^"+this.weekdaysShort(i,"")+"|^"+this.weekdaysMin(i,""),this._weekdaysParse[t]=new RegExp(n.replace(".",""),"i")),this._weekdaysParse[t].test(e))return t},_longDateFormat:{LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D YYYY",LLL:"MMMM D YYYY LT",LLLL:"dddd, MMMM D YYYY LT"},longDateFormat:function(e){var t=this._longDateFormat[e];return!t&&this._longDateFormat[e.toUpperCase()]&&(t=this._longDateFormat[e.toUpperCase()].replace(/MMMM|MM|DD|dddd/g,function(e){return e.slice(1)}),this._longDateFormat[e]=t),t},isPM:function(e){return"p"===(e+"").toLowerCase().charAt(0)},_meridiemParse:/[ap]\.?m?\.?/i,meridiem:function(e,t,i){return e>11?i?"pm":"PM":i?"am":"AM"},_calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},calendar:function(e,t){var i=this._calendar[e];return"function"==typeof i?i.apply(t):i},_relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},relativeTime:function(e,t,i,n){var s=this._relativeTime[i];return"function"==typeof s?s(e,t,i,n):s.replace(/%d/i,e)},pastFuture:function(e,t){var i=this._relativeTime[e>0?"future":"past"];return"function"==typeof i?i(t):i.replace(/%s/i,t)},ordinal:function(e){return this._ordinal.replace("%d",e)},_ordinal:"%d",preparse:function(e){return e},postformat:function(e){return e},week:function(e){return W(e,this._week.dow,this._week.doy).week},_week:{dow:0,doy:6},_invalidDate:"Invalid date",invalidDate:function(){return this._invalidDate}}),J=function(e,t,i,n){return"boolean"==typeof i&&(n=i,i=void 0),q({_i:e,_f:t,_l:i,_strict:n,_isUTC:!1})},J.utc=function(e,t,i,n){return"boolean"==typeof i&&(n=i,i=void 0),q({_useUTC:!0,_isUTC:!0,_l:i,_i:e,_f:t,_strict:n}).utc()},J.unix=function(e){return J(1e3*e)},J.duration=function(e,t){var i,s,r,a=J.isDuration(e),o="number"==typeof e,l=a?e._input:o?{}:e,c=null;return o?t?l[t]=e:l.milliseconds=e:(c=ce.exec(e))?(i="-"===c[1]?-1:1,l={y:0,d:_(c[te])*i,h:_(c[ie])*i,m:_(c[ne])*i,s:_(c[se])*i,ms:_(c[re])*i}):(c=de.exec(e))&&(i="-"===c[1]?-1:1,r=function(e){var t=e&&parseFloat(e.replace(",","."));return(isNaN(t)?0:t)*i},l={y:r(c[2]),M:r(c[3]),d:r(c[4]),h:r(c[5]),m:r(c[6]),s:r(c[7]),w:r(c[8])}),s=new n(l),a&&e.hasOwnProperty("_lang")&&(s._lang=e._lang),s},J.version="2.4.0",J.defaultFormat="YYYY-MM-DDTHH:mm:ssZ",J.updateOffset=function(){},J.lang=function(e,t){var i;return e?(t?y(S(e),t):null===t?(E(e),e="en"):ae[e]||k(e),
i=J.duration.fn._lang=J.fn._lang=k(e),i._abbr):J.fn._lang._abbr},J.langData=function(e){return e&&e._lang&&e._lang._abbr&&(e=e._lang._abbr),k(e)},J.isMoment=function(e){return e instanceof i},J.isDuration=function(e){return e instanceof n},X=Ne.length-1;X>=0;--X)!function(e){var t,i;if(0===e.indexOf("week"))t=7,i="day";else{if(0!==e.indexOf("month"))return;t=12,i="month"}J[e]=function(n,s){var r,a,o=J.fn._lang[e],l=[];if("number"==typeof n&&(s=n,n=void 0),a=function(e){var t=J().utc().set(i,e);return o.call(J.fn._lang,t,n||"")},null!=s)return a(s);for(r=0;r<t;r++)l.push(a(r));return l}}(Ne[X]);for(J.normalizeUnits=function(e){return u(e)},J.invalid=function(e){var t=J.utc(NaN);return null!=e?s(t._pf,e):t._pf.userInvalidated=!0,t},J.parseZone=function(e){return J(e).parseZone()},s(J.fn=i.prototype,{clone:function(){return J(this)},valueOf:function(){return+this._d+6e4*(this._offset||0)},unix:function(){return Math.floor(+this/1e3)},toString:function(){return this.clone().lang("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")},toDate:function(){return this._offset?new Date(+this):this._d},toISOString:function(){return x(J(this).utc(),"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]")},toArray:function(){var e=this;return[e.year(),e.month(),e.date(),e.hours(),e.minutes(),e.seconds(),e.milliseconds()]},isValid:function(){return b(this)},isDSTShifted:function(){return!!this._a&&(this.isValid()&&d(this._a,(this._isUTC?J.utc(this._a):J(this._a)).toArray())>0)},parsingFlags:function(){return s({},this._pf)},invalidAt:function(){return this._pf.overflow},utc:function(){return this.zone(0)},local:function(){return this.zone(0),this._isUTC=!1,this},format:function(e){var t=x(this,e||J.defaultFormat);return this.lang().postformat(t)},add:function(e,t){var i;return i="string"==typeof e?J.duration(+t,e):J.duration(e,t),o(this,i,1),this},subtract:function(e,t){var i;return i="string"==typeof e?J.duration(+t,e):J.duration(e,t),o(this,i,-1),this},diff:function(e,t,i){var n,s,a=this._isUTC?J(e).zone(this._offset||0):J(e).local(),o=6e4*(this.zone()-a.zone());return t=u(t),"year"===t||"month"===t?(n=432e5*(this.daysInMonth()+a.daysInMonth()),s=12*(this.year()-a.year())+(this.month()-a.month()),s+=(this-J(this).startOf("month")-(a-J(a).startOf("month")))/n,s-=6e4*(this.zone()-J(this).startOf("month").zone()-(a.zone()-J(a).startOf("month").zone()))/n,"year"===t&&(s/=12)):(n=this-a,s="second"===t?n/1e3:"minute"===t?n/6e4:"hour"===t?n/36e5:"day"===t?(n-o)/864e5:"week"===t?(n-o)/6048e5:n),i?s:r(s)},from:function(e,t){return J.duration(this.diff(e)).lang(this.lang()._abbr).humanize(!t)},fromNow:function(e){return this.from(J(),e)},calendar:function(){var e=this.diff(J().zone(this.zone()).startOf("day"),"days",!0),t=e<-6?"sameElse":e<-1?"lastWeek":e<0?"lastDay":e<1?"sameDay":e<2?"nextDay":e<7?"nextWeek":"sameElse";return this.format(this.lang().calendar(t,this))},isLeapYear:function(){return p(this.year())},isDST:function(){return this.zone()<this.clone().month(0).zone()||this.zone()<this.clone().month(5).zone()},day:function(e){var t=this._isUTC?this._d.getUTCDay():this._d.getDay();return null!=e?(e=V(e,this.lang()),this.add({d:e-t})):t},month:function(e){var t,i=this._isUTC?"UTC":"";return null!=e?"string"==typeof e&&"number"!=typeof(e=this.lang().monthsParse(e))?this:(t=this.date(),this.date(1),this._d["set"+i+"Month"](e),this.date(Math.min(t,this.daysInMonth())),J.updateOffset(this),this):this._d["get"+i+"Month"]()},startOf:function(e){switch(e=u(e)){case"year":this.month(0);case"month":this.date(1);case"week":case"isoWeek":case"day":this.hours(0);case"hour":this.minutes(0);case"minute":this.seconds(0);case"second":this.milliseconds(0)}return"week"===e?this.weekday(0):"isoWeek"===e&&this.isoWeekday(1),this},endOf:function(e){return e=u(e),this.startOf(e).add("isoWeek"===e?"week":e,1).subtract("ms",1)},isAfter:function(e,t){return t=void 0!==t?t:"millisecond",+this.clone().startOf(t)>+J(e).startOf(t)},isBefore:function(e,t){return t=void 0!==t?t:"millisecond",+this.clone().startOf(t)<+J(e).startOf(t)},isSame:function(e,t){return t=void 0!==t?t:"millisecond",+this.clone().startOf(t)==+J(e).startOf(t)},min:function(e){return e=J.apply(null,arguments),e<this?this:e},max:function(e){return e=J.apply(null,arguments),e>this?this:e},zone:function(e){var t=this._offset||0;return null==e?this._isUTC?t:this._d.getTimezoneOffset():("string"==typeof e&&(e=L(e)),Math.abs(e)<16&&(e*=60),this._offset=e,this._isUTC=!0,t!==e&&o(this,J.duration(t-e,"m"),1,!0),this)},zoneAbbr:function(){return this._isUTC?"UTC":""},zoneName:function(){return this._isUTC?"Coordinated Universal Time":""},parseZone:function(){return"string"==typeof this._i&&this.zone(this._i),this},hasAlignedHourOffset:function(e){return e=e?J(e).zone():0,(this.zone()-e)%60==0},daysInMonth:function(){return g(this.year(),this.month())},dayOfYear:function(e){var t=$((J(this).startOf("day")-J(this).startOf("year"))/864e5)+1;return null==e?t:this.add("d",e-t)},weekYear:function(e){var t=W(this,this.lang()._week.dow,this.lang()._week.doy).year;return null==e?t:this.add("y",e-t)},isoWeekYear:function(e){var t=W(this,1,4).year;return null==e?t:this.add("y",e-t)},week:function(e){var t=this.lang().week(this);return null==e?t:this.add("d",7*(e-t))},isoWeek:function(e){var t=W(this,1,4).week;return null==e?t:this.add("d",7*(e-t))},weekday:function(e){var t=(this.day()+7-this.lang()._week.dow)%7;return null==e?t:this.add("d",e-t)},isoWeekday:function(e){return null==e?this.day()||7:this.day(this.day()%7?e:e-7)},get:function(e){return e=u(e),this[e]()},set:function(e,t){return e=u(e),"function"==typeof this[e]&&this[e](t),this},lang:function(e){return void 0===e?this._lang:(this._lang=k(e),this)}}),X=0;X<Ie.length;X++)z(Ie[X].toLowerCase().replace(/s$/,""),Ie[X]);z("year","FullYear"),J.fn.days=J.fn.day,J.fn.months=J.fn.month,J.fn.weeks=J.fn.week,J.fn.isoWeeks=J.fn.isoWeek,J.fn.toJSON=J.fn.toISOString,s(J.duration.fn=n.prototype,{_bubble:function(){var e,t,i,n,s=this._milliseconds,a=this._days,o=this._months,l=this._data;l.milliseconds=s%1e3,e=r(s/1e3),l.seconds=e%60,t=r(e/60),l.minutes=t%60,i=r(t/60),l.hours=i%24,a+=r(i/24),l.days=a%30,o+=r(a/30),l.months=o%12,n=r(o/12),l.years=n},weeks:function(){return r(this.days()/7)},valueOf:function(){return this._milliseconds+864e5*this._days+this._months%12*2592e6+31536e6*_(this._months/12)},humanize:function(e){var t=+this,i=Y(t,!e,this.lang());return e&&(i=this.lang().pastFuture(t,i)),this.lang().postformat(i)},add:function(e,t){var i=J.duration(e,t);return this._milliseconds+=i._milliseconds,this._days+=i._days,this._months+=i._months,this._bubble(),this},subtract:function(e,t){var i=J.duration(e,t);return this._milliseconds-=i._milliseconds,this._days-=i._days,this._months-=i._months,this._bubble(),this},get:function(e){return e=u(e),this[e.toLowerCase()+"s"]()},as:function(e){return e=u(e),this["as"+e.charAt(0).toUpperCase()+e.slice(1)+"s"]()},lang:J.fn.lang,toIsoString:function(){var e=Math.abs(this.years()),t=Math.abs(this.months()),i=Math.abs(this.days()),n=Math.abs(this.hours()),s=Math.abs(this.minutes()),r=Math.abs(this.seconds()+this.milliseconds()/1e3);return this.asSeconds()?(this.asSeconds()<0?"-":"")+"P"+(e?e+"Y":"")+(t?t+"M":"")+(i?i+"D":"")+(n||s||r?"T":"")+(n?n+"H":"")+(s?s+"M":"")+(r?r+"S":""):"P0D"}});for(X in we)we.hasOwnProperty(X)&&(Q(X,we[X]),function(e){J.duration.fn[e]=function(){return this._data[e]}}(X.toLowerCase()));return Q("Weeks",6048e5),J.duration.fn.asMonths=function(){return(+this-31536e6*this.years())/2592e6+12*this.years()},J.lang("en",{ordinal:function(e){var t=e%10;return e+(1===_(e%100/10)?"th":1===t?"st":2===t?"nd":3===t?"rd":"th")}}),function(e){!function(e){e.lang("en-au",{months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),longDateFormat:{LT:"h:mm A",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd, D MMMM YYYY LT"},calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},ordinal:function(e){var t=e%10;return e+(1==~~(e%100/10)?"th":1===t?"st":2===t?"nd":3===t?"rd":"th")},week:{dow:1,doy:4}})}(J)}(),function(e){!function(e){e.lang("en-ca",{months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),longDateFormat:{LT:"h:mm A",L:"YYYY-MM-DD",LL:"D MMMM, YYYY",LLL:"D MMMM, YYYY LT",LLLL:"dddd, D MMMM, YYYY LT"},calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},ordinal:function(e){var t=e%10;return e+(1==~~(e%100/10)?"th":1===t?"st":2===t?"nd":3===t?"rd":"th")}})}(J)}(),function(e){!function(e){e.lang("en-gb",{months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),longDateFormat:{LT:"HH:mm",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd, D MMMM YYYY LT"},calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},ordinal:function(e){var t=e%10;return e+(1==~~(e%100/10)?"th":1===t?"st":2===t?"nd":3===t?"rd":"th")},week:{dow:1,doy:4}})}(J)}(),function(e){!function(e){e.lang("fr",{months:"janvier_fvrier_mars_avril_mai_juin_juillet_aot_septembre_octobre_novembre_dcembre".split("_"),monthsShort:"janv._fvr._mars_avr._mai_juin_juil._aot_sept._oct._nov._dc.".split("_"),weekdays:"dimanche_lundi_mardi_mercredi_jeudi_vendredi_samedi".split("_"),weekdaysShort:"dim._lun._mar._mer._jeu._ven._sam.".split("_"),weekdaysMin:"Di_Lu_Ma_Me_Je_Ve_Sa".split("_"),longDateFormat:{LT:"HH:mm",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd D MMMM YYYY LT"},calendar:{sameDay:"[Aujourd'hui  ] LT",nextDay:"[Demain  ] LT",nextWeek:"dddd [ ] LT",lastDay:"[Hier  ] LT",lastWeek:"dddd [dernier  ] LT",sameElse:"L"},relativeTime:{future:"dans %s",past:"il y a %s",s:"quelques secondes",m:"une minute",mm:"%d minutes",h:"une heure",hh:"%d heures",d:"un jour",dd:"%d jours",M:"un mois",MM:"%d mois",y:"un an",yy:"%d ans"},ordinal:function(e){return e+(1===e?"er":"")},week:{dow:1,doy:4}})}(J)}(),function(e){!function(e){function t(e,t,i,n){var s={m:["eine Minute","einer Minute"],h:["eine Stunde","einer Stunde"],d:["ein Tag","einem Tag"],dd:[e+" Tage",e+" Tagen"],M:["ein Monat","einem Monat"],MM:[e+" Monate",e+" Monaten"],y:["ein Jahr","einem Jahr"],yy:[e+" Jahre",e+" Jahren"]};return t?s[i][0]:s[i][1]}e.lang("de",{months:"Januar_Februar_Mrz_April_Mai_Juni_Juli_August_September_Oktober_November_Dezember".split("_"),monthsShort:"Jan._Febr._Mrz._Apr._Mai_Jun._Jul._Aug._Sept._Okt._Nov._Dez.".split("_"),weekdays:"Sonntag_Montag_Dienstag_Mittwoch_Donnerstag_Freitag_Samstag".split("_"),weekdaysShort:"So._Mo._Di._Mi._Do._Fr._Sa.".split("_"),weekdaysMin:"So_Mo_Di_Mi_Do_Fr_Sa".split("_"),longDateFormat:{LT:"HH:mm [Uhr]",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY LT",LLLL:"dddd, D. MMMM YYYY LT"},calendar:{sameDay:"[Heute um] LT",sameElse:"L",nextDay:"[Morgen um] LT",nextWeek:"dddd [um] LT",lastDay:"[Gestern um] LT",lastWeek:"[letzten] dddd [um] LT"},relativeTime:{future:"in %s",past:"vor %s",s:"ein paar Sekunden",m:t,mm:"%d Minuten",h:t,hh:"%d Stunden",d:t,dd:t,M:t,MM:t,y:t,yy:t},ordinal:"%d.",week:{dow:1,doy:4}})}(J)}(),J.lang("en"),J}),define("tve/util/CacheHelper",["xdk-base/class","xdk-base/core","xdk-base/promise","xdk-base/console","xdk-base/util"],function(e,t,i,n,s){var r=e.create({TTL:{NO_CACHE:-2,FOREVER:-1,DEFAULT:0}},{__ttl:null,__size:null,__cache:null,__enableCacheExpireCheck:!1,__cacheCheckIntervalTime:null,init:function(e){if(e=e||{},this.__ttl=e.ttl||1200,this.__size=e.size||100,this.__cacheReference=[],this.__enableCacheExpireCheck=!!e.enableCacheExpireCheck,this.__cacheCheckIntervalTime=e.cacheCheckIntervalTime||3e5,e.cache){this.__cache=s.clone(e.cache,!0);var t,i,n,r=this.__cache,a=this.__cacheReference,o=this.__size;for(i in r)r.hasOwnProperty(i)&&a.push(i);if((t=s.size(a))>o){for(n=o;n<t;n++)delete r[a[n]];s.remove(a,o,t-1)}}else this.__cache={};this.__enableCacheExpireCheck&&!this.__cacheCheckInterval&&(this.__cacheCheckInterval=setInterval(s.bind(this.__checkCache,this),this.__cacheCheckIntervalTime))},__checkCache:function(){var e=this.__cacheReference;s.each(e,s.bind(function(t,i){this.isExpired(t)&&(delete this.__cache[t],s.remove(e,i))},this))},setObject:function(e,t,i,n){if(!n||n!==r.TTL.NO_CACHE){i=i||(new Date).getTime();var a=this.__cacheReference,o=s.size(a),l=s.indexOf(a,e),c=n||this.__ttl;l>-1?s.remove(a,l):o&&o===this.__size&&(delete this.__cache[a[0]],s.remove(a,0)),a.push(e),this.__cache[e]={data:t,timestamp:i,expiration:i+1e3*c},n&&(this.__cache[e].customTTL=n)}},renewTimestamp:function(e){var t=this.__cache[e],i=t.customTTL||this.__ttl,n=(new Date).getTime();t.timestamp=n,t.expiration=n+i},isExpired:function(e){var t=this.__cache[e];return(!t.customTTL||t.customTTL!==r.TTL.FOREVER)&&(new Date).getTime()>t.expiration},getCache:function(e){if(this.__cache.hasOwnProperty(e))return this.__cache[e].data},getTimestamp:function(e){if(this.__cache.hasOwnProperty(e))return this.__cache[e].timestamp},deinit:function(){this.__cacheCheckInterval&&clearInterval(this.__cacheCheckInterval)}});return r}),define("lib/base64",[],function(){var e={alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",lookup:null,ie:/MSIE /.test(navigator.userAgent),ieo:/MSIE [67]/.test(navigator.userAgent),encode:function(t){var i,n,s,r=e.toUtf8(t),a=-1,o=r.length,l=[,,,];if(e.ie){for(var c=[];++a<o;)i=r[a],n=r[++a],l[0]=i>>2,l[1]=(3&i)<<4|n>>4,isNaN(n)?l[2]=l[3]=64:(s=r[++a],l[2]=(15&n)<<2|s>>6,l[3]=isNaN(s)?64:63&s),c.push(e.alphabet.charAt(l[0]),e.alphabet.charAt(l[1]),e.alphabet.charAt(l[2]),e.alphabet.charAt(l[3]));return c.join("")}for(var c="";++a<o;)i=r[a],n=r[++a],l[0]=i>>2,l[1]=(3&i)<<4|n>>4,isNaN(n)?l[2]=l[3]=64:(s=r[++a],l[2]=(15&n)<<2|s>>6,l[3]=isNaN(s)?64:63&s),c+=e.alphabet[l[0]]+e.alphabet[l[1]]+e.alphabet[l[2]]+e.alphabet[l[3]];return c},decode:function(t){if(t.length%4)throw new Error("InvalidCharacterError: 'B64.decode' failed: The string to be decoded is not correctly encoded.");var i=e.fromUtf8(t),n=0,s=i.length;if(e.ieo){for(var r=[];n<s;)i[n]<128?r.push(String.fromCharCode(i[n++])):i[n]>191&&i[n]<224?r.push(String.fromCharCode((31&i[n++])<<6|63&i[n++])):r.push(String.fromCharCode((15&i[n++])<<12|(63&i[n++])<<6|63&i[n++]));return r.join("")}for(var r="";n<s;)i[n]<128?r+=String.fromCharCode(i[n++]):i[n]>191&&i[n]<224?r+=String.fromCharCode((31&i[n++])<<6|63&i[n++]):r+=String.fromCharCode((15&i[n++])<<12|(63&i[n++])<<6|63&i[n++]);return r},toUtf8:function(e){var t,i=-1,n=e.length,s=[];if(/^[\x00-\x7f]*$/.test(e))for(;++i<n;)s.push(e.charCodeAt(i));else for(;++i<n;)t=e.charCodeAt(i),t<128?s.push(t):t<2048?s.push(t>>6|192,63&t|128):s.push(t>>12|224,t>>6&63|128,63&t|128);return s},fromUtf8:function(t){var i,n=-1,s=[],r=[,,,];if(!e.lookup){for(i=e.alphabet.length,e.lookup={};++n<i;)e.lookup[e.alphabet.charAt(n)]=n;n=-1}for(i=t.length;++n<i&&(r[0]=e.lookup[t.charAt(n)],r[1]=e.lookup[t.charAt(++n)],s.push(r[0]<<2|r[1]>>4),r[2]=e.lookup[t.charAt(++n)],64!=r[2])&&(s.push((15&r[1])<<4|r[2]>>2),r[3]=e.lookup[t.charAt(++n)],64!=r[3]);)s.push((3&r[2])<<6|r[3]);return s}};return e}),define("tvedemo/helper/sMoment",["lib/moment","xdk-base/device"],function(e,t){var i,n=function(){var e,t=document.getElementById("TimePlugin");if(t&&(e=t.GetEpochTime())>0){var n=(new Date).getTime();e*=1e3,i=(n-e)/1e3/60,i=10*Math.round(i/10)}};return function(s,r,a,o){var l=new e(s,r,a,o);if("playstation"===t.platform&&void 0===i)try{year=date.getYear(),month=date.getMonth()+1,month>3&&month<10&&(i=-1),day=date.getDate(),weekday=date.getDay(),daysInMonth=new Date(year,month,0).getDate(),day+(7-weekday)<=daysInMonth?10==month&&(i=-1):3==month&&(i=-1)}catch(e){}return"samsung"===t.platform&&void 0===i&&n(),i&&l.zone(i),l}}),define("tve/interface/ConfigurationService",["xdk-base/Interface"],function(e){return e.create("ConfigurationService",{getConfig:["key","defaultValue"],getConfigs:["keys","defaultValues"],getAllConfigs:[]})}),define("tve/interface/LogService",["xdk-base/Interface"],function(e){return e.create("LogService",{getLevel:[],debug:["code","msg","dimensions"],warn:["code","msg","dimensions"],error:["code","msg","dimensions"]})}),define("tve/interface/ResourceService",["xdk-base/Interface"],function(e){return e.create("ResourceService",{getResource:["key"],getAllResources:[]})}),define("tve/interface/StatusService",["xdk-base/Interface"],function(e){return e.create("StatusService",{getStatus:[],getMessage:[]})}),define("tve/interface/UserSettingsService",["xdk-base/Interface"],function(e){return e.create("UserSettingsService",{getSetting:["key","defaultValue"],getSharedSetting:["key","defaultValue"],getSettings:["keys","defaultValues"],getSharedSettings:["keys","defaultValues"],getAllSettings:[],getAllSharedSettings:[],setSetting:["key","value"],setSharedSetting:["key","value"],setAllSettings:["data"],setAllSharedSettings:["data"]})}),define("tve/AppGridService",["xdk-base/class","xdk-base/core","xdk-base/util","xdk-base/config","xdk-base/promise","xdk-base/ajax","xdk-base/console","xdk-base/device","tve/util/CacheHelper","lib/base64","tvedemo/helper/sMoment","tve/TVEError","tve/interface/ConfigurationService","tve/interface/LogService","tve/interface/ResourceService","tve/interface/StatusService","tve/interface/UserSettingsService"],function(e,t,i,n,s,r,a,o,l,c,d,u,h,_,g,f,p){"use strict";var m=u.FACILITY,v=u.ERROR;return e.create([h,_,g,f,p],{},{__sessionKey:null,__uuid:null,__logLevels:["off","error","warn","debug"],__sessionExpiration:null,__getSessionKey:function(){if(this.__isSessionValid())return s.resolve(this.__sessionKey);if(this.__getSessionPromise)return this.__getSessionPromise;var e=this.__baseURL+"/session",t={};return t.requestHeaders={},t.requestHeaders["X-Application-Key"]=this.__appKey,t.requestHeaders["X-User-Id"]=this.__uuid,a.warn("AppGrid session being requested"),this.__getSessionPromise=this.__sendRequest(e,t).then(i.bind(function(e){var t=e.responseJSON||null;if(t&&t.sessionKey&&t.expiration){if(this.__sessionKey=t.sessionKey,this.__sessionExpiration=d(t.expiration,"YYYYMMDD HH:mm:SS Z").valueOf(),this.__sessionExpiration<(new Date).getTime())throw new u(u.FACILITY.GENERAL,u.ERROR.INVALID,"GetSession: Unable to get the correct expiration.");return this.__getSessionPromise=null,this.__sessionKey}throw this.__getSessionPromise=null,new u(u.FACILITY.GENERAL,u.ERROR.INVALID,"GetSession: Unable to get the session. Cannot get the sessionKey or expiration.")},this),i.bind(function(e){throw this.__getSessionPromise=null,new u(u.FACILITY.GENERAL,u.ERROR.NOT_FOUND,"GetSession: Unable to get the session.",e)},this)),this.__getSessionPromise},__isSessionValid:function(){return this.__sessionKey&&this.__sessionExpiration>(new Date).getTime()+3e5},__sendGetRequest:function(e,t,n){t=t||{},t.parameters=t.parameters||"";var r=this.__generateCacheKey(e,t.parameters),a=(new Date).getTime(),o=this.__cacheHelper,c=o.getCache(r),d=i.bind(function(){return this.__getSessionKey().then(i.bind(function(i){return this.__sendRequest(e,t,i).then(function(e){return o.setObject(r,e,a,n||l.TTL.DEFAULT),e})},this))},this);return void 0===c||o.isExpired(r)?void 0!==c?this.__getSessionKey().then(i.bind(function(t){return this.__sendRequest(e,{requestHeaders:{"If-Modified-Since":new Date(o.getTimestamp(r)).toUTCString()}},t).then(function(e){return 304===e.status?(o.renewTimestamp(r),c):200===e.status?(o.setObject(r,e,a),e):void 0},function(){return d()})},this)):d():s.resolve(c)},__sendPostRequest:function(e,t){return t=t||{},t.method="post",t.requestHeaders=t.requestHeaders||{"content-type":"application/json"},this.__getSessionKey().then(i.bind(function(i){return this.__sendRequest(e,t,i)},this))},__generateCacheKey:function(e,t,n){var s=n?"__body["+n.toString()+"]":"",r=i.isString(t)?t:i.toQueryString(t),a=e+"?"+r+"&"+s;return window.btoa?window.btoa(a):c.encode(a)},getStatus:function(){var e=this.__baseURL+"/status";return this.__sendGetRequest(e).then(function(e){if(e.responseJSON&&e.responseJSON.status)return e.responseJSON.status;throw new u(m.STATUS_SERVICE,v.INVALID,"Cannot get the status")},function(e){throw new u(m.STATUS_SERVICE,v.NETWORK,"Cannot get the status",e)})},getMessage:function(){var e=this.__baseURL+"/status";return this.__sendGetRequest(e).then(function(e){if(e.responseJSON&&e.responseJSON.message)return e.responseJSON.message;throw new u(m.STATUS_SERVICE,v.INVALID,"Cannot get the message through status service")},function(e){throw new u(m.STATUS_SERVICE,v.NETWORK,"Cannot get the message through status service",e)})},applicationStart:function(){return this.__sendApplicationEvent("START")},applicationStop:function(){return this.__sendApplicationEvent("QUIT")},getConfig:function(e,t){var i=this.__baseURL+"/metadata/"+e;return this.__sendGetRequest(i).then(function(i){if(i.responseJSON&&i.responseJSON[e])return i.responseJSON[e];if(t)return t;throw new u(m.CONFIGURATION_SERVICE,u.ERROR.INVALID,"cannot get the config value")},function(e){if(t)return s.resolve(t);throw new u(m.CONFIGURATION_SERVICE,u.ERROR.NETWORK,"cannot get the config value",e)})},getConfigs:function(e,t){var n=this.__baseURL+"/metadata/"+e.join(",");return this.__sendGetRequest(n,null,l.TTL.FOREVER).then(function(e){if(e.responseJSON)return t?i.extend(t,e.responseJSON):e.responseJSON;throw new u(m.CONFIGURATION_SERVICE,u.ERROR.INVALID,"cannot get values of configs")},function(e){if(t)return s.resolve(t);throw new u(m.CONFIGURATION_SERVICE,u.ERROR.NETWORK,"cannot get values of configs",e)})},getAllConfigs:function(){var e=this.__baseURL+"/metadata";return this.__sendGetRequest(e).then(function(e){if(e.responseJSON)return e.responseJSON;throw new u(m.CONFIGURATION_SERVICE,u.ERROR.INVALID,"cannot get all configs")},function(e){throw new u(m.CONFIGURATION_SERVICE,u.ERROR.NETWORK,"cannot get all configs",e)})},getResource:function(e){return this.getAllResources().then(i.bind(function(t){if(t[e]){var i=t[e];return 0===i.indexOf("/")?this.__baseURL+i:i}throw new u(m.CONFIGURATION_SERVICE,u.ERROR.INVALID,"cannot get the requested resource "+e)},this),function(e){throw new u(m.CONFIGURATION_SERVICE,u.ERROR.NETWORK,"cannot get the requested resource",e)})},getAllResources:function(){if(!this.__getAllResourcesPromise){var e=this.__baseURL+"/asset";this.__getAllResourcesPromise=this.__sendGetRequest(e).then(function(e){if(e.responseJSON)return e.responseJSON;throw new u(m.CONFIGURATION_SERVICE,u.ERROR.INVALID,"cannot get all resources")},function(e){throw new u(m.CONFIGURATION_SERVICE,u.ERROR.NETWORK,"cannot get all resources "+e)})}return this.__getAllResourcesPromise},getLevel:function(){if(this.__getLevelPromise)return this.__getLevelPromise;var e=this.__baseURL+"/application/log/level";return this.__getLevelPromise=this.__sendGetRequest(e).then(i.bind(function(e){if(e.responseJSON&&e.responseJSON.logLevel)return this.__getLevelPromise=null,e.responseJSON.logLevel;throw this.__getLevelPromise=null,new u(m.LOG_SERVICE,v.INVALID,"Cannot get the log level")},this),i.bind(function(e){throw this.__getLevelPromise=null,new u(m.LOG_SERVICE,v.NETWORK,"Cannot get the log level",e)},this)),this.__getLevelPromise},debug:function(e,t,i){this.__sendLog("debug",e,t,i)},warn:function(e,t,i){this.__sendLog("warn",e,t,i)},error:function(e,t,i){this.__sendLog("error",e,t,i)},__getSettingHelper:function(e,t,n){var r=this.__baseURL+"/"+e+"/"+this.__uuid,a=0;return t&&1===(a=t.length)&&(r+="/"+t[0]),this.__sendGetRequest(r,null,l.TTL.NO_CACHE).then(function(e){if(!a&&e.responseJSON)return e.responseJSON;if(1===a&&e.responseJSON)return e.responseJSON;if(a>1&&e.responseJSON){var s,r=e.responseJSON;for(var o in r){s=!1;for(var l=0,c=t.length;l<c;l++)if(o===t[l]){s=!0;break}s||delete r[o]}return n?i.extend(n,r):r}if(n)return n;throw new u(m.USER_SETTINGS_SERVICE,v.INVALID,"cannot get requested setting")},function(e){if(n&&a)return s.resolve(n);throw new u(m.USER_SETTINGS_SERVICE,v.NETWORK,"cannot get requested setting",e)})},getSetting:function(e,t){return this.__getSettingHelper("user",[e],t)},getSharedSetting:function(e,t){return this.__getSettingHelper("group",[e],t)},getSettings:function(e,t){return this.__getSettingHelper("user",e,t)},getSharedSettings:function(e,t){return this.__getSettingHelper("group",e,t)},getAllSettings:function(){return this.__getSettingHelper("user")},getAllSharedSettings:function(){return this.__getSettingHelper("group")},__setSettingHelper:function(e,t){var n={},s=i.keys(t),r=s.length,a=this.__baseURL+"/"+e+"/"+this.__uuid;return 1===r?(a+="/"+s[0],n.postBody=t[s[0]]):n.postBody=JSON.stringify(t),this.__sendPostRequest(a,n).then(function(){},function(e){throw new u(m.USER_SETTINGS_SERVICE,v.NETWORK,"cannot set the setting",e)})},setSetting:function(e,t){var i={};return i[e]=t,this.__setSettingHelper("user",i)},setSharedSetting:function(e,t){var i={};return i[e]=t,this.__setSettingHelper("group",i)},setAllSettings:function(e){return this.__setSettingHelper("user",e)},setAllSharedSettings:function(e){return this.__setSettingHelper("group",e)},init:function(e,t,i){this.__baseURL=e,this.__appKey=t,this.__uuid=i,this.__cacheHelper=new l},__sendRequest:function(e,t,i){return t=t||{},t.requestHeaders=t.requestHeaders||{},i&&(t.requestHeaders["X-Session"]=i),r.request(e,t)},__sendApplicationEvent:function(e){var t=this.__baseURL+"/event/log",i={},n={};return i.eventType=e,n.postBody=JSON.stringify(i),this.__sendPostRequest(t,n).then(function(){},function(e){throw new u(m.ANALYTICS_SERVICE,v.NETWORK,"Cannot send the application event",e)})},__sendLog:function(e,t,n,s){if(!(t>-1&&t<1e5&&-1===t.toString().indexOf(".")))throw new u(m.LOG_SERVICE,v.INVALID,"LogService: Invalid code.");var r=this.__logLevels;this.getLevel().then(i.bind(function(a){if(i.indexOf(r,e)<=i.indexOf(r,a)){var o={},l={},c=this.__baseURL+"/application/log/"+e;l.code=t,l.message=n,s&&i.isObject(s)&&i.extend(l,s),o.postBody=JSON.stringify(l),this.__sendPostRequest(c,o)}},this),function(e){throw new u(m.LOG_SERVICE,v.NETWORK,"Cannot send the log",e)}).done()}})}),define("tve/sAppGridServiceHolder",["tve/AppGridService","tve/TVEError","xdk-base/class","xdk-base/util","xdk-base/config","xdk-base/promise","xdk-base/console","xdk-base/device","xdk-base/Env"],function(e,t,i,n,s,r,a,o,l){"use strict";var c=l.singleton();return new(i.create({},{__appGridService:null,__createAppGridService:function(){var t=s.get("tve.appgrid");if(t&&t.api&&t.appKey){var i=t.appKey,n=t.api,r=o.id.getUniqueID();this.__appGridService=new e(n,i,r)}else a.error("Unable to initialize the AppGrid Service, can not find the API or app key")},getAppGridService:function(){return this.__appGridService||this.__createAppGridService(),this.__appGridService},getAppGridServicePromise:function(){var e=r.defer();return c.isLoaded()&&!this.__appGridService&&this.__createAppGridService(),this.__appGridService?e.resolve(this.__appGridService):c.addEventListener(c.EVT_ONLOAD,n.bind(function(e){this.__appGridService||this.__createAppGridService(),e.resolve(this.__appGridService)},this,e)),e.promise}}))}),define("tve/model/ImmutableModel",["xdk-base/class","xdk-ax/mvc/Model"],function(e,t){return e.create(t,{},{unset:function(){return this},clear:function(){return this}})}),define("storm/model/DRMSettings",["xdk-base/class","tve/model/ImmutableModel"],function(e,t){"use strict";return e.create(t,{defaults:{root:"",platformId:"",product:"",serviceId:"",denseServiceId:"",serviceIdFormat:"",deviceFriendlyName:""}},{})}),define("storm/model/DRMSettingsBuilder",["xdk-base/class","storm/model/DRMSettings"],function(e,t){"use strict";return e.create({},{_attrs:{},setRoot:function(e){return this._attrs.root=e,this},setPlatformId:function(e){return this._attrs.platformId=e,this},setProduct:function(e){return this._attrs.product=e,this},setServiceId:function(e){return this._attrs.serviceId=e,this},setDenseServiceId:function(e){return this._attrs.denseServiceId=e,this},setServiceIdFormat:function(e){return this._attrs.serviceIdFormat=e,this},setDeviceFriendlyName:function(e){return this._attrs.deviceFriendlyName=e,this},build:function(){return new t(this._attrs)}})}),define("storm/model/GeolocationSettings",["xdk-base/class","tve/model/ImmutableModel"],function(e,t){"use strict";return e.create(t,{defaults:{root:"",mapping:""}},{})}),define("storm/model/GeolocationSettingsBuilder",["xdk-base/class","storm/model/GeolocationSettings"],function(e,t){"use strict";return e.create({},{_attrs:{},setRoot:function(e){return this._attrs.root=e,this},setMapping:function(e){return this._attrs.mapping=e,this},build:function(){return new t(this._attrs)}})}),define("storm/mgr/sAppConfigManager",["xdk-base/class","xdk-base/config","xdk-base/util","xdk-base/promise","xdk-base/ajax","tve/TVEError","tve/sAppGridServiceHolder","storm/model/DRMSettingsBuilder","storm/model/GeolocationSettingsBuilder"],function(e,t,i,n,s,r,a,o,l){"use strict";var c={RESOURCE:{LOGO:"asset.img.logo",PLACEHOLDER_LANDSCAPE:"asset.img.placeholder.landscape",PLACEHOLDER_PORTRAIT:"asset.img.placeholder.portrait"},FIELD:{SKY:{EHUB:"config.sky.ehub",SILK:"config.sky.silk",CMS:"config.sky.cms",SEARCH:"config.sky.search",LICENCING:"config.sky.licencing",GEOLOCATION:"config.sky.geolocation"},EHUB:{PERMITTED_CHANNELS:"config.ehub.permittedChannels"},UI:{EPG_EXTENT:"config.ui.epg.daysForwards",DEFAULT_AUDIO:"config.ui.video.defaultAudioTrack",NECESSARY_VERSION:"config.ui.necessaryVersion"},LIVE:{SUPPORT:"config.livefeature.disable"},PLATFORM:{SAMSUNG:"config.samsung",PLAYSTATION:"config.playstation"},BINGE:{MINI:"config.minibinge"},VIDEO:{DEFAULT_AUDIO:"config.video.defaultAudioTrack"}}};return new(e.create({STATUS:{ACTIVE:"Active"}},{init:function(){},getStatus:function(){return a.getAppGridService().getStatus()},getMessage:function(){return a.getAppGridService().getMessage()},getLogo:function(){return a.getAppGridService().getResource(c.RESOURCE.LOGO)},getPlaceholderPortrait:function(){return a.getAppGridService().getResource(c.RESOURCE.PLACEHOLDER_PORTRAIT)},getPlaceholderLandscape:function(){return a.getAppGridService().getResource(c.RESOURCE.PLACEHOLDER_LANDSCAPE)},getLanguageStrings:function(){return this._getLanguageStringsPromise?this._getLanguageStringsPromise:(this._getLanguageStringsPromise=this.__getAllAppConfigs().then(function(e){try{return JSON.parse(e["config.language"])}catch(e){
throw new r(r.FACILITY.CONFIGURATION_SERVICE,r.ERROR.INVALID,"Cannot parse config.language")}}),this._getLanguageStringsPromise)},getEpgDaysForwards:function(){return this.__getAllAppConfigs().then(function(e){return e[c.FIELD.UI.EPG_EXTENT]})},getVideoDefaultAudioTrack:function(){return this.__getAllAppConfigs().then(function(e){return e[c.FIELD.UI.DEFAULT_AUDIO]})},getDefaultAudioTrackMapping:function(){return this.__getAllAppConfigs().then(function(e){try{return JSON.parse(e[c.FIELD.VIDEO.DEFAULT_AUDIO])}catch(e){throw new r(r.FACILITY.CONFIGURATION_SERVICE,r.ERROR.INVALID,"Cannot parse "+c.FIELD.VIDEO.DEFAULT_AUDIO)}})},getSamsungSpecificConfig:function(){return this.__getAllAppConfigs().then(function(e){try{return JSON.parse(e[c.FIELD.PLATFORM.SAMSUNG])}catch(e){throw new r(r.FACILITY.CONFIGURATION_SERVICE,r.ERROR.INVALID,"Cannot parse "+c.FIELD.PLATFORM.SAMSUNG)}})},getPlaystationSpecificConfig:function(){return this.__getAllAppConfigs().then(function(e){try{return JSON.parse(e[c.FIELD.PLATFORM.PLAYSTATION])}catch(e){throw new r(r.FACILITY.CONFIGURATION_SERVICE,r.ERROR.INVALID,"Cannot parse "+c.FIELD.PLATFORM.PLAYSTATION)}})},getLgSpecificConfig:function(){return this.__getAllAppConfigs().then(function(e){try{return JSON.parse(e[c.FIELD.PLATFORM.LG])}catch(e){throw new r(r.FACILITY.CONFIGURATION_SERVICE,r.ERROR.INVALID,"Cannot parse "+c.FIELD.PLATFORM.LG)}})},getSessionKeepAlivePeriod:function(){return this._getSessionKeepAlivePeriodPromise||(this._getSessionKeepAlivePeriodPromise=this.__getAllAppConfigs().then(function(e){return e["config.sky.sessionKeepAlivePeriod"]})),this._getSessionKeepAlivePeriodPromise},getEhubConfig:function(){return this._getEhubConfigPromise?this._getEhubConfigPromise:(this._getEhubConfigPromise=this.__getAllAppConfigs().then(function(e){try{return JSON.parse(e[c.FIELD.SKY.EHUB])}catch(e){throw new r(r.FACILITY.CONFIGURATION_SERVICE,r.ERROR.INVALID,"Cannot parse "+c.FIELD.SKY.EHUB)}}),this._getEhubConfigPromise)},getSilkConfig:function(){return this._getSilkConfigPromise?this._getSilkConfigPromise:(this._getSilkConfigPromise=this.__getAllAppConfigs().then(function(e){try{return JSON.parse(e[c.FIELD.SKY.SILK])}catch(e){throw new r(r.FACILITY.CONFIGURATION_SERVICE,r.ERROR.INVALID,"Cannot parse "+c.FIELD.SKY.SILK)}}),this._getSilkConfigPromise)},getCmsConfig:function(){return this._getCmsConfigPromise?this._getCmsConfigPromise:(this._getCmsConfigPromise=this.__getAllAppConfigs().then(function(e){try{return JSON.parse(e[c.FIELD.SKY.CMS])}catch(e){throw new r(r.FACILITY.CONFIGURATION_SERVICE,r.ERROR.INVALID,"Cannot parse "+c.FIELD.SKY.CMS)}}),this._getCmsConfigPromise)},getSearchConfig:function(){return this._getSearchConfigPromise?this._getSearchConfigPromise:(this._getSearchConfigPromise=this.__getAllAppConfigs().then(function(e){try{return JSON.parse(e[c.FIELD.SKY.SEARCH])}catch(e){throw new r(r.FACILITY.CONFIGURATION_SERVICE,r.ERROR.INVALID,"Cannot parse "+c.FIELD.SKY.SEARCH)}}),this._getSearchConfigPromise)},getAnalyticsConfig:function(){return this._getAnalyticsConfigPromise?this._getAnalyticsConfigPromise:(this._getAnalyticsConfigPromise=this.__getAllAppConfigs().then(function(e){try{var i=t.get("environment");return JSON.parse(e["config.analytics.omniture"])[i]}catch(e){throw new r(r.FACILITY.CONFIGURATION_SERVICE,r.ERROR.INVALID,"Cannot parse "+c.FIELD.SKY.CMS)}}),this._getAnalyticsConfigPromise)},getDRMSettings:function(){return this._getLicencingConfigPromise||(this._getLicencingConfigPromise=this.__getAllAppConfigs().then(function(e){try{return JSON.parse(e[c.FIELD.SKY.LICENCING])}catch(e){throw new r(r.FACILITY.CONFIGURATION_SERVICE,r.ERROR.INVALID,"Cannot parse "+c.FIELD.SKY.LICENCING)}})),this._getLicencingConfigPromise.then(function(e){var i=t.get("environment");return(new o).setRoot(e.root[i]).setPlatformId(e.platformId[i]).setProduct(e.product[i]).setServiceId(e.serviceId[i]).setDenseServiceId(e.denseServiceId[i]).setServiceIdFormat(e.serviceIdFormatter[i]).setDeviceFriendlyName(e.deviceFriendlyName[i]).build()})},getPermittedLinearChannels:function(){return this._getPermittedLinearChannelsPromise||(this._getPermittedLinearChannelsPromise=this.__getAllAppConfigs().then(function(e){try{return JSON.parse(e[c.FIELD.EHUB.PERMITTED_CHANNELS])}catch(e){throw new r(r.FACILITY.CONFIGURATION_SERVICE,r.ERROR.INVALID,"Cannot parse "+c.FIELD.EHUB.PERMITTED_CHANNELS)}})),this._getPermittedLinearChannelsPromise.then(function(e){var i=t.get("environment");return e.ids[i]})},getGeolocationSettings:function(){return this._getGeolocationConfigPromise||(this._getGeolocationConfigPromise=this.__getAllAppConfigs().then(function(e){try{return JSON.parse(e[c.FIELD.SKY.GEOLOCATION])}catch(e){throw new r(r.FACILITY.CONFIGURATION_SERVICE,r.ERROR.INVALID,"Cannot parse "+c.FIELD.SKY.GEOLOCATION)}})),this._getGeolocationConfigPromise.then(function(e){var i=t.get("environment");return(new l).setRoot(e.root[i]).setMapping(e.mapping[i]).build()})},_ensurePackageColourMappingPromise:function(){this._getPackageColourMappingPromise||(this._getPackageColourMappingPromise=this.__getAllAppConfigs().then(function(e){try{return JSON.parse(e["config.cms.colours"])}catch(e){throw new r(r.FACILITY.CONFIGURATION_SERVICE,r.ERROR.INVALID,"Cannot parse config.cms.colours")}}))},getPackageImageForCode:function(e){return this._ensurePackageColourMappingPromise(),this._getPackageColourMappingPromise.then(function(t){var i=t&&t.colourCodeToName,s=t&&t.colourNameToImage,r=i&&i[e],o=s&&s[r];return o?a.getAppGridService().getResource(o):n.reject("No package image mapped to code "+e)})},getPackageColourForCode:function(e){return this._ensurePackageColourMappingPromise(),this._getPackageColourMappingPromise.then(function(t){var i=t&&t.colourCodeToName,n=t&&t.colourNameToHex,s=t&&t.defaultColour,r=i&&i[e];return n&&n[r]||s})},getLiveFeatureStatus:function(){return this.__getAllAppConfigs().then(function(e){try{return JSON.parse(e[c.FIELD.LIVE.SUPPORT])}catch(e){throw new r(r.FACILITY.CONFIGURATION_SERVICE,r.ERROR.INVALID,"Cannot parse "+c.FIELD.LIVE.SUPPORT)}})},getMiniBingeSetting:function(){return this.__getAllAppConfigs().then(function(e){try{return JSON.parse(e[c.FIELD.BINGE.MINI])}catch(e){throw new r(r.FACILITY.CONFIGURATION_SERVICE,r.ERROR.INVALID,"Cannot parse "+c.FIELD.LIVE.SUPPORT)}})},getLatestValidVersion:function(){return this.__getAllAppConfigs().then(function(e){try{return JSON.parse(e[c.FIELD.UI.NECESSARY_VERSION])}catch(e){return n.reject("Cannot parse "+c.FIELD.UI.NECESSARY_VERSION)}})},__getAllAppConfigs:function(){return this.__getAllAppConfigsPromise?this.__getAllAppConfigsPromise:(this.__getAllAppConfigsPromise=a.getAppGridService().getConfigs(["config.*"]).complete(i.bind(function(){this.__getAllAppConfigsPromise=null},this)),this.__getAllAppConfigsPromise)}}))}),define("storm/mgr/sEditorialManager",["xdk-base/core","xdk-base/class","xdk-base/util","xdk-base/ajax","xdk-base/promise","xdk-base/config","xdk-base/console","tve/TVEError","tve/sAppGridServiceHolder","storm/mgr/sAppConfigManager"],function(e,t,i,n,s,r,a,o,l,c){"use strict";var d="production"===r.get("environment");return new(t.create({},{CONTENT:{HOMEPAGE_HIGHLIGHTS:"homepageHighlights",NAVIGATION_OVERRIDES:"navigationOverrides",TEXT_MESSAGES:"textMessages",SILK_MESSAGES:"silkMessage",DAYPASS_DETAILS:"daypassDetails",PRODUCT_DETAILS:"subscriptionDetails",BINGE_RECOMMENDATION:"bingeRecommendation",CUSTOMER_COMMUNICATION:"customerCommunication",TERMS_DE:"termsDe",TERMS_AT:"termsAt",IMPRESSUM_DE:"impressumDe",IMPRESSUM_AT:"impressumAt",PRIVACY_DE:"privacyDe",PRIVACY_AT:"privacyAt",FAQ:"faq",EULA:"eula",PLATFORM_LICENSES:"platformLicenses",IMAGES:"imageResources"},_initDefer:s.defer(),_promisesPromises:{},init:function(){l.getAppGridServicePromise().then(i.bind(function(){c.getCmsConfig().then(i.bind(function(e){try{var t=e.root[d?"production":"test"],i=r.get("dev.proxy",!1),s=r.get("dev.proxyHosts",[]);for(var l in this.CONTENT)if(this.CONTENT.hasOwnProperty(l)){var c=e.editorial[this.CONTENT[l]],u=0===c.indexOf("http")?c:t+c;if(!d&&r.get("dev.replaceHost",!1)){for(var h=r.get("dev.findHosts",[]),_=r.get("dev.replaceHosts",[]),g=-1,f=0;f<h.length;f++)if(u.indexOf(h[f])>0){g=f;break}g>-1&&(u=u.replace(h[g],_[g]))}if(i&&s.length){for(var p=null,m=0;m<s.length;m++)if(u.indexOf(s[m])>0){p=s[m];break}if(p){var v=r.get("dev.proxyPath");u=v+encodeURIComponent(u)}}a.log("URL: "+u),this._promisesPromises[this.CONTENT[l]]=n.request(u,{method:"get"})}this._initDefer.resolve()}catch(e){this._initDefer.reject(new o(o.FACILITY.GENERAL,o.ERROR.INVALID,"sEditorialManager init: "+e))}},this))},this))},getEditorialContent:function(e){if(a.log("sEditorialManager::getEditorialContent("+e+")"),!i.isString(e))throw new o(o.FACILITY.GENERAL,o.ERROR.INVALID,"getEditorialContent: Key was not a string");if(e.length<1)throw new o(o.FACILITY.GENERAL,o.ERROR.INVALID,"getEditorialContent: Key was too short");return this._initDefer.promise.then(i.bind(function(){if(i.isUndefined(this._promisesPromises[e]))throw new o(o.FACILITY.GENERAL,o.ERROR.INVALID,"getEditorialContent: Key "+e+" unavailable");return this._promisesPromises[e]},this))}}))}),define("storm/mgr/sLanguageManager",["xdk-base/ax","xdk-base/util","xdk-base/core","xdk-base/class","xdk-base/config","xdk-base/console","tve/TVEError","lib/moment","tve/sAppGridServiceHolder","storm/mgr/sAppConfigManager","storm/mgr/sEditorialManager","xdk-base/ajax"],function(e,t,i,n,s,r,a,o,l,c,d,u){"use strict";var h={LOCAL:"Local",CMS:"CMS",APPGRID:"AppGrid"},_={MIRROR:"mirror",UNIVERSAL:"ALL"};return new(n.create({},{_currentLanguage:_.MIRROR,_availableLanguages:["en","de",_.MIRROR],_sourcePreferenceOrder:[h.LOCAL,h.CMS,h.APPGRID],_initDefer:e.promise.defer(),_mappings:{},init:function(){e.promise.all([this._populateLocalStrings(),this._populateCmsStrings(),this._getBingeRecommendation(),this._populateAppGridStrings()]).then(e.util.bind(function(){this._initDefer.resolve("Retrieved all language texts")},this),e.util.bind(function(e){this._initDefer.reject("Couldn't get all language texts: "+e)},this))},_mergeMappingsFromTo:function(t,i,n){if(!n||-1===this._sourcePreferenceOrder.indexOf(n))throw new a(a.FACILITY.GENERAL,a.ERROR.INVALID,"_mergeMappingsFromTo: No usable source type");for(var s in t)if(t.hasOwnProperty(s)){var o=i[s];if(e.util.isUndefined(o)){var l={};l.source=n,l.string=t[s],i[s]=l}else{var c=this._sourcePreferenceOrder.indexOf(o.source),d=this._sourcePreferenceOrder.indexOf(n);c===d&&r.warn("_mergeMappingsFromTo: Overwrite at same precedence level"),c<=d&&(o.source=n,o.string=t[s])}}},_populateStringsFromSource:function(t,i){if(i){if(!t||-1===this._sourcePreferenceOrder.indexOf(t))throw new a(a.FACILITY.GENERAL,a.ERROR.INVALID,"_populateStringsFromSource: No usable source type");for(var n in i)if(i.hasOwnProperty(n)){var s=i[n],r=this._mappings[n];e.util.isUndefined(r)&&(r={},this._mappings[n]=r),this._mergeMappingsFromTo(s,r,t)}}},_populateLocalStrings:function(){var t={};return window._language_config?(t=window._language_config,delete window._language_config):r.warn("No locally-configured language strings found"),this._populateStringsFromSource(h.LOCAL,t),e.promise.resolve("_populateLocalStrings complete")},_populateCmsStrings:function(){return d.getEditorialContent(d.CONTENT.TEXT_MESSAGES).then(e.util.bind(function(t){var i={};e.util.each(t.responseJSON.sections.section,function(t){e.util.each(t.item,function(e){i[t.name+"."+e.key]={de:e.content}})}),this._populateStringsFromSource(h.CMS,i)},this),function(e){throw new a(a.FACILITY.GENERAL,a.ERROR.INVALID,"_populateCmsStrings failed: "+e)})},_getBingeRecommendation:function(){return d.getEditorialContent(d.CONTENT.BINGE_RECOMMENDATION).then(e.util.bind(function(t){var i={};e.util.each(t.responseJSON.binge_recommendation,function(e){i["Binge_recommendation."+e.key]={de:e.value}}),this._populateStringsFromSource(h.CMS,i)},this),function(e){throw new a(a.FACILITY.GENERAL,a.ERROR.INVALID,"_populateCmsStrings failed: "+e)})},_populateAppGridStrings:function(){return l.getAppGridServicePromise().then(e.util.bind(function(){return c.getLanguageStrings().then(e.util.bind(function(e){this._populateStringsFromSource(h.APPGRID,e)},this),function(e){throw new a(a.FACILITY.GENERAL,a.ERROR.INVALID,"_populateAppGridStrings failed: "+e)})},this))},setLanguage:function(e){if(!e)throw new a(a.FACILITY.GENERAL,a.ERROR.INVALID,"setLanguage: No language was requested");if(-1===this._availableLanguages.indexOf(e))throw new a(a.FACILITY.GENERAL,a.ERROR.INVALID,"setLanguage: The requested language ("+e+") is not available");this._currentLanguage=e,o.lang(e)},getInitPromise:function(){return this._initDefer.promise},getCurrentLanguage:function(){return this._currentLanguage},_getString:function(i){if(!e.util.isString(i))throw new a(a.FACILITY.GENERAL,a.ERROR.INVALID,"getString: Key was not a string");if(i.length<1)return i;var n=this._mappings[i];if(e.util.isUndefined(n))return i;if(this._currentLanguage===_.MIRROR)return"["+i+"] maps ok";var r=n[this._currentLanguage];return e.util.isUndefined(r)&&(r=n[_.UNIVERSAL]),e.util.isUndefined(r)?"["+i+"] mapped, but not to language "+this._currentLanguage:"test"!==s.get("environment")||"NEW_LABEL_SMARTV"!==r.string&&"NEW"!==r.string&&!t.isUndefined(r.string)?"production"!==s.get("environment")||t.isString(r.string)?r.string:"":i},getString:function(e,t){if(!t)return this._getString(e);var i=function(e){var i=t[e.slice(1,-1)];return void 0!==i?i:e};return this._getString(e).replace(/([\{\[].*?[\}\]])/g,i)}}))}),define("storm/wgt/FullscreenTextDialog",["xdk-base/class","fix/Dialog","xdk-base/util","xdk-ax/Container","xdk-ax/focusManager","xdk-ax/evt/type","xdk-ui-basic/Layout","xdk-ui-basic/Button","xdk-ui-basic/Label","tvedemo/wgt/ScrollLabel","storm/mgr/sLanguageManager"],function(e,t,i,n,s,r,a,o,l,c,d){"use strict";return e.create(t,{},{init:function(e){e=e||{},e.title=e.title||"",e.message=e.message||"",this._cancelButton=new o({id:"cancelButton",css:"cancel-button",text:e.cancelButtonText||d.getString("Global.Global_buttonBack_button"),nextUp:"info-message"}),this._scrollingLabel=new c({id:"info-message",css:"wgt-dialog-message",nextDown:"cancelButton",scrollStep:150}),e.content=new n({children:[new n({css:"scrolling-label-container",children:[this._scrollingLabel]}),new a({id:"bottomContainer",forwardFocus:!0,children:[this._cancelButton]})]}),this._super(e),this.addClass("wgt-fullscreen-text-dialog"),this._cancelButtonAction=i.bind(function(){this.close()},this),this._cancelButton.addEventListener(r.CLICK,this._cancelButtonAction),this.setOption("forwardFocus",this._scrollingLabel),this._scrollingLabel.setText(e.message),this._lastFocus=s.getCurFocus(),this._scrollingLabel.__scrollable?s.focus(this._scrollingLabel):(this._scrollingLabel.setOption("focusable",!1),s.focus(this._cancelButton))},close:function(){this._cancelButton.removeEventListener(r.CLICK,this._cancelButtonAction),this._super(),this.deinit()}})}),define("storm/wgt/TermsAndConditionsDialog",["xdk-base/class","fix/Dialog","xdk-base/util","xdk-ax/Container","xdk-ax/focusManager","xdk-ax/evt/type","xdk-ui-basic/Layout","xdk-ui-basic/Button","xdk-ui-basic/Label","tvedemo/wgt/ScrollLabel","xdk-ui-basic/Checkbox","storm/wgt/FullscreenTextDialog"],function(e,t,i,n,s,r,a,o,l,c,d,u){"use strict";return e.create(t,{},{init:function(e){e=e||{},e.title=e.title||"",e.message=e.message||"",e.firstCheckboxLabel=e.firstCheckboxLabel||"",e.secondCheckboxLabel=e.secondCheckboxLabel||"",e.confirmButtonText=e.confirmButtonText||"",e.marketingTitle=e.marketingTitle||"",e.marketingBody=e.marketingBody||"",e.AGBTitle=e.AGBTitle||"",e.AGBBody=e.AGBBody||"",this._firstCheckbox=new d({id:"firstCheckbox",nextRight:"marketingButton",nextDown:"secondCheckbox"}),this._secondCheckbox=new d({id:"secondCheckbox",nextRight:"AGBButton",nextUp:"firstCheckbox",nextDown:"bottomContainer",nextLeft:"secondCheckbox"}),this._confirmButton=new o({id:"confirmButton",css:"confirm-button",text:e.confirmButtonText,nextUp:"secondCheckbox",nextRight:"cancelButton"}),this._cancelButton=new o({id:"cancelButton",css:"cancel-button",text:e.cancelButtonText,nextUp:"secondCheckbox",nextLeft:"confirmButton"}),this._marketingButton=new o({id:"marketingButton",css:"marketing-button",text:e.showMarketingButton,nextUp:"",nextDown:"AGBButton",nextLeft:"firstCheckbox"}),this._AGBButton=new o({id:"AGBButton",css:"agb-button",text:e.showAGBButton,nextUp:"marketingButton",nextDown:"cancelButton",nextLeft:"secondCheckbox"}),e.content=new n({children:[new a({css:"left-container",nextUp:null,children:[new l({css:"title",text:e.title}),new l({css:"message",text:e.message}),new a({css:"checkbox-container",children:[this._firstCheckbox,new l({css:"checkbox-label",text:e.firstCheckboxLabel}),this._secondCheckbox,new l({css:"checkbox-label",text:e.secondCheckboxLabel})]}),new a({id:"bottomContainer",css:"bottomContainer",forwardFocus:!0,children:[this._confirmButton,this._cancelButton]})]}),new a({css:"right-container",nextUp:null,children:[this._marketingButton,this._AGBButton]})]}),this._super(e),this.addClass("wgt-terms-and-conditions-dialog"),this.agbValueChanged=i.bind(this._agbValueChanged,this),this._confirmButtonAction=i.bind(function(){var t=this._firstCheckbox.getValue(),i=this._secondCheckbox.getValue();this.close(),e.confirmAction&&e.confirmAction(t,i)},this),this._cancelButtonAction=i.bind(function(){this.close(),e.cancelAction&&e.cancelAction()},this),this._openMarketingInfo=i.bind(this._openInfoTextDialog,this,e.marketingTitle,e.marketingBody),this._openAGBInfo=i.bind(this._openInfoTextDialog,this,e.AGBTitle,e.AGBBody),this._confirmButton.addEventListener(r.CLICK,this._confirmButtonAction),this._cancelButton.addEventListener(r.CLICK,this._cancelButtonAction),this._marketingButton.addEventListener(r.CLICK,this._openMarketingInfo),this._AGBButton.addEventListener(r.CLICK,this._openAGBInfo),this._secondCheckbox.addEventListener(r.VALUE_CHANGED,this.agbValueChanged),this.setOption("forwardFocus",this._firstCheckbox),this._firstCheckbox.check(!1),this._secondCheckbox.check(!1),this._lastFocus=s.getCurFocus(),s.focus(this._firstCheckbox)},_openInfoTextDialog:function(e,t){new u({title:e,message:t})},_agbValueChanged:function(e){!0===e?this._confirmButton.show():this._confirmButton.hide()},close:function(){this._confirmButton.removeEventListener(r.CLICK,this._confirmButtonAction),this._cancelButton.removeEventListener(r.CLICK,this._cancelButtonAction),this._marketingButton.removeEventListener(r.CLICK,this._openMarketingInfo),this._AGBButton.removeEventListener(r.CLICK,this._openAGBInfo),this._secondCheckbox.removeEventListener(r.VALUE_CHANGED,this.agbValueChanged),this._super(),this.deinit()}})}),define("storm/wgt/AcceptDialog",["xdk-base/class","fix/Dialog","xdk-base/util","xdk-ax/Container","xdk-ax/focusManager","xdk-ax/evt/type","xdk-ui-basic/Layout","xdk-ui-basic/Button","xdk-ui-basic/Label","xdk-base/device/vKey","tvedemo/wgt/ScrollLabel"],function(e,t,i,n,s,r,a,o,l,c,d){"use strict";return e.create(t,{},{init:function(e){e=e||{},e.title=e.title||"",e.hint=e.hint||"",e.body=e.body||"",e.type=e.type||"1button",e.confirmButtonText=e.confirmButtonText||"",e.cancelButtonText=e.cancelButtonText||"",this._bodyLabel=new d({id:"bodyLabel",scrollStep:220,nextDown:"confirmButton"}),this._confirmButton=new o({id:"confirmButton",css:"confirm-button",text:e.confirmButtonText,nextUp:"bodyLabel",nextRight:"cancelButton"}),this._cancelButton=new o({id:"cancelButton",css:"cancel-button",text:e.cancelButtonText,nextUp:"bodyLabel",nextLeft:"confirmButton"});var t=[new l({css:"title",text:e.title}),new l({css:"message",text:e.hint}),this._bodyLabel,this._confirmButton];"2button"===e.type&&t.push(this._cancelButton),e.content=new n({forwardFocus:this._bodyLabel,children:t}),this._super(e),this.addClass("wgt-accept-dialog"),this._confirmButtonAction=i.bind(function(){try{this.close()}catch(e){}i.isFunction(e.confirmAction)&&e.confirmAction()},this),this._cancelButtonAction=i.bind(function(){try{this.close()}catch(e){}i.isFunction(e.cancelAction)&&e.cancelAction()},this),this._confirmButton.addEventListener(r.CLICK,this._confirmButtonAction),this._cancelButton.addEventListener(r.CLICK,this._cancelButtonAction),this.setOption("forwardFocus",this._bodyLabel),this._bodyLabel.setText(e.body),this._lastFocus=s.getCurFocus(),s.focus(this._bodyLabel)},_keyHandler:function(e){return!this._opts.doNegativeActionOnClose||e.id!==c.BACK.id&&e.id!==c.EXIT.id?this._super(e):(e.id!==c.BACK.id&&e.id!==c.EXIT.id||"1button"!==this._opts.type||this._confirmButtonAction(),this._cancelButtonAction(),!1)},close:function(){this._confirmButton.removeEventListener(r.CLICK,this._confirmButtonAction),this._cancelButton.removeEventListener(r.CLICK,this._cancelButtonAction),this._super(),this.deinit()}})}),define("tvedemo/helper/dialogHelper",["xdk-base/util","xdk-ax/evt/type","xdk-ax/focusManager","xdk-base/promise","xdk-ax/mediator","tve/TVEError","xdk-ui-basic/Dialog","tvedemo/wgt/AlertDialog","tvedemo/wgt/ConfirmDialog","tvedemo/wgt/InputDialog","tvedemo/mgr/sHistoryManager","storm/wgt/TermsAndConditionsDialog","storm/wgt/AcceptDialog","storm/mgr/sLanguageManager","tvedemo/wgt/Keyboard"],function(e,t,i,n,s,r,a,o,l,c,d,u,h,_,g){"use strict";var f={VERTICAL_BUTTON_LAYOUT:1,HORIZONTAL_BUTTON_LAYOUT:2,fromSilkMessagePromise:function(e){n.isPromise(e)&&e.then(function(e){f.error({title:e.get("title"),reason:e.get("description")})})},error:function(i){var n,s={title:_.getString("Errormessages.Errormessages_GenericErrorMessageHeadline"),reason:_.getString("Global.Global_generalError"),buttonText:_.getString("Global.Global_Continue")};return i=e.extend(s,i||{}),n=new o({title:i.title,message:i.reason instanceof r?i.reason.getMessage():i.reason,buttonText:i.buttonText,disableAutoclose:i.disableAutoclose}),e.isFunction(i.closeAction)&&n.addEventListener(t.CLOSE,i.closeAction),n},success:function(i){i.buttonText=_.getString("Global.Global_Continue");var n=new o({title:i.title,message:i.message,buttonText:i.buttonText});return e.isFunction(i.closeAction)&&n.addEventListener(t.CLOSE,i.closeAction),n},input:function(e){return new c(e)},confirm:function(e){return new l(e)},termsAndConditions:function(e){return new u(e)},accept:function(e){return new h(e)},isAnyDialogOpen:function(){for(var e=i.getCurFocus();e;){if(e instanceof a)return!0;if(e instanceof g)return!0;e=e.getParent()}return!1}};return f}),define("tve/interface/VODContentService",["xdk-base/Interface"],function(e){return e.create("VODContentService",{getAllMovies:["opts"],getMovieById:["id","opts"],getMoviesByIds:["ids","opts"],getMoviesByCategoryId:["categoryId","opts"],getAllTVShows:["opts"],getTVShowById:["id","opts"],getTVShowsByIds:["ids","opts"],getTVShowsByCategoryId:["categoryId","opts"],getAllEpisodes:["opts"],getEpisodeById:["id","opts"],getEpisodesByTVShowId:["showId","opts"]})}),define("tve/interface/LinearContentService",["xdk-base/Interface"],function(e){return e.create("LinearContentService",{getAllChannels:["opts"],getPermittedChannels:["opts"],getChannelById:["id","opts"],getChannelsByIds:["ids","opts"],getChannelsByCategoryId:["categoryId","opts"],getAllChannelListings:["startTime","endTime","opts"],getChannelListingByChannelId:["channelId","startTime","endTime","opts"],getChannelListingsByChannelIds:["channelIds","startTime","endTime","opts"]})}),define("tve/AccedoOvpService",["xdk-base/ax","tve/util/CacheHelper","tve/TVEError","tve/interface/VODContentService","tve/interface/LinearContentService"],function(e,t,i,n,s){var r=i.FACILITY,a=i.ERROR,o={DESC:"desc",ASC:"asc"},l={cacheHelper:null,baseURL:"",init:function(e,t){this.baseURL=e,this.cacheHelper=t},categoryRequest:function(t){t=t||{};var i=this.baseURL+"/category",n=t.id,s=t.objType,r=r||{};return e.util.isBoolean(t.showEpisodes)&&(r.episodes=t.showEpisodes),e.util.isBoolean(t.showTVSeasons)&&(r.seasons=t.showTVSeasons),n&&(n=n.join?n.join():n,i+="/"+n,delete t.id),s&&(i+="/"+s,delete t.objType),this.request(i,t,r)},channelRequest:function(e){e=e||{};var t=this.baseURL+"/channel",i=e.id,n=n||{};return i&&(i=i.join?i.join():i,t+="/"+i,delete e.id),this.request(t,e,n)},channelByCategoryRequest:function(t){return t=t||{},t.id?(e.util.extend(t,{objType:"channel"}),this.categoryRequest(t)):e.promise.reject(new i(r.LINEAR_CONTENT_SERVICE,a.INTERNAL,"no id is provided in OVP API"))},channelListingRequest:function(t){t=t||{};var n=this.baseURL+"/tvlisting",s=t.channelId,o=o||{};return t.startTime&&t.endTime?(o.startTime=t.startTime,o.endTime=t.endTime,s&&(s=s.join?s.join():s,n+="/"+s,delete t.channelId),this.request(n,t,o)):e.promise.reject(new i(r.LINEAR_CONTENT_SERVICE,a.INTERNAL,"no startTime or endTime is provided in OVP API"))},movieRequest:function(e){e=e||{};var t=this.baseURL+"/movie",i=e.id,n=n||{};return i&&(i=i.join?i.join():i,t+="/"+i,delete e.id),this.request(t,e,n)},movieByCategoryRequest:function(t){return t=t||{},t.id?(e.util.extend(t,{objType:"movie"}),this.categoryRequest(t)):e.promise.reject(new i(r.VOD_CONTENT_SERVICE,a.INTERNAL,"no id is provided in OVP API"))},tvShowRequest:function(t){t=t||{};var i=this.baseURL+"/tvshow",n=t.id,s=t.objType,r=r||{};return e.util.isBoolean(t.showEpisodes)&&(r.episodes=t.showEpisodes),e.util.isBoolean(t.showTVSeasons)&&(r.seasons=t.showTVSeasons),n&&(n=n.join?n.join():n,i+="/"+n,delete t.id),s&&(i+="/"+s,delete t.objType),this.request(i,t,r)},tvShowByCategoryRequest:function(t){return t=t||{},t.id?(e.util.extend(t,{objType:"tvshow"}),this.categoryRequest(t)):e.promise.reject(new i(r.VOD_CONTENT_SERVICE,a.INTERNAL,"no id is provided in OVP API"))},tvSeasonRequest:function(t){t=t||{};var i=this.baseURL+"/tvseason",n=t.id,s=t.objType,r=r||{};return e.util.isBoolean(t.showEpisodes)&&(r.episodes=t.showEpisodes),n&&(n=n.join?n.join():n,i+="/"+n,delete t.id),s&&(i+="/"+s,delete t.objType),this.request(i,t,r)},tvSeasonByTVShowRequest:function(t){return e.util.extend(t,{objType:"tvseason"}),this.tvShowRequest(t)},episodeRequest:function(e){e=e||{};var t=this.baseURL+"/episode",i=e.id,n=n||{};return i&&(t+="/"+i,delete e.id),this.request(t,e,n)},episodeByTVShowRequest:function(t){return e.util.extend(t,{objType:"episode"}),this.tvShowRequest(t)},episodeByTVSeasonRequest:function(t){return e.util.extend(t,{objType:"episode"}),this.tvSeasonRequest(t)},vodSearchRequest:function(t){var i=this.baseURL+"/search",n=t.type,s=s||{};return i+="/"+n+"/"+t.key,e.util.isBoolean(t.showEpisodes)&&(s.episodes=t.showEpisodes),e.util.isBoolean(t.showTVSeasons)&&(s.seasons=t.showTVSeasons),this.request(i,t,s)},request:function(t,n,s){n=n||{},s=s||{};var l,c=this.cacheHelper,d=JSON.stringify({url:t,opts:n,param:s}),u=c.getCache(d);return e.util.isUndefined(u)||(c.isExpired(d)?c.getTimestamp(d):e.promise.resolve(u)),n.sortingKey&&(s.sortBy=n.sortingKey+"|"+(n.sortingOrder?n.sortingOrder:o.DESC)),s.pageSize=n.pageSize||100,s.pageNumber=n.pageNumber||1,l={method:"get",parameters:s},e.ajax.request(t,l).then(function(e){var t=null;return t=e.responseJSON||JSON.parse(e.responseText),c.setObject(d,t,+new Date),t},function(e){throw new i(r.GENERAL,a.NETWORK,e.transport?e.transport.statusText:"network issue",e)})}};return e.klass.create([n,s],{SORTING:o},{__cache:null,init:function(e){if(!e||!e.baseURL)throw new i(r.GENERAL,a.INTERNAL,"no baseURL is provided, cannot init service");this.__cache=new t,l.init(e.baseURL,this.__cache)},getAllCategories:function(e){return l.categoryRequest(e).then(function(e){return{entries:e.entries,totalCount:e.totalCount,pageSize:e.pageSize,pageNumber:e.pageNumber}})},getCategoryById:function(t,n){return t?(n=n||{},n.id=t,l.categoryRequest(n)):e.promise.reject(new i(r.GENERAL,a.INTERNAL,"no id is provided"))},getCategoriesByIds:function(t,n){return t&&e.util.isArray(t)?(n=n||{},n.id=t,l.categoryRequest(n).then(function(t){return{entries:e.util.isArray(t.entries)?t.entries:[t],totalCount:t.totalCount||1,pageSize:t.pageSize||1,pageNumber:t.pageNumber||1}})):e.promise.reject(new i(r.GENERAL,a.INTERNAL,"incorrect parameter type"))},__getChannel:function(e){return e&&e.categoryId?(e.id=e.categoryId,delete e.categoryId,l.channelByCategoryRequest(e)):l.channelRequest(e)},getAllChannels:function(e){return this.__getChannel(e).then(function(e){return{entries:e.entries,totalCount:e.totalCount,pageSize:e.pageSize,pageNumber:e.pageNumber}})},getPermittedChannels:function(e){return this.__getChannel(e).then(function(e){return{entries:e.entries,totalCount:e.totalCount,pageSize:e.pageSize,pageNumber:e.pageNumber}})},getChannelById:function(t,n){return t?(n=n||{},n.id=t,this.__getChannel(n)):e.promise.reject(new i(r.LINEAR_CONTENT_SERVICE,a.INTERNAL,"no id is provided"))},getChannelsByIds:function(t,n){return t&&e.util.isArray(t)?(n=n||{},n.id=t,this.__getChannel(n).then(function(t){return{entries:e.util.isArray(t.entries)?t.entries:[t],totalCount:t.totalCount||1,pageSize:t.pageSize||1,pageNumber:t.pageNumber||1}})):e.promise.reject(new i(r.LINEAR_CONTENT_SERVICE,a.INTERNAL,"incorrect parameter type"))},getChannelsByCategoryId:function(t,n){return t?(n=n||{},n.categoryId=t,this.__getChannel(n).then(function(e){return{entries:e.entries,totalCount:e.totalCount,pageSize:e.pageSize,pageNumber:e.pageNumber}})):e.promise.reject(new i(r.LINEAR_CONTENT_SERVICE,a.INTERNAL,"no categoryId is provided"))},getAllChannelListings:function(t,n,s){return t&&n?(s=s||{},s.startTime=t,s.endTime=n,l.channelListingRequest(s).then(function(e){return{entries:e.entries,totalCount:e.totalCount,pageSize:e.pageSize,pageNumber:e.pageNumber}})):e.promise.reject(new i(r.LINEAR_CONTENT_SERVICE,a.INTERNAL,"no startTime or endTime is provided"))},getChannelListingByChannelId:function(t,n,s,o){return t?n&&s?(o=o||{},o.channelId=t,o.startTime=n,o.endTime=s,l.channelListingRequest(o)):e.promise.reject(new i(r.LINEAR_CONTENT_SERVICE,a.INTERNAL,"no startTime or endTime is provided")):e.promise.reject(new i(r.LINEAR_CONTENT_SERVICE,a.INTERNAL,"no channelId is provided"))},getChannelListingsByChannelIds:function(t,n,s,o){return t?n&&s?(o=o||{},o.channelId=t,o.startTime=n,o.endTime=s,l.channelListingRequest(o).then(function(t){return{entries:e.util.isArray(t.entries)?t.entries:[t],totalCount:t.totalCount||1,pageSize:t.pageSize||1,pageNumber:t.pageNumber||1}})):e.promise.reject(new i(r.LINEAR_CONTENT_SERVICE,a.INTERNAL,"no startTime or endTime is provided")):e.promise.reject(new i(r.LINEAR_CONTENT_SERVICE,a.INTERNAL,"no channelIds are provided"))},__getMovie:function(e){return e&&e.categoryId?(e.id=e.categoryId,delete e.categoryId,l.movieByCategoryRequest(e)):l.movieRequest(e)},__getTVShow:function(t){var i={showTVSeasons:!0,showEpisodes:!0};return i=e.util.extend(i,t,!0),i&&i.categoryId?(i.id=i.categoryId,delete i.categoryId,l.tvShowByCategoryRequest(i)):l.tvShowRequest(i)},__getTVSeason:function(t){var i={showEpisodes:!0};return i=e.util.extend(i,t,!0),i&&i.showId?(i.id=i.showId,delete i.showId,l.tvSeasonByTVShowRequest(i)):l.tvSeasonRequest(i)},__getEpisode:function(e){return e&&e.showId?(e.id=e.showId,delete e.showId,l.episodeByTVShowRequest(e)):e&&e.seasonId?(e.id=e.seasonId,delete e.seasonId,l.episodeByTVSeasonRequest(e)):l.episodeRequest(e)},getAllMovies:function(e){return this.__getMovie(e).then(function(e){return{entries:e.entries,totalCount:e.totalCount,pageSize:e.pageSize,pageNumber:e.pageNumber}})},getMovieById:function(t,n){return t?(n=n||{},n.id=t,this.__getMovie(n)):e.promise.reject(new i(r.VOD_CONTENT_SERVICE,a.INTERNAL,"no id is provided"))},getMoviesByIds:function(t,n){return t&&e.util.isArray(t)?(n=n||{},n.id=t,this.__getMovie(n).then(function(t){return{entries:e.util.isArray(t.entries)?t.entries:[t],totalCount:t.totalCount||1,pageSize:t.pageSize||1,pageNumber:t.pageNumber||1}})):e.promise.reject(new i(r.VOD_CONTENT_SERVICE,a.INTERNAL,"incorrect parameter type"))},getMoviesByCategoryId:function(t,n){return t?(n=n||{},n.categoryId=t,this.__getMovie(n).then(function(e){return{entries:e.entries,totalCount:e.totalCount,
pageSize:e.pageSize,pageNumber:e.pageNumber}})):e.promise.reject(new i(r.VOD_CONTENT_SERVICE,a.INTERNAL,"no categoryId is provided"))},searchMovies:function(t,n){return t?(n=n||{},n.type="movie",n.key=t,l.vodSearchRequest(n).then(function(e){return{entries:e.entries,totalCount:e.totalCount,pageSize:e.pageSize,pageNumber:e.pageNumber}})):e.promise.reject(new i(r.VOD_CONTENT_SERVICE,a.INTERNAL,"no keyword is provided"))},getAllTVShows:function(e){return this.__getTVShow(e).then(function(e){return{entries:e.entries,totalCount:e.totalCount,pageSize:e.pageSize,pageNumber:e.pageNumber}})},getTVShowById:function(t,n){return t?(n=n||{},n.id=t,this.__getTVShow(n)):e.promise.reject(new i(r.VOD_CONTENT_SERVICE,a.INTERNAL,"no id is provided"))},getTVShowsByIds:function(t,n){return t&&e.util.isArray(t)?(n=n||{},n.id=t,this.__getTVShow(n).then(function(t){return{entries:e.util.isArray(t.entries)?t.entries:[t],totalCount:t.totalCount||1,pageSize:t.pageSize||1,pageNumber:t.pageNumber||1}})):e.promise.reject(new i(r.VOD_CONTENT_SERVICE,a.INTERNAL,"incorrect parameter type"))},getTVShowsByCategoryId:function(t,n){return t?(n=n||{},n.categoryId=t,this.__getTVShow(n).then(function(e){return{entries:e.entries,totalCount:e.totalCount,pageSize:e.pageSize,pageNumber:e.pageNumber}})):e.promise.reject(new i(r.VOD_CONTENT_SERVICE,a.INTERNAL,"no categoryId is provided"))},searchTVShows:function(t,n){return t?(n=n||{},n.showTVSeasons=!0,n.showEpisodes=!0,n.type="tvshow",n.key=t,l.vodSearchRequest(n).then(function(e){return{entries:e.entries,totalCount:e.totalCount,pageSize:e.pageSize,pageNumber:e.pageNumber}})):e.promise.reject(new i(r.VOD_CONTENT_SERVICE,a.INTERNAL,"no keyword is provided"))},getAllTVSeasons:function(e){return this.__getTVSeason(e).then(function(e){return{entries:e.entries,totalCount:e.totalCount,pageSize:e.pageSize,pageNumber:e.pageNumber}})},getTVSeasonById:function(t,n){return t?(n=n||{},n.id=t,this.__getTVSeason(n)):e.promise.reject(new i(r.VOD_CONTENT_SERVICE,a.INTERNAL,"no id is provided"))},getTVSeasonsByIds:function(t,n){return t&&e.util.isArray(t)?(n=n||{},n.id=t,this.__getTVSeason(n).then(function(t){return{entries:e.util.isArray(t.entries)?t.entries:[t],totalCount:t.totalCount||1,pageSize:t.pageSize||1,pageNumber:t.pageNumber||1}})):e.promise.reject(new i(r.VOD_CONTENT_SERVICE,a.INTERNAL,"incorrect parameter type"))},getTVSeasonsByTVShowId:function(t,n){return t?(n=n||{},n.showId=t,this.__getTVSeason(n).then(function(e){return{entries:e.entries,totalCount:e.totalCount,pageSize:e.pageSize,pageNumber:e.pageNumber}})):e.promise.reject(new i(r.VOD_CONTENT_SERVICE,a.INTERNAL,"no showId is provided"))},searchTVSeasons:function(t,n){return t?(n=n||{},n.type="tvseason",n.key=t,l.vodSearchRequest(n).then(function(e){return{entries:e.entries,totalCount:e.totalCount,pageSize:e.pageSize,pageNumber:e.pageNumber}})):e.promise.reject(new i(r.VOD_CONTENT_SERVICE,a.INTERNAL,"no keyword is provided"))},getAllEpisodes:function(e){return this.__getEpisode(e).then(function(e){return{entries:e.entries,totalCount:e.totalCount,pageSize:e.pageSize,pageNumber:e.pageNumber}})},getEpisodeById:function(t,n){return t?(n=n||{},n.id=t,this.__getEpisode(n)):e.promise.reject(new i(r.VOD_CONTENT_SERVICE,a.INTERNAL,"no id is provided"))},getEpisodesByTVShowId:function(t,n){return t?(n=n||{},n.showId=t,this.__getEpisode(n).then(function(e){return{entries:e.entries,totalCount:e.totalCount,pageSize:e.pageSize,pageNumber:e.pageNumber}})):e.promise.reject(new i(r.VOD_CONTENT_SERVICE,a.INTERNAL,"no showId is provided"))},getEpisodesByTVSeasonId:function(t,n){return t?(n=n||{},n.seasonId=t,this.__getEpisode(n).then(function(e){return{entries:e.entries,totalCount:e.totalCount,pageSize:e.pageSize,pageNumber:e.pageNumber}})):e.promise.reject(new i(r.VOD_CONTENT_SERVICE,a.INTERNAL,"no seasonId is provided"))},searchEpisodes:function(t,n){return t?(n=n||{},n.type="episode",n.key=t,l.vodSearchRequest(n).then(function(e){return{entries:e.entries,totalCount:e.totalCount,pageSize:e.pageSize,pageNumber:e.pageNumber}})):e.promise.reject(new i(r.VOD_CONTENT_SERVICE,a.INTERNAL,"no keyword is provided"))}})}),define("xdk-ax/data/interface/Datasource",["xdk-base/Interface"],function(e){"use strict";var t=e.create("Datasource",{getTotalCount:[],setTotalCount:["count"],hasData:["from","to"],getRange:["from","to"],setDataLoader:["loaderFn"],setDataUpdater:["updaterFn"],fetch:["from","size"],remove:["from","to"],insert:["newData","index"],reset:[]});return t.ACTION={INSERT:"insert",REMOVE:"remove",FETCH:"fetch",RESET:"reset"},t}),define("xdk-ax/data/Datasource",["xdk-base/class","xdk-base/EventDispatcher","xdk-base/core","xdk-base/util","xdk-base/promise","xdk-base/console","xdk-base/exception","xdk-ax/data/interface/Datasource"],function(e,t,i,n,s,r,a,o){"use strict";return e.create(t,[o],{EVT_UPDATED:"ui:ds:updated"},{__minFetchSize:1,_totalCount:-1,_dataLoader:null,_dataUpdater:null,_data:[],__dataObjArray:[],getTotalCount:function(){return this._totalCount},setTotalCount:function(e){var t=this._totalCount;return this._totalCount=e,-1===t?void(this._data=new Array(e)):t<e?void(this._data=this._data.concat(new Array(e-t))):this._data.length>e?void this._data.splice(e,this._data.length-e):void 0},setMinFetchSize:function(e){this.__minFetchSize=e},getMinFetchSize:function(){return this.__minFetchSize},hasData:function(e,t){return(e<0||e>=this.getTotalCount()||t<0||t>this.getTotalCount())&&!1,this.__hasFetchedData(e,t)},getRange:function(e,t){var r,a,o=this.getTotalCount(),l=this,c=[];if(n.isUndefined(t)&&(t=this.getTotalCount()),e<0||e>=t||e>0&&-1===t)return s.reject(i.createException("IncorrectParam",'Incorrect "from" or "to" parameter!'));if(-1!==o&&e>=o)return s.reject(i.createException("IncorrectState","No more data available!"));if(c=this.__checkFetchedData(e,t),0===c.length)return s.resolve(this.__getFetchedData(e,t));for(a=s.resolve(),r=0;r<c.length;r++)a=a.then(n.bind(function(e,t){var i,n;return l.hasData(e,t)?s.resolve():(i=e,n=t-i,l._load(i,n))},null,c[r].from,c[r].to));return a.then(function(){return l.__getFetchedData(e,t)})},setDataLoader:function(e){this._dataLoader=e},setDataUpdater:function(e){this._dataUpdater=e},fetch:function(e,t){return this._load(e,t).then(n.bind(function(t){this.dispatchEvent(this.constructor.EVT_UPDATED,{action:o.ACTION.FETCH,newData:t,index:e,length:t.length})},this))},_load:function(e,t){var i,s=t,r=this.getTotalCount();return e=e||0,t=t||0,t<this.__minFetchSize&&(t=this.__minFetchSize,-1!==r&&e+t>r&&(t=r-e),this.hasData(e+s,e+t)&&(t=s)),i={from:e,size:t},this._dataLoader(e,t).then(n.bind(this._processFetchedData,this,i))},_processFetchedData:function(e,t){var s=t.data,r=t.total,o=e.from,l=o;if(n.isNumber(r)&&this.setTotalCount(r),n.isNumber(t.from)&&(l=t.from),!s)throw i.createException(a.ILLEGAL_ARGUMENT,"Data is missing");return n.isArray(s)||(s=[s]),this.__setFetchedData(l,s),this.__getFetchedData(o,o+e.size)},remove:function(e,t){return n.isNumber(e)?(n.isNumber(t)||(t=e+1),n.isFunction(this._dataUpdater)?this._dataUpdater(o.ACTION.REMOVE,{from:e,to:t}).then(n.bind(function(e){if(!e)return s.reject(i.createException("Datasource: invalid data update via remove: no removed data received"));var t=e.from,r=e.to,a=[];n.isNumber(t)&&(a=this.__removeFetchedData(t,r)),this.dispatchEvent(this.constructor.EVT_UPDATED,{action:o.ACTION.REMOVE,index:t,length:a.length,removedData:a})},this)):s.reject(i.createException("Datasource: invalid data updater function."))):s.reject(i.createException("Invalid param"))},insert:function(e,t){return n.isArray(e)||(e=[e]),n.isNumber(t)||(t=this.getTotalCount()),n.isFunction(this._dataUpdater)?this._dataUpdater(o.ACTION.INSERT,{newData:e,from:t}).then(n.bind(function(e){if(!e)throw i.createException("Datasource: invalid data update via insert: no new data received");var t=e.newData,s=e.index;n.isArray(t)&&this.__insertFetchedData(s,t),this.dispatchEvent(this.constructor.EVT_UPDATED,{action:o.ACTION.INSERT,index:s,length:t.length,newData:t})},this)):s.reject(i.createException("Datasource: invalid data updater function."))},getFetchedCount:function(){return this._data.length},getFetchedData:function(e){return e<0||e>=this._data.length?null:this._data[e]},getAllFetchedData:function(){return this._data},reset:function(){this.__minFetchSize=1,this._data.length=0,this.__dataObjArray.length=0,this._totalCount=-1,this.dispatchEvent(this.constructor.EVT_UPDATED,{action:o.ACTION.RESET})},__removeFetchedData:function(e,t){var i,s=[],a=e,o=e,l=!1,c=!1,d=this.__dataObjArray.length;return n.isNumber(o)&&t>0&&(o=t-1),i=o-a+1,n.each(this.__dataObjArray,n.bind(function(e,t){return c&&o<e.start||o<e.start&&a<e.start?(e.start-=i,e.end-=i,t<d-1?e.next-=i:e.next=-1,l?void(t>0?e.prev-=i:e.prev=-1):void(l=!0)):a>e.end?void(e.next>o&&(e.next-=i)):a>=e.start&&a<=e.end&&o>=e.start&&o<=e.end?(e.end-=i,c=!0,void r.debug("remove dataset completely inside the cur data set "+a)):a<=e.start&&e.end<=o?(s.push(t),t>0?this.__dataObjArray[t-1].next=e.next-i:this.__dataObjArray[t].next=-1,t<d-1?this.__dataObjArray[t+1].prev=e.prev:this.__dataObjArray[t].prev=-1,c=!0,void r.debug("remove dataset completely cover the cur data set "+a)):a<e.start&&e.start<=o?(e.start=a,e.end-=i,t>0?this.__dataObjArray[t-1].next=e.start:e.prev=-1,t<d-1?this.__dataObjArray[t+1].prev=e.end:e.next=-1,c=!0,t>0&&-1!==e.prev&&e.prev+1===e.start&&(this.__dataObjArray[t-1].end=e.end,this.__dataObjArray[t-1].next=e.next,s.push(t)),void r.debug("remove dataset overlap with the cur data set startIndex "+a)):a>e.start&&e.end<=o?(e.end=a-1,t<d-1?this.__dataObjArray[t+1].prev=e.end:this.__dataObjArray[t].prev=-1,c=!0,void r.debug("remove dataset overlap with the cur data set endIndex"+a)):void 0},this)),n.each(s,n.bind(function(e,t){this.__dataObjArray.splice(e-t,1)},this)),this._totalCount-=i,this._data.splice(a,i)},__insertFetchedData:function(e,t){var i,s=-1,a=e,o=t.length,l=a+o-1,c=!1,d=!1,u=this.__dataObjArray.length;return 0===this.__dataObjArray.length?(i={prev:-1,next:-1,start:a,end:l},this.__dataObjArray.push(i),this._totalCount+=o,this._data.splice.apply(this._data,[i.start,0].concat(t)),this):(n.each(this.__dataObjArray,n.bind(function(e,t){return d?(e.start+=o,e.end+=o,t<u-1?e.next+=o:e.next=-1,c?void(t>0?e.prev+=o:e.prev=-1):void(c=!0)):a<e.start&&a>e.prev?(s=t,d=!0,i={prev:e.prev,next:e.start+o,start:a,end:l},e.prev=l,e.end+=o,void(e.start+=o)):a>e.end&&(e.next>l||-1===e.next)?(s=t+1,d=!0,i={prev:e.end,next:-1!==e.next?e.next+o:-1,start:a,end:l},e.next=a,void(t<this.__dataObjArray.length-1&&(this.__dataObjArray[t+1].prev=l))):a>=e.start&&a<=e.end?(e.end+=o,d=!0,void r.debug("insert dataset completely inside the cur data set "+a)):void 0},this)),s>-1&&i&&this.__dataObjArray.splice(s,0,i),this._totalCount+=o,this._data.splice.apply(this._data,[a,0].concat(t)),this)},__setFetchedData:function(e,t){var i,s,a={start:e,prev:-1,next:-1,end:e+t.length-1},o=!1,l=0;return-1!==this.getTotalCount()&&a.end>=this.getTotalCount()?(r.warn(e+t.length+"the size is over the total available size"+this.getTotalCount()),this):0===this.__dataObjArray.length?(this.__dataObjArray.push(a),this._data.splice.apply(this._data,[a.start,t.length].concat(t)),this):(n.each(this.__dataObjArray,n.bind(function(e,c){if(s=this.__dataObjArray.length,!(c!==s-1&&a.start>e.end+1)){if((-1===e.prev||e.prev<a.start)&&a.end+1<e.start)return l=c,a.next=e.start,a.prev=e.prev,o=!0,r.debug("complete before the data set with startIndex "+e.start),n.breaker;if((-1===e.next||e.next>a.end)&&a.start>e.end+1)return l=c+1,a.prev=e.end,a.next=e.next,o=!0,r.debug("complete after the data set with startIndex "+e.start),n.breaker;if(a.start>e.prev&&(-1===e.next||a.end<e.next))return a.start<e.start&&(e.start=a.start,c>0&&(this.__dataObjArray[c-1].next=e.start)),a.end>e.end&&(e.end=a.end,c<s-1&&(e.end+1===this.__dataObjArray[c+1].start?(e.end=this.__dataObjArray[c+1].end,e.next=this.__dataObjArray[c+1].next,this.__dataObjArray.splice(c+1,1)):this.__dataObjArray[c+1].prev=e.end)),o=!1,r.debug("overlapped and update the data set"+e.start),this._data.splice.apply(this._data,[a.start,t.length].concat(t)),n.breaker;for(i=e,l=c;c<s&&a.end>i.start;)a.next=i.next,a.prev=i.prev,i.start<a.start&&(a.start=i.start),i.end>a.end&&(a.end=i.end),this.__dataObjArray.splice(c,1),s=this.__dataObjArray.length,i=this.__dataObjArray[c];return o=!0,r.debug("overlap with multiple range of dataset"),n.breaker}},this)),o&&(this._data.splice.apply(this._data,[e,t.length].concat(t)),this.__dataObjArray.splice(l,0,a),s=this.__dataObjArray.length,l<s-1?this.__dataObjArray[l+1].prev=a.end:a.next=-1,l>0?this.__dataObjArray[l-1].next=a.start:a.prev=-1),this)},__getFetchedData:function(e,t){return n.isUndefined(t)&&(t=e+1),this._data.slice(e,t)},__checkFetchedData:function(e,t){var i=[],s=e,r=t,a=!1;return n.each(this.__dataObjArray,n.bind(function(e){return r<e.start?n.breaker:s<e.start?(i.push({from:s,to:e.start}),r>e.end+1?void(s=e.end+1):(a=!0,n.breaker)):s<=e.end?r>e.end+1?void(s=e.end+1):(a=!0,n.breaker):void 0},this)),a||i.push({from:s,to:r}),i},__hasFetchedData:function(e,t){var i=!1;return n.each(this.__dataObjArray,n.bind(function(s){if(e>=s.start&&e<=s.end)return(n.isUndefined(t)||t-1<=s.end)&&(i=!0),r.info("[XDK] Datasource contains part of the target range of data."),n.breaker},this)),i}})}),define("xdk-ax/data/LocalDatasource",["xdk-base/class","xdk-base/core","xdk-base/promise","xdk-ax/data/Datasource","xdk-ax/data/interface/Datasource"],function(e,t,i,n,s){"use strict";return e.create(n,{},{init:function(){var e=this;this.setDataUpdater(function(n,r){var a=i.defer();switch(n){case s.ACTION.REMOVE:!function(i,n){var s=e.getTotalCount();n=Math.min(n,s),i>=n?a.reject(t.createException("Trying to remove self more local data then locally have")):-1===s?a.reject(t.createException("ds incorrect total count","Total Item should be set before insert the data")):a.resolve({from:i,to:n})}(r.from,r.to);break;case s.ACTION.INSERT:!function(i,n){if(-1===e.getTotalCount())return void a.reject(t.createException("ds incorrect total count","Total Item should be set before insert the data"));a.resolve({newData:i,index:n})}(r.newData,r.from)}return a.promise})}})}),define("tve/model/Asset",["xdk-base/class","tve/model/ImmutableModel"],function(e,t){return e.create(t,{defaults:{id:null,title:null,description:null,geoLock:null,publishedDate:null,availableDate:null,metadata:{},credits:{},categories:[],parentalRatings:[],images:[],videos:[]}},{})}),define("tve/model/TVShow",["xdk-base/class","tve/model/Asset","xdk-base/util"],function(e,t,i){return e.create(t,{defaults:i.extend(i.clone(t.defaults),{episodeIds:[],seasonIds:[]},!0)},{})}),define("storm/helper/util",["xdk-ax/data/LocalDatasource","xdk-base/util","xdk-base/config","xdk-base/console","xdk-base/promise","xdk-base/device","xdk-base/ajax","tvedemo/helper/dialogHelper","xdk-ax/focusManager","tve/TVEError","tve/model/Asset","tve/model/TVShow","storm/mgr/sLanguageManager","tvedemo/helper/sMoment","lib/moment"],function(e,t,i,n,s,r,a,o,l,c,d,u,h,_,g){"use strict";function f(e,t){try{var i=-1!==e.indexOf(".")?e.split("."):e.split("/"),n=t.split(":");return i[2].length<i[0].length?new Date(i[0],i[1]-1,i[2],n[0],n[1]):new Date(i[2],i[1]-1,i[0],n[0],n[1])}catch(e){throw new c(c.FACILITY.GENERAL,c.ERROR.INVALID,"parseSkyDateTimeToDate failed: "+e)}}var p=null;return{isOnAir:function(e){return amd.require("tve/sServiceHolder").getDateTimeService().getServerDateTime().then(function(t){var i=t.getTime(),n=h.getString("ui.parsing.onAirStartDate")+h.getString("ui.parsing.epgEventTime"),s=_(e.start_date+e.start_time,n),r=_(e.end_date+e.end_time,n);return s.valueOf()<i&&i<r.valueOf()})},getSanitizedValue:function(e,t){return function e(t,i){return t&&i&&i.length?e(t[i.shift()],i):t}(e,(t||"").replace(/\[/g,".").replace(/\]/g,"").split("."))},probePromise:function(e){e.then(function(e){n.log("OK"),n.log(e)},function(e){n.log("KO"),n.log(e)})},parseSkyDateTimeToDate:function(e,t){return f(e,t)},parseAirDate:function(e){var t=new Date(e),i=t.getDate()+"",n=t.getMonth()+1+"";return 1==i.length&&(i="0"+i),1==n.length&&(n="0"+n),i+"."+n+".  "},sanitiseEpgEvents:function(e,i,n){var s=h.getString("Epg.noDataFoundMessage"),r=_(1e3*Math.floor(e/1e3)),a=_(1e3*Math.ceil(i/1e3)),o=function(e,t){return{id:0,title:s||"&nbsp;",length:g.duration(t.diff(e)).asMinutes(),startDate:e.format(h.getString("ui.parsing.epgEventDate")),startTime:e.format(h.getString("ui.parsing.epgEventTime")),endDate:t.format(h.getString("ui.parsing.epgEventDate")),endTime:t.format(h.getString("ui.parsing.epgEventTime"))}};if(0===n.length)n.push(o(r,a));else{for(var l,c=0,d=r;;){var u=n[c];if(t.isUndefined(u))break;l={start:_(f(u.startDate,u.startTime)),end:_(f(u.endDate,u.endTime))},d.diff(l.start)<0&&(n.splice(c,0,o(d,l.start)),c++),d=l.end,c++}d.diff(a)<0&&n.push(o(d,a))}return n},tokenReplacer:function(e,t){var i=/{([^:}]+)(?::([e0])?(\d+)?([dis]))?}/g;return e.replace(i,t)},versionNotCompatible:function(e,t){try{for(var s=t[i.get("environment")],r=e.split("."),a=s.minimum.split("."),o=0;o<a.length;o++){var l=Number(r[o]),c=Number(a[o]);if(l<c)return n.warn(e+" looks older than the required minimum "+s.minimum),-1===s.exceptions.indexOf(e)||(n.warn("... but it's on the exceptions list :)"),!1);if(l>c)return!1}return!1}catch(e){return n.warn("Exception trying to check version number: "+e),!0}},arrayToDs:function(t){var i=new e;return i.setDataLoader(function(){var e=s.defer();return e.resolve({data:t,total:t.length}),e.promise}),i},getRootFolder:function(e){var t,i;if("workstation"===r.platform)t=window.location.href.split("/index.html")[0];else if("samsung"===r.platform){t=function(e){if(r.id&&r.id.getFirmwareYear()>=2015)return window.location.href.split("/index.html")[0];e=e||"";var t=window.location.href.substring(0,location.href.lastIndexOf("/")+1);return-1===decodeURIComponent(window.location.toString()).indexOf("localhost")?-1!==decodeURIComponent(window.location.toString()).indexOf("file://C")?decodeURIComponent(t).split("file://")[1].replace("C/","C:/")+e:decodeURIComponent(t).split("file://")[1]+e:-1!==decodeURIComponent(window.location.toString()).indexOf("C:")?"/"+decodeURIComponent(t).split("file://localhost/C:\\")[1].replace(/\\/g,"/")+e:"/"+decodeURIComponent(t).split("file://localhost/")[1]+e}()}else{if("tizen"===r.platform)return i=s.defer(),tizen.filesystem.resolve("wgt-package"+e,function(e){i.resolve(e.toURI())},function(e){n.log("file.toURI() error: "+e.message),i.resolve("")},"r"),i.promise;t=window.location.href.split("/index.html")[0]}return s.resolve(t+e)},isFocusLost:function(){var e=l.getCurFocus();return!(e&&e.getRoot()&&e.getRoot().isInDOMTree())},preloadImage:function(e){(new Image).src=e},preloadImages:function(e){for(var t=[],i=0,n=e.length;i<n;i++)t[i]=new Image,t[i].src=e[i]},getTransitionEndEventName:function(){return null!==p?p:p="ontransitionend"in window?"transitionend":"onwebkittransitionend"in window?"webkitTransitionEnd":void 0},formatTime:function(e){e=~~e%356400;var t=~~(e/3600),i=~~(e%3600/60),n=e%60;return(t<10?"0":"")+t+":"+(i<10?"0":"")+i+":"+(n<10?"0":"")+n},allPromises:function(e,i){var n=s.defer(),r=[],a=e.length;if(!a)return n.resolve([]),n.promise;for(var o=function(e,s){r[s]=e,--a||(i&&(r=t.filter(r,function(e){return void 0!==e&&null!==e})),n.resolve(r))},l=0;l<e.length;l++)!function(t){e[l].then(function(e){o(e,t)},function(e){o(new Error(e),t)})}(l);return n.promise},isoDate:function(e){var t=new Date(e);if(isNaN(t)){var i,n,s=/^(\d{4}\-\d\d\-\d\d([tT][\d:\.]*)?)([zZ]|([+\-])(\d\d):(\d\d))?$/,r=s.exec(e)||[];if(r[1]){i=r[1].split(/\D/);for(var a=0,o=i.length;a<o;a++)i[a]=parseInt(i[a],10)||0;return i[1]-=1,(i=new Date(Date.UTC.apply(Date,i)),i.getDate())?(r[5]&&(n=60*parseInt(r[5],10),r[6]&&(n+=parseInt(r[6],10)),"+"===r[4]&&(n*=-1),n&&i.setUTCMinutes(i.getUTCMinutes()+n)),i):NaN}return NaN}return t},repeater:function(e,t){for(var i=[],n=0;n<t;n++)i.push(e(n));return i},traceObject:function(e,t,i,n,s){},transcodeDateString:function(e,t,i){return _(e,t).format(i)},areAssetIdsEqual:function(e,t){var i=parseInt(e,10),n=parseInt(t,10);return!isNaN(i)&&i===n},debounce:function(e,t,i){var n;return function(){var s=this,r=arguments;clearTimeout(n),n=setTimeout(function(){n=null,i||e.apply(s,r)},t),i&&!n&&e.apply(s,r)}}}});var CryptoJS=CryptoJS||function(e,t){var i={},n=i.lib={},s=function(){},r=n.Base={extend:function(e){s.prototype=this;var t=new s;return e&&t.mixIn(e),t.hasOwnProperty("init")||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},a=n.WordArray=r.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=void 0!=t?t:4*e.length},toString:function(e){return(e||l).stringify(this)},concat:function(e){var t=this.words,i=e.words,n=this.sigBytes;if(e=e.sigBytes,this.clamp(),n%4)for(var s=0;s<e;s++)t[n+s>>>2]|=(i[s>>>2]>>>24-s%4*8&255)<<24-(n+s)%4*8;else if(65535<i.length)for(s=0;s<e;s+=4)t[n+s>>>2]=i[s>>>2];else t.push.apply(t,i);return this.sigBytes+=e,this},clamp:function(){var t=this.words,i=this.sigBytes;t[i>>>2]&=4294967295<<32-i%4*8,t.length=e.ceil(i/4)},clone:function(){var e=r.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){for(var i=[],n=0;n<t;n+=4)i.push(4294967296*e.random()|0);return new a.init(i,t)}}),o=i.enc={},l=o.Hex={stringify:function(e){var t=e.words;e=e.sigBytes;for(var i=[],n=0;n<e;n++){var s=t[n>>>2]>>>24-n%4*8&255;i.push((s>>>4).toString(16)),i.push((15&s).toString(16))}return i.join("")},parse:function(e){for(var t=e.length,i=[],n=0;n<t;n+=2)i[n>>>3]|=parseInt(e.substr(n,2),16)<<24-n%8*4;return new a.init(i,t/2)}},c=o.Latin1={stringify:function(e){var t=e.words;e=e.sigBytes;for(var i=[],n=0;n<e;n++)i.push(String.fromCharCode(t[n>>>2]>>>24-n%4*8&255));return i.join("")},parse:function(e){for(var t=e.length,i=[],n=0;n<t;n++)i[n>>>2]|=(255&e.charCodeAt(n))<<24-n%4*8;return new a.init(i,t)}},d=o.Utf8={stringify:function(e){try{return decodeURIComponent(escape(c.stringify(e)))}catch(e){throw Error("Malformed UTF-8 data")}},parse:function(e){return c.parse(unescape(encodeURIComponent(e)))}},u=n.BufferedBlockAlgorithm=r.extend({reset:function(){this._data=new a.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=d.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var i=this._data,n=i.words,s=i.sigBytes,r=this.blockSize,o=s/(4*r),o=t?e.ceil(o):e.max((0|o)-this._minBufferSize,0);if(t=o*r,s=e.min(4*t,s),t){for(var l=0;l<t;l+=r)this._doProcessBlock(n,l);l=n.splice(0,t),i.sigBytes-=s}return new a.init(l,s)},clone:function(){var e=r.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});n.Hasher=u.extend({cfg:r.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){u.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,i){return new e.init(i).finalize(t)}},_createHmacHelper:function(e){return function(t,i){return new h.HMAC.init(e,i).finalize(t)}}});var h=i.algo={};return i}(Math);!function(){var e=CryptoJS,t=e.lib.WordArray;e.enc.Base64={stringify:function(e){var t=e.words,i=e.sigBytes,n=this._map;e.clamp(),e=[];for(var s=0;s<i;s+=3)for(var r=(t[s>>>2]>>>24-s%4*8&255)<<16|(t[s+1>>>2]>>>24-(s+1)%4*8&255)<<8|t[s+2>>>2]>>>24-(s+2)%4*8&255,a=0;4>a&&s+.75*a<i;a++)e.push(n.charAt(r>>>6*(3-a)&63));if(t=n.charAt(64))for(;e.length%4;)e.push(t);return e.join("")},parse:function(e){var i=e.length,n=this._map,s=n.charAt(64);s&&-1!=(s=e.indexOf(s))&&(i=s);for(var s=[],r=0,a=0;a<i;a++)if(a%4){var o=n.indexOf(e.charAt(a-1))<<a%4*2,l=n.indexOf(e.charAt(a))>>>6-a%4*2;s[r>>>2]|=(o|l)<<24-r%4*8,r++}return t.create(s,r)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),function(e){function t(e,t,i,n,s,r,a){return((e=e+(t&i|~t&n)+s+a)<<r|e>>>32-r)+t}function i(e,t,i,n,s,r,a){return((e=e+(t&n|i&~n)+s+a)<<r|e>>>32-r)+t}function n(e,t,i,n,s,r,a){return((e=e+(t^i^n)+s+a)<<r|e>>>32-r)+t}function s(e,t,i,n,s,r,a){return((e=e+(i^(t|~n))+s+a)<<r|e>>>32-r)+t}for(var r=CryptoJS,a=r.lib,o=a.WordArray,l=a.Hasher,a=r.algo,c=[],d=0;64>d;d++)c[d]=4294967296*e.abs(e.sin(d+1))|0;a=a.MD5=l.extend({_doReset:function(){this._hash=new o.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,r){for(var a=0;16>a;a++){var o=r+a,l=e[o];e[o]=16711935&(l<<8|l>>>24)|4278255360&(l<<24|l>>>8)}var a=this._hash.words,o=e[r+0],l=e[r+1],d=e[r+2],u=e[r+3],h=e[r+4],_=e[r+5],g=e[r+6],f=e[r+7],p=e[r+8],m=e[r+9],v=e[r+10],b=e[r+11],S=e[r+12],y=e[r+13],E=e[r+14],k=e[r+15],C=a[0],T=a[1],x=a[2],I=a[3],C=t(C,T,x,I,o,7,c[0]),I=t(I,C,T,x,l,12,c[1]),x=t(x,I,C,T,d,17,c[2]),T=t(T,x,I,C,u,22,c[3]),C=t(C,T,x,I,h,7,c[4]),I=t(I,C,T,x,_,12,c[5]),x=t(x,I,C,T,g,17,c[6]),T=t(T,x,I,C,f,22,c[7]),C=t(C,T,x,I,p,7,c[8]),I=t(I,C,T,x,m,12,c[9]),x=t(x,I,C,T,v,17,c[10]),T=t(T,x,I,C,b,22,c[11]),C=t(C,T,x,I,S,7,c[12]),I=t(I,C,T,x,y,12,c[13]),x=t(x,I,C,T,E,17,c[14]),T=t(T,x,I,C,k,22,c[15]),C=i(C,T,x,I,l,5,c[16]),I=i(I,C,T,x,g,9,c[17]),x=i(x,I,C,T,b,14,c[18]),T=i(T,x,I,C,o,20,c[19]),C=i(C,T,x,I,_,5,c[20]),I=i(I,C,T,x,v,9,c[21]),x=i(x,I,C,T,k,14,c[22]),T=i(T,x,I,C,h,20,c[23]),C=i(C,T,x,I,m,5,c[24]),I=i(I,C,T,x,E,9,c[25]),x=i(x,I,C,T,u,14,c[26]),T=i(T,x,I,C,p,20,c[27]),C=i(C,T,x,I,y,5,c[28]),I=i(I,C,T,x,d,9,c[29]),x=i(x,I,C,T,f,14,c[30]),T=i(T,x,I,C,S,20,c[31]),C=n(C,T,x,I,_,4,c[32]),I=n(I,C,T,x,p,11,c[33]),x=n(x,I,C,T,b,16,c[34]),T=n(T,x,I,C,E,23,c[35]),C=n(C,T,x,I,l,4,c[36]),I=n(I,C,T,x,h,11,c[37]),x=n(x,I,C,T,f,16,c[38]),T=n(T,x,I,C,v,23,c[39]),C=n(C,T,x,I,y,4,c[40]),I=n(I,C,T,x,o,11,c[41]),x=n(x,I,C,T,u,16,c[42]),T=n(T,x,I,C,g,23,c[43]),C=n(C,T,x,I,m,4,c[44]),I=n(I,C,T,x,S,11,c[45]),x=n(x,I,C,T,k,16,c[46]),T=n(T,x,I,C,d,23,c[47]),C=s(C,T,x,I,o,6,c[48]),I=s(I,C,T,x,f,10,c[49]),x=s(x,I,C,T,E,15,c[50]),T=s(T,x,I,C,_,21,c[51]),C=s(C,T,x,I,S,6,c[52]),I=s(I,C,T,x,u,10,c[53]),x=s(x,I,C,T,v,15,c[54]),T=s(T,x,I,C,l,21,c[55]),C=s(C,T,x,I,p,6,c[56]),I=s(I,C,T,x,k,10,c[57]),x=s(x,I,C,T,g,15,c[58]),T=s(T,x,I,C,y,21,c[59]),C=s(C,T,x,I,h,6,c[60]),I=s(I,C,T,x,b,10,c[61]),x=s(x,I,C,T,d,15,c[62]),T=s(T,x,I,C,m,21,c[63]);a[0]=a[0]+C|0,a[1]=a[1]+T|0,a[2]=a[2]+x|0,a[3]=a[3]+I|0},_doFinalize:function(){var t=this._data,i=t.words,n=8*this._nDataBytes,s=8*t.sigBytes;i[s>>>5]|=128<<24-s%32;var r=e.floor(n/4294967296);for(i[15+(s+64>>>9<<4)]=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8),i[14+(s+64>>>9<<4)]=16711935&(n<<8|n>>>24)|4278255360&(n<<24|n>>>8),t.sigBytes=4*(i.length+1),this._process(),t=this._hash,i=t.words,n=0;4>n;n++)s=i[n],i[n]=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8);return t},clone:function(){var e=l.clone.call(this);return e._hash=this._hash.clone(),e}}),r.MD5=l._createHelper(a),r.HmacMD5=l._createHmacHelper(a)}(Math),function(){var e=CryptoJS,t=e.lib,i=t.Base,n=t.WordArray,t=e.algo,s=t.EvpKDF=i.extend({cfg:i.extend({keySize:4,hasher:t.MD5,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var i=this.cfg,s=i.hasher.create(),r=n.create(),a=r.words,o=i.keySize,i=i.iterations;a.length<o;){l&&s.update(l);var l=s.update(e).finalize(t);s.reset();for(var c=1;c<i;c++)l=s.finalize(l),s.reset();r.concat(l)}return r.sigBytes=4*o,r}});e.EvpKDF=function(e,t,i){return s.create(i).compute(e,t)}}(),CryptoJS.lib.Cipher||function(e){var t=CryptoJS,i=t.lib,n=i.Base,s=i.WordArray,r=i.BufferedBlockAlgorithm,a=t.enc.Base64,o=t.algo.EvpKDF,l=i.Cipher=r.extend({cfg:n.extend(),createEncryptor:function(e,t){return this.create(this._ENC_XFORM_MODE,e,t)},createDecryptor:function(e,t){return this.create(this._DEC_XFORM_MODE,e,t)},init:function(e,t,i){this.cfg=this.cfg.extend(i),this._xformMode=e,this._key=t,this.reset()},reset:function(){r.reset.call(this),this._doReset()},process:function(e){return this._append(e),this._process()},finalize:function(e){return e&&this._append(e),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(e){return{encrypt:function(t,i,n){return("string"==typeof i?g:_).encrypt(e,t,i,n)},decrypt:function(t,i,n){return("string"==typeof i?g:_).decrypt(e,t,i,n)}}}});i.StreamCipher=l.extend({_doFinalize:function(){return this._process(!0)},blockSize:1});var c=t.mode={},d=function(e,t,i){var n=this._iv;n?this._iv=void 0:n=this._prevBlock;for(var s=0;s<i;s++)e[t+s]^=n[s]},u=(i.BlockCipherMode=n.extend({createEncryptor:function(e,t){return this.Encryptor.create(e,t)},createDecryptor:function(e,t){return this.Decryptor.create(e,t)},init:function(e,t){this._cipher=e,this._iv=t}})).extend();u.Encryptor=u.extend({processBlock:function(e,t){var i=this._cipher,n=i.blockSize;d.call(this,e,t,n),i.encryptBlock(e,t),this._prevBlock=e.slice(t,t+n)}}),u.Decryptor=u.extend({processBlock:function(e,t){var i=this._cipher,n=i.blockSize,s=e.slice(t,t+n);i.decryptBlock(e,t),d.call(this,e,t,n),this._prevBlock=s}}),c=c.CBC=u,u=(t.pad={}).Pkcs7={pad:function(e,t){for(var i=4*t,i=i-e.sigBytes%i,n=i<<24|i<<16|i<<8|i,r=[],a=0;a<i;a+=4)r.push(n);i=s.create(r,i),e.concat(i)},unpad:function(e){e.sigBytes-=255&e.words[e.sigBytes-1>>>2]}},i.BlockCipher=l.extend({cfg:l.cfg.extend({mode:c,padding:u}),reset:function(){l.reset.call(this);var e=this.cfg,t=e.iv,e=e.mode;if(this._xformMode==this._ENC_XFORM_MODE)var i=e.createEncryptor;else i=e.createDecryptor,this._minBufferSize=1;this._mode=i.call(e,this,t&&t.words)},_doProcessBlock:function(e,t){this._mode.processBlock(e,t)},_doFinalize:function(){var e=this.cfg.padding;if(this._xformMode==this._ENC_XFORM_MODE){e.pad(this._data,this.blockSize);var t=this._process(!0)}else t=this._process(!0),e.unpad(t);return t},blockSize:4});var h=i.CipherParams=n.extend({init:function(e){this.mixIn(e)},toString:function(e){return(e||this.formatter).stringify(this)}}),c=(t.format={}).OpenSSL={stringify:function(e){var t=e.ciphertext;return e=e.salt,(e?s.create([1398893684,1701076831]).concat(e).concat(t):t).toString(a)},parse:function(e){e=a.parse(e);var t=e.words;if(1398893684==t[0]&&1701076831==t[1]){var i=s.create(t.slice(2,4));t.splice(0,4),e.sigBytes-=16}return h.create({ciphertext:e,salt:i})}},_=i.SerializableCipher=n.extend({cfg:n.extend({format:c}),encrypt:function(e,t,i,n){n=this.cfg.extend(n);var s=e.createEncryptor(i,n);return t=s.finalize(t),s=s.cfg,h.create({ciphertext:t,key:i,iv:s.iv,algorithm:e,mode:s.mode,padding:s.padding,blockSize:e.blockSize,formatter:n.format})},decrypt:function(e,t,i,n){return n=this.cfg.extend(n),t=this._parse(t,n.format),e.createDecryptor(i,n).finalize(t.ciphertext)},_parse:function(e,t){return"string"==typeof e?t.parse(e,this):e}}),t=(t.kdf={}).OpenSSL={execute:function(e,t,i,n){return n||(n=s.random(8)),e=o.create({keySize:t+i}).compute(e,n),i=s.create(e.words.slice(t),4*i),e.sigBytes=4*t,h.create({key:e,iv:i,salt:n})}},g=i.PasswordBasedCipher=_.extend({cfg:_.cfg.extend({kdf:t}),encrypt:function(e,t,i,n){return n=this.cfg.extend(n),i=n.kdf.execute(i,e.keySize,e.ivSize),n.iv=i.iv,e=_.encrypt.call(this,e,t,i.key,n),e.mixIn(i),e},decrypt:function(e,t,i,n){return n=this.cfg.extend(n),t=this._parse(t,n.format),i=n.kdf.execute(i,e.keySize,e.ivSize,t.salt),n.iv=i.iv,_.decrypt.call(this,e,t,i.key,n)}})}(),function(){for(var e=CryptoJS,t=e.lib.BlockCipher,i=e.algo,n=[],s=[],r=[],a=[],o=[],l=[],c=[],d=[],u=[],h=[],_=[],g=0;256>g;g++)_[g]=128>g?g<<1:g<<1^283;for(var f=0,p=0,g=0;256>g;g++){var m=p^p<<1^p<<2^p<<3^p<<4,m=m>>>8^255&m^99;n[f]=m,s[m]=f;var v=_[f],b=_[v],S=_[b],y=257*_[m]^16843008*m;r[f]=y<<24|y>>>8,a[f]=y<<16|y>>>16,o[f]=y<<8|y>>>24,l[f]=y,y=16843009*S^65537*b^257*v^16843008*f,c[m]=y<<24|y>>>8,d[m]=y<<16|y>>>16,u[m]=y<<8|y>>>24,h[m]=y,f?(f=v^_[_[_[S^v]]],p^=_[_[p]]):f=p=1}
var E=[0,1,2,4,8,16,32,64,128,27,54],i=i.AES=t.extend({_doReset:function(){for(var e=this._key,t=e.words,i=e.sigBytes/4,e=4*((this._nRounds=i+6)+1),s=this._keySchedule=[],r=0;r<e;r++)if(r<i)s[r]=t[r];else{var a=s[r-1];r%i?6<i&&4==r%i&&(a=n[a>>>24]<<24|n[a>>>16&255]<<16|n[a>>>8&255]<<8|n[255&a]):(a=a<<8|a>>>24,a=n[a>>>24]<<24|n[a>>>16&255]<<16|n[a>>>8&255]<<8|n[255&a],a^=E[r/i|0]<<24),s[r]=s[r-i]^a}for(t=this._invKeySchedule=[],i=0;i<e;i++)r=e-i,a=i%4?s[r]:s[r-4],t[i]=4>i||4>=r?a:c[n[a>>>24]]^d[n[a>>>16&255]]^u[n[a>>>8&255]]^h[n[255&a]]},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._keySchedule,r,a,o,l,n)},decryptBlock:function(e,t){var i=e[t+1];e[t+1]=e[t+3],e[t+3]=i,this._doCryptBlock(e,t,this._invKeySchedule,c,d,u,h,s),i=e[t+1],e[t+1]=e[t+3],e[t+3]=i},_doCryptBlock:function(e,t,i,n,s,r,a,o){for(var l=this._nRounds,c=e[t]^i[0],d=e[t+1]^i[1],u=e[t+2]^i[2],h=e[t+3]^i[3],_=4,g=1;g<l;g++)var f=n[c>>>24]^s[d>>>16&255]^r[u>>>8&255]^a[255&h]^i[_++],p=n[d>>>24]^s[u>>>16&255]^r[h>>>8&255]^a[255&c]^i[_++],m=n[u>>>24]^s[h>>>16&255]^r[c>>>8&255]^a[255&d]^i[_++],h=n[h>>>24]^s[c>>>16&255]^r[d>>>8&255]^a[255&u]^i[_++],c=f,d=p,u=m;f=(o[c>>>24]<<24|o[d>>>16&255]<<16|o[u>>>8&255]<<8|o[255&h])^i[_++],p=(o[d>>>24]<<24|o[u>>>16&255]<<16|o[h>>>8&255]<<8|o[255&c])^i[_++],m=(o[u>>>24]<<24|o[h>>>16&255]<<16|o[c>>>8&255]<<8|o[255&d])^i[_++],h=(o[h>>>24]<<24|o[c>>>16&255]<<16|o[d>>>8&255]<<8|o[255&u])^i[_++],e[t]=f,e[t+1]=p,e[t+2]=m,e[t+3]=h},keySize:8});e.AES=t._createHelper(i)}(),define("lib/aes",function(){});var CryptoJS=CryptoJS||function(e,t){var i={},n=i.lib={},s=function(){},r=n.Base={extend:function(e){s.prototype=this;var t=new s;return e&&t.mixIn(e),t.hasOwnProperty("init")||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},a=n.WordArray=r.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=void 0!=t?t:4*e.length},toString:function(e){return(e||l).stringify(this)},concat:function(e){var t=this.words,i=e.words,n=this.sigBytes;if(e=e.sigBytes,this.clamp(),n%4)for(var s=0;s<e;s++)t[n+s>>>2]|=(i[s>>>2]>>>24-s%4*8&255)<<24-(n+s)%4*8;else if(65535<i.length)for(s=0;s<e;s+=4)t[n+s>>>2]=i[s>>>2];else t.push.apply(t,i);return this.sigBytes+=e,this},clamp:function(){var t=this.words,i=this.sigBytes;t[i>>>2]&=4294967295<<32-i%4*8,t.length=e.ceil(i/4)},clone:function(){var e=r.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){for(var i=[],n=0;n<t;n+=4)i.push(4294967296*e.random()|0);return new a.init(i,t)}}),o=i.enc={},l=o.Hex={stringify:function(e){var t=e.words;e=e.sigBytes;for(var i=[],n=0;n<e;n++){var s=t[n>>>2]>>>24-n%4*8&255;i.push((s>>>4).toString(16)),i.push((15&s).toString(16))}return i.join("")},parse:function(e){for(var t=e.length,i=[],n=0;n<t;n+=2)i[n>>>3]|=parseInt(e.substr(n,2),16)<<24-n%8*4;return new a.init(i,t/2)}},c=o.Latin1={stringify:function(e){var t=e.words;e=e.sigBytes;for(var i=[],n=0;n<e;n++)i.push(String.fromCharCode(t[n>>>2]>>>24-n%4*8&255));return i.join("")},parse:function(e){for(var t=e.length,i=[],n=0;n<t;n++)i[n>>>2]|=(255&e.charCodeAt(n))<<24-n%4*8;return new a.init(i,t)}},d=o.Utf8={stringify:function(e){try{return decodeURIComponent(escape(c.stringify(e)))}catch(e){throw Error("Malformed UTF-8 data")}},parse:function(e){return c.parse(unescape(encodeURIComponent(e)))}},u=n.BufferedBlockAlgorithm=r.extend({reset:function(){this._data=new a.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=d.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var i=this._data,n=i.words,s=i.sigBytes,r=this.blockSize,o=s/(4*r),o=t?e.ceil(o):e.max((0|o)-this._minBufferSize,0);if(t=o*r,s=e.min(4*t,s),t){for(var l=0;l<t;l+=r)this._doProcessBlock(n,l);l=n.splice(0,t),i.sigBytes-=s}return new a.init(l,s)},clone:function(){var e=r.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});n.Hasher=u.extend({cfg:r.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){u.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,i){return new e.init(i).finalize(t)}},_createHmacHelper:function(e){return function(t,i){return new h.HMAC.init(e,i).finalize(t)}}});var h=i.algo={};return i}(Math);!function(){var e=CryptoJS,t=e.lib,i=t.WordArray,n=t.Hasher,s=[],t=e.algo.SHA1=n.extend({_doReset:function(){this._hash=new i.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var i=this._hash.words,n=i[0],r=i[1],a=i[2],o=i[3],l=i[4],c=0;80>c;c++){if(16>c)s[c]=0|e[t+c];else{var d=s[c-3]^s[c-8]^s[c-14]^s[c-16];s[c]=d<<1|d>>>31}d=(n<<5|n>>>27)+l+s[c],d=20>c?d+(1518500249+(r&a|~r&o)):40>c?d+(1859775393+(r^a^o)):60>c?d+((r&a|r&o|a&o)-1894007588):d+((r^a^o)-899497514),l=o,o=a,a=r<<30|r>>>2,r=n,n=d}i[0]=i[0]+n|0,i[1]=i[1]+r|0,i[2]=i[2]+a|0,i[3]=i[3]+o|0,i[4]=i[4]+l|0},_doFinalize:function(){var e=this._data,t=e.words,i=8*this._nDataBytes,n=8*e.sigBytes;return t[n>>>5]|=128<<24-n%32,t[14+(n+64>>>9<<4)]=Math.floor(i/4294967296),t[15+(n+64>>>9<<4)]=i,e.sigBytes=4*t.length,this._process(),this._hash},clone:function(){var e=n.clone.call(this);return e._hash=this._hash.clone(),e}});e.SHA1=n._createHelper(t),e.HmacSHA1=n._createHmacHelper(t)}(),function(){var e=CryptoJS,t=e.enc.Utf8;e.algo.HMAC=e.lib.Base.extend({init:function(e,i){e=this._hasher=new e.init,"string"==typeof i&&(i=t.parse(i));var n=e.blockSize,s=4*n;i.sigBytes>s&&(i=e.finalize(i)),i.clamp();for(var r=this._oKey=i.clone(),a=this._iKey=i.clone(),o=r.words,l=a.words,c=0;c<n;c++)o[c]^=1549556828,l[c]^=909522486;r.sigBytes=a.sigBytes=s,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t=this._hasher;return e=t.finalize(e),t.reset(),t.finalize(this._oKey.clone().concat(e))}})}(),function(){var e=CryptoJS,t=e.lib,i=t.Base,n=t.WordArray,t=e.algo,s=t.HMAC,r=t.PBKDF2=i.extend({cfg:i.extend({keySize:4,hasher:t.SHA1,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var i=this.cfg,r=s.create(i.hasher,e),a=n.create(),o=n.create([1]),l=a.words,c=o.words,d=i.keySize,i=i.iterations;l.length<d;){var u=r.update(t).finalize(o);r.reset();for(var h=u.words,_=h.length,g=u,f=1;f<i;f++){g=r.finalize(g),r.reset();for(var p=g.words,m=0;m<_;m++)h[m]^=p[m]}a.concat(u),c[0]++}return a.sigBytes=4*d,a}});e.PBKDF2=function(e,t,i){return r.create(i).compute(e,t)}}(),define("lib/pbkdf2",function(){}),define("storm/mgr/sTokenManager",["xdk-base/ax","xdk-base/core","xdk-base/class","xdk-base/console","lib/aes","lib/pbkdf2","lib/base64","tve/TVEError"],function(e,t,i,n,s,r,a,o){"use strict";var l={FREE:"STUBBED-OUT",NOTFREE:"STUBBED-OUT"};return new(i.create({},{TYPE:{FREE:"free",NOTFREE:"notfree"},init:function(){},getDecryptedToken:function(e){try{var t=e.type===this.TYPE.FREE?l.FREE:l.NOTFREE,i=CryptoJS.enc.Utf8.parse(t),s=CryptoJS.PBKDF2(t,i,{keySize:8,iterations:1e3}),r=CryptoJS.enc.Hex.stringify(s),a=CryptoJS.enc.Hex.parse(r.substr(0,32)),c=CryptoJS.enc.Hex.parse(r.substr(32,32)),d={ciphertext:CryptoJS.enc.Base64.parse(e.value),salt:""},u=CryptoJS.AES.decrypt(d,a,{iv:c});return{name:e.name,value:CryptoJS.enc.Utf8.stringify(u)}}catch(e){throw n.log(e),new o(o.FACILITY.GENERAL,o.ERROR.INTERNAL,"Decryption failed "+e)}}}))}),define("storm/mgr/sLinearChannelManager",["xdk-base/class","xdk-base/util","xdk-base/promise","xdk-base/console","storm/mgr/sAppConfigManager","storm/helper/util"],function(e,t,i,n,s,r){"use strict";return new(e.create({},{checkIfChannelIdPermitted:function(e){return s.getPermittedLinearChannels().then(function(n){var s=i.defer();return n?(t.each(n,function(i){if(r.areAssetIdsEqual(i,e))return s.resolve("Channel id "+e+" is permitted"),t.breaker}),s.reject("Channel id "+e+" is NOT permitted")):s.reject("Channel id "+e+" is NOT permitted"),s.promise})},filterPermittedChannels:function(e){n.log("Filter channels");var s=[],r=[];return t.each(e,function(e){r.push(this.checkIfChannelIdPermitted(e.get("id")).then(function(t){return n.log(t),s.push(e),t},function(e){n.warn(e)}))},this),i.all(r).then(function(e){return n.log("All channels resolved"),s})}}))}),define("storm/model/SilkMessage",["xdk-base/class","tve/model/ImmutableModel"],function(e,t){"use strict";return e.create(t,{defaults:{code:null,title:"",description:""}},{})}),define("storm/model/SilkMessageBuilder",["xdk-base/class","storm/model/SilkMessage"],function(e,t){"use strict";return e.create({},{_attrs:{},setCode:function(e){return this._attrs.code=e,this},setTitle:function(e){return this._attrs.title=e,this},setDescription:function(e){return this._attrs.description=e,this},build:function(){return new t(this._attrs)}})}),define("storm/mgr/sSilkMessagesManager",["xdk-base/class","xdk-base/util","xdk-base/promise","xdk-base/console","tve/TVEError","storm/mgr/sEditorialManager","storm/mgr/sLanguageManager","storm/model/SilkMessageBuilder"],function(e,t,i,n,s,r,a,o){"use strict";return new(e.create({},{getSilkMessageForCode:function(e){return r.getEditorialContent(r.CONTENT.SILK_MESSAGES).then(function(s){try{var r,l=s.responseJSON.messageList.messageItem;if(t.each(l,function(i){if(i.code===e)return r=(new o).setCode(e).setTitle(i.title).setDescription(i.description&&i.description.length?i.description:i.short_description).build(),t.breaker}),r)return i.resolve(r)}catch(t){n.warn("Unable to map error code "+e+": "+t)}return a.getInitPromise().then(function(){return i.resolve((new o).setCode(e).setTitle(a.getString("Errormessages.Errormessages_GenericErrorMessageHeadline")).setDescription(a.getString("Errormessages.Errormessages_labelErrorMessage")).build())})})}}))}),define("storm/event/UserEvent",{UserDataRequireUpdate:"UserEvent:UserDataRequireUpdate",UserDataUpdated:"UserEvent:UserDataUpdated",UserHasBeenLoggedOut:"UserEvent:UserHasBeenLoggedOut",UserSessionKickedOut:"UserEvent:UserSessionKickedOut"}),define("storm/helper/silkResponseHelper",["xdk-base/util","xdk-ax/evt/type","xdk-ax/focusManager","xdk-base/promise","xdk-ax/mediator","tve/TVEError","storm/mgr/sSilkMessagesManager","tvedemo/helper/dialogHelper","storm/event/UserEvent"],function(e,t,i,n,s,r,a,o,l){"use strict";var c={SUCCESS:"OK",FAILURE:"KO"};return{SILK_CODE:{NO_ERRORS:"S_100",NULL_SESSION_ID:"S_217",USER_NOT_FOUND_ON_SILK_CACHE:"S_218",NO_DATA_FOUND:"S_232",ALREADY_LOGGED_IN:"T_206",NO_ACTIVE_SESSION:"T_208",PLAY_SESSION_TOKEN_LIFESPAN_REACHED:"S_230",NO_ASSET_ID:"S_226",INVALID_PLAY_SESSION_TOKEN:"S_229",DOMAIN_NOT_EXISTING:"T_402",USER_HAS_TOO_MANY_DEVICES_REGISTERED:"T_403"},MODE:{NOISY:void 0,SILENT:"silent",BLOCK_EVENTS:"block_events"},skimSilkResponse:function(t,i,r){var d=n.defer();try{if(t.resultMessage!==c.SUCCESS){switch(t.resultCode){case this.SILK_CODE.NO_ERRORS:break;case this.SILK_CODE.ALREADY_LOGGED_IN:d.resolve(t);break;case this.SILK_CODE.USER_NOT_FOUND_ON_SILK_CACHE:r!==this.MODE.BLOCK_EVENTS&&s.publish(l.UserSessionKickedOut),d.resolve(t)}a.getSilkMessageForCode(t.resultCode).then(e.bind(function(e){i!==this.MODE.SILENT&&o.error({title:e.get("title"),reason:e.get("description")})},this)),d.reject(t)}else t.reloadUserData&&r!==this.MODE.BLOCK_EVENTS&&s.publish(l.UserDataRequireUpdate),d.resolve(t)}catch(e){d.reject("Unable to skim SILK response: "+e)}return d.promise}}}),define("tve/StormService",["xdk-base/ax","xdk-base/console","xdk-base/promise","tve/util/CacheHelper","tve/TVEError","tve/interface/LinearContentService","tve/sAppGridServiceHolder","storm/mgr/sAppConfigManager","tvedemo/helper/sMoment","storm/helper/util","storm/mgr/sLanguageManager","storm/mgr/sTokenManager","storm/mgr/sEditorialManager","storm/mgr/sLinearChannelManager","storm/helper/silkResponseHelper","xdk-base/device"],function(e,t,i,n,s,r,a,o,l,c,d,u,h,_,g,f){"use strict";var p=s.FACILITY,m=s.ERROR,v={DESC:"desc",ASC:"asc"},b={STORM:["ST","skygo","sg"],SNAP:["HE","snap","sn"]},S={STORM:"sg",SNAP:"sn"},y=function(e){return-1!==b.STORM.indexOf(e)?S.STORM:-1!==b.SNAP.indexOf(e)?S.SNAP:void 0},E={initDefer:e.promise.defer(),cacheHelper:null,roots:{},paths:{},product:{},platform:{},proxy:null,proxyHosts:null,__serverDateTime:void 0,__serverDateTimeDefer:e.promise.defer(),__channelIds:[],version:e.config.get("version"),init:function(t,i,n,s){this.isProduction=s,this.cacheHelper=t,this.proxy=i,this.proxyHosts=n,a.getAppGridServicePromise().then(e.util.bind(function(){var t=[];t.push(o.getEhubConfig()),t.push(o.getCmsConfig()),t.push(o.getSilkConfig()),t.push(o.getSearchConfig()),e.promise.all(t).then(e.util.bind(function(e){var t=this.isProduction?"production":"test";this.roots.ehub=e[0].root[t],this.paths.ehub=e[0].paths,this.paths.ehub.onair="/epgd/st/onAir/{channel_id}/",this.roots.cms=e[1].root[t],this.paths.cms=e[1].paths,this.roots.silk=e[2].root[t],this.product.silk=e[2].product[t],this.platform.silk=e[2].platform[t],this.paths.silk=e[2].paths,this.roots.search=e[3].root[t],this.product.search=e[3].product[t],this.platform.search=e[3].platform[t],this.paths.search=e[3].paths,this.initDefer.resolve(),this.__synchroniseServerDateTime()},this),e.util.bind(function(e){this.initDefer.reject("StormService init not completed: "+e),this.__serverDateTimeDefer.reject("Date/time sync impossible: "+e)},this))},this))},initialisedPromise:function(){return this.initDefer.promise},getNavigationOverrides:function(){return this.initialisedPromise().then(e.util.bind(function(){return h.getEditorialContent(h.CONTENT.NAVIGATION_OVERRIDES).then(e.util.bind(function(e){return JSON.parse(e.response)[this.isProduction?"production":"test"]},this))},this))},getHomePageHighlights:function(){return this.initialisedPromise().then(e.util.bind(function(){return h.getEditorialContent(h.CONTENT.HOMEPAGE_HIGHLIGHTS).then(e.util.bind(function(e){return JSON.parse(e.response)[this.isProduction?"production":"test"]},this))},this))},getClipToken:function(t){return this.initialisedPromise().then(e.util.bind(function(){var t=this.roots.silk+this.paths.silk.clipToken;t=this.__completeSilkUrl(t+"?clipType=FREE");var i={};return i.method="post",this.request(t,i).then(function(t){return g.skimSilkResponse(t,g.MODE.SILENT).then(function(){var e={name:t.tokenName,value:t.tokenValue,type:u.TYPE.FREE};return u.getDecryptedToken(e)},function(){return e.promise.reject("Clip token request failed "+t.resultCode)})})},this))},loginUser:function(t){return this.initialisedPromise().then(e.util.bind(function(){t=t||{};var e=this.roots.silk+this.paths.silk.login;e=t.username&&t.username.indexOf("@")>0?this.__completeSilkUrl(e+"?email="+t.username+"&password="+t.password):this.__completeSilkUrl(e+"?customerCode="+t.username+"&password="+t.password);var i={};return i.method="post",this.request(e,i,t,!0)},this))},logoutUser:function(t){return this.initialisedPromise().then(e.util.bind(function(){var e=this.roots.silk+this.paths.silk.logout;return e=this.__completeSilkUrl(e+"?skygoSessionId="+t.sessionId),t.method="delete",this.request(e,t,null,!0)},this))},killSession:function(t){return this.initialisedPromise().then(e.util.bind(function(){t=t||{};var e=this.roots.silk+this.paths.silk.kill;return e=this.__completeSilkUrl(e+"?skygoSessionId="+t.sessionId),t.method="post",this.request(e,t,null,!0)},this))},userDataRequest:function(e){e=e||{};var t=this.roots.silk+this.paths.silk.userData;return t=this.__completeSilkUrl(t+"?skygoSessionId="+e.sessionId),e.method="get",this.request(t,e,null,!0)},uploadCustomerBookmarks:function(e){e=e||{};var t=this.roots.silk+this.paths.silk.bookmark+"/all";return t=this.__completeSilkUrl(t+"?skygoSessionId="+e.sessionId),e.method="post",this.request(t,e,{},!0)},getAllCustomerBookmarks:function(e){e=e||{};var t=this.roots.silk+this.paths.silk.bookmark+"/all";return t=this.__completeSilkUrl(t+"?skygoSessionId="+e.sessionId),e.method="get",this.request(t,e,{},!0)},getCustomerBookmarks:function(e){e=e||{};var t=this.roots.silk+this.paths.silk.bookmark;return t=this.__completeSilkUrl(t+"?skygoSessionId="+e.sessionId+"&assetId="+e.assetId),e.method="get",this.request(t,e,{},!0)},toggleBookmarkRequest:function(e){e=e||{};var t=this.roots.silk+this.paths.silk.bookmark;return t=this.__completeSilkUrl(t+"?skygoSessionId="+e.sessionId+"&bookmarkFlag="+e.bookmark),e.method="put",this.request(t,e,{},!0)},acceptTermsAndConditionsRequest:function(e){e=e||{};var t=this.roots.silk+this.paths.silk.acceptTerms;return t=this.__completeSilkUrl(t+"?skygoSessionId="+e.sessionId+"&termsAndConditionsFlag="+e.acceptTermsAndConditions+"&privacyFlag="+e.privacyFlag),e.method="put",this.request(t,e)},fskPinCheckRequest:function(e){e=e||{};var t=this.roots.silk+this.paths.silk.checkMpPin;return t=this.__completeSilkUrl(t+"?skygoSessionId="+e.sessionId+"&password="+e.fskPin),e.method="get",this.request(t,e,null,!0)},getDeviceDetails:function(e){e=e||{};var t=this.roots.silk+this.paths.silk.device;return t=this.__completeSilkUrl(t+(e.sessionId?"?skygoSessionId="+e.sessionId:"?")),this.request(t,e,null,!0)},resetDeviceList:function(e){e=e||{};var t=this.roots.silk+this.paths.silk.device;return t=this.__completeSilkUrl(t+(e.sessionId?"?skygoSessionId="+e.sessionId:"?")),e.method="delete",this.request(t,e,null,!0)},getUserWatchList:function(e){e=e||{};var t=this.roots.silk+this.paths.silk.watchlist;return t=this.__completeSilkUrl(t+"?skygoSessionId="+e.sessionId),this.request(t,e,null,!0)},addAssetToUserWatchList:function(e,t){e=e||{};var i=y(e.catalog),n=this.roots.silk+this.paths.silk.watchlist;return n=this.__completeSilkUrl(n+"?skygoSessionId="+t+"&assetId="+e.assetId+"&type="+e.assetType+"&catalog="+i),e.method="post",this.request(n,e,null,!0)},removeAssetFromWatchList:function(e,t){e=e||{};var i=this.roots.silk+this.paths.silk.watchlist;return i=this.__completeSilkUrl(i+"?skygoSessionId="+t+"&assetId="+e.assetId),e.method="delete",this.request(i,e,null,!0)},getRecentlyWatched:function(e){e=e||{};var t=this.roots.silk+this.paths.silk.lastWatched;return t=this.__completeSilkUrl(t+"?skygoSessionId="+e.sessionId),this.request(t,e,null,!0)},addAssetToRecentlyWatched:function(e){e=e||{};var t=this.roots.silk+this.paths.silk.lastWatched;return t=this.__completeSilkUrl(t+"?skygoSessionId="+e.sessionId+"&assetId="+e.assetId+"&title="+e.title+"&color="+e.color+"&isHD="+(e.isHD?"Y":"N")+"&fsk="+e.fsk+"&imageUrl="+e.imageUrl+"&type="+e.type),e.apixId&&e.apixId.length>0&&(t=t+"&id="+e.apixId),e.method="post",this.request(t,e,null,!0)},cmsRequest:function(t,i){return this.initialisedPromise().then(e.util.bind(function(){return this.__simpleRequest(this.roots.cms,t,i)},this))},epgRequest:function(t){return this.initialisedPromise().then(e.util.bind(function(){return this.__simpleRequest(this.roots.ehub,this.paths.ehub.excerpt,t)},this))},onAirRequest:function(e,t){e=e||{};var t=t||{},i=this.roots.ehub+this.paths.ehub.onair;return i=c.tokenReplacer(i,function(t,i){return"channel_id"===i?e.channelId:""}),this.request(i,t,void 0,!0)},playstationNavigation:function(e,t){return"playstation"===f.platform||!0===t?e.replace("navigation","navigation_playstation"):e},navigationRequest:function(t){return this.initialisedPromise().then(e.util.bind(function(){var e=this.playstationNavigation(this.paths.cms.navigation,!0);return this.__simpleRequest(this.roots.cms,e,t)},this))},__advanceServerDateTime:function(){e.util.isUndefined(this.__serverDateTime)||this.__serverDateTime.setMilliseconds(this.__serverDateTime.getMilliseconds()+3e4)},__synchroniseServerDateTime:function(){this.__dateTimeSyncHandle=void 0,this.dateTimeRequest().then(e.util.bind(function(i){try{var n=i.date+" "+i.time,r=l(n,"DD.MM.YYYY HH:mm");r.isValid()?(this.__serverDateTime=r.toDate(),e.promise.isFulfilled(this.__serverDateTimeDefer.promise)&&(this.__serverDateTimeDefer=e.promise.defer()),this.__serverDateTimeDefer.resolve(this.__serverDateTime),e.util.isUndefined(this.__dateTimeAdvanceHandle)&&(this.__dateTimeAdvanceHandle=setInterval(e.util.bind(function(){this.__advanceServerDateTime()},this),3e4)),this.__dateTimeSyncHandle=setTimeout(e.util.bind(function(){this.__synchroniseServerDateTime()},this),9e5)):(t.warn("Date/time synchronisation failed, due to invalid "+n),e.util.isUndefined(this.__serverDateTime)&&this.__serverDateTimeDefer.reject(new s(s.FACILITY.GENERAL,s.ERROR.INVALID,"Invalid date/time: "+n)))}catch(i){t.warn("Date/time synchronisation failed, due to "+i),e.util.isUndefined(this.__serverDateTime)&&this.__serverDateTimeDefer.reject(i)}},this),e.util.bind(function(i){e.util.isUndefined(this.__serverDateTime)?(t.error("Date and time may be presented incorrectly in UI, due to "+i),this.__serverDateTimeDefer.reject(i)):t.error("Date and time may slip out of sync, due to "+i)},this))},__completeSilkUrl:function(e){return e+"&product="+this.product.silk+"&platform="+this.platform.silk+"&version="+this.version},__completeSearchUrl:function(e){return e+"&product="+this.product.search+"&platform="+this.platform.search+"&version="+this.version},__simpleRequest:function(t,i,n){return t&&t.length?i&&i.length?(n=n||{},this.request(t+i,n)):e.promise.reject("Request path is empty"):e.promise.reject("Request root is empty")},heartbeatRequest:function(t){return this.initialisedPromise().then(e.util.bind(function(){var e={method:"put"},i=this.roots.silk+this.paths.silk.heartbeat,n="";return t.playSessionToken&&(n="&playSessionToken="+t.playSessionToken),i=i+"?skygoSessionId="+t.skygoSessionId+"&assetId="+t.assetId+n,t.playedTime&&t.duration&&(i=i+"&bookmark="+(t.playedTime>>0)+"&duration="+(t.duration>>0)),t.watched&&(i=i+"&watched="+t.watched),i=this.__completeSilkUrl(i),this.request(i,e,null,!0)},this))},searchRequest:function(t,i){return i=i||{},this.initialisedPromise().then(e.util.bind(function(){var e=this.roots.search+this.paths.search.search,n="?searchKey="+encodeURIComponent(t)+(i.catalog?"&catalog="+i.catalog:"");return e=this.__completeSearchUrl(e+n),this.request(e,i)},this))},serverDateTimePromise:function(){return this.__serverDateTimeDefer.promise},dateTimeRequest:function(){return this.initialisedPromise().then(e.util.bind(function(){var e=this.roots.ehub+this.paths.ehub.datetime+"?"+Math.random();return this.request(e,{timeOut:10})},this))},channelRequest:function(e){e=e||{};var t=this.roots.ehub+this.paths.ehub.channels,i=e.id,n=n||{};return i&&(i=i.join?i.join():i,t+="/"+i,delete e.id),this.request(t,e,n)},channelByCategoryRequest:function(t){return t=t||{},t.id?(e.util.extend(t,{objType:"channel"}),this.categoryRequest(t)):e.promise.reject(new s(p.LINEAR_CONTENT_SERVICE,m.INTERNAL,"no id is provided in OVP API"))},channelListingRequest:function(t){t=t||{};var i=this.roots.ehub+this.paths.ehub.events,n=t.channelId,r=r||{};if(!t.startTime||!t.endTime)return e.promise.reject(new s(p.LINEAR_CONTENT_SERVICE,m.INTERNAL,"no startTime or endTime is provided in OVP API"));return i+="/"+function(e){var t=e.getDate(),i=e.getMonth()+1,n=e.getFullYear();return t=t<10?"0"+t:t,i=i<10?"0"+i:i,t+"."+i+"."+n}(new Date(t.startTime)),n?(n=n.join?n.join():n,delete t.channelId):n=this.__channelIds.join(","),i+="/"+n+"/",this.request(i,t,r)},eventDetailsRequest:function(e){e=e||{};var t=t||{},i=this.roots.ehub+this.paths.ehub.eventDetail;return i=c.tokenReplacer(i,function(t,i){return"event_id"===i?e.programId:"channel_id"===i?e.channelId:""}),this.request(i,e,t)},assetDetailRequest:function(t,i){if(!t||!i)return e.promise.reject("Incorrect assetId or catalog");var n=y(i),s=this.roots.cms+(n===S.STORM?this.paths.cms.stormAsset:this.paths.cms.snapAsset);return s=c.tokenReplacer(s,function(e,i){return"assetId"===i?t:""}),this.request(s)},serieAssetDetailRequest:function(t,i){if(!t)return e.promise.reject("Incorrect serieAssetId");var n=y(i),s=this.roots.cms+(n===S.STORM?this.paths.cms.stormSeriesGlobal:this.paths.cms.snapSeriesGlobal);return s=c.tokenReplacer(s,function(e,i){return"serieAssetId"===i?t:""}),this.request(s)},seasonAssetDetailRequest:function(t,i){if(!t)return e.promise.reject("Incorrect seasonAssetId");var n=y(i),s=this.roots.cms+(n===S.STORM?this.paths.cms.stormSeason:this.paths.cms.snapSeason);return s=c.tokenReplacer(s,function(e,i){return"seasonId"===i?t:""}),this.request(s)},keepAlive:function(e){var t={method:"put"},i=this.roots.silk+this.paths.silk.keepAlive;return i=this.__completeSilkUrl(i+"?skygoSessionId="+e),this.request(i,t,null,!0)},sportNewsByCategoryRequest:function(e){var t=this.roots.cms+this.paths.cms.sportNewsCategory;return t=c.tokenReplacer(t,function(t,i){return"categoryId"===i?e:""}),this.request(t)},request:function(i,n,r,a){n=n||{},r=r||{};var o,l=this.cacheHelper,c=JSON.stringify({url:i,opts:n,param:r}),d=l.getCache(c);if(!e.util.isUndefined(d)){if(!l.isExpired(c))return e.promise.resolve(d);l.getTimestamp(c)}if(n.requestHeaders=e.util.extend(n.requestHeaders||{},{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8"}),o={method:n.method||"get",timeOut:n.timeOut,parameters:r,requestHeaders:n.requestHeaders,postBody:n.postBody},"test"===e.config.get("environment")&&e.config.get("dev.replaceHost",!1)){for(var u=e.config.get("dev.findHosts",[]),h=e.config.get("dev.replaceHosts",[]),_=-1,g=0;g<u.length;g++)if(i.indexOf(u[g])>0){_=g;break}_>-1&&(i=i.replace(u[_],h[_]))}if(this.proxy&&this.proxyHosts.length){for(var f=null,v=0;v<this.proxyHosts.length;v++)if(i.indexOf(this.proxyHosts[v])>0){f=this.proxyHosts[v];break}if(f){i=e.config.get("dev.proxyPath")+encodeURIComponent(i)}}return e.ajax.request(i,o).then(function(e){var i=e.responseJSON;if(!i)try{i=JSON.parse(e.responseText)}catch(n){if(!e.responseXML||!e.responseXML.childNodes.length)throw t.error(n);i=e.responseXML.childNodes[0]}return a||l.setObject(c,i,+new Date),i},function(e){throw new s(p.GENERAL,m.NETWORK,e.transport?e.transport.statusText:"network issue",e)})}};return e.klass.create([r],{SORTING:v},{__cache:null,__opts:null,init:function(e){this.__cache=new n,this.__opts=e;var t,i;this.__opts.proxy&&(t=this.__opts.proxy,i=this.__opts.proxyHosts),E.init(this.__cache,t,i,e.production)},acquireCMSRoot:function(){return E.initialisedPromise().then(function(){return E.roots.cms})},cmsRequest:function(e,t){return E.cmsRequest(e,t)},getNavigationOverrides:function(){return E.getNavigationOverrides()},getHomePageHighlights:function(){return E.getHomePageHighlights()},getClipToken:function(e){return E.getClipToken(e)},loginUser:function(e){return E.loginUser(e)},logoutUser:function(e){return E.logoutUser(e)},acceptTermsAndConditions:function(e){return E.acceptTermsAndConditionsRequest(e)},toggleBookmarkRequest:function(e){return E.toggleBookmarkRequest(e)},getUserData:function(e){return E.userDataRequest(e)},uploadCustomerBookmarks:function(e){return E.uploadCustomerBookmarks(e)},getAllCustomerBookmarks:function(e){return E.getAllCustomerBookmarks(e)},getCustomerBookmarks:function(e){return E.getCustomerBookmarks(e)},killSession:function(e){return E.killSession(e)},checkFskPin:function(e){return E.fskPinCheckRequest(e)},getDeviceDetails:function(e){return E.getDeviceDetails(e)},resetDeviceList:function(e){return E.resetDeviceList(e)},getUserWatchList:function(e){var t={sessionId:e};return E.getUserWatchList(t)},addAssetToUserWatchList:function(e,t){return E.addAssetToUserWatchList(e,t)},removeAssetFromWatchList:function(e,t){return E.removeAssetFromWatchList(e,t)},getRecentlyWatched:function(e){var t={sessionId:e};return E.getRecentlyWatched(t)},addAssetToRecentlyWatched:function(e){return E.addAssetToRecentlyWatched(e)},onAirRequest:function(e,t){return E.onAirRequest(e,t,void 0,!0)},__getChannel:function(e){return e&&e.categoryId?(e.id=e.categoryId,delete e.categoryId,E.channelByCategoryRequest(e)):E.channelRequest(e)},getAllChannels:function(t){return this.__getChannel(t).then(function(t){return 0===E.__channelIds.length&&e.util.each(t.channelList,function(e){E.__channelIds.push(e.id)}),{entries:t.channelList,totalCount:t.channelList.length,pageSize:t.channelList.length,pageNumber:1}})},getPermittedChannels:function(n){return t.log("getPermittedChannels()"),t.log(n),this.__getChannel(n).then(function(n){var s={entries:[],totalCount:0,pageSize:0,pageNumber:1},r=[];return e.util.each(n.channelList,function(e){t.log("Checking "+e.id),r.push(_.checkIfChannelIdPermitted(e.id).then(function(i){return t.log(i),s.entries.push(e),i},function(e){t.warn(e)}))}),i.all(r).then(function(e){return t.log("All channels resolved"),s.totalCount=s.pageSize=s.entries.length,t.log(s),s})})},getAllChannelIds:function(t){return this.__getChannel(t).then(function(t){return 0===E.__channelIds.length&&e.util.each(t.channelList,function(e){E.__channelIds.push(e.id)}),E.__channelIds})},getChannelById:function(t,i){return t?(i=i||{},i.id=t,this.__getChannel(i)):e.promise.reject(new s(p.LINEAR_CONTENT_SERVICE,m.INTERNAL,"no id is provided"))},getChannelsByIds:function(t,i){return t&&e.util.isArray(t)?(i=i||{},i.id=t,this.__getChannel(i).then(function(t){return{entries:e.util.isArray(t.entries)?t.entries:[t],totalCount:t.totalCount||1,pageSize:t.pageSize||1,pageNumber:t.pageNumber||1}})):e.promise.reject(new s(p.LINEAR_CONTENT_SERVICE,m.INTERNAL,"incorrect parameter type"))},getChannelsByCategoryId:function(t,i){return t?(i=i||{},i.categoryId=t,this.__getChannel(i).then(function(e){return{entries:e.entries,totalCount:e.totalCount,pageSize:e.pageSize,pageNumber:e.pageNumber}})):e.promise.reject(new s(p.LINEAR_CONTENT_SERVICE,m.INTERNAL,"no categoryId is provided"))},getAllChannelListings:function(t,i,n){if(!t||!i)return e.promise.reject(new s(p.LINEAR_CONTENT_SERVICE,m.INTERNAL,"no startTime or endTime is provided"));var r=n.channelId;return n=n||{},n.startTime=t,n.endTime=i,n.timeOut=60,E.channelListingRequest(n).then(function(e){var n=[];for(var s in r)r.hasOwnProperty(s)&&n.push({channelId:r[s],programs:c.sanitiseEpgEvents(t,i,e[r[s]])});return{entries:n,totalCount:n.length,pageSize:n.length,pageNumber:1}})},getChannelListingByChannelId:function(t,i,n,r){return t?i&&n?(r=r||{},r.channelId=t,r.startTime=i,r.endTime=n,E.channelListingRequest(r)):e.promise.reject(new s(p.LINEAR_CONTENT_SERVICE,m.INTERNAL,"no startTime or endTime is provided")):e.promise.reject(new s(p.LINEAR_CONTENT_SERVICE,m.INTERNAL,"no channelId is provided"))},getChannelListingsByChannelIds:function(t,i,n,r){return t?i&&n?(r=r||{},r.channelId=t,r.startTime=i,r.endTime=n,E.channelListingRequest(r).then(function(t){return{entries:e.util.isArray(t.entries)?t.entries:[t],totalCount:t.totalCount||1,pageSize:t.pageSize||1,pageNumber:t.pageNumber||1}})):e.promise.reject(new s(p.LINEAR_CONTENT_SERVICE,m.INTERNAL,"no startTime or endTime is provided")):e.promise.reject(new s(p.LINEAR_CONTENT_SERVICE,m.INTERNAL,"no channelIds are provided"))},getEventDetails:function(t,i,n){return 0===t?e.promise.resolve({title1:d.getString("Epg.noDataFoundMessage"),title2:""}):(n=n||{},n.programId=t,n.channelId=i,E.eventDetailsRequest(n).then(function(e){return e}))},getServerDateTime:function(){return E.serverDateTimePromise()},getNavigation:function(e){return E.navigationRequest(e)},getFirstChildSectionNodeList:function(e){return E.navigationRequest(e).then(function(e){return e.querySelectorAll("navigation > section[displayFirstChild=true]")})},getHighlightsMenu:function(t){return this.getFirstChildSectionNodeList(t).then(e.util.bind(function(e){for(var t,i=[],n=0,s=e.length;n<s;n++)(t=this.__findNodeWithAttribute(e[n].childNodes,"structureType","LandingPageHighlights"))&&i.push({title:e[n].getAttribute("label"),path:t.getAttribute("path")});return i},this))},getHighlightsMenuContentPromise:function(i,n,s){return n||(n="MostWatchedFilm"),
E.cmsRequest(i,s).then(function(i){if(!(i&&i.listing&&i.listing.listing&&i.listing.listing.item))throw t.error("Highlights jsonObject format incorrect!");if(!i.listing.listing.item.length)return t.info("Highlights content empty");for(var r=i.listing.listing.item,a=0,o=r.length;a<o;a++)if(r[a].path&&r[a].structureType===n)return E.cmsRequest(r[a].path,s);return e.promise.resolve({})})},getCurrentlyRunningEvents:function(i){return E.navigationRequest(i).then(e.util.bind(function(i){var n=this.__findNodeWithAttribute(i.childNodes,"structureType","LandingPageStartScreen");if(n){var s=n.getAttribute("path");return e.promise.all([E.cmsRequest(s),E.epgRequest()]).then(function(e){var i,n=e[1],s=[],r=[];if(!(e[0].listing&&e[0].listing.info&&e[0].listing.info.EPGEexcerpt&&e[0].listing.info.EPGEexcerpt.tab))throw t.error("No EPG tab information found");i=e[0].listing.info.EPGEexcerpt.tab;for(var a=0;a<i.length;a++)s.push(i[a].ccode);for(var o=0;o<n.length;o++)-1!==s.indexOf(n[o].tabName)&&(r=r.concat(n[o].eventList));return r})}},this))},getListingItem:function(i,n){return i&&i.length?E.cmsRequest(i,n).then(function(e){if(!(e&&e.listing&&e.listing.listing&&e.listing.listing.item))throw t.error("getListingItem: jsonObject format incorrect!");return e.listing.listing.item}):e.promise.reject("path is empty")},getSnapListingItems:function(i,n){return i&&i.length?E.cmsRequest(i,n).then(function(e){if(!e||!e.listing||!e.listing.items)throw t.error("getSnapListingItems: jsonObject format incorrect!");return e.listing.items}):e.promise.reject("path is empty")},getAssetList:function(i,n){return i&&i.length?E.cmsRequest(i,n).then(function(e){var i=c.getSanitizedValue(e,"listing.listing")||c.getSanitizedValue(e,"listing.asset_listing");if(!i)throw t.error("getAssetList: jsonObject format incorrect, no listing");var n=i.asset||i.item;if(!n)throw t.error("getAssetList: jsonObject format incorrect, no listing array");return{listing:n,catalog:e.product,pages:e.listing.pages||0}}):e.promise.reject("path is empty")},getLetterList:function(i,n){return i&&i.length?E.cmsRequest(i,n).then(function(e){if(!e||!e.letters||!e.letters.letter)throw t.error("getLetterList: jsonObject format incorrect!");return e.letters.letter}):e.promise.reject("path is empty")},__findNodeWithAttribute:function(e,t,i,n){if(!(e&&e.length&&t&&i))return!1;for(var s=0,r=e.length;s<r;s++){if(e[s].getAttribute(t)===i)return e[s];if(n&&e[s].getAttribute(t)===n)return e[s]}return!1},getSportLivePlannerPromise:function(t){if(!t||!t.childNodes.length||!t.getAttribute||"SportSection"!==t.getAttribute("structureType"))return e.promise.reject("invalid node");for(var i,n,s=e.promise.defer(),r=0;i=t.childNodes[r++];)if("LiveplannerSection"===i.getAttribute("structureType")){if(!(i=i.firstChild)||!(n=i.getAttribute("path")))break;return E.cmsRequest(n).then(function(e){if(!e.listing||!e.listing.listing||!e.listing.listing.item||"LiveplannerListing"!==e.listing.listing.item.structureType)return s.reject("invalid node");E.cmsRequest(e.listing.listing.item.path).then(function(e){s.resolve(e)})}).fail(function(){s.reject("ajax-call failed")}),s.promise}return s.reject("invalid node")},getSportHighlightSections:function(e){if(!e||!e.childNodes.length||!e.getAttribute||"SportSection"!==e.getAttribute("structureType"))throw t.error("invalid node");for(var i,n=[],s=0;i=e.childNodes[s++];)/Section$/.test(i.getAttribute("structureType"))&&"false"===i.getAttribute("hide")&&n.push({structureType:i.getAttribute("structureType"),text:i.getAttribute("label"),displayFirstChild:"true"===i.getAttribute("displayFirstChild")});return n},getSportHighlightPromise:function(t,i){if(!t||!t.childNodes.length||!t.getAttribute||"SportSection"!==t.getAttribute("structureType"))return e.promise.reject("invalid node");for(var n,s=e.promise.defer(),r=0,a=[],o=[];n=t.childNodes[r++];)if(i===n.getAttribute("structureType")){for(var l=0;l<n.childNodes.length;l++)"false"===n.childNodes[l].getAttribute("hide")&&o.push(E.cmsRequest(n.childNodes[l].getAttribute("path")));c.allPromises(o).then(function(e){o=[];for(var r=0;r<e.length;r++)Error.prototype.isPrototypeOf(e[r])||e[r]&&o.push(E.cmsRequest(e[r].listing.listing.item.path));c.allPromises(o).then(function(e){for(var r=0;r<e.length;r++)if(!Error.prototype.isPrototypeOf(e[r])){var o=e[r]?e[r].listing.listing.item||e[r].listing.listing.asset:null;o&&o.length>0&&a.push({category:e[r].listing.info.category,catalog:e[r].product,items:o})}s.resolve({sportSectionLabel:t.getAttribute("label"),label:n.getAttribute("label"),section:i,data:a,displayFirstChild:"true"===n.getAttribute("displayFirstChild")})})});break}return s.promise},getSportNewsByCategory:function(e){return E.sportNewsByCategoryRequest(e)},getHomepageSportHighlights:function(e){return E.cmsRequest(e).then(function(e){for(var t=e.listing.listing.item,i=[],n=0;n<t.length;n++)i.push({title:t[n].item_title,image:t[n].item_image,category:t[n].item_category_name,id:t[n].item_id,category_id:t[n].item_category_id,type:"sportsNews",package_code:t[n].category_key_color});return{listing:i,catalog:e.product}})},getAssetById:function(e,t){return E.assetDetailRequest(e,t)},getAssetDvdCover:function(t){var i=t.get("dvdCover");return i?e.promise.resolve({url:E.roots.cms+i.path+"/"+i.file}):o.getPlaceholderPortrait().then(function(e){return{url:e}})},getAssetChannelLogo:function(t){var i=t.get("logoUrl");return i&&""!==i?E.initialisedPromise().then(function(){return{url:E.roots.cms+i}}):e.promise.reject("No channel logo available")},getAssetImageBySize:function(t,i,n){if(!t||!i||!n)return e.promise.reject("getAssetImageBySize, a parameter is missing");if(n>i)return this.getAssetDvdCover(t);var s,r=t.get("images");return r&&e.util.each(r,function(t){if(t.width>=i&&t.height>=n&&(t.path.length||t.file.length))return s=t,e.util.breaker}),s?E.initialisedPromise().then(function(){return{url:E.roots.cms+s.path+"/"+s.file}}):o.getPlaceholderLandscape().then(function(e){return{url:e}})},getSerieAssetById:function(e,t){return E.serieAssetDetailRequest(e,t)},getSeasonAssetById:function(e,t){return E.seasonAssetDetailRequest(e,t)},keepAlive:function(e){return E.keepAlive(e)},heartbeat:function(e){return E.heartbeatRequest(e)},searchFor:function(i,n){return E.searchRequest(i,n).then(function(e){return e&&e.assetListResult},function(i){return t.warn("Search request failed due to "+i),e.promise.reject(i)})}})}),define("storm/mgr/sLocalStorageManager",["xdk-base/ax","xdk-base/core","xdk-base/util","xdk-base/class","xdk-base/device","xdk-base/console"],function(e,t,i,n,s,r){"use strict";var a=function(e,t){for(var i in t)if(t.hasOwnProperty(i)&&t[i]===e)return!0;return!1};return new(n.create({},{KEYS:{PER_USER:"per_user",USERNAME:"username",PASSWORD:"password",SESSION:"session",EULA_TIMESTAMP:"eula_timestamp",BINGE_AUTO_PLAY:"binge_auto_play",BOOKMARK_CROSSDEVICE_SETTINGS:"bookmark_crossdevice_settings",CUSTOMER_MESSAGES:"customer_messages"},getStoredValue:function(e,t){if(e===this.KEYS.PER_USER&&r.error("getStoredValue saw attempt to get all per-user data"),i.isUndefined(t)||r.warn("getStoredValue ignoring specific username; that's not yet supported"),a(e,this.KEYS))try{return s.storage.get(e)}catch(e){return void r.warn("device.storage.get failed "+e)}else r.warn("getStoredValue ignoring request for unknown key "+e)},setStoredValue:function(e,t,n){if(e===this.KEYS.PER_USER&&r.error("getStoredValue saw attempt to trash per-user data"),i.isUndefined(n)||r.warn("setStoredValue ignoring specific username; that's not yet supported"),a(e,this.KEYS)||r.warn("setStoredValue ignoring request for unknown key "+e),i.isUndefined(t)){r.warn("setStoredValue is clearing one key "+e);try{return s.storage.unset(e)}catch(e){return void r.warn("device.storage.unset failed "+e)}}else try{return s.storage.set(e,t)}catch(e){return void r.warn("device.storage.set failed "+e)}}}))});var customConsole=window.console||null;AppMeasurement.getInstance=s_gi,window.s_objectID||(window.s_objectID=0),s_pgicq(),define("appmeasurement",function(){}),define("appmeasurementMedia",function(){});var CryptoJS=CryptoJS||function(e,t){var i={},n=i.lib={},s=function(){},r=n.Base={extend:function(e){s.prototype=this;var t=new s;return e&&t.mixIn(e),t.hasOwnProperty("init")||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},a=n.WordArray=r.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=void 0!=t?t:4*e.length},toString:function(e){return(e||l).stringify(this)},concat:function(e){var t=this.words,i=e.words,n=this.sigBytes;if(e=e.sigBytes,this.clamp(),n%4)for(var s=0;s<e;s++)t[n+s>>>2]|=(i[s>>>2]>>>24-s%4*8&255)<<24-(n+s)%4*8;else if(65535<i.length)for(s=0;s<e;s+=4)t[n+s>>>2]=i[s>>>2];else t.push.apply(t,i);return this.sigBytes+=e,this},clamp:function(){var t=this.words,i=this.sigBytes;t[i>>>2]&=4294967295<<32-i%4*8,t.length=e.ceil(i/4)},clone:function(){var e=r.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){for(var i=[],n=0;n<t;n+=4)i.push(4294967296*e.random()|0);return new a.init(i,t)}}),o=i.enc={},l=o.Hex={stringify:function(e){var t=e.words;e=e.sigBytes;for(var i=[],n=0;n<e;n++){var s=t[n>>>2]>>>24-n%4*8&255;i.push((s>>>4).toString(16)),i.push((15&s).toString(16))}return i.join("")},parse:function(e){for(var t=e.length,i=[],n=0;n<t;n+=2)i[n>>>3]|=parseInt(e.substr(n,2),16)<<24-n%8*4;return new a.init(i,t/2)}},c=o.Latin1={stringify:function(e){var t=e.words;e=e.sigBytes;for(var i=[],n=0;n<e;n++)i.push(String.fromCharCode(t[n>>>2]>>>24-n%4*8&255));return i.join("")},parse:function(e){for(var t=e.length,i=[],n=0;n<t;n++)i[n>>>2]|=(255&e.charCodeAt(n))<<24-n%4*8;return new a.init(i,t)}},d=o.Utf8={stringify:function(e){try{return decodeURIComponent(escape(c.stringify(e)))}catch(e){throw Error("Malformed UTF-8 data")}},parse:function(e){return c.parse(unescape(encodeURIComponent(e)))}},u=n.BufferedBlockAlgorithm=r.extend({reset:function(){this._data=new a.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=d.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var i=this._data,n=i.words,s=i.sigBytes,r=this.blockSize,o=s/(4*r),o=t?e.ceil(o):e.max((0|o)-this._minBufferSize,0);if(t=o*r,s=e.min(4*t,s),t){for(var l=0;l<t;l+=r)this._doProcessBlock(n,l);l=n.splice(0,t),i.sigBytes-=s}return new a.init(l,s)},clone:function(){var e=r.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});n.Hasher=u.extend({cfg:r.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){u.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,i){return new e.init(i).finalize(t)}},_createHmacHelper:function(e){return function(t,i){return new h.HMAC.init(e,i).finalize(t)}}});var h=i.algo={};return i}(Math);!function(e){for(var t=CryptoJS,i=t.lib,n=i.WordArray,s=i.Hasher,i=t.algo,r=[],a=[],o=function(e){return 4294967296*(e-(0|e))|0},l=2,c=0;64>c;){var d;e:{d=l;for(var u=e.sqrt(d),h=2;h<=u;h++)if(!(d%h)){d=!1;break e}d=!0}d&&(8>c&&(r[c]=o(e.pow(l,.5))),a[c]=o(e.pow(l,1/3)),c++),l++}var _=[],i=i.SHA256=s.extend({_doReset:function(){this._hash=new n.init(r.slice(0))},_doProcessBlock:function(e,t){for(var i=this._hash.words,n=i[0],s=i[1],r=i[2],o=i[3],l=i[4],c=i[5],d=i[6],u=i[7],h=0;64>h;h++){if(16>h)_[h]=0|e[t+h];else{var g=_[h-15],f=_[h-2];_[h]=((g<<25|g>>>7)^(g<<14|g>>>18)^g>>>3)+_[h-7]+((f<<15|f>>>17)^(f<<13|f>>>19)^f>>>10)+_[h-16]}g=u+((l<<26|l>>>6)^(l<<21|l>>>11)^(l<<7|l>>>25))+(l&c^~l&d)+a[h]+_[h],f=((n<<30|n>>>2)^(n<<19|n>>>13)^(n<<10|n>>>22))+(n&s^n&r^s&r),u=d,d=c,c=l,l=o+g|0,o=r,r=s,s=n,n=g+f|0}i[0]=i[0]+n|0,i[1]=i[1]+s|0,i[2]=i[2]+r|0,i[3]=i[3]+o|0,i[4]=i[4]+l|0,i[5]=i[5]+c|0,i[6]=i[6]+d|0,i[7]=i[7]+u|0},_doFinalize:function(){var t=this._data,i=t.words,n=8*this._nDataBytes,s=8*t.sigBytes;return i[s>>>5]|=128<<24-s%32,i[14+(s+64>>>9<<4)]=e.floor(n/4294967296),i[15+(s+64>>>9<<4)]=n,t.sigBytes=4*i.length,this._process(),this._hash},clone:function(){var e=s.clone.call(this);return e._hash=this._hash.clone(),e}});t.SHA256=s._createHelper(i),t.HmacSHA256=s._createHmacHelper(i)}(Math),define("cryptojs/sha256",function(){}),define("storm/OmnitureMedia",["xdk-base/class","xdk-base/util","appmeasurement","appmeasurementMedia","cryptojs/sha256","xdk-base/device"],function(e,t,i,n,s,r){"use strict";return e.create({_monitorCounter:0,_eventNames:{VIDEO_COMPLETE:"event16"},LIVE_PROGRAMCHECK_INTERVAL:20},{s:null,__initialized:!1,_device:"",_currentEvent:{id:null,title:null},stormService:null,_sessionActive:!1,_currentPosition:0,_playedDuration:0,init:function(e,t,i){this.s=e,this._device=t,this.stormService=i,this._initMediaAnalytics(),this.__initialized=!0},isInitialized:function(){return this.__initialized},_initMediaAnalytics:function(){this.s.Media.autoTrack=!1,this.s.Media.segmentByMilestones=!0,this.s.Media.trackWhilePlaying=!0,this.s.Media.playerName=this._device,this.s.Media.trackUsingContextData=!0,this.s.Media.monitor=t.bind(this.mediaMonitor,this)},mediaMonitor:function(e,t){void 0!==e&&(this.s=e);var i=!1,n={current:0,target:0,unit:""};this._live?(this._playedDuration+=1,this._currentPsition+=1,n=function(e,t,i,n){var s=e;if(n)var r=t[i];return{current:s,target:r,unit:"s"}}(this._currentPosition,this._offsetMilestones,this._milestonesTracked,this._milestoneTrackingEnabled)):n=function(e,t,i,n,s){var r=e/t*100,a=NaN;return s&&(a=i[n]),{current:r,target:a,unit:"%"}}(this._currentPosition,this._trackDuration,this._milestones,this._milestonesTracked,this._milestoneTrackingEnabled),t&&("MILESTONE"==t.event||"SECONDS"==t.event)&&this._milestoneTrackingEnabled&&(i=!0,console.info("[OmnitureMedia] Monitor: Currently at: "+n.current+" and have played "+this._playedDuration+" seconds. Firing "+n.target+n.unit+" event"),this._milestonesTracked+=1,this._milestonesTracked>=this._milestones.length&&(this._milestoneTrackingEnabled=!1)),i&&(console.log("Firing milestone: "+n.current+" with track name: "+this._trackName),i=!1,this.setAnalyticsTags(),function(e,t){console.info("[OmnitureMedia] Monitor: Firing: "+e),t(e)}(this._trackName,this.s.Media.track),this.unsetAnalyticsTags())},mediaSetDuration:function(e){this._trackDuration=e},mediaSetPosition:function(e){var t=Math.abs(e-this._currentPosition);0==t>5&&(this._playedDuration+=t),this._live||(this._currentPosition=e)},checkLiveEvent:function(){return this.getCurrentChannelProgram(this._channelId).then(t.bind(function(e){e&&e.id&&(console.log("[omnitureMedia] checkLiveEvent: result ID= "+e.id+" TITLE="+e.title),this._currentEvent.id==e.id&&this._currentEvent.title==e.title||(this._currentEvent={id:e.id,title:e.title},console.log("[omnitureMedia] checkLiveEvent: Live event programme has changed, sending tracking event"),this.setAnalyticsTags(),this.s.Media.track(this._trackName),this.unsetAnalyticsTags())),this.resolve()},this),function(e){console.error(e),this.resolve()})},mediaOpen:function(e,i,n){if(!this.isInitialized())return void console.warn("[OmnitureMedia] Analytics hasn't been initialized yet");var s=e.get("type")||"live";s=s.toLowerCase(),this._trackName=this._getTrackNameFromAsset(e,i),this._asset=e,this._mediaType=i,this._trackDuration=n,this._setTrackingTags(e,i),console.log("[OmnitureMedia] mediaOpen("+this._trackName+", "+n+")"),"live"===s?(this._live=!0,this._trackDuration=n=-1):this._live=!1,this._channelId=e.get("id"),this._currentEvent={id:e.get("id"),title:e.get("title")},this._sessionActive=!0,this.getCurrentChannelProgram(this._channelId).then(t.bind(function(e){e&&e.id&&(this._currentEvent={id:e.id,title:e.title}),this.setAnalyticsTags();try{this.s.Media.open(this._trackName,n,this._device),this.s.Media.play(this._trackName,0)}catch(e){console.error(e)}this.unsetAnalyticsTags()},this),function(e){console.error(e),this.setAnalyticsTags();try{this.s.Media.open(this._trackName,n,this._device),this.s.Media.play(this._trackName,0)}catch(e){console.error(e)}this.unsetAnalyticsTags()}),this._milestoneTrackingEnabled=!0,this._milestonesTracked=0,this._milestones=[10,30,50,80,90],this._offsetMilestones=[10,60,300,600,1800,3600,5400,7200,9e3,10800,12600,14400,16200,18e3,19800,21600,23400,25200,27e3,28800,30600,32400,34200,36e3,37800,39600,41400,43200],this._currentPosition=0,this._playedDuration=0,this._refreshMetadataTimer=setInterval(t.bind(function(){this._live&&this.checkLiveEvent()},this),6e4)},getCurrentChannelProgram:function(e){return console.log("[OmnitureMedia] Checking current program for channel "+e),this.stormService.onAirRequest({channelId:e}).then(function(e){return console.info("[OmnitureMedia] On Air:"),console.info("[OmnitureMedia] Event ID: "+e.id),console.info("[OmnitureMedia] Event title: "+e.title),e})},_getTrackNameFromAsset:function(e,t){var i,n=e.get("eventId"),s=e.get("title"),r=e.get("type")||"live",a="VOD";if("film"==(r=r.toLowerCase()))a="movie"==t?"VOD":"TRAILER",i="ev_"+n+"::"+s+"::"+a;else if("episode"==r){a="SERIES";var o=e.get("episodeNumber"),l=e.get("seasonNumber"),c=e.get("serieTitle");i="ev_"+n+"::S"+l+" E"+o+":"+c+"::"+a}else if("live"==r){a="STREAM";var d=e.get("id");i="ev_"+d+"::"+s+"::"+a}return i},mediaPlay:function(e,t,i){if(this.isInitialized()){i=i||this._currentPosition,this._live||(this._currentPosition=i),console.log("[OmnitureMedia] mediaPlay("+this._trackName+", "+this._playedDuration+")");try{this.setAnalyticsTags(),this.s.Media.play(this._trackName,this._playedDuration)}catch(e){console.error(e)}this.unsetAnalyticsTags()}else console.warn("[OmnitureMedia] Analytics hasn't been initialized yet")},_setTrackingTags:function(e,t){var i=e.get("type")||"live";i=i.toLowerCase();var n="",s="";if("film"===i||"episode"===i){var r=e.get("genreList");if(r&&void 0!==r.main&&void 0!==r.main.content&&(n=r.main.content),"episode"===i){var a=e.get("episodeNumber");s="S"+e.get("seasonNumber")+":E"+a}this.s.movieID=null,this.s.Media.trackUsingContextData=!0,this.s.Media.trackOffsetMilestones=null,this.s.Media.trackSeconds=null,this.s.Media.trackMilestones="10,30,50,80,90"}else"live"===i&&(this.s.Media.trackMilestones=null,this.s.Media.trackOffsetMilestones="10,60,300,600",this.s.Media.trackSeconds=1800);this._genre=n,this._series=s,this._live&&(this.s.contextData["video.program"]=this._currentEvent.title,this.s.contextData["video.program.eventid"]=this._currentEvent.id),-1!==["HE","snap","sn"].indexOf(e.get("catalog"))?this._product="snap":this._product="online",this.s.Media.length=this._trackDuration},setAnalyticsTags:function(){this.s.contextData["video.genre"]=this._genre,this.s.contextData["video.series"]=this._series,this._live&&(this.s.contextData["video.program"]=this._currentEvent.title,this.s.contextData["video.program.eventid"]=this._currentEvent.id),this.s.contextData["video.product"]=this._product,null!=this._previousProductValue&&void 0!=this._previousProductValue||(this._previousProductValue=this.s.contextData["box.product"],this.s.contextData["box.product"]=this._product),console.log("[OmnitureMedia] setAnalyticsTags with values:"),console.log("genre: "+this._genre+" series: "+this._series+" program title: "+this._currentEvent.title+" program id: "+this._currentEvent.id+" product: "+this._product)},unsetAnalyticsTags:function(){this.s.contextData["video.genre"]=null,this.s.contextData["video.series"]=null,this.s.contextData["video.program"]=null,this.s.contextData["video.program.eventid"]=null,this.s.contextData["video.product"]=null},mediaStop:function(e,t,i){if(e=e||this._asset,t=t||this._mediaType,i=i||this._currentPosition,this.isInitialized()){this._setTrackingTags(e,t),console.log("[OmnitureMedia] mediaStop("+this._trackName+", "+this._playedDuration+")");try{this.setAnalyticsTags(),this.s.Media.stop(this._trackName,this._playedDuration),this.unsetAnalyticsTags()}catch(e){console.error(e)}}else console.warn("[OmnitureMedia] Analytics hasn't been initialized yet")},mediaClose:function(e,t,i){if(e=e||this._asset,t=t||this._mediaType,i=i||this._currentPosition,!this.isInitialized())return void console.warn("[OmnitureMedia] Analytics hasn't been initialized yet");if(!this._sessionActive)return void console.warn("[OmnitureMedia] mediaClose called twice");this._sessionActive=!1,this.mediaStop(e,t,i),this._setTrackingTags(e,t),this.setAnalyticsTags(),console.log("[OmnitureMedia] mediaClose("+this._trackName+")");try{this.setAnalyticsTags(),this.s.Media.close(this._trackName),this._genre=null,this._series=null,this._product=null,this.s.contextData["box.product"]=this._previousProductValue,this._previousProductValue=null,this._currentEvent={id:null,title:null},this._live=!1,this._trackName="",this.s.Media.trackMilestones=null,this.s.Media.trackOffsetMilestones=null,this.s.Media.trackSeconds=null,this.s.movieID=null,this.unsetAnalyticsTags(),clearInterval(this._refreshMetadataTimer)}catch(e){console.error(e)}},_prepareTrackingObject:function(e,t){this._getAnalyticsPlatform(),this._getAnalyticsPlatformModel();return t.hier1=t.hierarchy,t},_getAnalyticsPlatformModel:function(){var e=this._getAnalyticsPlatform(),t="";return"samsungtv"===e?t=r.id.getFirmwareYear():"playstation"===e&&(t=r.platform),t},_getAnalyticsPlatform:function(){var e="samsungtv";return"samsung"===r.platform?e="samsungtv":"ps3"!==r.platform&&"ps4"!==r.platform||(e="playstation"),e},mediaSetAsset:function(e){this._asset=e,this._channelId=e.get("id"),this._currentEvent={id:e.get("id"),title:e.get("title")}},mediaSetMediaType:function(e){this._mediaType=e}})}),define("storm/OmnitureStats",["xdk-base/class","xdk-base/util","xdk-base/config","xdk-base/promise","xdk-base/console","xdk-base/ajax","tve/TVEError","tve/sAppGridServiceHolder","storm/mgr/sAppConfigManager","storm/mgr/sLocalStorageManager","xdk-base/device","storm/OmnitureMedia","appmeasurement","appmeasurementMedia","cryptojs/sha256"],function(e,t,i,n,s,r,a,o,l,c,d,u){"use strict";var h;return h=e.create({PLATFORM:{OMNITURE:"omniture"},TRACK_PAGE_LEVELS:2},{__initialized:!1,_live:!1,_channelId:null,_trackName:"",_currentSection:"",_currentPage:"",_currentPath:"",_platformConfig:null,config:null,stormService:null,previousPageAnalytics:"",s_account:"",s:null,media:null,init:function(e){this.stormService=e,this._platformConfig=i.get("analytics.platform",null),this._platformConfig&&o.getAppGridServicePromise().then(t.bind(function(){this._initDefer=n.defer(),l.getAnalyticsConfig().then(t.bind(this._getAnalyticsConfigCallback,this))},this))},_getAnalyticsConfigCallback:function(e){if(this.isInitialized()&&this._initDefer.reject(new a(a.FACILITY.GENERAL,a.ERROR.INVALID,"AnalyticsService init: Analytics has already been initialized")),s.log("[OmnitureStats] Analytics platform used: "+this._platformConfig),this._platformConfig===h.PLATFORM.OMNITURE)try{this.config=this._parseAnalyticsConfig(e);var t=e.ACCOUNT,n=e.DEVICE;s.log("[OmnitureStats] Analytics init:"),s.log("[OmnitureStats] Account: "+t),s.log("[OmnitureStats] Device: "+n);var r=new AppMeasurement;this.s=r,this.media=new u(r,n,this.stormService),this.s_account=r.account=t,this._configureAnalytics(t),r.debugTracking=i.get("analytics.debug",!0),r.trackLocal=!0,r.trackingServer="omni.sky.de",r.trackingServerSecure="somni.sky.de",this._sAppMeasurement=r,r.contextData["box.device"]=this.config.DEVICE,r.contextData["box.product"]="online",r.contextData["box.app.version"]=i.get("version"),this.__initialized=!0,this._initDefer.resolve()}catch(e){this._initDefer.reject(new a(a.FACILITY.GENERAL,a.ERROR.INVALID,"AnalyticsService init: "+e))}},_configureAnalytics:function(e){this.s.account=e,this.s.charSet="UTF-8",this.s.trackDownloadLinks=!1,this.s.trackExternalLinks=!1,this.s.trackInlineStats=!1,this.s.linkDownloadFileTypes="exe,zip,wav,mp3,mov,mpg,avi,wmv,pdf,doc,docx,xls,xlsx,ppt,pptx",this.s.linkInternalFilters="javascript:",this.s.linkLeaveQueryString=!1,this.s.linkTrackVars="None",this.s.linkTrackEvents="None",this.s.visitorNamespace="st",this.s.dc="122";var t=c.getStoredValue(c.KEYS.USERNAME);t&&""!==t&&(this.s.visitorID=CryptoJS.SHA256(t))},_parseAnalyticsConfig:function(e){var t={};return e&&(e[d.platform]?t.DEVICE=e[d.platform]:t.DEVICE=e.DEVICE,t.ACCOUNT=e.ACCOUNT),t},login:function(e){if(this.isInitialized()){s.log("[OmnitureStats] login("+e+")");try{var t=CryptoJS.SHA256(e);this.s.visitorID=t,this.s.contextData["user.hashedCID"]=t,this.s.contextData["user.loginStatus"]="login",this.s.contextData["action.login"]=1;var i=this.s.t();i&&s.log("[OmnitureStats] Error from Omniture analytics: "+i),this.s.contextData["action.login"]=""}catch(e){s.error(e)}}else s.warn("[OmnitureStats] Analytics hasn't been initialized yet")},logout:function(){if(this.isInitialized()){s.log("[OmnitureStats] logout()");try{this.s.contextData["user.loginStatus"]="logout",this.s.contextData["action.logout"]=1;var e=this.s.t();s.log(e),this.s.contextData["action.logout"]="",delete this.s.visitorID}catch(e){s.error(e)}}else s.warn("[OmnitureStats] Analytics hasn't been initialized yet")},trackLevel:function(e,t,i){if(!this.isInitialized())return void s.warn("[OmnitureStats] Analytics hasn't been initialized yet");if(!(e>h.TRACK_PAGE_LEVELS)){var n=!1;if(!0===i&&(n=!0),void 0===t&&(t=this._currentPath),0!==t.length){var r;if(s.log('[OmnitureStats] AnalyticsService::trackLevel("'+e+'","'+t+'")'),1===e)"snap"===t.toLowerCase()?this.s.contextData["box.product"]="snap":this.s.contextData["box.product"]="online",r=this._currentSection=t,delete this._currentPath;else if(2===e){if(t===this._currentPath)return;"Home"===this._currentSection?(delete this._currentSection,r=t):r=this._currentSection+"/"+t,this._currentPath=t}(this._currentPage!==t||n)&&(this._currentPage=t,this.__setTracking({pageName:r,level1:this._currentSection,level2:this._currentPath}))}}},trackPage:function(e,t){s.log('[OmnitureStats] AnalyticsService::trackPage("'+e+'","'+t+'")'),this.mediaClose(),this.__setTracking({pageName:e,channel:t,level1:this._currentSection,level2:this._currentPath})},__setTracking:function(e){if(!this.isInitialized())return void s.warn("[OmnitureStats] Analytics hasn't been initialized yet");void 0===e.level1?delete this.s.contextData["page.level1"]:this.s.contextData["page.level1"]=e.level1,void 0===e.level2?delete this.s.contextData["page.level2"]:this.s.contextData["page.level2"]=e.level2,void 0===e.channel?delete this.s.channel:this.s.channel=e.channel,delete this.s.contextData["video.product"],this.s.pageName=e.pageName,this.s.contextData["stv.page.pageName"]=e.pageName,this.s.contextData["page.pageName"]=e.pageName;try{var t=this.s.t();t&&s.warn("[OmnitureStats] Error from Omniture analytics: "+t)}catch(e){s.error(e)}s.log('[OmnitureStats] AnalyticsService::setTracking("'+e.pageName+'")')},trackSearch:function(e){try{this.s.contextData["page.search.term"]=e;var t=this.s.t();t&&s.warn("[OmnitureStats] Error from Omniture analytics: "+t)}catch(e){s.error(e)}delete this.s.contextData["page.search.term"]},isInitialized:function(){return this.__initialized},mediaOpen:function(e,t,i){this.media.mediaOpen(e,t,i)},mediaStop:function(e,t,i){this.media.mediaStop(e,t,i)},mediaPlay:function(e,t,i){this.media.mediaPlay(e,t,i)},mediaClose:function(e,t,i){this.media.mediaClose(e,t,i)},mediaSetDuration:function(e){this.media.mediaSetDuration(e)},mediaSetPosition:function(e){this.media.mediaSetPosition(e)},mediaMonitor:function(e,t){this.media.mediaMonitor(e,t)},mediaSetAsset:function(e){this.media.mediaSetAsset(e)},mediaSetMediaType:function(e){this.media.mediaMonitor(e)},mediaCheckLiveEvent:function(){this.media.checkLiveEvent()}})}),define("tve/sServiceHolder",["tve/AccedoOvpService","xdk-base/class","xdk-base/util","xdk-base/config","xdk-base/promise","xdk-base/console","tve/StormService","storm/OmnitureStats"],function(e,t,i,n,s,r,a,o){"use strict";return new(t.create({},{__dateTimeService:null,__configurationService:null,__statusService:null,__loggingService:null,__analyticsService:null,__vodContentService:null,__stormAssetService:null,__linearContentService:null,__ovpService:null,__stormService:null,getDateTimeService:function(){return this.__dateTimeService=this.__dateTimeService||this.__getStormService(),this.__dateTimeService},getVODContentService:function(){return this.__vodContentService=this.__vodContentService||this.__getAccedoOvpService(),this.__vodContentService},getLinearContentService:function(){return this.__linearContentService=this.__linearContentService||this.__getStormService(),this.__linearContentService},getStormAssetService:function(){return this.__stormAssetService=this.__stormAssetService||this.__getStormService(),this.__stormAssetService},getAnalyticsService:function(){return this.__analyticsService=this.__analyticsService||this.__getAnalyticsService(),this.__analyticsService},__getAccedoOvpService:function(){if(this.__ovpService)return this.__ovpService;var t=n.get("tve.ovp");if(t&&t.api)return this.__ovpService=new e({baseURL:t.api}),this.__ovpService;r.error("### Unable to initialize the Ovp Service, can not find the API end-point and keys from config")},__getAnalyticsService:function(){return this.__analyticsService?this.__analyticsService:(this.__analyticsService=new o(this.__getStormService()),this.__analyticsService)},__getStormService:function(){if(this.__stormService)return this.__stormService;var e={proxy:!1,production:"production"===n.get("environment")};e.proxy=n.get("dev.proxy"),e.proxyHosts=n.get("dev.proxyHosts");var t=amd.require("xdk-base/device");return"samsung"===t.platform?e.proxy=!1:"webos"===t.platform||"lg"===t.platform||r.warn("Proxy option is "+e.proxy+"; we don't seem to be on an actual device"),this.__stormService=new a(e),this.__stormService},init:function(){}}))}),define("tvedemo/mgr/sNavigationManager",["tvedemo/helper/dialogHelper","tvedemo/mgr/sHistoryManager","storm/mgr/sLanguageManager","tve/sServiceHolder","xdk-ax/mediator","xdk-base/console","xdk-base/promise","xdk-base/util","xdk-base/ax","tve/TVEError","storm/helper/util"],function(e,t,i,n,s,r,a,o,l,c,d){"use strict";var u=c.FACILITY,h=c.ERROR,_=n.getLinearContentService();return new(l.klass.create({},{CONFIG_AUTO_NAVIGATION:!1,CONFIG_CUSTOM_HIGHLIGHT:!0,MENU_UPDATE:"menuUpdate",NAV_AVAILABLE:"navAvailable",MENU_RECONSTRUCT_COMPLETE:"menuReconstructComplete",MAIN_MENU:1,SUB_MENU:2,MENU_RESPOND_TIME:200,_menuStack:[],_selectionStack:[],_fullSelectionStack:[],_breadcrumbStack:[],_currentMenuTitle:"",_currentSelectedIndex:0,__lastLoginStatus:!1,_processing:0,_menuUpdateCallback:void 0,_menuResetCallback:void 0,isInitiated:function(){return this._menuStack.length},_resetMenu:function(e){return this._menuStack=[],this._selectionStack=[],this._breadcrumbStack=[],e=!!e,this.getMainMenu(e).then(o.bind(function(e){return this._menuStack[0]=e,this._menuStack[0]},this))},getMainMenu:function(t){return this._processing++,t=!!t,_.getNavigation().then(o.bind(function(n){var a=this._parseXMLtoMenulist(n),o=[{text:i.getString("Global.Global_Search_menu_item").toUpperCase(),id:"search",action:function(){e.input({dialogCss:"search-dialog",title:i.getString("Global.Global_SearchPopUpTitle"),message:i.getString("Global.Global_SearchPopUpMessage"),finishedTextInput:function(e){e&&s.publish("navigate",{path:"Main/SearchListing",state:{keyword:e}})},positiveText:i.getString("Suchen"),negativeText:i.getString("Global.Global_buttonBack_button")})}},{text:i.getString("MainNavigation.MainNavigation_SettingsSectionLabel").toUpperCase(),id:"setting",_children:[{text:i.getString("Settings.Settings_Menu_item_Account").toUpperCase(),id:"myAccount",path:"Main/MyAccount",requireLogin:!0},{text:i.getString("Settings.Settings_labelDeviceManagement").toUpperCase(),
id:"deviceManagement",path:"Main/Devices",requireLogin:!0},{text:i.getString("Settings.Settings_content_settings_headline")||"N/A",id:"autoplayBookmark",path:"Main/BookmarkSettings",requireLogin:!0},{text:i.getString("Settings.Settings_labelEULA").toUpperCase(),id:"eula",path:"Main/TextPage"},{text:i.getString("Settings.Settings_labelPrivacy_policy").toUpperCase(),id:"dataPrivacy",path:"Main/TextPage"},{text:i.getString("Settings.Settings_labelImprint").toUpperCase(),id:"imprint",path:"Main/TextPage"},{text:i.getString("Settings.Settings_labelTermsAndConditions").toUpperCase(),id:"tnc",path:"Main/TextPage"}]},{text:i.getString("Settings.Settings_label_MyStuff").toUpperCase(),loginStateMustBe:!0,id:"mystuff",_children:[{text:i.getString("MainNavigation.MainNavigation_WatchlistSectionLabel").toUpperCase(),id:"watchlist",path:"Main/Watchlist"},{text:i.getString("Settings.Settings_label_RecentlyWatched").toUpperCase(),id:"recentlyWatched",path:"Main/RecentlyWatched"}]},{text:i.getString("Settings.Settings_labelAccount").toUpperCase(),loginStateMustBe:!1,id:"login",path:"Main/Login"}],d=function(e){return e=e.filter(function(e){return e._children&&(e._children=d(e._children)),!!l.util.isUndefined(e.loginStateMustBe)||e.loginStateMustBe===t})};if(!a)throw r.error("Fatal error! Cannot parse XML Menu"),new c(u.NAVIGATION_MANAGER,h.INTERNAL,"Fatal error! Cannot parse XML Menu");return a.concat(d(o))},this)).complete(o.bind(function(){this._processing--},this))},_propagateSubmenu:function(e,t,i){if(i=i||!1,!e||!e.length)return r.error("Cannot propagate empty submenu"),a.reject(new c(u.NAVIGATION_MANAGER,h.INTERNAL,"Cannot propagate empty submenu"));(!t||t>=e.length||t<0)&&(t=0),this._menuStack.push(e),this._breadcrumbStack.push(this._currentMenuTitle),this._selectionStack.push(this._currentSelectedIndex);for(var n,o=a.defer(),l=0,d=e.length;l<d&&(n=(t+l)%d,!1===e[n].selectable);l++)r.warn("Menuitem not selectable at index: "+n);if(!1===e[n].selectable)throw r.error("The whole menulist is not selectable!"),new c(u.NAVIGATION_MANAGER,h.NOT_FOUND,"The whole menulist is not selectable!");return s.publish(this.MENU_UPDATE,{selection:n,target:this.SUB_MENU,promise:o,list:e,obtainFocus:!0}),this._fullSelectionStack.splice(this._menuStack.length-1,this._fullSelectionStack.length-(this._menuStack.length-1),n),this.CONFIG_AUTO_NAVIGATION||i?this._handleMenu(e[n]):(r.info("submenu propagation stopped auto navigation"),s.publish("navigate",{path:"Main/Blank",state:{navigator:this.getParentMenuitem()}}),o.promise.then(function(){return e[n]}))},insertSubmenu:function(e,t,i,n,s){return e&&e.length?(this._currentSelectedIndex=i||this._currentSelectedIndex,this._currentMenuTitle=t||this._currentMenuTitle,s=s||!1,this._propagateSubmenu(e,n,s)):(r.error("Cannot propagate empty submenu"),a.reject(new c(u.NAVIGATION_MANAGER,h.INTERNAL,"Cannot propagate empty submenu")))},handleMenu:function(e){return this._processing?(r.error("sNavigationManager busy"),a.reject(new c(u.NAVIGATION_MANAGER,h.INTERNAL,"sNavigationManager busy"))):(this._processing++,this._handleMenu(e).complete(o.bind(function(){this._processing--,s.publish(this.NAV_AVAILABLE)},this)))},_handleMenu:function(e,t,i){if(!1===e.selectable)return r.error("This item is not selectable"),a.reject(new c(u.NAVIGATION_MANAGER,h.NOT_FOUND,"This item is not selectable"));var n,l=this._getCurrentMenulist();if(this._currentSelectedIndex=l.indexOf(e),this._currentMenuTitle=e.text,-1===this._currentSelectedIndex)for(var d=0,_=l.length;d<_;d++){if(e.hasOwnProperty("id")&&l[d].hasOwnProperty("id")&&e.id===l[d].id){this._currentSelectedIndex=d;break}if(e.hasOwnProperty("text")&&l[d].hasOwnProperty("text")&&e.text===l[d].text){r.warn("Weak identity used to recover menu index"),this._currentSelectedIndex=d;break}}if(-1===this._currentSelectedIndex?(r.warn("Cannot find item in menu system"),r.warn(e),r.warn("Potential hazard when propagating next level menu")):this._fullSelectionStack.splice(this._menuStack.length-1,this._fullSelectionStack.length-(this._menuStack.length-1),this._currentSelectedIndex),!i&&e.action&&o.isFunction(e.action)&&(n=e.action()),!t&&e.path&&e.path.length){var g="Main/ProgramListing"===e.path,f={path:e.path,requireLogin:e.requireLogin,extendLoading:g,state:{navigator:e}};return r.debug("Navigate to: ",f),s.publish("navigate",f),a.when(n,function(){return e})}return e.node?a.when(n,o.bind(this._resolveXML,this,e.node)):e._children&&e._children.length?a.when(n,o.bind(this._propagateSubmenu,this,e._children)):(r.warn("No action taken for menu item",e),a.when(n,function(){return e}))},_resolveXML:function(e){var t=this._parseXMLtoMenulist(e);if(t)return this._propagateSubmenu(t);t=[];var i,s=e.getAttribute("title"),l=[],g=function(e){var t=a.defer();switch(e.displayType){case"dvd_cover":e.path="Main/MoviesListing",t.resolve(e);break;case"16:9":e.path="Main/TVShowsListing",t.resolve(e);break;default:if("LiveplannerListing"===e.id){e.path="Main/TVShowsListing",t.resolve(e);break}if("SportNewsListing"===e.id){e.path="Main/TVShowsListing",t.resolve(e);break}"EditorialSpecial"===e.id?_.cmsRequest(e.url).then(function(i){var n=d.getSanitizedValue(i,"listing.info.title"),s=d.getSanitizedValue(i,"listing.asset_listing.asset[0]");n&&s?(e.text=n.toUpperCase(),e.displayType=s.displayType,e.path="dvd_cover"===s.displayType?"Main/MoviesListing":"Main/TVShowsListing",t.resolve(e)):t.reject()}):(r.warn("Menu item displayType not recognized: "+e.displayType+" for "+e.id),t.reject())}return t.promise};switch(s&&s.length&&(s=s.toUpperCase()),e.getAttribute("structureType")){case"LandingPageHighlightsSNAP":return this.CONFIG_CUSTOM_HIGHLIGHT?n.getLinearContentService().getNavigationOverrides().then(o.bind(function(e){var t=this.getSectionMenuitem(),n=this.getParentMenuitem();if(!t||!n)throw r.error("Unexpected error: no selectionStack history was found!"),new c(u.NAVIGATION_MANAGER,h.INTERNAL,"Unexpected error: no selectionStack history was found!");try{var l=e[t.id]&&e[t.id][n.id];return i=this._parseJSONtoMenuitem(l),g(i).then(o.bind(function(e){return e.text=s,this._handleMenu(e)},this))}catch(e){return a.reject("Could not find menuitem due to: "+e)}},this)):_.getListingItem(e.getAttribute("path")).then(o.bind(function(e){return _.getSnapListingItems(e.path).then(o.bind(function(e){return e&&e.length||r.error("itemlist is empty"),o.each(e,o.bind(function(e){var t;for(var n in e)if(e.hasOwnProperty(n)){t=n;break}var s=e[t];i=this._parseSNAPJSONtoMenuitem(s,t),l.push(g(i))},this)),d.allPromises(l,!0).then(o.bind(function(e){return this._propagateSubmenu(e)},this))},this))},this));case"LandingPageHighlights":return this.CONFIG_CUSTOM_HIGHLIGHT?n.getLinearContentService().getNavigationOverrides().then(o.bind(function(e){var t=this.getSectionMenuitem();if(!t)throw r.error("Unexpected error: no selectionStack history was found!"),new c(u.NAVIGATION_MANAGER,h.INTERNAL,"Unexpected error: no selectionStack history was found!");try{var n=e[t.id];return i=this._parseJSONtoMenuitem(n),g(i).then(o.bind(function(e){return e.text=s,this._handleMenu(e)},this))}catch(e){return a.reject("Could not find menuitem due to: "+e)}},this)):_.getListingItem(e.getAttribute("path")).then(o.bind(function(e){return e&&e.length||r.error("itemlist is empty"),o.each(e,o.bind(function(e){i=this._parseJSONtoMenuitem(e),l.push(g(i))},this)),d.allPromises(l,!0).then(o.bind(function(e){return this._propagateSubmenu(e)},this))},this));case"LandingPageLiveplanner":case"LandingPageSportNews":case"LandingPageSingleListingSNAP":case"LandingPageSingleListing":return _.getListingItem(e.getAttribute("path")).then(o.bind(function(e){return e.length&&r.error("Singlelist should not be an array!"),i=this._parseJSONtoMenuitem(e),g(i).then(o.bind(function(e){return e.text=s,this._handleMenu(e)},this))},this));case"LandingPageOrderedListingSNAP":case"LandingPageOrderedListing":return _.getListingItem(e.getAttribute("path")).then(o.bind(function(e){for(var i=0,n=e.length;i<n;i++){var s=e[i];if(s.structureType&&-1!==s.structureType.indexOf("ByLexic"))return s.url=s.path,g(s).then(o.bind(function(e){return _.getLetterList(e.url).then(o.bind(function(i){var n=e.url.replace(/[^\/]*$/,""),s=!1;if(o.each(i,function(i){s=s||i.linkable,t.push({text:i.content.toString(),path:e.path,selectable:i.linkable,url:n+i.content.toString()+".json"})}),e.path=e.url,!1===s)throw r.error("No linkable letter available (No data)"),new c(u.NAVIGATION_MANAGER,h.NOT_FOUND,"No linkable letter available (No data)");return this._propagateSubmenu(t)},this))},this))}},this));case"LandingPageDoubleListing":return _.getListingItem(e.getAttribute("path")).then(o.bind(function(e){return i={text:s,path:"Main/MixedListing",listings:e},this._handleMenu(i)},this));case"EditorialListing":return i={text:s,path:"Main/MoviesListing",url:e.getAttribute("path")},this._handleMenu(i);case"YearOrder":return i={text:s,path:"Main/MoviesListing",url:e.getAttribute("path"),id:"ByYear"},this._handleMenu(i)}return r.error("[sNavigationManager _resolveXML] unhandled resolution to "+e.getAttribute("structureType")),a.reject(new c(u.NAVIGATION_MANAGER,h.INTERNAL,"No resolution to this XML node!"))},_parseXMLtoMenulist:function(e){if(!e||!e.childNodes||!e.childNodes.length)return!1;for(var t,i,n,s=[],r=0,a=e.childNodes.length;r<a;r++)if(t=e.childNodes[r].getAttribute("label"),i=e.childNodes[r].getAttribute("structureType"),n=e.childNodes[r].getAttribute("hide"),t&&t.length&&"true"!==n)switch(t=t.toUpperCase(),i){case"LandingPageStartScreen":s.push({text:t,id:"home",path:"Main/Home",node:e.childNodes[r]});break;case"LandingPageEPG":s.push({text:t,id:"programGuide",path:"Main/ProgramListing",node:e.childNodes[r]});break;case"ClipSection":case"ReplaysSection":case"LandingPageWebView":break;case"LandingPageHighlightsSport":s.push({text:t,id:"sport",path:"Main/SportHome",node:e});break;case"SportSection":case"FilmSection":case"SeriesSection":case"DocuSection":case"KidsSection":case"SnapSection":default:s.push({text:t,id:i,node:e.childNodes[r]})}return s},_parseJSONtoMenuitem:function(e){return{text:e.title&&e.title.toUpperCase(),url:e.path,id:e.structureType,displayType:e.displayType}},_parseSNAPJSONtoMenuitem:function(e,t){return{text:e.title&&e.title.toUpperCase(),url:e.path,id:t,displayType:e.display_type?e.display_type:"16:9"}},triggerUpdateMenu:function(e,t){var i,n=this.getSectionMenuitem();return this.__lastLoginStatus=e,this.getMainMenu(this.__lastLoginStatus).then(o.bind(function(e){if(this._menuStack[0]=e,o.isUndefined(t)?(o.each(e,o.bind(function(e,t){if(n&&n.id===e.id)return i=t,o.breaker},this)),o.isNumber(i)&&(this._selectionStack[0]=i,this._fullSelectionStack[0]=i)):(this._selectionStack[0]=t,this._fullSelectionStack[0]=t),1===this._menuStack.length){var r=a.defer();return s.publish(this.MENU_UPDATE,{selection:0,list:this._menuStack&&this._menuStack[0],target:this.MAIN_MENU,promise:r,obtainFocus:!1}),r.promise}if(2===this._menuStack.length){var r=a.defer(),l=o.isArray(this._fullSelectionStack)&&this._fullSelectionStack.length>0?this._fullSelectionStack[this._fullSelectionStack.length-1]:0;return s.publish(this.MENU_UPDATE,{selection:l,list:this._getCurrentMenulist(),target:this.SUB_MENU,promise:r,obtainFocus:!1}),r.promise}},this))},triggerResetMenu:function(e,t){return this._resetMenu(this.__lastLoginStatus).then(o.bind(function(){var i=a.defer();return s.publish(this.MENU_UPDATE,{selection:t||0,list:this._menuStack&&this._menuStack[0],target:this.MAIN_MENU,promise:i,obtainFocus:!e}),i.promise},this))},returnUpperLevelMenu:function(e){if(e=e||!1,this._menuStack.length<=1)return r.info("Top level menu reached"),a.resolve("Top level menu reached");var t=this.getParentMenuitem(),i=a.defer();return t&&t.fixedMenu?(r.info("This menu is not collapsible"),this._menuStack.length):(this._menuStack.pop(),this._breadcrumbStack.pop(),!1===e?this._menuStack.length>1?s.publish(this.MENU_UPDATE,{selection:this._popLastSelection(),list:this._getCurrentMenulist(),target:this.SUB_MENU,promise:i,obtainFocus:!1}):(s.publish(this.MENU_UPDATE,{selection:this._popLastSelection(),list:this._menuStack&&this._menuStack[0],target:this.MAIN_MENU,promise:i,obtainFocus:!0}),this._selectionStack=[],this._breadcrumbStack=[]):this._menuStack.length<=1&&(this._selectionStack=[],this._breadcrumbStack=[]),i.promise)},getBreadcrumb:function(){return this._breadcrumbStack.join(" / ")},getPath:function(){return this._breadcrumbStack.join("/")},getRootSectionName:function(){return this._breadcrumbStack[0]},_getCurrentMenulist:function(){return this._menuStack.length?this._menuStack[this._menuStack.length-1]:[]},_popLastSelection:function(){return this._selectionStack.length?this._selectionStack.pop():0},getLastSelection:function(){return this._selectionStack.length?this._selectionStack[this._selectionStack.length-1]:0},getSelectionIndex:function(e){return!this._selectionStack.length||e>=this._selectionStack.length||e<0?0:this._selectionStack[e]},getParentMenuitem:function(){return!this._menuStack.length||!this._selectionStack.length||this._menuStack.length<2?null:this._menuStack[this._menuStack.length-2][this._selectionStack[this._selectionStack.length-1]]},getSectionMenuitem:function(){if(!this._selectionStack.length)return null;var e=this._selectionStack&&o.isArray(this._selectionStack)&&this._selectionStack[0];return o.isNumber(e)&&this._menuStack&&o.isArray(this._menuStack)&&this._menuStack[0]&&o.isArray(this._menuStack[0])?this._menuStack[0][e]:null},cloneCurrentMenuStack:function(){return o.clone(this._menuStack,!0)},cloneCurrentTrackStack:function(){return this._fullSelectionStack.slice()},cloneCurrentBreadcrumb:function(){return this._breadcrumbStack.slice()},hardConstructMenu:function(e,i,n){if(!(e&&i&&n&&o.isArray(e)&&o.isArray(i)&&o.isArray(n)&&e.length))return r.error("param mismatch!"),a.reject(new c(u.NAVIGATION_MANAGER,h.INTERNAL,"param mismatch!"));if(!i.length)return s.publish(this.MENU_RECONSTRUCT_COMPLETE),a.resolve();var l=o.clone(e,!0),d=i.slice(),_=n.slice(),g=a.defer(),f=g.promise;return this.getMainMenu(this.__lastLoginStatus).then(o.bind(function(e){var i=l[0][d[0]],n=-1;if(!i)return void g.reject();for(var a=0,c=e.length;a<c;a++)if(e[a].id===i.id){n=a;break}if(-1===n)return r.warn("menu branch node not found"),t.back(),void g.resolve();l[0]=e,d[0]=n,this._menuStack=l,this._selectionStack=d.slice(0,l.length-1),this._fullSelectionStack=d,this._breadcrumbStack=_,l.length>1?s.publish(this.MENU_UPDATE,{selection:this._fullSelectionStack[this._fullSelectionStack.length-1],list:this._getCurrentMenulist(),target:this.SUB_MENU,promise:g,obtainFocus:!1}):s.publish(this.MENU_UPDATE,{selection:o.isArray(this._fullSelectionStack)&&this._fullSelectionStack.length>0?this._fullSelectionStack[this._fullSelectionStack.length-1]:0,list:o.isArray(this._menuStack)&&this._menuStack[0],target:this.MAIN_MENU,promise:g,obtainFocus:!1})},this),function(){g.reject()}),f.complete(o.bind(function(){s.publish(this.MENU_RECONSTRUCT_COMPLETE)},this)),f},getSeriesBaseNode:function(e){var t=e||"SeriesSection";return this.getMainMenu(this.__lastLoginStatus).then(o.bind(function(e){var i={node:null,index:0};return o.each(e,function(e,n){if(e.id===t)return i.node=e,i.index=n,o.breaker}),i},this))},hasSeriesBaseNavigationItem:function(){return this.getSeriesBaseNode().then(function(e){return!o.isUndefined(e.node)}).fail(function(){return a.resolve(!1)})},navigateToSeriesBasePage:function(e,t){var i,a=t||null;return e=e||!1,this.getSeriesBaseNode(a).then(o.bind(function(a){if(!o.isUndefined(a.node)){var l,d,_=this._parseXMLtoMenulist(a.node.node);if(o.each(_,o.bind(function(e,n){if(t){if(i="FilmSection"===t?"alle filme":"alle serie",i="alle serie","FilmSection"===t?i="alle filme":"SportSection"===t&&(i="live planer"),e.text.toLowerCase().indexOf(i)>-1)return l=e,d=n,o.breaker}else if(e&&!this._parseXMLtoMenulist(e.node))return l=e,d=n,o.breaker},this)),_&&l)return n.getLinearContentService().getNavigationOverrides().then(o.bind(function(t){var i;if(!a.node)throw r.error("Unexpected error: no selectionStack history was found!"),new c(u.NAVIGATION_MANAGER,h.INTERNAL,"Unexpected error: no selectionStack history was found!");try{var n=t[a.node.id];i=this._parseJSONtoMenuitem(n)}catch(e){this.updateMenuAfterSeriesNavigate(a,{subMenuItems:_,subMenuItem:l,subMenuIndex:d}).resolve()}i.path="Main/TVShowsListing";var o=this.updateMenuAfterSeriesNavigate(a,{subMenuItems:_,subMenuItem:l,subMenuIndex:d}),g={path:i.path,requireLogin:!1,extendLoading:!1,historySkip:e,navigatedPromise:o,state:{navigator:i}};s.publish("navigate",g)},this))}},this))},updateMenuAfterSeriesNavigate:function(e,t){var i=a.defer();return i.promise.then(o.bind(function(){return this.triggerResetMenu(!0,e.index).done(o.bind(function(){this._currentSelectedIndex=e.index,this._selectionStack.push(this._currentSelectedIndex),this._currentMenuTitle=e.node.text,this._breadcrumbStack.push(e.node.text),this._menuStack.push(t.subMenuItems),s.publish(this.MENU_UPDATE,{selection:t.subMenuIndex,target:this.SUB_MENU,promise:a.defer(),list:t.subMenuItems,obtainFocus:!0})},this))},this)),i}}))}),define("tvedemo/ctrl/RoutableController",["xdk-base/class","xdk-ax/mvc/Controller","xdk-ax/mediator","xdk-base/util","xdk-ax/focusManager","xdk-base/promise","tvedemo/mgr/sNavigationManager","tve/sServiceHolder","storm/OmnitureStats","xdk-base/console"],function(e,t,i,n,s,r,a,o,l,c){"use strict";var d=e.create(t,{getDefaultState:function(){return{}}},{__state:{},__historyFocus:null,init:function(e){this.__state=this.constructor.getDefaultState(),this._super(e)},setView:function(e){this._super(e),e.setOption("forwardFocus",!0)},getContext:function(){return n.clone(this.getState())},getState:function(){return this.__state},getPathStates:function(){for(var e=this.getState(),t=this.getParentController();t&&t instanceof d;)e=n.extend(e,t.getState()),t=t.getParentController();return e},extendPathStates:function(e){return n.extend(e,this.getPathStates())},updateState:function(e){var t,i=this.constructor.getDefaultState();for(t in e)n.isUndefined(i[t])&&c.error("Unmatched state. All the state should be predefined with a default State by getDefaultState function.");return this.__state=n.clone(e,!0),this},getSubControllerLocation:function(){return this.getView()},_setupSubtree:function(e){var t,i,s,a,o=0,l=this._subControllers.length,c=[];for(this.setup(e),e.setupPending=r.when(e.setupPending,n.bind(function(){return this._navigationBacktrace(e)},this));o<l;o++)t=this._subControllers[o],i=t.getId(),s=e&&e.subContexts&&e.subContexts[i]?e.subContexts[i]:{},s=n.extend(s,e),c.push(e.setupPending.then(function(){return t._setupSubtree(s)}));return a=c.length>0?r.all(c):e.setupPending,this.postSetup?(a&&a.then(n.bind(function(){this.postSetup(e)},this)),r.resolve(this.postSetup(e))):r.resolve(!0)},_navigationBacktrace:function(e){return!0===e.historyBack?e.__menuClone?a.hardConstructMenu(e.__menuClone.navigationTree,e.__menuClone.navigationTrace,e.__menuClone.breadcrumb):(i.publish(a.MENU_RECONSTRUCT_COMPLETE,!0),a.triggerResetMenu(!0)):(a.isInitiated()&&this.saveMenuState(),r.resolve())},saveMenuState:function(){this.__state.__menuClone={breadcrumb:a.cloneCurrentBreadcrumb(),navigationTree:a.cloneCurrentMenuStack(),navigationTrace:a.cloneCurrentTrackStack()}},trackLevel:function(e,t,i){o.getAnalyticsService().trackLevel(e,t,i)},trackPage:function(e,t){o.getAnalyticsService().trackPage(e,t)}});return d}),define("storm/tmpl/splash",["xdk-ui-basic/Layout","xdk-ax/Container","xdk-ui-basic/Image","xdk-ui-basic/Label","xdk-base/config"],function(e,t,i,n,s){"use strict";return function(){return{klass:e,id:"#splashView",width:1,alignment:e.HORIZONTAL,focusable:!0,children:[{klass:i,css:"backdrop",src:"img/skystorm/splash.png"},{klass:n,css:"info",id:"info",text:"UI version: "+s.get("version")},{id:"loaderSpinner",klass:i,css:"load",src:"img/loading/load.gif"}]}}}),define("xdk-base/device/interface/Id",["xdk-base/Interface"],function(e){"use strict";var t=e.create("Id",{getDeviceType:[],getHardwareType:[],getMac:[],getFirmware:[],getFirmwareYear:[],getUniqueID:[],getModel:[],getIP:[]});return t.HARDWARE_TYPE={BD:"Bluray",TV:"TV",MONITOR:"Monitor",HOME_THEATRE:"Home Theatre",EMULATOR:"Emulator",WORKSTATION:"Workstation",STB:"Set Top Box",CONSOLE:"Console",CONSOLE_MONITOR:"Console Monitor",MOBILE:"Mobile Device",UNKNOWN:"Unknown"},t}),define("xdk-mouse/mouseHandler",["xdk-base/core","xdk-ax/focusManager","xdk-base/Env","xdk-base/device","xdk-base/util","xdk-ax/mvc/AppRoot","xdk-ax/evt/type","xdk-base/console","xdk-base/device/interface/Id","xdk-base/config"],function(e,t,i,n,s,r,a,o,l,c){"use strict";function d(e){return e?!e.__comp&&e.parentNode&&e.parentNode!==document.body?d(e.parentNode):e.__comp||null:null}var u,h,_,g,f,p,m,v,b,S,y,E,k,C,T=null,x=null,I=!1,w=null,L=null,A=null,D=!1,P=null,R=null,O=null,N=!1;f=function(e){var t;if(e!==I){if(t=F(),I=e)return void t.addClass("mouse-on");t.removeClass("mouse-on"),g()}},g=function(e){if(F().removeClass("mouse-focus-on-non-focusable"),I){if(e&&t.focus(e,{skipForwardFocus:!0}))return;if(!_)return void t.focus(null);F().addClass("mouse-focus-on-non-focusable")}t.ensureFocus()},p=function(){if(P&&!1===P())return!0;f(!0)},m=function(e){if(e&&e.source&&"device"!==e.source)return!0;if(!I)return!0;return!(!R||!1!==R())||(f(!1),!1)},v=function(e){e=e||window.event;var i=e.target||e.srcElement,n=d(i);if(B().isBlockingMouse())return!0;if(I||(p(),F().addClass("mouse-on")),I=!0,!n)return g(null),!0;for(;n&&!t.isCompFocusable(n);)n=n.getParent();return!(!O||!1!==O(n))||(n?(g(n),!0):(g(null),!0))},A=function(e){var t=e.keyCode,i=!1;switch(t){case 1536:p(),i=!0;break;case 1537:m(),i=!0,D=!0,s.defer().then(function(){D=!1}).done()}return!i&&!D||(e.stopPropagation(),e.preventDefault(),!1)},b=function(){if("webos"===n.platform)return void document.addEventListener("keydown",A,!0);if("lg"===n.platform&&!(n.id.getFirmwareYear()<=2011&&n.id.getHardwareType()===l.HARDWARE_TYPE.EMULATOR))return w=window.onmouseon,L=window.onmouseoff,window.onmouseon=p,void(window.onmouseoff=m);if("wiiu"===n.platform&&nwf&&window===nwf.display.DisplayManager.singleton().getTVDisplay().window){var e,t,i=[];i[0]=nwf.input.WiiRemote.getController(nwf.input.WiiRemote.REMOTE_1),i[1]=nwf.input.WiiRemote.getController(nwf.input.WiiRemote.REMOTE_2),i[2]=nwf.input.WiiRemote.getController(nwf.input.WiiRemote.REMOTE_3),i[3]=nwf.input.WiiRemote.getController(nwf.input.WiiRemote.REMOTE_4);for(e in i)t=i[e],t.cursor.addEventListener(nwf.events.DPDControlEvent.UPDATE,S);m=s.wrap(m,function(e){return!!N||e()})}F().addEventListener(a.KEY,m,!0)},S=function(t){N=!0,I||(o.info("[Wii]Mouse ON with the evt"+t),p()),x&&s.clearDelay(x),x=e.getGuid(),s.delay(.2,x).then(y).done()},y=function(){o.info("[Wii]Mouse off outside the screen"),N=!1,x=null},E=function(){if("webos"===n.platform)return void document.removeEventListener("keydown",A);if("lg"===n.platform&&!(n.id.getFirmwareYear()<=2011&&n.id.getHardwareType()===l.HARDWARE_TYPE.EMULATOR))return window.onmouseon=w,void(window.onmouseoff=L);if("wiiu"===n.platform&&nwf){var e,t,i=[];i[0]=nwf.input.WiiRemote.getController(nwf.input.WiiRemote.REMOTE_1),i[1]=nwf.input.WiiRemote.getController(nwf.input.WiiRemote.REMOTE_2),i[2]=nwf.input.WiiRemote.getController(nwf.input.WiiRemote.REMOTE_3),i[3]=nwf.input.WiiRemote.getController(nwf.input.WiiRemote.REMOTE_4);for(e in i)t=i[e],t.cursor.removeEventListener(nwf.events.DPDControlEvent.UPDATE,S)}F().removeEventListener(a.KEY,m,!0)},k=function(){T.addEventListener("mouseover",v)},C=function(){T.removeEventListener("mouseover",v)};var M=function(e){var t=e.target||e.srcElement,i={deltaY:e.wheelDelta,target:d(t)},n=B();n.dispatchEvent(n.EVT_ON_MOUSE_WHEEL,i)},B=function(){return u=u||i.singleton()},F=function(){return h=h||r.singleton(),h.getView()};return{start:function(){if(T=T||F().getRoot(),_=c.get("mouse.keep-focus",!1),b(),k(),"lg"===n.platform&&window.NetCastGetMouseOnOff){var e="ON"===window.NetCastGetMouseOnOff().toUpperCase();f(e)}T.addEventListener("mousewheel",M)},stop:function(){T=T||F().getRoot(),E(),C(),T.removeEventListener("mousewheel",M),I=!1},isMouseOn:function(){return I},setMouseOnCallback:function(e){P=e},setMouseOffCallback:function(e){R=e},setMouseOverCallback:function(e){O=e}}}),define("tve/videoPlaybackService/model/PlaybackInfo",["xdk-base/class"],function(e){return e.create({},{currentTime:0,duration:0,state:null,init:function(e){e=e||{},this.duration=e.duration||0,this.currentTime=e.currentTime||0,this.state=e.state||null}})}),define("tve/videoPlaybackService/model/Playlist",["xdk-base/class","tve/videoPlaybackService/model/PlaybackInfo"],function(e,t){return e.create({},{items:[],currentItemIdx:0,currentPlaybackInfo:null,metadata:{},init:function(e){e=e||{},this.items=e.items||[],this.currentItemIdx=e.currentItemIdx||0,this.metadata=e.metadata||{},this.currentPlaybackInfo=new t}})}),define("tve/videoPlaybackService/model/PlaylistItem",["xdk-base/class"],function(e){return e.create({},{id:null,url:null,metadata:{},drmAttributes:{},init:function(e){e=e||{},this.id=e.id||null,this.url=e.url||null,this.metadata=e.metadata||{},this.drmAttributes=e.drmAttributes||null}})}),define("tve/videoPlaybackService/evt/VideoPlaybackControlsEvent",{SetControlsInPlayState:"VideoPlaybackControlsEvent:SetControlsInPlayState",SetControlsInPauseState:"VideoPlaybackControlsEvent:SetControlsInPauseState",UpdatePlayheadState:"VideoPlaybackControlsEvent:UpdatePlayheadState",UpdateVolumeState:"VideoPlaybackControlsEvent:UpdateVolumeState",DismissControls:"VideoPlaybackControlsEvent:DismissControls",NextPlaylistItem:"VideoPlaybackControlsEvent:NextPlaylistItem",PreviousPlaylistItem:"VideoPlaybackControlsEvent:PreviousPlaylistItem",NotifyError:"VideoPlaybackControlsEvent:NotifyError",SuspendUI:"VideoPlaybackControlsEvent:SuspendUI",TimePlayedIncreased:"VideoPlaybackControlsEvent:TimePlayedIncreased"}),define("tve/videoPlaybackService/evt/VideoPlaybackStatusEvent",{PlayState:"VideoPlaybackStatusEvent:PlayState",PauseState:"VideoPlaybackStatusEvent:PauseState",BufferState:"VideoPlaybackStatusEvent:BufferState",StopState:"VideoPlaybackStatusEvent:StopState",SkippingState:"VideoPlaybackStatusEvent:SkippingState"}),define("tve/videoPlaybackService/evt/VideoControlsStatusEvent",{DismissSelected:"VideoControlsStatusEvent:DismissSelected",PlaySelected:"VideoControlsStatusEvent:PlaySelected",PauseSelected:"VideoControlsStatusEvent:PauseSelected",VolumeChanged:"VideoControlsStatusEvent:VolumeChanged",PlayheadMoved:"VideoControlsStatusEvent:PlayheadMoved",NextPlaylistItemSelected:"VideoControlsStatusEvent:NextPlaylistItemSelected",PreviousPlaylistItemSelected:"VideoControlsStatusEvent:PreviousPlaylistItemSelected"}),define("xdk-base/device/interface/Suspendable",["xdk-base/Interface"],function(e){"use strict";var t=e.create("Suspendable",{suspend:[],getSuspendedCount:[]});return t.SuspendedPlayback=e.create("SuspendedPlayback",{restore:["cb"],dispose:[],getMediaMeta:[],getPlayer:[]}),t}),define("xdk-base/device/interface/Preloadable",["xdk-base/Interface","xdk-base/class"],function(e,t){"use strict";var i=e.create("Preloadable",{preload:["url","opts"],getPreloadedCount:[]});return i.PreloadedPlayback=e.create("PreloadedPlayback",{play:["pos"],dispose:[],getMediaMeta:[],getPlayer:[]}),i}),define("xdk-base/device/AbstractPlayer",["xdk-base/class","xdk-base/console","xdk-base/device/interface/Player"],function(e,t,i){"use strict";return e.createAbstract([i],{PLAYBACK_STATE:{PLAYING:"playing",PAUSED:"paused",STOPPED:"stopped"}},{__id:null,speed:function(e){t.warn("Speeding "+e+" is not supported in the player")},getPlaybackSpeed:function(){return t.warn("no play back speed in the player"),1},getBitrates:function(){return t.debug("no bitrate provided"),null},getId:function(){return this.__id},setId:function(e){this.__id=e}})}),define("xdk-base/device/FallbackSuspendedPlayback",["xdk-base/class","xdk-base/device/interface/Suspendable","xdk-base/device/AbstractPlayer","xdk-base/util"],function(e,t,i,n){"use strict";return e.create([t.SuspendedPlayback],{},{init:function(e,t,i){this.__media=e,this.__player=t,this.__url=i.url,this.__opts=i.opts||{},this.__pos=i.pos||0,this.__state=i.state},restore:function(e){var t=this.__media,s=n.extend(n.extend({},this.__opts,!0),{player:this.__player}),r=this.__state===i.PLAYBACK_STATE.STOPPED;if(!r){var a=n.bind(function(n){switch(n.toState){case t.PLAYING:this.__state===i.PLAYBACK_STATE.PAUSED&&t._doPause(),t.__stateMachine.removeEventListener(t.EVT_STATE_CHANGED,a),e()}},this);t.__stateMachine.addEventListener(t.EVT_STATE_CHANGED,a)}if(t._doLoad(this.__url,s),r)return void e();t._doPlay({sec:this.__pos})},dispose:function(){this.__player=null},getMediaMeta:function(){return{url:this.__url,opts:this.__opts}},getPlayer:function(){return this.__player}})}),define("xdk-base/device/FallbackPreloadedPlayback",["xdk-base/class","xdk-base/device/interface/Preloadable","xdk-base/util","xdk-base/device/playerRegistry","xdk-base/core","xdk-base/exception"],function(e,t,i,n,s,r){"use strict";return e.create([t.PreloadedPlayback],{},{init:function(e,t,i){this.__media=e,this.__url=t,this.__opts=i||{},this.__opts.player?this.__player=this.__opts.player:this.__player=n.getPlayer(this.__opts)},play:function(e){var t=this.__media;t.load(this.__url,this.__opts),t.play({sec:e})},dispose:function(){},getMediaMeta:function(){return{url:this.__url,opts:this.__opts}},getPlayer:function(){return this.__player}})}),define("xdk-base/device/interface/SubtitleStgy",["xdk-base/Interface"],function(e){"use strict";var t=e.create("SubtitleStgy",{setPlayer:["player"],showSubtitle:["id"],hideSubtitle:[],getCurrentSubtitle:[],getSubtitles:[]});return t.TYPE="internal",t}),define("xdk-base/device/interface/ExtSubtitleStgy",["xdk-base/Interface","xdk-base/device/interface/SubtitleStgy"],function(e,t){"use strict";var i=e.create("ExtSubtitleStgy",[t],{prepare:["subtitleOption"]});return i.TYPE="external",i}),define("xdk-base/device/MediaSubtitle",["xdk-base/class","xdk-base/config","xdk-base/console","xdk-base/promise","xdk-base/core","xdk-base/exception","xdk-base/util","xdk-base/device/interface/SubtitleStgy","xdk-base/device/interface/ExtSubtitleStgy","require"],function(e,t,i,n,s,r,a,o,l,c){"use strict";var d=o.TYPE,u=l.TYPE;return e.create({},{__player:null,__currentId:-1,__subtitleArr:null,__idMapping:[],__internalStgy:null,__externalStgy:null,__subtitleStgy:null,init:function(e,t,i){this.__subtitleStgy=e||{},this.__player=t,this.__preloaded=i},prepare:function(t){var n,a,d,u;if(n=this.__subtitleStgy.internal,i.info("[XDK] internal strategy is loading now"),n){if(a=c(n),!e.hasImpl(a,o))throw s.createException(r.ILLEGAL_STATE,"Internal Subtitle doesn't implement subtitle strategy");try{this.__internalStgy=new a,i.info("[XDK] Success to create subtitle internal strategy "+n)}catch(e){i.warn("[XDK] Fail to create subtitle internal strategy "+n)}this.__internalStgy.setPlayer(this.__player,this.__preloaded)}if(d=this.__subtitleStgy.external,i.info("[XDK] external strategy is loading now"),d){if(u=c(d),!e.hasImpl(u,l))throw s.createException(r.ILLEGAL_STATE,"External Subtitle doesn't implement subtitle strategy");try{this.__externalStgy=new u,i.info("[XDK] Success to create subtitle external strategy "+d)}catch(e){i.warn("[XDK] Fail to create subtitle external strategy "+d)}this.__externalStgy.setPlayer(this.__player,this.__preloaded),this.__externalStgy.prepare(t)}},showSubtitle:function(e){if(a.isUndefined(e)){if(-1===this.__currentId)return n.reject(s.createException(r.ILLEGAL_STATE," Fail to sho the subtitle when no available subtitle strategy."));e=this.__currentId}var t;try{t=this.__getStgyById(e)}catch(e){return n.reject(e)}if(t){var i=this.__idMapping[e];return this.__currentId=e,t.showSubtitle(i)}return n.reject(s.createException(r.ILLEGAL_STATE," Fail to show the subtitle when no available subtitle strategy."))},hideSubtitle:function(){
if(-1===this.__currentId)return n.reject(s.createException(r.ILLEGAL_STATE," Fail hide the subtitle when no available subtitle to hide."));var e=this.__getStgyById(this.__currentId);return e?e.hideSubtitle():n.reject(s.createException(r.ILLEGAL_STATE," Fail hide the subtitle when no available subtitle strategy."))},__getStgyById:function(e){if(!this.__subtitleArr||e>this.__subtitleStgy.length)throw s.createException(r.ILLEGAL_ARGUMENT," the id is not in a possible range");var t=this.__subtitleArr[e];return t.type===d&&this.__internalStgy?this.__internalStgy:t.type===u&&this.__externalStgy?this.__externalStgy:null},getCurrentSubtitle:function(){return-1===this.__currentId?n.reject(s.createException(r.ILLEGAL_STATE," Fail to get current substitle since it doesn't exist or set")):n.resolve(this.__subtitleArr[this.__currentId])},getSubtitles:function(){if(this.__subtitleArr)return n.resolve(this.__subtitleArr);var e=[],t=a.bind(function(e){this.__idMapping.push(e.id),e.id=this.__subtitleArr.length,this.__subtitleArr.push(e)},this);return this.__subtitleArr=[],this.__externalStgy&&e.push(this.__externalStgy.getSubtitles().then(a.bind(function(e){a.each(e,t)},this))),this.__internalStgy&&e.push(this.__internalStgy.getSubtitles().then(a.bind(function(e){a.each(e,t)},this))),n.all(e).then(a.bind(function(){return this.__subtitleArr},this))},deinit:function(){this.__externalStgy&&this.__externalStgy.deinit&&this.__externalStgy.deinit(),this.__internalStgy&&this.__internalStgy.deinit&&this.__internalStgy.deinit()}})}),define("css!xdk-base/device/css/Media",[],function(){}),define("xdk-base/device/Media",["xdk-base/class","xdk-base/EventDispatcher","xdk-base/device/interface/Suspendable","xdk-base/device/interface/Preloadable","xdk-base/device/FallbackSuspendedPlayback","xdk-base/device/FallbackPreloadedPlayback","xdk-base/device/playerRegistry","xdk-base/core","xdk-base/util","xdk-base/console","xdk-base/config","require","xdk-base/exception","xdk-base/promise","xdk-base/device/AbstractPlayer","xdk-base/device/interface/Player","xdk-base/device/MediaSubtitle","css!./css/Media"],function(e,t,i,n,s,r,a,o,l,c,d,u,h,_,g,f,p){"use strict";var m,v,b=f.PLAYBACK_STATE,S=f.PLAYBACK_ERRORS;return m=e.create(t,{singleton:function(){return v||(v=new m),v}},{STOPPED:0,PLAYING:1,PAUSED:2,SKIPPING:3,SPEEDING:4,BUFFERING:5,CONNECTING:6,EVT_STATE_CHANGED:"media:state-change",EVT_BUFFERING_PROGRESS:"media:buffering-progress",EVT_TIME_UPDATE:"media:time-update",EVT_FINISHED:"media:finish",EVT_ERROR:"media:error",EVT_PUSHED:"media:pushed",EVT_POPPED:"media:popped",__state:0,__prevState:0,__lastReceivedNonSkipState:0,__hasError:!1,__player:null,__url:"",__opts:null,__type:null,__drm:null,__parentNode:null,__skipDelayHandle:null,__accumulatedArrivalTime:null,__accumulatedStep:null,__updatedTime:null,__multiAudioStgy:null,__playbackStack:[],__pushing:!1,__popping:!1,__stateMachine:null,__preloaded:{},__backgroundPlayerList:[],__subtitleModule:null,__savedStrategies:{},__suspendedStrategies:[],init:function(){this._super(),this.__stateMachine=new t},deinit:function(){this.__player&&this.__player.reset(),this.__resetStgies(),this.__url="",this.__opts=null,this._super()},_extractMediaContainer:function(e){return/.mp4\?|\.mp4$/i.test(e)?"mp4":/.wmv\?|\.wmv$|.wma\?|\.wma$|.asf\?|\.asf$/i.test(e)?"asf":/.m3u8\?|\.m3u8$/i.test(e)?"hls":/.mp3\?|\.mp3$/i.test(e)?"mp3":"*"},load:function(e,t){this.__popping||this._doLoad(e,t)},_doLoad:function(e,t){var i,n=l.bind(function(){this.__resetStgies(),this.__multiAudioStgy=this.__prepareAudioTrack(this.__player),this.__subtitleModule=this.__prepareSubtitle(this.__player,t)},this);t=t||{},t.type=t.type||this._extractMediaContainer(e),t.drm=t.drm||void 0;try{i=this.__getPlayer(t)}catch(e){throw this._onError(S.RENDER.UNSUPPORTED,"Exception caught when trying to load the media with type = "+t.type+", drm = "+t.drm+":\n"+e.message),this.__player&&(this.__backgroundPlayerList.indexOf(this.__player)<0&&this.__player.reset(),this.__player=null),e}if(this.__url===e&&i===this.__player&&!t.forceReload&&!this.__hasError)return void n();this.__hasError=!1,this.__url=e,this.__player!==i&&(this.__player&&this.__backgroundPlayerList.indexOf(this.__player)<0&&this.__player.reset(),this.__player=i),this.__player.prepare(t),n(),this.__type=t.type,this.__drm=t.drm,this.__url=e,this.__opts=t,this.__player.load(e,t)},__prepareSubtitle:function(e,t,i){var n,s,r,a;if(n=e.getId(),!(r=d.get("device.subtitleStgy",null)))return null;if(!(s=r[n])||!s.internal&&!s.external)return null;try{a=new p(s,e,i),a.prepare(t.subtitle),c.info("[XDK] create the subtitle")}catch(e){c.warn("[XDK] Fail to prepare subtitle")}return a},__prepareAudioTrack:function(e,t){var i,n,s,r,a;if(i=e.getId(),!(n=d.get("device.multiAudioTrackStgy",null)))return null;if(s=n[i],!n||!s)return null;c.info("[XDK] Multi Audio Track exist "+s),r=u(s);try{a=new r(e),c.info("[XDK] Linked the player and multi audio track")}catch(e){c.warn("[XDK] Fail to load the audio track : "+s+" : "+e.name)}return a},play:function(e){this.__popping||this._doPlay(e)},_doPlay:function(e){if(!(this.isState(this.SKIPPING)||this.isState(this.BUFFERING)||this.isState(this.CONNECTING))){if(!this.__player)return void c.warn("Player is not ready, please call load() first to load up a player implementation.");l.isNumber(e)?e={sec:e}:e||(e={}),this.__player.play(e)}},stop:function(){this.isState(this.STOPPED)||this.__popping||(this._clearSkipDelayData(),this.__player&&this.__player.stop())},pause:function(){this.__popping||this._doPause()},_doPause:function(){(this.isState(this.PLAYING)||this.isState(this.SPEEDING))&&this.__player.pause()},resume:function(){this.isState(this.PAUSED)&&!this.__popping&&this.__player.resume()},seek:function(e){this.isState(this.STOPPED)||this.__popping||(this.isState(this.SKIPPING)&&(this._clearSkipDelayData(),this._changeState(this.__prevState)),e>this.getDuration()?(c.info("[Media] Seek time "+e+" is larger than the duration "+this.getDuration()+", now it will seek the duration time"),e=this.getDuration()):e<0&&(c.info("[Media] Seek time "+e+" is smaller than 0 "+this.getDuration()+", now it will seek 0s"),e=0),this.__player.seek(e))},_clearSkipDelayData:function(){this._clearSkipDelay(),this.__accumulatedArrivalTime=null,this.__accumulatedStep=null},_clearSkipDelay:function(){this.__skipDelayHandle&&(l.clearDelay(this.__skipDelayHandle),this.__skipDelayHandle=null)},skip:function(e){if(this.__state!==this.STOPPED&&!this.__popping){l.isNumber(e)&&(e={sec:e}),e=e||{},e.sec=e.sec||10;var t,i,n=e.multipleFactor||1,s=e.delaySec||2,r=e.progressiveCap||300;if(!e.progressive||this.__player._noProgressive)return this.__accumulatedArrivalTime?void c.warn("Simple skip is forbidden during progressive skip. Abort the skip operation."):(t=this.getCurTime()+e.sec,t>this.getDuration()?t=this.getDuration():t<0&&(t=0),this._clearSkipDelayData(),void this.__player.skip(t-this.getCurTime()));this._onSkipping(),n<1&&(n=1),l.isNumber(this.__accumulatedArrivalTime)||(this.__accumulatedArrivalTime=this.getCurTime(!0)),!this.__accumulatedStep||this.__accumulatedStep*e.sec<0?this.__accumulatedStep=e.sec:this.__accumulatedStep=Math.round(this.__accumulatedStep*n),this.__accumulatedStep>r?this.__accumulatedStep=r:this.__accumulatedStep<-r&&(this.__accumulatedStep=-r),e.sec>=r||e.sec<=-r?this.__accumulatedArrivalTime+=e.sec:this.__accumulatedArrivalTime+=this.__accumulatedStep,t=this.__accumulatedArrivalTime,t>this.getDuration()?t=this.getDuration():t<0&&(t=0),i=l.bind(function(){this.__player.skip(t-this.__player.getCurTime()),this._clearSkipDelayData(),this._changeState(this.__lastReceivedNonSkipState),c.info("[XDK] delayed skip action committed.")},this),this._clearSkipDelay(),this.__skipDelayHandle=o.getGuid(),l.delay(s,this.__skipDelayHandle).then(i),this._onTimeUpdate(t,!0)}},speed:function(e){(this.isState(this.PLAYING)||this.isState(this.SPEEDING)||this.isState(this.PAUSED))&&!this.__popping&&this.__player.speed(e)},getPlaybackSpeed:function(){return this.__state===this.STOPPED?0:this.__state===this.PLAYING?0:this.__player.getPlaybackSpeed()},setWindowSize:function(e){if(!this.__player)return void c.warn("Player is not ready, please call load() first to load up a player implementation.");this.__player.setWindowSize(e)},setFullscreen:function(){if(!this.__player)return void c.warn("Player is not ready, please call load() first to load up a player implementation.");this.__player.setFullscreen()},getBitrates:function(){return this.__state===this.STOPPED?null:this.__player.getBitrates()},getState:function(){return this.__state},isState:function(e){return e===this.__state},getCurTime:function(){return this.__state===this.STOPPED?0:this.__player.getCurTime()},getDuration:function(){return this.__player?this.__player.getDuration():(c.warn("Player is not ready, please call load() first to load up a player implementation."),0)},push:function(){var t;this.__pushing=!0,this._clearSkipDelayData();var n,r=this.getState();switch(r){case this.STOPPED:n=b.STOPPED;break;case this.PAUSED:n=b.PAUSED;break;default:n=b.PLAYING,r=this.PLAYING}var a={url:this.getUrl(),opts:this.getOpts(),pos:this.getCurTime(),state:r,player:this.__player};e.hasImpl(this.__player.constructor,i)?(t=this.__player.suspend(),-1===this.__backgroundPlayerList.indexOf(this.__player)&&this.__backgroundPlayerList.push(this.__player)):(t=new s(this,this.__player,{url:a.url,opts:a.opts,pos:a.pos,state:n}),this.__player.stop()),t.__evtObject=a,this.__playbackStack.push(t),this.__suspendedStrategies.push({audioTrack:this.__multiAudioStgy,subtitleModule:this.__subtitleModule}),this.__state=this.STOPPED,this.__url=void 0,this.__opts=void 0,this.__type=void 0,this.__drm=void 0,this.__player=void 0,this.__subtitleModule=void 0,this.__multiAudioStgy=void 0,this.__pushing=!1,this.dispatchEvent(this.EVT_PUSHED,a)},pop:function(){var e=this.__playbackStack.pop(),t=this.__suspendedStrategies.pop();if(!e)throw o.createException(h.ILLEGAL_STATE,"There is no suspended playback state in the stack.");this.__popping=!0,this.__player&&this.__player.stop(),e.restore(l.bind(function(){var i=e.getMediaMeta(),n=e.__evtObject;this.__url=i.url,this.__opts=i.opts,this.__player=e.getPlayer(),this.__state=n.state,this.__subtitleModule=t.subtitleModule,this.__multiAudioStgy=t.audioTrack,e.dispose(),this.__resetUnusedPlayers(),this.__popping=!1,this.dispatchEvent(this.EVT_POPPED,n)},this))},preload:function(t,i){var s;i=l.extend({},i||{},!0),i.type=i.type||this._extractMediaContainer(t);var a,o,c=this.__getPlayer(i);return e.hasImpl(c.constructor,n)?(delete i.player,c.prepare(i),s=c.preload(t,i),-1===this.__backgroundPlayerList.indexOf(c)&&this.__backgroundPlayerList.push(c)):s=new r(this,t,i),o={audioTrack:this.__prepareAudioTrack(c,s),subtitleModule:this.__prepareSubtitle(c,i,s)},a=this.__savePreloaded(s),this.__savedStrategies[a]=o,a},playPreloaded:function(e,t){this.stop();var i=this.__getPreloadedByToken(e),n=i.getMediaMeta();if(i.play(t),this.__url=n.url,this.__opts=n.opts,this.__player=i.getPlayer(),!this.__savedStrategies[e])return this.__subtitleModule=null,void(this.__multiAudioStgy=null);i instanceof r?(this.__savedStrategies[e].subtitleModule=this.__subtitleModule,this.__savedStrategies[e].audioTrack=this.__multiAudioStgy):(this.__subtitleModule=this.__savedStrategies[e].subtitleModule,this.__multiAudioStgy=this.__savedStrategies[e].audioTrack)},disposePreloaded:function(e){this.__getPreloadedByToken(e).dispose(),this.__savedStrategies[e]=null,this.__deletePreloadedByToken(e),this.__resetUnusedPlayers()},__getPreloadedByToken:function(e){var t=this.__preloaded[e];if(!t)throw o.createException(h.ILLEGAL_ARGUMENT,"No associated preloaded playback.");return t},__savePreloaded:function(e){var t=o.getGuid()+"";return this.__preloaded[t]=e,t},__deletePreloadedByToken:function(e){this.__preloaded[e]=null},__getPlayer:function(e){var t;if(e.player){if(t=e.player,!this.__checkCapabilities(t,e))throw o.createException(h.ILLEGAL_ARGUMENT,"The specified player is not capable to play the media.");return t}if(!(t=a.getPlayer(e)))throw o.createException(h.ILLEGAL_ARGUMENT,"None of the registered player can play this type of media.");return t},__checkCapabilities:function(e,t){var i=e.getCapabilities(),n=t.type,s=t.drm,r=!(n&&-1===i.type.indexOf(n))||"*"===n,a=!(s&&-1===i.drms.indexOf(s));return r&&a},__resetUnusedPlayers:function(){for(var t=this.__backgroundPlayerList.length-1;t>=0;t--){var s=this.__backgroundPlayerList[t];e.hasImpl(s.constructor,n)&&0!==s.getPreloadedCount()||e.hasImpl(s.constructor,i)&&0!==s.getSuspendedCount()||(this.__backgroundPlayerList.splice(t,1),s!==this.__player&&s.reset())}},_onTimeUpdate:function(e,t){this.isState(this.SKIPPING)&&!t||(this.__updatedTime=e,this.dispatchEvent(this.EVT_TIME_UPDATE,e))},_onConnecting:function(){this._changeState(this.CONNECTING)},_onPlaying:function(){this._changeState(this.PLAYING)},_onPause:function(){this._changeState(this.PAUSED)},_onStopped:function(){this._changeState(this.STOPPED)},_onSkipping:function(){this._changeState(this.SKIPPING)},_onSpeeding:function(){this._changeState(this.SPEEDING)},_onBufferingStart:function(){this._changeState(this.BUFFERING)},_onBufferingProgress:function(e){this.dispatchEvent(this.EVT_BUFFERING_PROGRESS,e)},_onBufferingFinish:function(){if(!this.isState(this.STOPPED)){if(this.__prevState===this.CONNECTING||this.__prevState===this.BUFFERING)return void this._changeState(this.PLAYING);c.debug("change back to prev state"+this.__prevState),this._changeState(this.__prevState)}},_onFinish:function(){this._changeState(this.STOPPED),this.dispatchEvent(this.EVT_FINISHED)},_onError:function(e,t,i){this.__hasError=!0,this.__popping&&(this.__popping=!1),this._changeState(this.STOPPED);var n,s,r,a={errorType:"",errorMessage:"",errorCode:0,errorData:null};l.isObject(e)?(n=e.code,s=e.desc,r=e.evt,a.errorCode=n):r=e,l.isObject(t)?s=t.msg||e.desc:l.isString(t)&&(s=t),a.errorType=r,a.errorMessage=s,i&&(a.errorData=i),this.dispatchEvent(this.EVT_ERROR,a)},_changeState:function(e,t){if(this.__state===e)return void c.debug("[XDK] Change State Fail as in the same state "+e);if(e!==this.SKIPPING&&(this.__lastReceivedNonSkipState=e),null===this.__skipDelayHandle){this.__prevState=this.__state,this.__state=e;var i=l.extend({fromState:this.__prevState,toState:this.__state},t||{});if(this._shouldSkipOutgoingStateChangeEvent())return void this.__stateMachine.dispatchEvent(this.EVT_STATE_CHANGED,i);this.dispatchEvent(this.EVT_STATE_CHANGED,i)}},_shouldSkipOutgoingStateChangeEvent:function(){return this.__pushing||this.__popping},getAudioTracks:function(){return this.__multiAudioStgy?this.__multiAudioStgy.getAudioTracks():_.reject(o.createException(h.UNSUPPORTED_OPERATION,"MultiAudioTracks strategy hasn't set yet"))},setAudioTrack:function(e){return this.__multiAudioStgy?l.isString(e)?this.__multiAudioStgy.setAudioTrack(e):_.reject(o.createException(h.ILLEGAL_ARGUMENT,"Argument type is not valid")):_.reject(o.createException(h.UNSUPPORTED_OPERATION,"MultiAudioTracks strategy hasn't set yet"))},getAudioTrackAttr:function(e,t,i){return this.__multiAudioStgy?l.isString(e)&&l.isString(t)&&l.isString(i)?this.__multiAudioStgy.getAudioTrackAttr(e,t,i):_.reject(o.createException(h.ILLEGAL_ARGUMENT,"Argument type is not valid or missing")):_.reject(o.createException(h.UNSUPPORTED_OPERATION,"MultiAudioTracks strategy hasn't set yet"))},getCurrentAudioTrackId:function(){return this.__multiAudioStgy?this.__multiAudioStgy.getCurrentAudioTrackId():_.reject(o.createException(h.UNSUPPORTED_OPERATION,"MultiAudioTracks strategy hasn't set yet"))},getUrl:function(){return this.__url},getOpts:function(){return this.__opts},showSubtitle:function(e){return this.__subtitleModule?this.__subtitleModule.showSubtitle(e):_.reject(o.createException(h.ILLEGAL_STATE,"No available subtitle strategy"))},hideSubtitle:function(){return this.__subtitleModule?this.__subtitleModule.hideSubtitle():_.reject(o.createException(h.ILLEGAL_STATE,"No available subtitle strategy"))},getCurrentSubtitle:function(){return this.__subtitleModule?this.__subtitleModule.getCurrentSubtitle():_.reject(o.createException(h.ILLEGAL_STATE,"No available subtitle strategy"))},getSubtitles:function(){return this.__subtitleModule?this.__subtitleModule.getSubtitles():_.reject(o.createException(h.ILLEGAL_STATE,"No available subtitle strategy"))},__resetStgies:function(){this.__multiAudioStgy&&this.__multiAudioStgy.deinit&&this.__multiAudioStgy.deinit(),this.__subtitleModule&&this.__subtitleModule.deinit&&this.__subtitleModule.deinit(),this.__subtitleModule=null,this.__multiAudioStgy=null}}),m.singleton(),m}),define("tve/videoPlaybackService/VideoManager",["xdk-base/class","xdk-base/util","xdk-ax/mediator","./evt/VideoPlaybackControlsEvent","./model/Playlist","tve/TVEError","./evt/VideoControlsStatusEvent","xdk-base/console","./model/PlaylistItem","xdk-base/device/Media","./evt/VideoPlaybackStatusEvent"],function(e,t,i,n,s,r,a,o,l,c,d){var u=c.singleton(),h=null;return e.create({STATUS:{PLAYING:"PLAYING",PAUSED:"PAUSED",STOPPED:"STOPPED",BUFFERING:"BUFFERING",SKIPPING:"SKIPPING"}},{_playlist:null,_currentItem:null,_currentPlaybackState:null,_currentPlaybackTime:0,_playbackDuration:0,_currentAudioTrack:0,init:function(){this._registerPlaybackEventHandlers(),this._registerPlaybackControlsStatusEventHandlers()},setPlaylist:function(e){this._playlist=e,this._playlist.currentItemIdx=-1},clearPlaylist:function(){this._playlist&&(this._playlist.items=[],this._playlist.currentItemIdx=-1)},setVideoLoadedCallback:function(e){h=e},playPlaylistItem:function(e,i){if(!this._playlist)throw new r(r.FACILITY.PLAYBACK_SERVICE,r.ERROR.INVALID,"Playlist is not set");var s=t.indexOf(this._playlist.items,e),a={pos:0};if(s<0)throw new r(r.FACILITY.PLAYBACK_SERVICE,r.ERROR.INVALID,"Item is not in playlist");if(!t.isUndefined(i)){if(i=parseInt(i,10),!t.isNumber(i))throw new r(r.FACILITY.PLAYBACK_SERVICE,r.ERROR.INVALID,"Playback position is not a number");a.pos=i}t.extend(a,this._packEventInfo(e)),this._playlist.currentItemIdx=s,this._play(e,i),this.__dispatchEvent(n.SetControlsInPlayState,a)},nextItem:function(){var e;this._playNextPlaylistItem()&&(e=this._packEventInfo(this._currentItem),this.__dispatchEvent(n.NextPlaylistItem,e))},prevItem:function(){var e;this._playPrevPlaylistItem()&&(e=this._packEventInfo(this._currentItem),this.__dispatchEvent(n.PreviousPlaylistItem,e))},playResume:function(){if(!this._playlist)throw new r(r.FACILITY.PLAYBACK_SERVICE,r.ERROR.INVALID,"Playlist is not set");var e,t=this._playlist.items.length-1;if(t<0)throw new r(r.FACILITY.PLAYBACK_SERVICE,r.ERROR.INVALID,"Playlist is empty");if(this._playlist.currentItemIdx<0)throw new r(r.FACILITY.PLAYBACK_SERVICE,r.ERROR.INVALID,"No playing item");e=this._packEventInfo(this._currentItem),u.resume(),this.__dispatchEvent(n.SetControlsInPlayState,e)},pause:function(){u.pause(),this.__dispatchEvent(n.SetControlsInPauseState,{})},dismiss:function(){u.stop(),this.__dispatchEvent(n.DismissControls,{})},seek:function(e){this._seek(e),this.__dispatchEvent(n.UpdatePlayheadState,{pos:e})},setVolume:function(e){throw new r(r.FACILITY.PLAYBACK_SERVICE,r.ERROR.INVALID,"setVolume is not supported")},_playbackFinished:function(){this.__dispatchEvent(n.DismissControls,{})},_timeUpdated:function(e){h&&this._currentPlaybackTime&&e>this._currentPlaybackTime&&(h(),h=null),this._currentPlaybackTime=e,this._playbackDuration=u.getDuration(),this.__dispatchEvent(n.TimePlayedIncreased,{pos:e}),this.__dispatchEvent(n.UpdatePlayheadState,{pos:e,duration:this._playbackDuration})},_playbackError:function(e){o.log("[VideoManager:_playbackError]"),this.__dispatchEvent(n.NotifyError,{error:e})},_playbackStateChanged:function(e){switch(e.toState){case u.PLAYING:h&&(h(),h=null),this._currentPlaybackState=this.constructor.STATUS.PLAYING;break;case u.PAUSED:this._currentPlaybackState=this.constructor.STATUS.PAUSED;break;case u.BUFFERING:this._currentPlaybackState=this.constructor.STATUS.BUFFERING;break;case u.SKIPPING:this._currentPlaybackState=this.constructor.STATUS.SKIPPING;break;case u.STOPPED:h&&(h(),h=null),this._currentPlaybackState=this.constructor.STATUS.STOPPED;break;default:return}this._dispatchPlaybackStatus()},_dismissSelected:function(e){u.stop()},_playSelected:function(e){u.resume()},_pauseSelected:function(e){u.pause()},_playheadMoved:function(e){this._seek(e.pos)},_nextPlaylistItemSelected:function(e){this._playNextPlaylistItem()},_previousPlaylistItemSelected:function(e){this._playPrevPlaylistItem()},__dispatchEvent:function(e,t){i.publish(e,t)},_play:function(e,i){var n=t.extend({},e.metadata);n=t.extend(n,e.drmAttributes),n.forceReload=!0,this._currentItem=e,this._currentPlaybackTime=i,this._playbackDuration=e.metadata.duration,u.load(this._currentItem.url,n),this._prePlaySetUp(),u.play({sec:i})},_seek:function(e){u.seek(e)},_playNextPlaylistItem:function(){if(!this._playlist)throw new r(r.FACILITY.PLAYBACK_SERVICE,r.ERROR.INVALID,"Playlist is not set");var e=this._playlist.items.length;if(e<1)throw new r(r.FACILITY.PLAYBACK_SERVICE,r.ERROR.INVALID,"Playlist is empty");return!(this._playlist.currentItemIdx>=e-1)&&(this._playlist.currentItemIdx++,this._currentItem=this._playlist.items[this._playlist.currentItemIdx],this._play(this._currentItem),!0)},_playPrevPlaylistItem:function(){if(!this._playlist)throw new r(r.FACILITY.PLAYBACK_SERVICE,r.ERROR.INVALID,"Playlist is not set");var e,t=this._playlist.items.length-1;if(t<0)throw new r(r.FACILITY.PLAYBACK_SERVICE,r.ERROR.INVALID,"Playlist is empty");return!(this._playlist.currentItemIdx<=0)&&(this._playlist.currentItemIdx--,e=this._getCurrentPlaylistItem(),this._packEventInfo(e),this._play(e),!0)},_packEventInfo:function(e){var t={id:e.id,url:e.url,metadata:e.metadata};return e.drmAttributes&&(t.drmAttributes=e.drmAttributes),t.currentPlaybackTime=this._currentPlaybackTime,t},_getCurrentPlaylistItem:function(){return this._playlist?this._playlist.items[this._playlist.currentItemIdx]:null},_registerPlaybackEventHandlers:function(){this.__bindedPlaybackFinished=t.bind(this._playbackFinished,this),u.addEventListener(u.EVT_FINISHED,this.__bindedPlaybackFinished),this.__bindedTimeUpdated=t.bind(this._timeUpdated,this),u.addEventListener(u.EVT_TIME_UPDATE,this.__bindedTimeUpdated),this.__bindedPlaybackError=t.bind(this._playbackError,this),u.addEventListener(u.EVT_ERROR,this.__bindedPlaybackError),this.__bindedPlaybackStateChanged=t.bind(this._playbackStateChanged,this),u.addEventListener(u.EVT_STATE_CHANGED,this.__bindedPlaybackStateChanged)},_unregisterPlaybackEventHandlers:function(){u.removeEventListener(u.EVT_FINISHED,this.__bindedPlaybackFinished),u.removeEventListener(u.EVT_TIME_UPDATE,this.__bindedTimeUpdated),u.removeEventListener(u.EVT_ERROR,this.__bindedPlaybackError),u.removeEventListener(u.EVT_STATE_CHANGED,this.__bindedPlaybackStateChanged)},_registerPlaybackControlsStatusEventHandlers:function(){this.__bindedDismissSelected=t.bind(this._dismissSelected,this),i.subscribe(a.DismissSelected,this.__bindedDismissSelected),this.__bindedPlaySelected=t.bind(this._playSelected,this),i.subscribe(a.PlaySelected,this.__bindedPlaySelected),this.__bindedPauseSelected=t.bind(this._pauseSelected,this),i.subscribe(a.PauseSelected,this.__bindedPauseSelected),this.__bindedPlayheadMoved=t.bind(this._playheadMoved,this),i.subscribe(a.PlayheadMoved,this.__bindedPlayheadMoved),this.__bindedNextPlaylistItemSelected=t.bind(this._nextPlaylistItemSelected,this),i.subscribe(a.NextPlaylistItemSelected,this.__bindedNextPlaylistItemSelected),this.__bindedPreviousPlaylistItemSelected=t.bind(this._previousPlaylistItemSelected,this),i.subscribe(a.PreviousPlaylistItemSelected,this.__bindedPreviousPlaylistItemSelected)},_unregisterPlaybackControlsStatusEventHandlers:function(){i.unsubscribe(a.DismissSelected,this.__bindedDismissSelected),i.unsubscribe(a.PlaySelected,this.__bindedPlaySelected),i.unsubscribe(a.PauseSelected,this.__bindedPauseSelected),i.unsubscribe(a.PlayheadMoved,this.__bindedPlayheadMoved),i.unsubscribe(a.NextPlaylistItemSelected,this.__bindedNextPlaylistItemSelected),i.unsubscribe(a.PreviousPlaylistItemSelected,this.__bindedPreviousPlaylistItemSelected)},_prePlaySetUp:function(){u.setFullscreen()},_dispatchPlaybackStatus:function(){var e=this._getCurrentPlaylistItem(),t=this._packEventInfo(e);switch(this._currentPlaybackState){case this.constructor.STATUS.PLAYING:this.__dispatchEvent(d.PlayState,t);break;case this.constructor.STATUS.PAUSED:this.__dispatchEvent(d.PauseState,t);break;case this.constructor.STATUS.BUFFERING:this.__dispatchEvent(d.BufferState,t);break;case this.constructor.STATUS.SKIPPING:this.__dispatchEvent(d.SkippingState,t);break;case this.constructor.STATUS.STOPPED:this.__dispatchEvent(d.StopState,t)}},getPlaylist:function(){return this._playlist},deinit:function(){this._unregisterPlaybackEventHandlers(),this._unregisterPlaybackControlsStatusEventHandlers()}})}),define("storm/mgr/sVideoManager",["xdk-base/class","xdk-base/util","xdk-base/console","tve/videoPlaybackService/VideoManager","xdk-base/device/Media","storm/mgr/sAppConfigManager","xdk-ax/mediator","tve/videoPlaybackService/evt/VideoPlaybackStatusEvent","xdk-base/device","xdk-base/device/playerRegistry","xdk-base/promise","xdk-base/ajax","storm/helper/util"],function(e,t,i,n,s,r,a,o,l,c,d,u,h){"use strict";var _=s.singleton();return e.create(n,{},{ERROR_CODES:{FIRMWARE_UPDATE_REQUIRED:"SEFPlayer:firmwareUpgradeRequired"},init:function(){this._registerPlaybackEventHandlers(),this._registerPlaybackControlsStatusEventHandlers(),this.__audioListener=t.bind(this.getAudioTracks,this),a.subscribe(o.PlayState,this.__audioListener)},deinit:function(){this._unregisterPlaybackEventHandlers(),this._unregisterPlaybackControlsStatusEventHandlers(),a.unsubscribe(o.PlayState,this.__audioListener)},skip:function(e){_.skip(e)},_play:function(e,n){var s=t.extend({},e.metadata);s=t.extend(s,e.drmAttributes),s.forceReload=!0,this._currentItem=e,this._currentPlaybackTime=n,this._playbackDuration=e.metadata.duration,"lg"===l.platform?this.getAudioTracksFromManifest(this._currentItem.url).done(t.bind(function(e){r.getDefaultAudioTrackMapping().then(t.bind(function(t){var n,s;if(!(e&&e.length&&t&&t.audioLanguage&&t.audioCodec))return!1;try{n=t.audioLanguage.split("|"),s=t.audioCodec.split("|");for(var r=0;r<s.length;r++)for(var a=0;a<e.length;a++)if(e[a].codec===s[r])for(var o=0;o<n.length;o++)if(e[a].LANGCODE===n[o])return e[a].name}catch(e){i.log("Error matching audio track: "+e)}return!1},this)).done(t.bind(function(e){e&&(s.audioLanguage=e),_.load(this._currentItem.url,s),this._prePlaySetUp(),_.play(n)},this))},this)):(_.load(this._currentItem.url,s),this._prePlaySetUp(),_.play(n))},getAudioTracksFromManifest:function(e){if(i.log("Loading manifest file "+e),!e||-1===e.toLowerCase().indexOf("/manifest"))return d.resolve([]);var t={method:"get"};return u.request(e,t).then(function(e){i.log("Response:");var t=[];try{for(var n,s=e.responseXML.getElementsByTagName("StreamIndex"),r=0;r<s.length;r++)if("audio"===s[r].getAttribute("Type")){n=s[r].getElementsByTagName("QualityLevel"),n=n&&n[0];var a=s[r].getAttribute("Language")||null,o=s[r].getAttribute("Name")||null,l=n&&n.getAttribute("FourCC")||null;a&&l&&(i.log("Audio track found: "+a),t.push({id:a,LANGCODE:a,name:o,codec:l}))}}catch(e){i.error("Couldn't load manifest file. "+e.message)}return t},function(e){return h.traceObject(e,"Manifest loading error","error"),[]})},getState:function(){return _.getState()},getAudioTracks:function(){i.log("sVideoManager::getAudioTracks()"),this._audioTracks&&0!=this._audioTracks.length||_.getAudioTracks().then(t.bind(function(e){a.unsubscribe(o.StopState,this.__stopAudioListener),this._audioTracks=[],this._currentAudioTrack=0;for(var i,n=[],s=0;s<e.length;s++)i=_.getAudioTrackAttr(e[s],"LANGCODE","default").then(t.bind(function(e,t){this._audioTracks.push({id:e,lang:t})},this,e[s])),n.push(i);return d.all(n)},this)).then(t.bind(function(){a.publish("onAudioTracks",this._audioTracks.length)},this))},setDefaultAudioLanguage:function(){if(!this._audioTracks)return!1;r.getVideoDefaultAudioTrack().then(t.bind(function(e){if(!e)return!1;e=e.split("|")[0];for(var i=0;i<this._audioTracks.length;i++)this._audioTracks[i].lang===e&&(this._currentAudioTrack=i,_.setAudioTrack(this._audioTracks[i].id).then(t.bind(function(){a.publish("onAudioTrackChange",this._getCurrentAudioLanguage())},this)))},this))},_getCurrentAudioLanguage:function(){return!(!this._audioTracks||t.isUndefined(this._currentAudioTrack))&&this._audioTracks[this._currentAudioTrack].lang},toggleAudio:function(){if(!this._audioTracks||t.isUndefined(this._currentAudioTrack))return!1;var e;e=this._currentAudioTrack<this._audioTracks.length-1?this._currentAudioTrack+1:0,_.setAudioTrack(this._audioTracks[e].id).then(t.bind(function(){this._currentAudioTrack=e,a.publish("onAudioTrackChange",this._getCurrentAudioLanguage())},this))}})}),define("storm/model/Eula",["xdk-base/class","tve/model/ImmutableModel"],function(e,t){"use strict";return e.create(t,{defaults:{title:"",enticement:"",body:"",timestamp:""}},{})}),define("storm/model/EulaBuilder",["xdk-base/class","storm/model/Eula"],function(e,t){"use strict";return e.create({},{_attrs:{},setTitle:function(e){return this._attrs.title=e,this},setEnticement:function(e){return this._attrs.enticement=e,this},setBody:function(e){return this._attrs.body=e,this},setTimestamp:function(e){return this._attrs.timestamp=e,this},build:function(){return new t(this._attrs)}})}),define("storm/mgr/sEulaManager",["xdk-base/class","xdk-base/util","xdk-base/promise","xdk-base/console","tve/TVEError","storm/mgr/sEditorialManager","storm/mgr/sLocalStorageManager","storm/model/EulaBuilder"],function(e,t,i,n,s,r,a,o){"use strict";return new(e.create({},{_createCombinedTimestamp:function(e){var i="";return t.each(e,function(e){i+=e.get("timestamp")}),i},hasEulaBeenAgreed:function(){return this.getAllEulas().then(t.bind(function(e){var t=this._createCombinedTimestamp(e),s=a.getStoredValue(a.KEYS.EULA_TIMESTAMP);return n.info("EULA agreement check:"),n.info("Stored timestamp: "+s),n.info("Combined timestamp: "+t),i.resolve(t===s)},this),function(e){return i.reject("Unable to check if EULA agreed to: "+e)})},getAllEulas:function(){return i.all([this.getEula("de"),this.getEula("at")])},getEula:function(e){var t=e&&"AT"===(e+"").toUpperCase();return r.getEditorialContent(r.CONTENT.EULA).then(function(e){var i=e.responseJSON.eula;return(new o).setTitle(t?i.article_name_at:i.article_name).setEnticement(t?i.short_description_at:i.short_description_de).setBody(t?i.article_body_at:i.article_body).setTimestamp(t?i.last_update_date_at:i.last_update_date_de).build()})},agreeToEulas:function(e){a.setStoredValue(a.KEYS.EULA_TIMESTAMP,this._createCombinedTimestamp(e))}}))}),define("storm/mgr/sCustomerCommunicationManager",["xdk-base/class","xdk-base/util","xdk-base/promise","xdk-base/console","tve/TVEError","storm/mgr/sEditorialManager","storm/mgr/sLocalStorageManager"],function(e,t,i,n,s,r,a){"use strict";return new(e.create({},{hasMessageBeenShown:function(e){var i=JSON.parse(a.getStoredValue(a.KEYS.CUSTOMER_MESSAGES));return t.contains(i,e)},getActiveMessages:function(){return r.getEditorialContent(r.CONTENT.CUSTOMER_COMMUNICATION).then(t.bind(function(e){var i=e.responseJSON.customerMessages.customerMsg,n=new Date;return t.filter(i,t.bind(function(e){return!this.hasMessageBeenShown(e.Message_Id)&&new Date(e.StartTime)<n&&new Date(e.EndTime)>n},this))},this))},setMessageToBeSeen:function(e){var t=JSON.parse(a.getStoredValue(a.KEYS.CUSTOMER_MESSAGES));t||(t=[]),t.push(e),a.setStoredValue(a.KEYS.CUSTOMER_MESSAGES,JSON.stringify(t))}}))}),define("tvedemo/wgt/Loading",["xdk-ax/Container","xdk-ui-basic/Image","xdk-base/class","xdk-base/Env","xdk-ax/mvc/AppRoot"],function(e,t,i,n,s){"use strict";var r=s.singleton(),a=n.singleton(),o=i.create(e,{_shared:null,
getShared:function(){return this._shared||(this._shared=new o),this._shared},open:function(){return this.getShared().open()},close:function(){return this.getShared().close()}},{init:function(i){i=i||{},i.css=i.css||"",i.css+="wgt-dialog-modal wgt-loading",i.parent=r.getView(),this._super(i),this._overlay=new e({parent:this,css:"wgt-dialog-overlay"}),new t({klass:t,css:"load",src:"img/loading/load.gif",parent:this._overlay})},open:function(){this.show(),a.blockKeys()},close:function(){a.unblockKeys(),this.hide()}});return o}),define("tvedemo/mgr/deepLinkingManager",["xdk-base/class","xdk-base/device","xdk-base/util","xdk-ax/mediator","tvedemo/wgt/Loading","xdk-base/promise"],function(e,t,i,n,s,r){"use strict";return new(e.create({CONTENT_TYPES:{"Film-":"FILM","Episode-":"EPISODE","Series-":"SERIES","Season-":"SEASON","Sport-:":"SPORT"}},{getDeepLinkData:function(e){var n,s,a,o={},l=r.defer();if("tizen"===t.platform){if(!(n=tizen.application.getCurrentApplication().getRequestedAppControl()))return console.info("no req app control"),l.reject("tizen: no req app control");for(e=n.appControl.data,s=0;s<e.length;s++)if(console.log("[data]: "+e[s].key+" "+e[s].value[0]),"PAYLOAD"==e[s].key){a=e[s].value[0];break}try{a=JSON.parse(a),a=JSON.parse(a.values),console.log("values"),console.log(a)}catch(e){console.info("Couldn't parse payload: "+e),a=null}if(a&&a.deeplink){if(!(a=a.deeplink.split("-"))||a.length<2)return{};o.contentType=a[0].toUpperCase()||"UNKNOWN",o.assetId=a[1],o.extraId=a[2]||null,l.resolve(o)}}else{if("playstation"===t.platform&&"PS4"===t.id.getModel()){var c=amd.require("xdk-ext-device-playstation/webmaf"),d=i.bind(function(e){return c&&c.removeNativeEventListener("getExternalParameter",d),e&&"ok"===e.status&&e.value&&e.value.length>0?(a=e.value.split("-"),o.contentType=a[0].toUpperCase()||"UNKNOWN",o.assetId=a[1],l.resolve(o),l.resolve(o)):l.reject("ps4: deeplinking not ok")},this);return!e&&c?c.command("getExternalParameter",{},d):d(e),l.promise}l.reject("Unsupported platform")}return l.promise},handleDeepLinking:function(e){this.getDeepLinkData(e).then(i.bind(function(e){e.contentType&&e.assetId&&this.navigate(e.contentType,e.assetId)},this))},navigate:function(e,i){var r,a,o={__forceReload:!0},l="tizen"===t.platform;switch(s.open(),console.log("DEEP LINK NAVIGATION - assetId: "+i+", contentType: "+e),e){case"SERIES":r="Main/TVShow",a={serieId:i,catalog:"sg"};break;case"SEASON":r="Main/TVShow",a={seasonId:i,catalog:"sg"};break;case"EPISODE":r="Main/Episode",a={selectedEpisodeId:i,catalog:"sg",autoPlay:l};break;case"SPORT":r="Main/Sport",a={assetId:i,catalog:"sg"};break;case"FILM":default:r="Main/Movie",a={assetId:i,catalog:"sg",autoPlay:l}}n.publish("navigate",{path:r,state:a,message:o})}}))}),define("storm/ctrl/Splash",["xdk-base/ax","xdk-ax/mvc/AppRoot","tvedemo/ctrl/RoutableController","xdk-ax/mvc/view","storm/tmpl/splash","xdk-base/util","xdk-ax/evt/type","xdk-ax/focusManager","xdk-mouse/mouseHandler","xdk-ax/mediator","xdk-base/device/vKey","storm/mgr/sAppConfigManager","xdk-base/device","xdk-base/promise","storm/helper/util","tve/videoPlaybackService/model/Playlist","tve/videoPlaybackService/model/PlaylistItem","tve/videoPlaybackService/evt/VideoPlaybackControlsEvent","tve/videoPlaybackService/evt/VideoPlaybackStatusEvent","storm/mgr/sVideoManager","storm/mgr/sLanguageManager","storm/mgr/sEulaManager","storm/mgr/sCustomerCommunicationManager","tvedemo/wgt/AlertDialog","tvedemo/helper/dialogHelper","tve/sServiceHolder","tvedemo/mgr/deepLinkingManager","xdk-base/Env","xdk-base/console"],function(e,t,i,n,s,r,a,o,l,c,d,u,h,_,g,f,p,m,v,b,S,y,E,k,C,T,x,I,w){"use strict";var L=t.singleton(),A=!1,D=I.singleton(),P=!1;return e.klass.create(i,{VIDEO_URL:"/video/splash.mp4",EVENT:{CONTROLLER_READY:1,VIDEO_FINISHED:2}},{splashView:!0,splashShowing:!0,init:function(){l.start(),this.setView(n.render(s))},setup:function(t){var i;this._super(t),this.currentView=this.getView(),i=this.currentView.find("info"),!1===e.config.get("displayVersion")&&i.hide(),this._handleDeepLinkingDataRef=r.bind(this.getDeepLinkData,this),"tizen"===h.platform&&window.addEventListener("appcontrol",this._handleDeepLinkingDataRef),this.__handleResumeRef=r.bind(this.__handleResume,this),D.addEventListener(D.EVT_ONRESUME,this.__handleResumeRef),this.getDeepLinkData(),this.setupPlayback(),S.setLanguage("de")},__handleResume:function(){!P||"tizen"!==h.platform&&"workstation"!==h.platform||this._showEulaPopup(),P=!1},getDeepLinkData:function(){x.getDeepLinkData().then(r.bind(function(e){this._deepLinkData=e},this))},checkAppStatus:function(){!0!==A&&(A=!0,u.getStatus().then(r.bind(function(t){return t===u.constructor.STATUS.ACTIVE?_.all([u.getLatestValidVersion(),T.getDateTimeService().getServerDateTime(),T.getAnalyticsService(),S.getInitPromise(),u.getSamsungSpecificConfig().then(function(e){e&&h.id&&r.isFunction(h.id.setRequiredSamsung2014FirmwareIdentifiers)&&h.id.setRequiredSamsung2014FirmwareIdentifiers(e.playback2014)})]).then(r.bind(function(t){return this._validVersionInfo=t[0],y.hasEulaBeenAgreed().then(r.bind(function(t){!0===t?this._eulaAgreed():this.videoFinished?this._showEulaPopup():r.delay(6).then(e.util.bind(function(){this._showEulaPopup()},this))},this),function(e){return _.reject("EULA check impossible: "+e)})},this)).complete(r.bind(function(){this.splashShowing=!1},this)):_.reject("AppGrid says mode '"+t+"' (not '"+u.constructor.STATUS.ACTIVE+"')")},this)).fail(r.bind(function(t){e.console.log("Going to maintenance mode due to: "+t),this.splashShowing=!1,this.next(this.constructor.EVENT.CONTROLLER_READY,function(){L.getView().removeClass("fullscreen-video-mode"),c.publish("navigate",{path:"Maintenance",historySkip:!0})})},this)).done())},_showEulaPopup:function(){var e=r.bind(function(){C.confirm({title:S.getString("Login.Login_labelEula_is_not_accepted_hl"),message:S.getString("Login.Login_labelEula_is_not_accepted_message"),positiveText:S.getString("Global.Global_buttonConfirm"),negativeText:S.getString("Global.Global_buttonClose"),invertBackKey:!0,positiveAction:r.bind(function(){this._showEulaPopup()},this),negativeAction:r.bind(function(){w.warn("User really does not want to accept the EULA"),h.system.exit(),"playstation"===h.platform?this._showEulaPopup():-1!==navigator.userAgent.toLowerCase().indexOf("web0s")?r.delay(2).then(r.bind(function(){this._showEulaPopup()},this)):"tizen"!==h.platform&&"workstation"!==h.platform||(P=!0)},this),doNegativeActionOnClose:!0},this)},this);y.getAllEulas().then(r.bind(function(t){var i="";r.each(t,function(e){i+=e.get("title")+"<br>",i+=e.get("body")+"<br>"}),C.accept({title:S.getString("Login.Login_labelEula_confirmation_hl"),hint:S.getString("Login.Login_labelEula_confirmation_message"),body:i,type:"2button",confirmButtonText:S.getString("Login.Login_labelEula_accept_btn"),confirmAction:r.bind(function(){y.agreeToEulas(t),this._eulaAgreed()},this),cancelButtonText:S.getString("Global.Global_Cancel_Button"),cancelAction:e,doNegativeActionOnClose:!0}),this.currentView.find("loaderSpinner").hide()},this))},_eulaAgreed:function(){w.log("Eula has been agreed"),this.next(this.constructor.EVENT.CONTROLLER_READY,r.bind(function(){if(L.getView().removeClass("fullscreen-video-mode"),g.versionNotCompatible(e.config.get("version"),this._validVersionInfo)){var t=new k({title:S.getString("Global.Global_generalAppError"),message:S.getString("Global.Global_Update_Message")+" ("+e.config.get("version")+")",buttonText:S.getString("Global.Global_buttonExit")});o.focus(t),t.addEventListener(a.CLOSE,function(){w.log("Harsh exit because app version check failed"),"tizen"!==h.platform&&"workstation"!==h.platform||(P=!0),h.system.exit()})}else"tizen"===h.platform&&(window.removeEventListener("appcontrol",this._handleDeepLinkingDataRef),window.addEventListener("appcontrol",r.bind(x.handleDeepLinking,x))),this._showCommunicationMessages(r.bind(function(){c.publish("navigate",{path:"Main",historySkip:!0,state:{deepLinkData:this._deepLinkData}})},this))},this))},_showCommunicationMessages:function(e){this.currentView.find("loaderSpinner").show(),E.getActiveMessages().then(r.bind(function(t){if(this.currentView.find("loaderSpinner").hide(),0===t.length)return void e();var i=function(n){var s=t[n];return s?(n++,E.hasMessageBeenShown(s.Message_Id)?void(t[n]&&t[n].Message_Id?i(n):e()):void C.accept({title:s.Title,hint:"",body:s.Message,type:"1button",confirmButtonText:s.ActionButton_2,confirmAction:r.bind(function(){E.setMessageToBeSeen(s.Message_Id),i(n)},this),doNegativeActionOnClose:!0})):void e()};i(0)},this))},next:function(e,t){e===this.constructor.EVENT.CONTROLLER_READY?this.controllerReady=t:e===this.constructor.EVENT.VIDEO_FINISHED&&(this.videoFinished=t),this.controllerReady&&this.videoFinished?this.controllerReady():this.videoFinished&&this.videoFinished()},setupPlayback:function(){g.getRootFolder(this.constructor.VIDEO_URL).then(r.bind(function(e){var t=e;this.prepareForVideoStart(),this.__videoManager=new b;var i=[new p({url:t})],n=new f({items:i});this.__dismissControlsRef=r.bind(this._dismissControls,this),c.subscribe(m.DismissControls,this.__dismissControlsRef),this.__videoErrorRef=r.bind(this._videoError,this),c.subscribe(m.NotifyError,this.__videoErrorRef),this.__playStateRef=r.bind(this._videoState,this),c.subscribe(v.PlayState,this.__playStateRef),c.subscribe(v.StopState,this.__playStateRef),this.__videoManager.setPlaylist(n),this.__videoManager.playPlaylistItem(i[0])},this))},_videoState:function(){this.checkAppStatus()},_dismissControls:function(){this.next(this.constructor.EVENT.VIDEO_FINISHED,this.dealWithVideoStop),this.checkAppStatus()},_videoError:function(){this.next(this.constructor.EVENT.VIDEO_FINISHED,this.dealWithVideoStop),this.checkAppStatus()},prepareForVideoStart:function(){this.currentView.addClass("splash-video-playing"),L.getView().addClass("fullscreen-video-mode")},dealWithVideoStop:function(){this.currentView.removeClass("splash-video-playing")},reset:function(){c.unsubscribe(m.DismissControls,this.__dismissControlsRef),c.unsubscribe(m.NotifyError,this.__videoErrorRef),c.unsubscribe(v.PlayState,this.__playStateRef),c.unsubscribe(v.StopState,this.__playStateRef),this.__videoManager&&this.__videoManager.deinit()}})}),define("tvedemo/model/WatchList",["xdk-base/class","tve/model/ImmutableModel"],function(e,t){return e.create(t,{defaults:{assetId:null,catalog:null,insertDate:null,platform:null,assetType:null}},{})}),define("tvedemo/model/WatchListBuilder",["xdk-base/class","tvedemo/model/WatchList"],function(e,t){return e.create({},{_attrs:{},setAssetId:function(e){return this._attrs.assetId=e,this},setCatalog:function(e){return this._attrs.catalog=e,this},setInsertDate:function(e){return this._attrs.insertDate=e,this},setPlatform:function(e){return this._attrs.platform=e,this},setAssetType:function(e){return this._attrs.assetType=e,this},build:function(){return new t(this._attrs)}})}),define("tvedemo/model/RecentlyWatched",["xdk-base/class","tve/model/ImmutableModel"],function(e,t){return e.create(t,{defaults:{assetId:null,title:null,category:null,color:null,isHD:null,fsk:null,imageUrl:null,time:null,assetType:null,bookmark:null,percentage:null,duration:null}},{})}),define("tvedemo/model/RecentlyWatchedBuilder",["xdk-base/class","tvedemo/model/RecentlyWatched"],function(e,t){return e.create({},{_attrs:{},setAssetId:function(e){return this._attrs.assetId=e,this},setTitle:function(e){return this._attrs.title=e,this},setCategory:function(e){return this._attrs.category=e,this},setColor:function(e){return this._attrs.color=e,this},setIsHD:function(e){return this._attrs.isHD=e,this},setFsk:function(e){return this._attrs.fsk=e,this},setImageUrl:function(e){return this._attrs.imageUrl=e,this},setTime:function(e){return this._attrs.time=e,this},setAssetType:function(e){return this._attrs.assetType=e,this},setEndDate:function(e){return this._attrs.endDate=e,this},setStartDate:function(e){return this._attrs.startDate=e,this},setContentTargeting:function(e){return this._attrs.contentTargeting=-1!==e.indexOf("xbox"),this},setCatalog:function(e){return this._attrs.catalog=e,this},setBookmark:function(e){return this._attrs.bookmark=e,this},setPercentage:function(e){return this._attrs.percentage=e,this},setDuration:function(e){return this._attrs.duration=1e3*e,this},setWatchedFlag:function(e){return this._attrs.watchedFlag=e,this},setSeasonNo:function(e){return this._attrs.seasonNumber=e,this},setEpisodeNo:function(e){return this._attrs.episodeNumber=e,this},setSerieCommTitle:function(e){return this._attrs.serieCommTitle=e,this},build:function(){return new t(this._attrs)}})}),define("tvedemo/model/User",["xdk-base/class","tve/model/ImmutableModel"],function(e,t){return e.create(t,{defaults:{sessionId:null,remainingAttempt:null,customerCode:null,customerId:null,country:null,email:null,presentation:null,firstName:null,lastName:null,privacyFlag:null,cardExpiry:null,dunning:null,dayPassPurchaseAllowed:null,isTCSigned:null,entitlements:[],dayPasses:[],tickets:[],subscriptions:[],addOns:[]}},{})}),define("tvedemo/model/UserBuilder",["xdk-base/class","tvedemo/model/User"],function(e,t){return e.create({},{_attrs:{},setSessionId:function(e){return this._attrs.sessionId=e,this},setRemainingAttempt:function(e){return this._attrs.remainingAttempt=e,this},setCustomerCode:function(e){return this._attrs.customerCode=e,this},setCustomerId:function(e){return this._attrs.customerId=e,this},setCountry:function(e){return this._attrs.country=e,this},setEmail:function(e){return this._attrs.email=e,this},setPresentation:function(e){return this._attrs.presentation=e,this},setFirstName:function(e){return this._attrs.firstName=e,this},setLastName:function(e){return this._attrs.lastName=e,this},setPrivacyFlag:function(e){return this._attrs.privacyFlag=e,this},setCardExpiry:function(e){return this._attrs.cardExpiry=e,this},setDunning:function(e){return this._attrs.dunning=e,this},setDayPassPurchaseAllowed:function(e){return this._attrs.dayPassPurchaseAllowed=e,this},setIsTCSigned:function(e){return this._attrs.isTCSigned=e,this},setBookmarkOn:function(e){return this._attrs.isBookmarkOn=e,this},setEntitlement:function(e){return this._attrs.entitlements=e,this},setDayPasses:function(e){return this._attrs.dayPasses=e,this},setTickets:function(e){return this._attrs.tickets=e,this},setSubscriptions:function(e){return this._attrs.subscriptions=e,this},setAddOns:function(e){return this._attrs.addOns=e,this},build:function(){return new t(this._attrs)}})}),define("tvedemo/model/AddonSubscription",["xdk-base/class","tve/model/ImmutableModel"],function(e,t){return e.create(t,{defaults:{code:null,id:null,expire:null}},{})}),define("tvedemo/model/AddonSubscriptionBuilder",["xdk-base/class","tvedemo/model/AddonSubscription"],function(e,t){return e.create({},{_attrs:{},setCode:function(e){return this._attrs.code=e,this},setId:function(e){return this._attrs.id=e,this},setExpire:function(e){return this._attrs.expire=e,this},build:function(){return new t(this._attrs)}})}),define("storm/model/Ticket",["xdk-base/class","tve/model/ImmutableModel"],function(e,t){"use strict";return e.create(t,{defaults:{key:null,title:"",startDate:null,endDate:null,entitlements:""}},{})}),define("storm/model/TicketBuilder",["xdk-base/class","storm/model/Ticket"],function(e,t){"use strict";return e.create({},{_attrs:{},setKey:function(e){return this._attrs.key=e,this},setTitle:function(e){return this._attrs.title=e,this},setStartDate:function(e){return this._attrs.startDate=e,this},setEndDate:function(e){return this._attrs.endDate=e,this},setEntitlements:function(e){return this._attrs.entitlements=e,this},build:function(){return new t(this._attrs)}})}),define("storm/model/Device",["xdk-base/class","tve/model/ImmutableModel"],function(e,t){"use strict";return e.create(t,{defaults:{id:"",activationDate:"",platform:""}},{})}),define("storm/model/DeviceBuilder",["xdk-base/class","storm/model/Device"],function(e,t){"use strict";return e.create({},{_attrs:{},setId:function(e){return this._attrs.id=e,this},setActivationDate:function(e){return this._attrs.activationDate=e,this},setPlatform:function(e){return this._attrs.platform=e,this},build:function(){return new t(this._attrs)}})}),define("storm/model/DeviceDetails",["xdk-base/class","tve/model/ImmutableModel"],function(e,t){"use strict";return e.create(t,{defaults:{resetDelay:"",resetNextDay:"",freeSlots:"",deviceList:""}},{})}),define("storm/model/DeviceDetailsBuilder",["xdk-base/class","storm/model/DeviceDetails"],function(e,t){"use strict";return e.create({},{_attrs:{},setResetDelay:function(e){return this._attrs.resetDelay=e,this},setResetNextDay:function(e){return this._attrs.resetNextDay=e,this},setFreeSlots:function(e){return this._attrs.freeSlots=e,this},setDeviceList:function(e){return this._attrs.deviceList=e,this},build:function(){return new t(this._attrs)}})}),define("tvedemo/mgr/sLocalBookmarkManager",["xdk-base/ax","xdk-base/class","xdk-base/config","xdk-base/util","xdk-base/console","tve/sServiceHolder","xdk-base/device","xdk-base/promise","storm/mgr/sAppConfigManager","storm/mgr/sSilkMessagesManager","storm/mgr/sLanguageManager","storm/mgr/sLocalStorageManager","storm/helper/silkResponseHelper","lib/moment"],function(e,t,i,n,s,r,a,o,l,c,d,u,h,_){"use strict";return new(t.create({},{_user:null,_bookmarks:{},init:function(){},setUser:function(e){this._user=e},setBookmarks:function(e,t){t=t||[],this.addLocalCustomerStorage(e);var i={};n.each(t,function(e){i[e.assetId]=e}),this.updateCustomerBookmarks(i)},getLocalBookmarksForUpload:function(){var e,t=this.getCustomerBookmarkSetting();return!!t&&(!!((e=n.values(t.bookmarks))&&e.length>0)&&JSON.stringify({bookmarks:e}))},deleteLocalCustomerStorage:function(e){if(!(e=e||this._user))return!1;var t,i=this.getStorage();t=n.filter(i,function(t){return e.get("customerId")!==t.customerId}),this.saveStorage(t)},addLocalCustomerStorage:function(e){if(!e)return!1;var t={customerId:e.get("customerId"),localBookmarks:"true",lastUsage:this.getEpochTime(),bookmarks:{}},i=this.getStorage();i.push(t),this.saveStorage(i)},hasLocalBookmarks:function(){var e=this.getStorage(),t=!1;return e?(n.each(e,n.bind(function(e){if(e.customerId===this._user.get("customerId"))return t=!0,n.breaker},this)),t):t},updateCustomerBookmarks:function(e){var t=this.getStorage();n.each(t,n.bind(function(t){t.customerId===this._user.get("customerId")&&(t.bookmarks=e,t.lastUsage=this.getEpochTime())},this)),this.saveStorage(t)},getCustomerBookmarkSetting:function(){var e,t=this.getStorage();return!(!t||!this._user)&&(n.each(t,n.bind(function(t){t.customerId===this._user.get("customerId")&&(e=t)},this)),e)},getCustomerBookmarks:function(e){if(n.isUndefined(e)||n.isUndefined(e.assetId)||!this._user)return[];var t=this.getCustomerBookmarkSetting();if(!t)return o.resolve([]);e.assetId=""+e.assetId;var i=e.assetId.split(","),s=[];return n.each(i,function(e){t.bookmarks[e]&&s.push(t.bookmarks[e])}),o.resolve({bookmarks:s})},setLocalBookmark:function(e){var t,i,n;e.assetId&&e.playedTime&&e.duration&&e.watched&&(n=this.getCustomerBookmarkSetting(),t=this.getEpochTime(),i=e.playedTime/e.duration*100,n.bookmarks[e.assetId]={assetId:e.assetId,duration:e.duration>>0,bookmark:e.playedTime>>0,percentage:i>>0,time:t,watchedState:e.watched},this.updateCustomerBookmarks(n.bookmarks))},getStorage:function(){var e=u.getStoredValue(u.KEYS.BOOKMARK_CROSSDEVICE_SETTINGS);return e?JSON.parse(e):[]},saveStorage:function(e){if(e)try{u.setStoredValue(u.KEYS.BOOKMARK_CROSSDEVICE_SETTINGS,JSON.stringify(e))}catch(e){s.info("Could not save local bookmark: "+e)}},getEpochTime:function(){return Date.now()/1e3>>0}}))}),define("tvedemo/mgr/sEndUserManager",["xdk-base/ax","xdk-base/class","xdk-base/config","xdk-base/util","xdk-base/console","tve/sServiceHolder","xdk-base/device","xdk-base/promise","tve/TVEError","xdk-ax/mediator","tvedemo/model/WatchListBuilder","storm/mgr/sAppConfigManager","tvedemo/model/RecentlyWatchedBuilder","tvedemo/model/UserBuilder","tvedemo/model/AddonSubscriptionBuilder","storm/model/TicketBuilder","storm/model/DeviceBuilder","storm/model/DeviceDetailsBuilder","storm/mgr/sSilkMessagesManager","storm/mgr/sLanguageManager","storm/mgr/sLocalStorageManager","storm/helper/silkResponseHelper","tvedemo/mgr/sNavigationManager","storm/event/UserEvent","lib/moment","tvedemo/mgr/sLocalBookmarkManager"],function(e,t,i,n,s,r,a,o,l,c,d,u,h,_,g,f,p,m,v,b,S,y,E,k,C,T){"use strict";var x=r.getLinearContentService(),I=!1,w="Unable to perform action before login.",L=function(e){for(var t=[],i=(new Date).getTime(),n=0;n<e.length;n++)e[n].expirationTime>i&&t.push(e[n]);return t},A=function(){var e={},t=function(e){var t=new g,i={code:e.code||"",id:e.id||"",expire:e.expire||""};return t.setCode(i.code).setId(i.id).setExpire(i.expire).build()};e.parseAddonSubscriptions=t;var i=function(e){var t=b.getString("ui.parsing.daypassValidityDate")+" "+b.getString("ui.parsing.daypassValidityTime");return(new f).setKey(e.rateCode).setTitle(e.name).setStartDate(C(e.activationDate,t).toDate()).setEndDate(C(e.expirationDate,t).toDate()).setEntitlements(e.packageCode).build()};e.parseUserTickets=i;var s=function(e){var s=new _,r=[],a=[],o=[],l={sessionId:e.skygoSessionId,remainingAttempt:e.remainingAttempt||"",customerCode:e.customerCode||"",customerId:e.customerId||"",country:e.country||"",email:e.email||"",presentation:e.presentation||"",firstName:e.firstName||"",lastName:e.lastName||"",privacyFlag:e.privacyFlag||"",cardExpiry:e.ccExpire||"",dunning:e.dunning||"",dayPassPurchaseAllowed:e.tvod||"",isTCSigned:"Y"===e.tcFlag,isBookmarkOn:"Y"===e.bookmarkFlag,entitlements:e.entitlements||[],dayPasses:e.dayPasses||[],tickets:e.tickets||[]};return l.subscriptions=e.subscriptions,l.addOns=e.addOns,l.subscriptions&&l.subscriptions.length>0&&(r=n.map(l.subscriptions,function(e){return t(e)})),l.addOns&&l.addOns.length>0&&(a=n.map(l.addOns,function(e){return t(e)})),l.tickets&&l.tickets.length&&(o=n.map(l.tickets,function(e){return i(e)}),o=o.sort(function(e,t){return e.get("startDate")<t.get("startDate")?-1:e.get("startDate")>t.get("startDate")?1:0})),s.setSessionId(l.sessionId).setRemainingAttempt(l.url).setCustomerCode(l.customerCode).setCustomerId(l.customerId).setCountry(l.country).setEmail(l.email).setPresentation(l.presentation).setFirstName(l.firstName).setLastName(l.lastName).setPrivacyFlag(l.privacyFlag).setCardExpiry(l.cardExpiry).setDunning(l.dunning).setDayPassPurchaseAllowed(l.dayPassPurchaseAllowed).setIsTCSigned(l.isTCSigned).setBookmarkOn(l.isBookmarkOn).setEntitlement(l.entitlements).setDayPasses(l.dayPasses).setTickets(o).setSubscriptions(r).setAddOns(a).build()};return e.parseUser=s,e.parseDevice=function(e){var t=new p;return t.setId(e.deviceId).setActivationDate(e.activationDate).setPlatform(e.platform),t.build()},e.parseDeviceDetails=function(t){var i=new m,s=[];if(!n.isUndefined(t)&&(i.setResetDelay(t.deviceResetDelay).setResetNextDay(t.deviceResetNextDay).setFreeSlots(t.freeSlots),t.deviceList&&t.deviceList.length))for(var r=0;r<t.deviceList.length;r++)s.push(e.parseDevice(t.deviceList[r]));return i.setDeviceList(s).build()},e}();return new(t.create({},{LOGOUT:{ON_APP_EXIT:"exit",RETAIN_USERNAME:"retain",DISCARD_USERNAME:"discard"},loggedinUser:void 0,init:function(){this.__userDataUpdatedHandler=n.bind(function(){this.getUserData().then(function(){c.publish(k.UserDataUpdated)})},this),c.subscribe(k.UserDataRequireUpdate,this.__userDataUpdatedHandler)},checkUserSessionIsValid:function(){return this.getUserData()},getUserData:function(){return x.getUserData({sessionId:this.getUserSessionId()}).then(n.bind(function(e){return y.skimSilkResponse(e,y.MODE.SILENT).then(n.bind(function(){var t,i;return this.loggedinUser&&(t=this.loggedinUser.get("customerCode"))&&(i=this.loggedinUser.get("customerId")),this.loggedinUser=A.parseUser(e),this.loggedinUser.get("customerCode")&&this.loggedinUser.get("customerCode").length||!t||this.loggedinUser.get("customerId")!==i||this.loggedinUser.set("customerCode",t),"KO"===e.resultMessage&&e.resultCode===y.SILK_CODE.USER_NOT_FOUND_ON_SILK_CACHE&&(I=!1),this.loggedinUser},this))},this))},acceptTermsAndConditions:function(e,t,i){return x.acceptTermsAndConditions({acceptTermsAndConditions:t?"Y":"N",privacyFlag:i?"Y":"N",sessionId:e.get("sessionId")}).then(n.bind(function(e){return y.skimSilkResponse(e,y.MODE.SILENT).then(n.bind(function(){return this.getUserData().then(n.bind(function(e){return this.checkTermsAndConditions(e)},this))},this))},this))},checkTermsAndConditions:function(e){var t=o.defer();return e?t.resolve(e.get("isTCSigned")):t.resolve(!1),t.promise},loginCheck:function(){var e=o.defer();return this.getUserSessionId()?e.resolve():c.publish("navigate",{path:"Main/Login",message:{intermediateLogin:e}}),e.promise},login:function(e,t,i){var s={username:e,password:t};return x.loginUser(s).then(n.bind(function(a){return y.skimSilkResponse(a,y.MODE.SILENT).then(n.bind(function(){return"KO"===a.resultMessage?a.resultCode===y.SILK_CODE.ALREADY_LOGGED_IN&&i?(s={sessionId:a.skygoSessionId},this.__killSession(s,e,t)):o.reject(v.getSilkMessageForCode(a.resultCode)):(S.setStoredValue(S.KEYS.USERNAME,e),S.setStoredValue(S.KEYS.PASSWORD,t),r.getAnalyticsService().login(e),this._delayKeepAlive(),this.loggedinUser=A.parseUser(a),S.setStoredValue(S.KEYS.SESSION,JSON.stringify(a)),this.__onLoginSuccess())},this),function(){return o.reject(v.getSilkMessageForCode(a.resultCode))})},this))},autoLogin:function(e){var t=S.getStoredValue(S.KEYS.USERNAME),i=S.getStoredValue(S.KEYS.PASSWORD);return t&&i?(s.log("[sEndUserManager] Auto login at backend for ["+t+"] & ["+i+"]"),this.login(t,i,e)):void s.log("[sEndUserManager] couldn't find valid password or username")},sessionCheck:function(){s.log("[sEndUserManager] sessionCheck");var e=S.getStoredValue(S.KEYS.SESSION);if(!e)return s.log("[sEndUserManager] can't found existing session data"),o.reject();"string"==typeof e&&/\{.*\}/.test(e)&&(e=JSON.parse(e)),this.loggedinUser=A.parseUser(e);var t=this.getUserSessionId();return t?x.keepAlive(t).then(n.bind(function(e){return y.skimSilkResponse(e,y.MODE.SILENT).then(n.bind(function(){return"OK"===e.resultMessage?this.__onLoginSuccess():(this._discardSession(!0),this.loggedinUser=null),e},this))},this),function(e){s.warn("Keep alive failed due to "+e)}):(s.log("[sEndUserManager] failed to get session id"),o.reject())},__onLoginSuccess:function(){return I=!0,c.publish("userSession",I),this.__userKickedOutHandler=n.bind(function(){this._discardSession(!0)},this),T.setUser(this.loggedinUser),!0===this.loggedinUser.get("isBookmarkOn")?this.uploadBookmarks().complete(n.bind(function(e){T.deleteLocalCustomerStorage(e)},this,this.loggedinUser)):this._prepareLocalBookmarkManager(this.loggedinUser),c.subscribe(k.UserSessionKickedOut,this.__userKickedOutHandler),E.triggerUpdateMenu(I).then(n.bind(function(){return this.loggedinUser},this))},__killSession:function(e,t,i){return x.killSession(e).then(n.bind(function(e){return y.skimSilkResponse(e,y.MODE.SILENT).then(n.bind(function(){if("KO"===e.resultMessage)switch(e.resultCode){case y.SILK_CODE.NO_ACTIVE_SESSION:case y.SILK_CODE.NULL_SESSION_ID:}return this.login(t,i)},this))},this),function(){return s.log("Failed to kill session"),o.reject("Failed to kill session")})},getCustomerBookmark:function(e){return this.loggedinUser?this._getBookmarkService().getCustomerBookmarks({assetId:e,sessionId:this.loggedinUser.get("sessionId")}).then(function(t){s.log("[sEndUserManager] getCustomerBookmark - got callback after getting a bookmark");var i=0;if(t&&t.hasOwnProperty("bookmarks")&&Array.isArray(t.bookmarks))for(var n=0;n<t.bookmarks.length;n++){var r=t.bookmarks[n];if(r.hasOwnProperty("assetId")&&r.assetId==e&&r.hasOwnProperty("bookmark")){i=r.bookmark,"W"===r.watchedState&&(i=0);break}}return i},function(){return s.warn("Error reading the bookmark with with assetID: "+e),o.resolve(0)}):o.resolve(0)},getBookmarkForAssetList:function(e){return e&&this.loggedinUser?this._getBookmarkService().getCustomerBookmarks({assetId:e,sessionId:this.loggedinUser.get("sessionId")}).then(function(e){return!e||!e.bookmarks||e.bookmarks.length<=0?o.resolve(!1):e.bookmarks}).fail(function(){return o.resolve(!1)}):o.resolve(!1)},_getBookmarkService:function(){if(!this.loggedinUser)return x;var e=x;return!1===this.loggedinUser.get("isBookmarkOn")&&(e=T),e},_prepareLocalBookmarkManager:function(){return T.setUser(this.loggedinUser),!1===T.hasLocalBookmarks()?(s.log("Download bookmarks"),x.getAllCustomerBookmarks({sessionId:this.loggedinUser.get("sessionId")}).then(n.bind(function(e){var t=e&&e.bookmarks;return T.setBookmarks(this.loggedinUser,t)},this))):o.resolve()},setLocalBookmark:function(e){this.loggedinUser&&!1===this.loggedinUser.get("isBookmarkOn")&&T.setLocalBookmark(e)},uploadBookmarks:function(){var e=T.getLocalBookmarksForUpload();return e?x.uploadCustomerBookmarks({sessionId:this.loggedinUser.get("sessionId"),postBody:e}):o.resolve()},updateCustomerBookmarkFlag:function(){var e={sessionId:this.loggedinUser.get("sessionId"),bookmark:!0===this.loggedinUser.get("isBookmarkOn")?"N":"Y"};return"N"===e.bookmark?this._prepareLocalBookmarkManager().then(n.bind(function(){return x.toggleBookmarkRequest(e)},this)):x.toggleBookmarkRequest(e).then(n.bind(function(e){return this.uploadBookmarks().then(n.bind(function(){return T.deleteLocalCustomerStorage(this.loggedinUser),e},this))},this))},logout:function(e){if(e===this.LOGOUT.DISCARD_USERNAME&&S.setStoredValue(S.KEYS.USERNAME),!I)return o.reject(w);var t={sessionId:this.loggedinUser.get("sessionId")};return x.logoutUser(t).then(n.bind(function(t){return y.skimSilkResponse(t,y.MODE.SILENT,y.MODE.BLOCK_EVENTS).then(n.bind(function(){return"KO"===t.resultMessage&&t.resultCode!==y.SILK_CODE.USER_NOT_FOUND_ON_SILK_CACHE?o.reject(v.getSilkMessageForCode(t.resultCode)):(r.getAnalyticsService().logout(),e===this.LOGOUT.ON_APP_EXIT?o.resolve("Ready to exit"):this._discardSession())},this))},this))},_discardSession:function(t){return e.util.clearDelay("keepAliveDelay"),I?(I=!1,this.loggedinUser=null,c.publish("userSession",I),c.unsubscribe(k.UserSessionKickedOut,this.__userKickedOutHandler),E.triggerUpdateMenu(!1).then(function(){t&&(s.warn("Session discarded, and user has been warned!"),c.publish(k.UserHasBeenLoggedOut))})):o.resolve()},_keepAlive:function(){var e=this.getUserSessionId();if(!e)return void s.warn("Can't keep alive with no session id");x.keepAlive(e).then(n.bind(function(e){y.skimSilkResponse(e,y.MODE.SILENT).then(n.bind(function(){"OK"===e.resultMessage?this._delayKeepAlive():this._discardSession(!0)},this))},this),function(e){s.warn("Keep alive failed due to "+e)})},_delayKeepAlive:function(){e.util.clearDelay("keepAliveDelay"),u.getSessionKeepAlivePeriod().then(e.util.bind(function(t){e.util.delay(t/1e3,"keepAliveDelay").then(e.util.bind(function(){this._keepAlive()},this))},this),function(e){s.warn("Session keep alive not scheduled due to "+e)})},getUserWatchList:function(){return this.loggedinUser?x.getUserWatchList(this.loggedinUser.get("sessionId")).then(n.bind(function(e){return y.skimSilkResponse(e,y.MODE.SILENT).then(function(){var t=null,i=[],s=null;return e.watchlist&&n.each(e.watchlist,function(e){t=new d,s=t.setAssetId(e.assetId).setCatalog(e.catalog).setInsertDate(e.insertDate).setPlatform(e.platform).setAssetType(e.type).build(),i.push(s)}),i},n.bind(function(){switch(e.resultCode){case y.SILK_CODE.NO_DATA_FOUND:return o.reject(b.getString("Mystuff.Mystuff_labelno_watchlist_desc"));default:return s.warn("Treating unexpected SILK response "+e.resultCode+" as no data"),o.reject(b.getString("Mystuff.Mystuff_labelno_watchlist_desc"))}},this))},this),function(e){return s.warn("Bad failure trying to get watchlist: "+e),o.reject(b.getString("Mystuff.Mystuff_labelno_watchlist_desc"))}):o.resolve([])},checkIfAssetIsInUserWatchList:function(e){
return this.loggedinUser?this.getUserWatchList().then(function(t){var i=[];return n.each(t,function(e){i.push(e.get("assetId"))}),n.every(e,function(e){return-1!==i.indexOf(e)})},function(){return!1}):o.resolve(!1)},addAssetToUserWatchList:function(e){return this.loggedinUser?x.addAssetToUserWatchList(e,this.loggedinUser.get("sessionId")).then(n.bind(function(e){return y.skimSilkResponse(e,y.MODE.SILENT).then(n.bind(function(){return"KO"!==e.resultMessage||(e.resultCode===y.SILK_CODE.USER_NOT_FOUND_ON_SILK_CACHE||(e.resultCode,y.SILK_CODE.NULL_SESSIONID),!1)},this))},this),function(){s.error("addAssetToUserWatchList failed")}):o.reject(w)},removeAssetFromWatchList:function(e){return this.loggedinUser?x.removeAssetFromWatchList(e,this.loggedinUser.get("sessionId")).then(n.bind(function(e){return y.skimSilkResponse(e,y.MODE.SILENT).then(n.bind(function(){return"KO"!==e.resultMessage||(e.resultCode===y.SILK_CODE.USER_NOT_FOUND_ON_SILK_CACHE||(e.resultCode,y.SILK_CODE.NULL_SESSIONID),!1)},this))},this),function(){s.error("removeAssetFromWatchList failed")}):o.reject(w)},getRecentlyWatched:function(){return this.loggedinUser?x.getRecentlyWatched(this.loggedinUser.get("sessionId")).then(function(e){return y.skimSilkResponse(e,y.MODE.SILENT).then(function(){if("OK"===e.resultMessage){var t=null,i=[],s=null;return e.lastWatchedList&&n.each(e.lastWatchedList,function(e){t=new h,e.isHD=n.isUndefined(e.isHD)?e.isHd:e.isHD,s=t.setAssetId(e.assetId).setTitle(e.title).setCategory(e.category).setColor(e.color).setIsHD(e.isHD).setFsk(e.fsk).setImageUrl(e.imageUrl).setTime(e.time).setAssetType(e.type).setStartDate(e.publishStartDate).setEndDate(e.publishEndDate).setContentTargeting(e.contentTargeting).setCatalog(e.catalog).setBookmark(e.bookmark).setPercentage(e.percentage).setDuration(e.duration).setWatchedFlag(e.watchedFlag).setSeasonNo(e.seasonNumber).setEpisodeNo(e.episodeNumber).setSerieCommTitle(e.seriesCommTitle).build(),i.push(s)}),i}})},function(){s.error("getRecentlyWatched failed")}):o.resolve([])},addAssetToRecentlyWatched:function(t){return t=t||{},e.util.extend(t,{sessionId:this.loggedinUser.get("sessionId")}),x.addAssetToRecentlyWatched(t).then(function(e){return y.skimSilkResponse(e,y.MODE.SILENT).then(function(){return"OK"===e.resultMessage?o.resolve("Successfully added to recently watched."):o.reject("Failed to add to recently watched.")})},function(){s.error("addAssetToRecentlyWatched failed")})},getDeviceDetails:function(){var e=o.defer();return x.getDeviceDetails({sessionId:this.getUserSessionId()}).then(function(t){y.skimSilkResponse(t,y.MODE.SILENT).then(function(){"OK"===t.resultMessage&&e.resolve(A.parseDeviceDetails(t)),t.resultCode===y.SILK_CODE.USER_NOT_FOUND_ON_SILK_CACHE&&e.reject(void 0),e.reject(v.getSilkMessageForCode(t.resultCode))},function(i){s.warn("silkResponseHelper.skimSilkResponse rejected "+i),t.resultCode===y.SILK_CODE.DOMAIN_NOT_EXISTING?e.resolve(A.parseDeviceDetails(void 0)):e.reject(i)})},function(t){s.warn("stormService.getDeviceDetails response skim rejected "+t),e.reject(t)}),e.promise},resetDeviceList:function(){return x.resetDeviceList({sessionId:this.getUserSessionId()}).then(function(e){return y.skimSilkResponse(e,y.MODE.SILENT).then(function(){return"OK"===e.resultMessage||(e.resultCode===y.SILK_CODE.USER_NOT_FOUND_ON_SILK_CACHE?o.reject(void 0):o.reject(v.getSilkMessageForCode(e.resultCode)))})})},checkUserPrivileges:function(e){if(!e)return o.resolve(void 0);var t=e.get("packageCode"),i=!1;return t?I?(n.each(this.loggedinUser.get("entitlements"),function(e){if(e===t)return i=!0,n.breaker}),o.resolve(i)):(i=!1,o.resolve(i)):(i=!0,o.resolve(i))},getUserSessionId:function(){return this.loggedinUser&&this.loggedinUser.get("sessionId")},getCustomerID:function(){return this.loggedinUser&&this.loggedinUser.get("customerId")},getEntitlements:function(){return this.loggedinUser&&this.loggedinUser.get("entitlements")},getLoginStatus:function(){return I||!1},getLoggedInUser:function(){return this.getUserData().then(n.bind(function(){return this.loggedinUser||void 0},this))},getFavoriteMovies:function(){return this.loggedIn?this.__userSettingService.getSharedSetting("favoriteMovies"):o.reject(w)},addFavoriteMovieById:function(e){return this.__addFavoriteAssetHelper("favoriteMovies",e)},removeFavoriteMovieById:function(e){return this.__removeFavoriteAssetHelper("favoriteMovies",e)},checkFavoriteForMovieById:function(e){return this.__checkFavoriteAssetHelper("favoriteMovies",e)},getFavoriteShows:function(){return this.loggedIn?this.__userSettingService.getSharedSetting("favoriteShows"):o.reject(w)},addFavoriteShowById:function(e){return this.__addFavoriteAssetHelper("favoriteShows",e)},removeFavoriteShowById:function(e){return this.__removeFavoriteAssetHelper("favoriteShows",e)},checkFavoriteForShowById:function(e){return this.__checkFavoriteAssetHelper("favoriteShows",e)},getFavoriteChannels:function(){return this.loggedIn?this.__userSettingService.getSharedSetting("favoriteChannels"):o.reject(w)},addFavoriteChannelById:function(e){return this.__addFavoriteAssetHelper("favoriteChannels",e)},removeFavoriteChannelById:function(e){return this.__removeFavoriteAssetHelper("favoriteChannels",e)},checkFavoriteForChannelById:function(e){return this.__checkFavoriteAssetHelper("favoriteChannels",e)},__addFavoriteAssetHelper:function(e,t){return this.loggedIn?this.__userSettingService.getSharedSetting(e).then(n.bind(function(i){if(i){for(var n=0,s=i.length;n<s;n++)if(i[n].assetId===t)return null;return i.push({assetId:t}),this.__userSettingService.setSharedSetting(e,JSON.stringify(i))}return i=[{assetId:t}],this.__userSettingService.setSharedSetting(e,JSON.stringify(i))},this)):o.reject(w)},__removeFavoriteAssetHelper:function(e,t){return this.loggedIn?this.__userSettingService.getSharedSetting(e).then(n.bind(function(i){if(i)for(var n=0,s=i.length;n<s;n++)if(i[n].assetId===t)return i.splice(n,1),this.__userSettingService.setSharedSetting(e,JSON.stringify(i));return null},this)):o.reject(w)},__checkFavoriteAssetHelper:function(e,t){return this.loggedIn?this.__userSettingService.getSharedSetting(e).then(function(e){if(e)for(var i=0,n=e.length;i<n;i++)if(e[i].assetId===t)return!0;return!1}):o.reject(w)},getMovieRentalExpiryById:function(e){return this.loggedIn?this.__userSettingService.getSharedSetting("movieRentals").then(n.bind(function(t){if(!t)throw new l(l.FACILITY.USER_SETTINGS_SERVICE,l.ERROR.NOT_FOUND,"No such record");for(var i=0,n=t.length;i<n;i++)if(t[i].assetId===e){if(t[i].expirationTime>(new Date).getTime())return t[i].expirationTime;throw new l(l.FACILITY.USER_SETTINGS_SERVICE,l.ERROR.NOT_FOUND,"No valid rental in place. Maybe the rental has expired already")}throw new l(l.FACILITY.USER_SETTINGS_SERVICE,l.ERROR.NOT_FOUND,"No such record")},this)):o.reject(w)},getAllMovieRentals:function(){return this.loggedIn?this.__userSettingService.getSharedSetting("movieRentals").then(L):o.reject(w)},addMovieRental:function(e,t){return this.loggedIn?this.__userSettingService.getSharedSetting("movieRentals").then(n.bind(function(i){if(i){for(var n=0,s=i.length;n<s;n++)if(i[n].assetId===e)return i[n].expirationTime=t,this.__userSettingService.setSharedSetting("movieRentals",JSON.stringify(i));return i.push({assetId:e,expirationTime:t}),this.__userSettingService.setSharedSetting("movieRentals",JSON.stringify(i))}return i=[{assetId:e,expirationTime:t}],this.__userSettingService.setSharedSetting("movieRentals",JSON.stringify(i))},this)):o.reject(w)},removeMovieRentalById:function(e){return this.loggedIn?this.__userSettingService.getSharedSetting("movieRentals").then(n.bind(function(t){if(t)for(var i=0,n=t.length;i<n;i++)if(t[i].assetId===e)return t.splice(i,1),this.__userSettingService.setSharedSetting("movieRentals",JSON.stringify(t))},this)):o.reject(w)},getLastWatchedVideos:function(){return this.loggedIn?this.__userSettingService.getSharedSettings(["lastWatchedMovies","lastWatchedEpisodes"]).then(n.bind(function(e){return e&&e.lastWatchedMovies&&e.lastWatchedEpisodes?e.lastWatchedMovies.concat(e.lastWatchedEpisodes):null},this)):o.reject(w)},addLastWatchedMovie:function(e,t,i){return this.__addLastWatchedAsset("lastWatchedMovies",e,t,i)},getLastWatchedMovieById:function(e){return this.loggedIn?this.__userSettingService.getSharedSetting("lastWatchedMovies").then(n.bind(function(t){for(var i=0,n=t.length;i<n;i++)if(t[i].assetId===e)return t[i];return null},this)):o.reject(w)},addLastWatchedEpisode:function(e,t,i){return this.__addLastWatchedAsset("lastWatchedEpisodes",e,t,i)},getLastWatchedEpisodeById:function(e){return this.loggedIn?this.__userSettingService.getSharedSetting("lastWatchedEpisodes").then(n.bind(function(t){for(var i=0,n=t.length;i<n;i++)if(t[i].assetId===e)return t[i];return null},this)):o.reject(w)},__addLastWatchedAsset:function(e,t,i,s){return this.loggedIn?this.__userSettingService.getSharedSetting(e).then(n.bind(function(n){if(n){for(var r=0,a=n.length;r<a;r++)if(n[r].assetId===t){n.splice(r,1);break}}else n=[];return n.push({assetId:t,lastPosition:i,lastPlayedDevice:s}),this.__userSettingService.setSharedSetting(e,JSON.stringify(n))},this)):o.reject(w)},getLastWatchedChannel:function(){return this.loggedIn?this.__userSettingService.getSharedSetting("lastWatchedChannel").then(n.bind(function(e){return e||null},this)):o.reject(w)},addLastWatchedChannelById:function(e){return this.loggedIn?this.__userSettingService.setSharedSetting("lastWatchedChannel",JSON.stringify({assetId:e})):o.reject(w)},checkFskPin:function(e){return e&&this.loggedinUser?x.checkFskPin({sessionId:this.loggedinUser.get("sessionId"),fskPin:e}).then(function(e){return y.skimSilkResponse(e,y.MODE.SILENT).then(function(){return e})}):o.resolve(!1)},deinit:function(){this._super(),c.unsubscribe(k.UserDataRequireUpdate,this.__userDataUpdatedHandler)}}))}),define("tvedemo/mgr/appRouter",["xdk-ax/mediator","xdk-ax/mvc/ControllerManager","xdk-ax/mvc/AppRoot","xdk-base/config","xdk-base/util","tvedemo/ctrl/RoutableController","xdk-base/promise","xdk-base/core","xdk-ax/focusManager","tvedemo/wgt/Loading","xdk-base/console","storm/helper/util","tvedemo/mgr/sEndUserManager","tvedemo/mgr/sHistoryManager","xdk-base/device"],function(e,t,i,n,s,r,a,o,l,c,d,u,h,_,g){"use strict";function f(e,t){var i,n,c,u={},h=e.page,_=e.state,g=e.message,f=e.historySkip;return t?(i=t.currentController,n=t.navigated):(i=S,n=!1),d.info("Navigate Step : "+h,_,g),v(h).then(function(e){var t;if(a.isPromise(i))t=i;else{var h=a.defer();h.resolve(i),t=h.promise}return t.then(function(t){var i,h,p=0,v=0;if(c=t.getSubControllers(),c&&c[0]&&!0===c[0]._isVideoPlayer&&(h=!0),(n||f||h)&&(u={historySkip:!0}),u.context=_?s.extend(e.getDefaultState(),_):e.getDefaultState(),g&&s.keys(g).length>0&&(p=s.keys(u.context).length,v=s.keys(g).length,d.info("state keys: "+s.keys(u.context).join()),d.info("message keys: "+s.keys(g).join()),s.extend(u.context,g),v+p!==s.keys(u.context).length))throw o.createException("appRouter","Repeated item in state or context,");if(u.historyFocus=l.getCurFocus(),c.length>1)throw o.createException("appRouter","IncorrectController, the number of subcontrollers is more than 1.");if(!(e.prototype instanceof r))throw o.createException("appRouter","the target Controller is not instance of RoutableController");return 0===c.length?(i=t.getSubControllerLocation(),t=y.open(e,i,u),a.when(u.context.setupPending,function(){return u.context.setupPending=null,{navigated:!0,currentController:t}})):c[0]instanceof e&&m(c[0],_)&&!u.context.__forceReload?{navigated:!1,currentController:c[0]}:(t=y.replace(c[0],e,u),a.when(u.context.setupPending,function(){return u.context.setupPending=null,{navigated:!0,currentController:t}}))})})}function p(t){var i,n=[],r=!1,o=0,l=t.path||"",u=t.state||null,g=t.message||null,p=t.historySkip||!1,m=t.extendLoading||!1;if(t.requireLogin&&!h.getLoginStatus())return void e.publish("navigate",{path:"Main/Login",state:{redirection:{cmd:t}}});if(T)return void d.info("appRouter is processing. Further action is not allowed.");for(T=!0,c.open(),n=l.split("/"),o=0;o<n.length;o++)i=i?i.then(s.bind(f,null,{page:n[o],state:u,message:g,historySkip:p})):f({page:n[o],state:u,message:g,historySkip:p});i.then(function(e){r=e.navigated,d.info("finish loading")}).complete(function(){l===x.MAIN_HOME&&_.clear(),m&&r||c.close(),T=!1,t.navigatedPromise&&a.isPromise(t.navigatedPromise.promise)&&t.navigatedPromise.resolve("navigated"),e.publish("navigated",t)}).done()}function m(e,t){if(!t)return!0;var i,n=e.getState();for(i in t)if(!s.isUndefined(n[i])&&n[i]!==t[i])return!1;return!0}function v(e){var t,i;if(i=a.defer(),k[e])t=k[e];else{if(!C)throw o.createException("appRouter","Unable to find the right controller");t=C+"/"+e,k[e]=t}return amd.require([t],function(e){i.resolve(e)},function(){i.reject("unable to load the module"+t)}),i.promise}var b,S=i.singleton(),y=t.singleton(),E=n.get("approuter",null),k={},C="",T=!1,x={MAIN_HOME:"Main/Home"};if(E){if(!E.base)throw o.createException("appRouter","the base is not set.");if(C=E.base,E.paths)for(b in E.paths)E.paths.hasOwnProperty(b)&&(k[b]=E.paths[b])}return{activate:function(){e.subscribe("navigate",p)},deactivate:function(){e.unsubscribe("navigate",p)}}}),define("storm/event/LifecycleEvent",{HomePageInitialised:"LifecycleEvent:HomePageInitialised"}),define("storm/focusHandler",["xdk-base/class","xdk-ax/focusManager","xdk-base/util","xdk-ui-basic/Dialog","tvedemo/wgt/Keyboard"],function(e,t,i,n,s){"use strict";return new(e.create({},{init:function(){this._defaultFocusHandler=i.bind(t.focus,t),t.focus=i.bind(function(e,i){var n=t.getCurFocus(),s=this.isComponentPartOfDialog(n);return s?this.isPartOfSameDialog(n,e)?this._defaultFocusHandler(e,i):s._isOpen?this.isComponentPartOfDialog(e)?this._defaultFocusHandler(e,i):this.isComponentPartOfKeyboard(e)?this._defaultFocusHandler(e,i):(s._lastFocus=e,!1):this._defaultFocusHandler(e,i):!!(e&&e.getRoot&&e.getRoot())&&this._defaultFocusHandler(e,i)},this)},isComponentPartOfDialog:function(e){for(var t=e;t;){if(t instanceof n)return t;t=t.getParent()}return!1},isComponentPartOfKeyboard:function(e){for(var t=e;t;){if(t instanceof s)return t;t=t.getParent()}return!1},isPartOfSameDialog:function(e,t){for(var i=e,s=t;i&&!(i instanceof n);)i=i.getParent();for(;s&&!(s instanceof n);)s=s.getParent();return i===s}}))({})}),define("xdk-base/device/interface/System",["xdk-base/Interface"],function(e){"use strict";var t=e.create("System",{setScreenSaver:["flag"],setSystemMute:["flag"],powerOff:[],exit:[],hasMouse:[],hasFixedKeyboard:[],getDisplayResolution:[],supportSSL:[],getNetworkStatus:[],redraw:["element"]});return t.EVT_NETWORK_STATUS_CHANGED="device:system:network-status-changed",t.EVT_RESIZE="device:system:resize",t}),require(["xdk-base/Env","xdk-ax/mvc/AppRoot","storm/ctrl/Splash","xdk-base/console","xdk-base/promise","tve/sAppGridServiceHolder","tvedemo/mgr/appRouter","tvedemo/mgr/sHistoryManager","tvedemo/mgr/sEndUserManager","storm/mgr/sAppConfigManager","storm/mgr/sLanguageManager","storm/event/LifecycleEvent","xdk-base/config","xdk-base/device","xdk-ax/evt/type","tvedemo/wgt/ConfirmDialog","xdk-base/util","tvedemo/wgt/Loading","xdk-ax/mediator","xdk-mouse/mouseHandler","storm/focusHandler","tvedemo/helper/dialogHelper","xdk-ax/focusManager","xdk-base/device/interface/System"],function(e,t,i,n,s,r,a,o,l,c,d,u,h,_,g,f,p,m,v,b,S,y,E,k){"use strict";var C=e.singleton(),T=t.singleton(),x=!1,I={TV:"tv",HUB:"smarthub"},w=function(e,t){n.warn("Exiting, to destination "+e);var i=s.defer();t=t||!1,"samsung"===_.platform||"tizen"===_.platform?t?i.resolve("Logout skipped since internet was most likely down"):(m.open(),l.logout(l.LOGOUT.ON_APP_EXIT).then(function(e){i.resolve("Success: "+e)},function(e){s.isPromise(e)?e.then(function(e){var t=e&&e.get("description");i.resolve("Failure: "+t)}):i.resolve("Failure: "+e)})):l.logout(l.LOGOUT.RETAIN_USERNAME).then(function(e){i.resolve("Success!")},function(e){s.isPromise(e)?e.then(function(e){var t=e&&e.get("description");i.resolve("Failure: "+t)}):i.resolve("Failure: "+e)}),i.promise.then(function(t){n.log("Final logout: "+t),m.close(),n.__sendLog&&n.__sendLog(),_.system.exit({toTV:e===I.TV})})},L=function(e){var i=T._subControllers&&T._subControllers[0];if("playstation"===_.platform||i&&!0===i.splashView&&!0===i.splashShowing)return"playstation"===_.platform;var n=e.id===_.vKey.EXIT.id,s=e.id===_.vKey.BACK.id&&0===o.getHistoryStack().length;if(n||s){if(y.isAnyDialogOpen()||x)return!0;var r=y.confirm({skipFocusRestore:!0,css:"exit",title:d.getString("ui.exit.title"),message:d.getString("ui.exit.body"),positiveText:d.getString("ui.exit.exitYesButton"),negativeText:d.getString("ui.exit.exitNoButton"),positiveAction:function(){w("samsung"===_.platform||"tizen"===_.platform?n?I.TV:I.HUB:I.HUB)},parent:T.getView()});return r.addEventListener(g.CLOSE,function(){E.focus(t.singleton().getSubController(0).getView())}),v.publish("exitPopup",!0),r.addEventListener(g.CLOSE,function(){x=!1,v.publish("exitPopup",!1)}),x=!0,!1}return!(e.id!==_.vKey.BACK.id||!(i&&!0!==i.splashView&&y.isAnyDialogOpen()||x))||void 0},A=null,D=function(e){if(!1===e){var t="Smart TV";"playstation"===_.platform&&(t="PS4"===_.id.getModel()?"PlayStation4-System":"PlayStation3-System");var i={device:t};m.close(),A=y.error({title:d.getString("ui.networkFail.title"),reason:d.getString("ui.networkFail.body",i),buttonText:d.getString("ui.global.retry"),disableAutoclose:!0,closeAction:function(){_.system.getNetworkStatus().then(function(e){e||"playstation"===_.platform?D(e):w(I.HUB,!0)})}})}else if(A){try{A.close()}catch(e){n.warn("Trouble closing network status popup due to "+e)}A=null,P||(n.warn("Invoking window.location.reload()..."),window.location.reload(!0))}},P=!1,R=function(){P=!0,v.unsubscribe(u.HomePageInitialised,R)};C.addEventListener(C.EVT_ONLOAD,function(){T.getView().addClass(_.id.getModel()),b.setMouseOnCallback(function(){v.publish("mouseOn")}),b.setMouseOffCallback(function(){v.publish("mouseOff")}),v.subscribe(u.HomePageInitialised,R),C.addEventListener(C.EVT_ONKEY,function(e){_.tvkey.constructor.SMART_HUB&&e.id===_.tvkey.constructor.SMART_HUB.id?(n.warn("Smart-hub key is pressed, trying to exit to HUB"),w(I.HUB)):"tizen"!==_.platform&&_.tvkey.constructor.CH_UP&&e.id===_.tvkey.constructor.CH_UP.id?(n.warn("CH_UP key is pressed, trying to exit to TV"),w(I.TV)):"tizen"!==_.platform&&_.tvkey.constructor.CH_DOWN&&e.id===_.tvkey.constructor.CH_DOWN.id&&(n.warn("CH_DOWN key is pressed, trying to exit to TV"),w(I.TV))}),a.activate(),o.activate(),r.getAppGridService().applicationStart().fail(function(){n.warn("Cannot send applicationStart to the AppGrid service")}),T.setMainController(i),T.getView().addEventListener(g.KEY,L,!0),_.system.getNetworkStatus().then(function(e){D(e),_.system.addEventListener(k.EVT_NETWORK_STATUS_CHANGED,D)})}),C.addEventListener(C.EVT_ONUNLOAD,function(){r.getAppGridService().applicationStop().done()})}),define("app",["xdk-base/amd","xdk-base/domReady","../dep/dep.config.js","../dep/img.map.js","amd.config.js"],function(){}),define("xdk-base/device/shared/Html5Player",["xdk-base/core","xdk-base/class","xdk-base/device/AbstractPlayer","xdk-base/device/interface/Player","xdk-base/device/Media","xdk-base/util","xdk-base/console","require"],function(e,t,i,n,s,r,a,o){"use strict";var l=s.singleton(),c=null,d=function(){return c||(c=o("xdk-base/device").system.getDisplayResolution())},u=n.PLAYBACK_ERRORS;return t.create(i,{},{_onLoaded:!1,_CONTAINER_NAME:"Html5PlayerContainer",_parentNode:null,_playerObject:null,_prepared:!1,_duration:0,_connectionTimeLimit:90,_connectionTimeOut:null,_connected:!1,_pausedVideo:!1,_supportHLS:!1,_supportDASH:!1,_support:!0,_seek:!1,_seekTime:0,_url:null,__hasFinished:!0,__errorReported:!1,init:function(){this.__bindedOnLoad=r.bind(this._onLoad,this),this.__bindedOnTimeUpdate=r.bind(this._onTimeUpdate,this),this.__bindedOnWaiting=r.bind(this._onWaiting,this),this.__bindedOnPlaying=r.bind(this._onPlaying,this),this.__bindedOnError=r.bind(this._onError,this),this.__bindedOnFinished=r.bind(this._onFinished,this),this.__bindedOnCanPlay=r.bind(this._onCanPlay,this),this.__bindedOnDurationChange=r.bind(this._onDurationChange,this),this.__bindedOnRateChange=r.bind(this._onRateChange,this)},prepare:function(e){a.info("html5 player prepare"+e),this._prepared||(this._parentNode=document.getElementsByTagName("body")[0],this._playerContainer=document.createElement("div"),this._playerContainer.id=this._CONTAINER_NAME,this._playerContainer.className="playerContainer",this._playerObject=document.createElement("video"),this._playerObject.id="Html5Player",this._playerObject.className="playerObject",this._playerContainer.appendChild(this._playerObject),this._parentNode.appendChild(this._playerContainer),this._addVideoEventListeners(this._playerObject),this.hide(),this._prepared=!0)},reset:function(){this._prepared&&(this.hide(),this._stopPlayback(),this._removeVideoEventListeners(this._playerObject),this.deinit())},deinit:function(){this._prepared&&(this._prepared=!1,this._stopPlayback(),this._playerContainer?(this._playerContainer.removeChild(this._playerObject),this._parentNode.removeChild(this._playerContainer),this._playerContainer=null):this._parentNode.removeChild(this._playerObject),a.info("HTML5 video player deinit successfull."))},play:function(t){if(this.__errorReported)return void a.warn("[Html5Player] Play after error. A load() operation is expected to reset the state.");if(a.info("[XKD HTML5] Play requested."),!this._support)return this._stopPlayback(),void l._onError(u.RENDER.UNSUPPORTED,"unsupport format in the html5 video player");if(!this.url||this._playerObject.getAttribute("src")&&this._playerObject.getAttribute("src")===this.url||(this._playerObject.setAttribute("src",this.url),this._playerObject.load()),this.show(),this._connected||(this._connected=!0,l._onConnecting(),this._playerObject.play(),this._removeConnectionTimeOut(),this._connectionTimeOut=e.getGuid(),r.delay(this._connectionTimeLimit,this._connectionTimeOut).then(r.bind(this._onConnectionTimeout,this),function(){}).done()),this.__hasFinished=!1,this._pausedVideo=!1,this._seek=!1,t&&!r.isUndefined(t.sec)&&(this._seek=!0,this._seekTime=t.sec),1!==this.getPlaybackSpeed()&&(this._playerObject.playbackRate=1),this._onLoaded&&(this._removeConnectionTimeOut(),this._seek&&this._seekTime>0)){var i=r.bind(function(){this._playerObject.removeEventListener("seeked",i),this._pausedVideo||this._playerObject.play()},this);return this._playerObject.addEventListener("seeked",i),this.__setCurrentTime(this._seekTime),void(this._seek=!1)}this._playerObject.play()},pause:function(){a.info("[XDK HTML5] Pausing video."),this._pausedVideo=!0,this._playerObject.pause(),l._onPause()},stop:function(){a.info("[XDK HTML5] Stopping video"),this._stopPlayback(),l._onStopped()},_stopPlayback:function(){this._playerObject.pause(),this.hide(),this._removeConnectionTimeOut(),this._connected=!1,this._onLoaded&&!this.__hasFinished&&this.__setCurrentTime(0)},resume:function(){a.info("[XDK HTML5] Resuming..."),this._playerObject.play(),this._pausedVideo=!1,1!==this.getPlaybackSpeed()&&(this._playerObject.playbackRate=1)},skip:function(e){this.__setCurrentTime(this.getCurTime()+e)},seek:function(e){e===this._duration&&(e=Math.floor(this.getDuration()-1)),this.__setCurrentTime(e)},getPlaybackSpeed:function(){return this._playerObject.playbackRate},getCurTime:function(){return this._playerObject.currentTime},_setDuration:function(){this._duration=this._playerObject.duration},getDuration:function(){return this._duration},show:function(){this._playerObject&&(this._playerObject.style.visibility="visible")},hide:function(){this._playerObject&&(this._playerObject.style.visibility="hidden")},getCapabilities:function(){var e={type:["mp4","mp3"]};return this._supportHLS&&e.type.push("hls"),this._supportDASH&&e.type.push("dash"),e},load:function(e,t){return this.url=e,!!this._prepared&&(t=t||{},this._preparePlayerObject(t)&&this._doLoad(e,t),e)},isMetadataLoaded:function(){return this._onLoaded},setWindowSize:function(e){if(!this._playerObject)return void a.warn("[Html5Player] Fail to set the size due to no playerObject");var t="playerObject",i=d();e.relativeToParent&&(t+=" relative"),e.width===i.width&&e.height===i.height&&(t+=" fullscreen"),this._playerObject.className=t,this._playerObject.style.width=e.width+"px",this._playerObject.style.height=e.height+"px",this._playerObject.style.left=e.left+"px",this._playerObject.style.top=e.top+"px",this._currentWindowSize=e},setFullscreen:function(){var e=d();this.setWindowSize({top:0,left:0,height:e.height,width:e.width})},_preparePlayerObject:function(e){return!!this._playerObject&&(e.parentNode&&(this._playerContainer&&(this._parentNode.removeChild(this._playerContainer),this._playerContainer=null),this._parentNode=e.parentNode,this._parentNode.appendChild(this._playerObject)),!0)},_doLoad:function(e,t){this.__hasFinished=!1,this.__errorReported=!1,this._onLoaded=!1,this._connected=!1,this._pausedVideo=!0,this._playerObject.setAttribute("src",e),this._playerObject.load(),this.hide(),"mp3"===t.type&&this.setWindowSize({width:0,height:0,top:0,left:0}),this._support=this._canPlayMedia(t)},_canPlayMedia:function(e){var t=this.getCapabilities(),i=e.type,n=e.drm,s=!(i&&-1===t.type.indexOf(i))||"*"===i,r=!(n&&-1===t.drms.indexOf(n));return s&&r},_onCanPlay:function(){!this._pausedVideo&&this._connected&&this._playerObject.play()},_onConnectionTimeout:function(){this._stopPlayback(),l._onError(u.NETWORK.FAILED)},_onDurationChange:function(){this._onLoaded=!0,this._setDuration(),this._performInitialSeek()},_onLoad:function(){this._removeConnectionTimeOut(),this._onDurationChange(),this._connected&&1===this.getPlaybackSpeed()&&(a.info("[XDK HTML5] onload event"),l._onBufferingStart(),l._onBufferingProgress())},_performInitialSeek:function(){!this._seek||this._seekTime<0||(this.__setCurrentTime(this._seekTime),this._seek=!1)},_addVideoEventListeners:function(e){e.addEventListener("loadedmetadata",this.__bindedOnLoad),e.addEventListener("waiting",this.__bindedOnWaiting),e.addEventListener("timeupdate",this.__bindedOnTimeUpdate),e.addEventListener("seeking",this.__bindedOnWaiting),e.addEventListener("seeked",this.__bindedOnPlaying),e.addEventListener("playing",this.__bindedOnPlaying),e.addEventListener("error",this.__bindedOnError),e.addEventListener("ended",this.__bindedOnFinished),e.addEventListener("canplay",this.__bindedOnCanPlay),e.addEventListener("durationchange",this.__bindedOnDurationChange),e.addEventListener("ratechange",this.__bindedOnRateChange)},_removeVideoEventListeners:function(e){e.removeEventListener("loadedmetadata",this.__bindedOnLoad),e.removeEventListener("waiting",this.__bindedOnWaiting),e.removeEventListener("timeupdate",this.__bindedOnTimeUpdate),e.removeEventListener("seeking",this.__bindedOnWaiting),e.removeEventListener("seeked",this.__bindedOnPlaying),e.removeEventListener("playing",this.__bindedOnPlaying),e.removeEventListener("error",this.__bindedOnError),e.removeEventListener("ended",this.__bindedOnFinished),e.removeEventListener("canplay",this.__bindedOnCanPlay),e.removeEventListener("durationchange",this.__bindedOnDurationChange),e.removeEventListener("ratechange",this.__bindedOnRateChange)},_removeConnectionTimeOut:function(){null!==this._connectionTimeOut&&(r.clearDelay(this._connectionTimeOut),this._connectionTimeOut=null)},_onWaiting:function(){l.isState(l.CONNECTING)||this.__needBlockStateChange()||(a.info("[xdk html5] waiting"),l._onBufferingStart(),l._onBufferingProgress())},__needBlockStateChange:function(){return!this._connected||1!==this.getPlaybackSpeed()},_onPlaying:function(){this.__needBlockStateChange()||(a.info("[xdk html5] onplaying event"),this._removeConnectionTimeOut(),this._pausedVideo?l._onPause():l._onPlaying(),l.isState(l.BUFFERING)&&l._onBufferingFinish())},_onTimeUpdate:function(){var e;this._connected&&(e=this.getCurTime(),e<0&&(e=0),l._onTimeUpdate(e))},_onFinished:function(){a.info("[XDK HTML5] finished event"),this.__hasFinished=!0,this._stopPlayback(),l._onFinish()},_onError:function(e){if(!this.__hasFinished&&!this.__errorReported){var t;if(this._playerObject.networkState===this._playerObject.NETWORK_NO_SOURCE)t=u.NETWORK.FILE,this._removeConnectionTimeOut(),this.hide(),this._connected=!1,this._onLoaded=!1;else{switch(e.target.error.code){case e.target.error.MEDIA_ERR_ABORTED:t=u.RENDER.ABORTED;break;case e.target.error.MEDIA_ERR_NETWORK:t=u.NETWORK.FAILED;break;case e.target.error.MEDIA_ERR_DECODE:t=u.RENDER.DECODE;break;case e.target.error.MEDIA_ERR_SRC_NOT_SUPPORTED:t=u.RENDER.UNSUPPORTED;break;default:t=u.RENDER.FAILED}this._stopPlayback()}this.__errorReported=!0,a.error("[XDK HTML5] onRenderError : "),l._onError(t)}},_onRateChange:function(){if(1!==this._playerObject.playbackRate)return void l._onSpeeding();l._onPlaying()},getPlayerObject:function(){return this._playerObject},speed:function(e){return r.isNumber(e)?e<=0?void a.warn("Negative playbackRate is not supported"):(l.isState(l.PAUSED)&&this._playerObject.play(),this._playerObject.playbackRate=e,void(this._pausedVideo=!1)):void a.warn("Speed value must be a number")},__setCurrentTime:function(e){this._playerObject.currentTime=e}})}),define("xdk-base/device/shared/ConnectionPoller",["xdk-base/core","xdk-base/class","xdk-base/util","xdk-base/console","xdk-base/config","xdk-base/exception"],function(e,t,i,n,s,r){"use strict";return t.create({},{__timer:null,__pollingInterval:15,__currentStatus:!0,__consecFailure:0,__consecFailureThreshold:3,_checkStatus:null,init:function(t,n,a){if(!i.isFunction(t)||!i.isFunction(n))throw e.createException(r.ILLEGAL_ARGUMENT,"Check Status or onStatusChange function is not defined properly.");this._checkStatus=t,this._onStatusChange=n,a=a||{},this.__currentStatus=!i.isBoolean(a.networkStatus)||a.networkStatus,this.__consecFailureThreshold=i.isNumber(a.consecFailureThreshold)?a.consecFailureThreshold:s.get("device.connection-poller.consec-failure-threshold",this.__consecFailureThreshold),this.__pollingInterval=i.isNumber(a.pollingInterval)?a.pollingInterval:s.get("device.connection-poller.interval",this.__pollingInterval)},isConnected:function(){return this.__currentStatus},startPolling:function(){this.__timer=e.getGuid()+"-ConnectionPoller-polling",i.delay(this.__pollingInterval,this.__timer).then(i.bind(this.__poll,this),function(){}).done()},isPolling:function(){return null!==this.__timer},__poll:function(){var e=i.bind(function(t,i){return n.info("[ConnectionPoller] Checking the connection status:"+t),t===i?void this.startPolling():i||!i&&this.__consecFailure>=this.__consecFailureThreshold-1?(this.__currentStatus=i,this._onStatusChange(this.__currentStatus),this.__consecFailure=0,void this.startPolling()):(this.__consecFailure++,void this._checkStatus(e))},this,this.__currentStatus);this._checkStatus(e)},stopPolling:function(){i.clearDelay(this.__timer),this.__timer=null,this.__consecFailure=0},setPollingInterval:function(e){this.__pollingInterval=e},getPollingInterval:function(){return this.__pollingInterval}})}),define("xdk-base/device/interface/Storage",["xdk-base/Interface"],function(e){"use strict";return e.create("Storage",{set:[],get:["key"],unset:[],clear:[]})}),define("xdk-base/device/AbstractStorage",["xdk-base/class","xdk-base/config","xdk-base/device/interface/Storage","require"],function(e,t,i,n){"use strict";return e.createAbstract([i],{},{_uniquePrefix:t.get("device.storage.prefix","AccedoXDK"),get:function(e){return!1},clear:function(){var e,t=n("xdk-base/device"),i=t.id.__UUID_KEY;e=this.get(i),this._doClear(),this.set(i,e)}})}),define("xdk-base/device/shared/CookiesStorage",["xdk-base/class","xdk-base/device/AbstractStorage","xdk-base/util","xdk-base/console"],function(e,t,i,n){"use strict";return e.create(t,{},{__tempCookies:null,set:function(e,t){n.log("using cookies storage"),this.__tempCookies||this.__getCookies(),
this.__tempCookies[e]=t,this.__setCookies()},get:function(e){this.__tempCookies||this.__getCookies();var t;return this.__tempCookies&&this.__tempCookies[e]&&(t=this.__tempCookies[e],!i.isUndefined(t))?t:null},unset:function(e){this.__tempCookies||this.__getCookies(),this.__tempCookies&&!i.isUndefined(this.__tempCookies[e])&&(this.__tempCookies[e]=null,delete this.__tempCookies[e],this.__setCookies())},_doClear:function(){this.__tempCookies={},this.__setCookies()},__getCookies:function(){var e,t,s,r;if(!i.isString(document.cookie))return void n.warn("document.cookie doesn't exist and unable to get the cookies");if(!document.cookie)return void(this.__tempCookies={});for(e=document.cookie.split(";"),s=0,r=e.length;s<r;s++)if(t=i.strip(e[s]),i.startsWith(t,this._uniquePrefix+"=")&&(t=t.substring((this._uniquePrefix+"=").length)))try{return void(this.__tempCookies=i.parse(decodeURIComponent(t)))}catch(e){n.warn("unable to load the cookies")}this.__tempCookies={}},__setCookies:function(){if(!this.__tempCookies)return n.warn("cookie Object is undefined and unable to set into the cookies"),!1;var e,t,s;i.isEmpty(this.__tempCookies)?t="; expires= -1":(e=new Date,e.setTime(e.getTime()+31536e6),t="; expires="+e.toGMTString()),s=this._uniquePrefix+"="+encodeURIComponent(i.stringify(this.__tempCookies))+t+"; domain="+location.hostname+"; path=/",document.cookie=s}})}),define("xdk-base/device/shared/FlashPlayer",["xdk-base/core","xdk-base/class","xdk-base/device/AbstractPlayer","xdk-base/device/interface/Player","xdk-base/device/Media","xdk-base/util","xdk-base/console","require"],function(e,t,i,n,s,r,a,o){"use strict";var l=s.singleton(),c=null,d=function(){return c||(c=o("xdk-base/device").system.getDisplayResolution())},u=n.PLAYBACK_ERRORS;return t.create(i,{},{_curTime:0,_onLoaded:!1,_CONTAINER_NAME:"FlashPlayerContainer",_parentNode:null,_playerObject:null,_prepared:!1,_duration:0,_connectionTimeLimit:90,_connectionTimeOut:null,_connected:!1,_pausedVideo:!1,_supportHLS:!1,_support:!0,_seek:!1,_seekTime:0,_url:null,init:function(t){if("samsung"===t.getId()&&t.getInterface(t.constructor.ID).getFirmwareYear()<2012)throw e.createException("FlashPlayerNotSupported","Flash Player is not supported when less than 2012.")},prepare:function(e){if(!e.swfUrl)return a.warn("Unable to find the url of the flash"),!1;if(!this._prepared){this._parentNode=window.document.getElementsByTagName("body")[0],this._playerContainer=document.createElement("div"),this._playerContainer.id=this._CONTAINER_NAME,this._playerContainer.className="playerContainer";try{var t,i,n,s;this._playerObject=document.createElement("object"),this._playerObject.setAttribute("id","FlashPlayer"),this._playerObject.className="playerObject",this._playerObject.setAttribute("type","application/x-shockwave-flash"),t=document.createElement("param"),t.name="movie",t.value=e.swfUrl,this._playerObject.appendChild(t),i=document.createElement("param"),i.name="quality",i.value="high",this._playerObject.appendChild(i),n=document.createElement("param"),n.name="wmode",n.value="transparent",this._playerObject.appendChild(n),s=document.createElement("param"),s.name="bgcolor",s.value="000000",this._playerObject.appendChild(s),this._playerContainer.appendChild(this._playerObject),this._parentNode.appendChild(this._playerContainer),window.__flashCallback=r.bind(this.callback,this),this._inited=!0}catch(e){return a.error("VideoPlayer error: while creating the player object: "+e),!1}this._prepared=!0}},reset:function(){this._prepared&&(this.hide(),this._stopPlayback(),this.deinit())},deinit:function(){this._prepared&&(this._prepared=!1,this._playerContainer?(this._playerContainer.removeChild(this._playerObject),this._parentNode.removeChild(this._playerContainer),this._playerContainer=null):this._parentNode.removeChild(this._playerObject),delete window.__flashCallback,a.info("Flash video player deinit successfull."))},play:function(t){if(a.info("[XKD flash] Play requested."),!this._support)return this._stopPlayback(),void l._onError(u.RENDER.UNSUPPORTED,"unsupport format in the flash video player");if(l.isState(l.STOPPED)&&this._url&&this._playerObject.loadUrl)if("rtmp"===this._urlOpts.type){var i={};this._urlOpts.streamName&&(i.streamName=this._urlOpts.streamName),this._urlOpts.liveStreaming?(i.liveStreaming=this._urlOpts.liveStreaming,this._noProgressive=!0):this._noProgressive=!1,this._playerObject.loadUrl(this._url,i)}else"mp4"===this._urlOpts.type&&this._playerObject.loadUrl(null,{streamName:this._url});if(this.show(),!this._connected){this._connected=!0,l._onConnecting();try{this._playerObject.play()}catch(e){a.warn("unable to play the video.Flash hasn't been initialized correctly. Please check the url")}this._removeConnectionTimeOut(),this._connectionTimeOut=e.getGuid(),r.delay(this._connectionTimeLimit,this._connectionTimeOut).then(r.bind(this._onConnectionTimeout,this)).done()}this._pausedVideo=!1,this._seek=!1,t&&t.sec&&(this._seek=!0,this._seekTime=t.sec),l.isState(l.PAUSED)&&(this.__withholdSeek&&(this.__withholdSeek=!1,this.seek(this.__withholdSeekTime)),this._playerObject.play(),l._onPlaying())},pause:function(){a.info("[XDK flash] Pausing video."),this._pausedVideo=!0,this._playerObject.pause(),l._onPause()},stop:function(){a.info("[XDK flash] Stopping video"),this._stopPlayback(),l._onStopped()},_stopPlayback:function(){this.__withholdSeek=!1,this.__withholdSeekTime=0,this._playerObject&&this._playerObject.pause&&this._playerObject.pause(),this.hide(),this._removeConnectionTimeOut(),this._connected=!1,this._onLoaded=!1},resume:function(){a.info("[XDK flash] Resuming..."),l.isState(l.PAUSED)&&this.__withholdSeek&&(this.__withholdSeek=!1,this.seek(this.__withholdSeekTime)),this._playerObject.play(),this._pausedVideo=!1,l._onPlaying()},skip:function(e){if(l.isState(l.PAUSED)||l._prevState===l.PAUSED)return this.__withholdSeek=!0,this.getCurTime()+e>this.getDuration()&&this.getCurTime()+e>=0&&(this.__withholdSeekTime=this.getDuration()),this.__withholdSeekTime=this.getCurTime()+e,void this._onTimeUpdate(this.__withholdSeekTime);this._playerObject.seek(this.getCurTime()+e)},seek:function(e){return!(e<0)&&(this._inited&&this._url&&e>=0?(e===this._duration&&(e=Math.floor(this.getDuration()-1)),this._playerObject.seek(e),l._onTimeUpdate(e),!0):void 0)},getCurTime:function(){return this._curTime},_setDuration:function(e){this._duration=e},getDuration:function(){return this._duration},show:function(){this._playerObject&&(this._playerObject.style.visibility="visible")},hide:function(){this._playerObject&&(this._playerObject.style.visibility="hidden")},getCapabilities:function(){return{type:["rtmp"]}},load:function(e,t){return this._playerOpts=t,!!this._prepared&&(this._playerObject&&(t.parentNode&&(this._playerContainer&&(this._parentNode.removeChild(this._playerContainer),this._playerContainer=null),this._parentNode=t.parentNode,this._parentNode.appendChild(this._playerObject)),this._url=e,this._urlOpts=t),e)},setWindowSize:function(e){e.relativeToParent?this._playerObject.style.position="relative":this._playerObject.style.position="fixed",this._playerObject&&(this._playerObject.style.width=e.width+"px",this._playerObject.style.height=e.height+"px",this._playerObject.style.left=e.left+"px",this._playerObject.style.top=e.top+"px",this._playerObject.setWindowSize&&this._playerObject.setWindowSize(e.width,e.height)),this._currentWindowSize=e},setFullscreen:function(){this.setWindowSize({top:0,left:0,height:d().height,width:d().width}),this._playerObject.style.position="fixed"},_onConnectionTimeout:function(){this._stopPlayback(),l._onError(u.NETWORK.DISCONNECTED),a.info("[xdk flash] Connection error")},_onLoad:function(e){this._onLoaded=!0,this._removeConnectionTimeOut(),this._setDuration(e.duration),this._seek&&this._seekTime>0&&(this._playerObject.seek(this._seekTime),this._seek=!1),this._connected&&(a.info("[XDK flash] onload event"),l._onBufferingStart(),l._onBufferingProgress())},_removeConnectionTimeOut:function(){null!==this._connectionTimeOut&&(r.clearDelay(this._connectionTimeOut),this._connectionTimeOut=null)},_onPlaying:function(){this._connected&&(a.info("[xdk flash] onplaying event"),this._removeConnectionTimeOut(),this._pausedVideo?l._onPause():l._onPlaying(),l.isState(l.BUFFERING)&&l._onBufferingFinish())},_onTimeUpdate:function(e){this._connected&&(this._curTime=e,l._onTimeUpdate(e))},_onFinished:function(){a.info("[XDK flash] finished event"),this._stopPlayback(),l._onFinish()},_onError:function(e){l.isState(l.STOPPED)||(this._stopPlayback(),l._onError(u.RENDER.FAILED,{code:null,msg:e},e),a.error("[xdk flash] onRenderError : "+e))},callback:function(e,t){switch(t=r.parse(t),a.debug("[xdk flash] callback"+e+"data"+t.code),e){case"timeUpdate":this._onTimeUpdate(t.time);break;case"loadedmetadata":a.debug("load meta data"),this._onLoad(t);break;case"statuschange":switch(t.code){case"NetStream.Finish":this._onFinished();break;case"NetStream.Buffer.Full":case"NetStream.Seek.Complete":this._onPlaying();break;case"NetStream.Play.Start":case"NetStream.Buffer.Empty":case"NetStream.Seek.Notify":if(l.isState(l.PAUSED)||l.isState(l.SKIPPING))return;l.isState(l.BUFFERING)?l._onBufferingProgress():l._onBufferingStart();break;case"NetStream.Play.Stop":break;case"NetStream.Play.StreamNotFound":l._onError(u.NETWORK.FILE,null,t);break;case"NetStream.Play.FileStructureInvalid":l._onError(u.RENDER.UNSUPPORTED,null,t)}}}})}),define("xdk-base/device/shared/LocalStorage",["xdk-base/class","xdk-base/device/AbstractStorage","xdk-base/console"],function(e,t,i){"use strict";return e.create(t,{},{set:function(e,t){i.log("using Localstorage"),localStorage.setItem(e,t)},get:function(e){return localStorage.getItem(e)},unset:function(e){localStorage.removeItem(e)},_doClear:function(){localStorage.clear()}})}),define("xdk-base/device/shared/opif/DrmAgent",["xdk-base/class","xdk-base/promise","xdk-base/util","xdk-base/console","xdk-base/core","xdk-base/exception"],function(e,t,i,n,s,r){"use strict";var a="application/vnd.ms-playready.initiator+xml",o={UNKNOWN:"Unknown",PLAY_READY:"PlayReady",MARLIN:"Marlin"};return e.create({},{_drmAgent:void 0,_systemId:void 0,_requestCounter:0,__laDeferred:void 0,__queuedPromise:void 0,__acquiuringLicense:!1,__queue:[],__processingQueue:!1,init:function(e,t){if(!e)throw s.createException(r.ILLEGAL_ARGUMENT,"No valid native drm agent available");if(!t)throw s.createException(r.ILLEGAL_ARGUMENT,"systemId is mandatory");this._drmAgent=e,this._systemId=t,e.onDRMMessageResult=i.bind(this._onDRMMessageResult,this),e.onDRMRightsError=i.bind(this._onDRMRightsError,this)},deinit:function(){var e=this._drmAgent;this._drmAgent=null,this._systemId=null,e.onDRMMessageResult=null,e.onDRMRightsError=null},sendLicenseRequest:function(e,n){var s=t.defer(),r=i.bind(function(t){var i;return this._requestCounter=0,this.__laDeferred=t,i=t.promise,this._sendDRMMessages(e,n),i.then(function(e){t.resolve(e)}).fail(function(e){t.reject(e)})},this,s);return this.__acquiuringLicense||0!==this.__queue.length?this.__queue.push(r):(this.__acquiuringLicense=!0,r(s)),s.promise},_processQueue:function(){if(!this.__processingQueue){this.__processingQueue=!0;var e=this.__queue.shift();e?e().then(i.bind(function(){this.__processingQueue=!1,this._processQueue()},this)):this.__processingQueue=!1}},_sendDRMMessages:function(e,t){var o;try{i.isString(e)&&(this._requestCounter++,o="<?xml version='1.0' encoding='utf-8'?><PlayReadyInitiator xmlns='http://schemas.microsoft.com/DRM/2007/03/protocols/'><LicenseServerUriOverride><LA_URL>"+e+"</LA_URL></LicenseServerUriOverride></PlayReadyInitiator>",this._drmAgent.sendDRMMessage(a,o,this._systemId),n.info("sendDRMMessage (License Acquisition URL): "+e)),i.isString(t)&&(this._requestCounter++,o="<?xml version='1.0' encoding='utf-8'?><PlayReadyInitiator xmlns='http://schemas.microsoft.com/DRM/2007/03/protocols/'><SetCustomData><CustomData>"+t+"</CustomData></SetCustomData></PlayReadyInitiator>",this._drmAgent.sendDRMMessage(a,o,this._systemId),n.info("sendDRMMessage (CustomData): "+t))}catch(e){n.warn("[DrmAgent] ERROR: sendDRMMessage ("+e+")"),this._requestCounter=0,this.__acquiuringLicense=!1,this.__laDeferred.reject(s.createException(r.INTERNAL,"sendDRMMessage failed: "+e))}},_onDRMMessageResult:function(e,t,i){var s;switch(this._requestCounter--,i){case 0:s="Successful",this._requestCounter>0&&(s+=", but not yet ready (request counter > 0)");break;case 1:"0x8004C600"===t?s="Server could not deliver a license (server internal error)":"0x8004C580"===t&&(s="Acquired license successfully but domain certificate missing on device");break;case 2:s="Cannot process request";break;case 3:s="Unknown MIME type";break;case 4:s="User consent needed"}n.info("[DrmAgent] onDRMMessageResult: resultCode:"+i+" - "+s),n.debug("[DrmAgent] counter down to "+this._requestCounter),0===this._requestCounter&&this._onLicenseAcquired()},_onLicenseAcquired:function(){n.info("[DrmAgent] license acquired"),this.__laDeferred.resolve(!0),this.__acquiuringLicense=!1,this._processQueue()},_onDRMRightsError:function(e,t,i,a){var l,c=o.UNKNOWN;switch(e){case 0:l="No license (0), consumption of the content is blocked";break;case 1:l="Invalid License (1), consumption of the content is blocked";break;case 2:l="Valid License (2), consumption of the content is unblocked";break;default:l="Unknown ("+e+")"}i&&(c=-1!==i.indexOf("19188")?o.MARLIN:-1!==i.indexOf("19219")?o.PLAY_READY:i),n.warn("[DrmAgent] onDRMRightsError (from "+c+"): "+l+"; contentId:"+t+"; rightsIssuerUrl: "+a),this.__laDeferred.reject(s.createException(r.UNAUTHORIZED,l)),this.__acquiuringLicense=!1,this._processQueue()}})}),define("xdk-base/device/shared/browser/TvKey",["xdk-base/class","xdk-base/console","xdk-base/util","xdk-base/device/shared/browser/keyMap"],function(e,t,i,n){"use strict";return e.create({},{__keys:null,__chars:null,init:function(){this.initKeyMapping(n.REMOTE)},initKeyMapping:function(e,t){e&&(this.__keys||(this.__keys={}),i.each(e.VKey,i.bind(function(e){this.__keys[e.key]=e.value},this))),t&&t.VKey&&(this.__chars||(this.__chars={}),i.each(t.VKey,i.bind(function(e){this.__chars[e.key]=e.value},this)))},initKeyHandling:function(){document.onkeypress=i.bind(this.keyHandler,this),document.onkeydown=i.bind(this.keyHandler,this)},keyHandler:function(e){var t,i,n;return n=require("xdk-base/device").getDeviceHandler(),t=this.getVirtualKey(e),!(i=this.getMappedKey(t))||(n.onDeviceKey(i),e.preventDefault(),!1)},__isCharTyped:function(e){return e>=65&&e<=90||e>=48&&e<=57||e>=96&&e<=111||32===e},getMappedKey:function(e){var i=e.code,n=e.isChar;if(t.info("Received key, code :"+i+" isChar : "+n),n){if(this.__chars&&this.__chars[i])return this.__chars[i]}else{if(this.__chars&&this.__isCharTyped(i))return!1;if(this.__keys[i])return this.__keys[i]}return!1},getVirtualKey:function(e){return"keypress"===e.type.toLowerCase()?{code:e.charCode,isChar:!0}:{code:e.keyCode,isChar:!1}},getKeyMapping:function(){var e={keyCode:this.__keys};return this.__chars&&(e.charCode=this.__chars),e}})}),define("xdk-base/device/shared/sta/keyMap",["xdk-base/util","xdk-base/device/vKey"],function(e,t){"use strict";var i={VKey:{},keyCode:{}},n=["DOWN","UP","LEFT","RIGHT","ENTER","0","1","2","3","4","5","6","7","8","9","RED","BLUE","GREEN","YELLOW","PLAY","PAUSE","STOP","FAST_FWD","REWIND","BACK"];return e.each(n,function(e){var n=window["VK_"+e];n&&(1!==e.length?("ENTER"===e&&(e="OK"),"FAST_FWD"===e&&(e="FF"),"REWIND"===e&&(e="RW"),i.VKey[n]=t[e],i.keyCode[e]=n):(i.VKey[n]=t["KEY_"+e],i.keyCode["KEY_"+e]=n))}),{STA:i}}),define("xdk-base/device/shared/sta/TvKey",["xdk-base/class","xdk-base/device/shared/browser/TvKey","xdk-base/device/shared/sta/keyMap"],function(e,t,i){"use strict";return e.create(t,{},{init:function(){this.initKeyMapping(i.STA),this.initKeyHandling()}})}),define("tvedemo/ext/device/shared/opif/DrmAgent",["xdk-base/class","xdk-base/promise","xdk-base/util","xdk-base/console","xdk-base/core","xdk-base/exception","storm/helper/util"],function(e,t,i,n,s,r,a){"use strict";var o="application/vnd.ms-playready.initiator+xml",l={UNKNOWN:"Unknown",PLAY_READY:"PlayReady",MARLIN:"Marlin"};return e.create({},{_drmAgent:void 0,_systemId:void 0,_requestCounter:0,__laDeferred:void 0,__jdDeferred:void 0,__joiningDomain:!1,__queuedPromise:void 0,__acquiuringLicense:!1,__queue:[],__processingQueue:!1,init:function(e,t){if(!e)throw s.createException(r.ILLEGAL_ARGUMENT,"No valid native drm agent available");if(!t)throw s.createException(r.ILLEGAL_ARGUMENT,"systemId is mandatory");this._drmAgent=e,this._systemId=t,e.onDRMMessageResult=i.bind(this._onDRMMessageResult,this),e.onDRMRightsError=i.bind(this._onDRMRightsError,this)},sendLicenseRequest:function(e,s){var r=t.defer(),a=i.bind(function(t){n.log("Processing request");var i;return this.__laDeferred=t,i=t.promise,this._sendDRMMessages(e,s),i.then(function(e){t.resolve(e)}).fail(function(e){t.reject(e)})},this,r);return this.__acquiuringLicense||0!==this.__queue.length?this.__queue.push(a):(this.__acquiuringLicense=!0,a(r)),r.promise},joinDomainAttempts:0,joinDomain:function(e,s,r,a,l){if(!(this.joinDomainAttempts>=1)){this.joinDomainAttempts++,r=r||null;var c=t.defer(),d=i.bind(function(t){n.log("Processing joinDomain request");var i;this._requestCounter++,this.__jdDeferred=t,i=t.promise;var l='<?xml version="1.0" encoding="utf-8"?><PlayReadyInitiator xmlns="http://schemas.microsoft.com/DRM/2007/03/protocols/"><JoinDomain><DomainController>'+e+"</DomainController><DS_ID>"+s+"</DS_ID>"+(r?"<AccountID>"+r+"</AccountID>":"")+"<CustomData>"+a+"</CustomData></JoinDomain></PlayReadyInitiator>";try{this._drmAgent.sendDRMMessage(o,l,this._systemId)}catch(e){n.error(e.message),t.reject(e.message)}return i.then(function(e){t.resolve(e)}).fail(function(e){t.reject(e)})},this,c);return this.__joiningDomain||0!==this.__queue.length?this.__queue.push(d):(this.__joiningDomain=!0,d(c)),c.promise}},_processQueue:function(){if(!this.__processingQueue){this.__processingQueue=!0;var e=this.__queue.shift();e?e().then(i.bind(function(){this.__processingQueue=!1,this._processQueue()},this)):this.__processingQueue=!1}},_sendDRMMessages:function(e,t){var a;try{i.isString(e)&&(this._requestCounter++,a="<?xml version='1.0' encoding='utf-8'?><PlayReadyInitiator xmlns='http://schemas.microsoft.com/DRM/2007/03/protocols/'><LicenseServerUriOverride><LA_URL>"+e+"</LA_URL></LicenseServerUriOverride></PlayReadyInitiator>",this._drmAgent.sendDRMMessage(o,a,this._systemId),n.log("sendDRMMessage (License Acquisition URL): "+e)),i.isString(t)&&(this._requestCounter++,a="<?xml version='1.0' encoding='utf-8'?><PlayReadyInitiator xmlns='http://schemas.microsoft.com/DRM/2007/03/protocols/'><SetCustomData><CustomData>"+t+"</CustomData></SetCustomData></PlayReadyInitiator>",this._drmAgent.sendDRMMessage(o,a,this._systemId),n.log("sendDRMMessage (CustomData): "+t))}catch(e){n.warn("[DrmAgent] ERROR: sendDRMMessage ("+e+")"),this._requestCounter=0,this.__acquiuringLicense=!1,this.__laDeferred.reject(s.createException(r.INTERNAL,"sendDRMMessage failed: "+e))}},_onDRMMessageResult:function(e,t,i){var s;switch(this._requestCounter--,i){case 0:s="Successful",this._requestCounter>0&&(s+=", but not yet ready (request counter > 0)");break;case 1:"0x8004C600"===t?s="Server could not deliver a license (server internal error)":"0x8004C580"===t&&(s="Acquired license successfully but domain certificate missing on device");break;case 2:s="Cannot process request";break;case 3:s="Unknown MIME type";break;case 4:s="User consent needed"}n.log("[DrmAgent] onDRMMessageResult: msgId: "+e+" resultMsg: "+t+" resultCode: "+i+" - "+s),n.log("[DrmAgent] counter down to "+this._requestCounter);var r={msgId:e,resultMsg:t,resultCode:i,description:s};this.__joiningDomain?this._onDomainJoinded(r):0===this._requestCounter&&this._onLicenseAcquired(r)},_onDomainJoinded:function(e){n.log("[DrmAgent] domain joined"),this.__jdDeferred.resolve(e),this.__joiningDomain=!1,this.joinDomainAttempts=0},_onLicenseAcquired:function(e){n.log("[DrmAgent] license acquired (or not)"),a.traceObject(e,"Result","log"),this.__laDeferred.resolve(e),this.__acquiuringLicense=!1,this._processQueue()},_onDRMRightsError:function(e,t,i,a){var o,c=l.UNKNOWN;switch(e){case 0:o="No license (0), consumption of the content is blocked";break;case 1:o="Invalid License (1), consumption of the content is blocked";break;case 2:o="Valid License (2), consumption of the content is unblocked";break;default:o="Unknown ("+e+")"}i&&(c=-1!==i.indexOf("19188")?l.MARLIN:-1!==i.indexOf("19219")?l.PLAY_READY:i),n.warn("[DrmAgent] onDRMRightsError (from "+c+"): "+o+"; contentId:"+t+"; rightsIssuerUrl: "+a),this.__acquiuringLicense&&(this.__laDeferred.reject(s.createException(r.UNAUTHORIZED,o)),this.__acquiuringLicense=!1),this.__joiningDomain&&(this.__jdDeferred.reject(s.createException(r.UNAUTHORIZED,o)),this.__joiningDomain=!1),this._processQueue()}})});var Conviva=Conviva||{};(Conviva.r=function(){"use strict";if(void 0===Conviva.PrivateLoader){var e=Conviva.PrivateLoader={};!function(){var t=e.Client=function(e,r){function o(e,t){if(!(e instanceof i))throw new Error("clientSettings parameter should be an instance of ClientSettings.");if(!(t instanceof s))throw new Error("systemFactory parameter should be an instance of SystemFactory.");this._settings=e.clone(),this._systemFactory=t,this._systemFactory.configure("SDK",this._settings),this._exceptionCatcher=this._systemFactory.buildExceptionCatcher(),this._exceptionCatcher.runProtected("Client.init",function(){l._id=A.uinteger32(),l._logger=l._systemFactory.buildLogger(),l._logger.setModuleName("Client"),l._logger.info("init(): url="+l._settings.gatewayUrl+" customerKey="+l._settings.customerKey),l._config=l._systemFactory.buildConfig(),l._config.load(),l._sessionFactory=l._systemFactory.buildSessionFactory(l,l._settings,l._config),l._logger.info("init(): done.")},function(e){throw new Error("Client constructor failed: "+e.message)})}var l=this;this._logger=null,this._sessionFactory=null,this._systemFactory=null,this._globalSessionKey=-1,this._settings=null,this._systemSettings=null,this._exceptionCatcher=null,this._config=null,this._id=-1,this._released=!1,o.apply(this,arguments),this.release=function(){this._released||this._exceptionCatcher.runProtected("Client.release",function(){l._logger.info("release()"),l._sessionFactory.cleanup(),l._sessionFactory=null,l._globalSessionKey=-1,l._logger=null,l._id=-1,l._exceptionCatcher=null,l._settings=null,l._systemSettings=null,l._systemFactory=null,l._released=!0})},this.createSession=function(e){var i=t.NO_SESSION_KEY;return this._released?i:null==e||e instanceof n?(this._exceptionCatcher.runProtected("Client.createSession",function(){i=l._sessionFactory.makeVideoSession(e)}),i):(l._logger.error("createSession(): expecting an instance of ContentMetadata for contentMetadata parameter"),i)},this.reportError=function(e,t,i){return this._released?void 0:I.isValidString(t)?i!==Conviva.Client.ErrorSeverity.FATAL&&i!==Conviva.Client.ErrorSeverity.WARNING?void this._logger.error("reportError(): invalid error severity: "+i):void this._exceptionCatcher.runProtected("Client.reportError",function(){var n=l._sessionFactory.getVideoSession(e);null!=n&&n.reportError(t,i)}):void this._logger.error("reportError(): invalid error message string: "+t)},this.updateContentMetadata=function(e,t){return this._released?void 0:t instanceof n?void this._exceptionCatcher.runProtected("Client.updateContentMetadata",function(){var i=l._sessionFactory.getVideoSession(e);if(null!=i){var n=t.clone();i.updateContentMetadata(n)}}):void l._logger.error("updateContentMetadata(): expecting an instance of ContentMetadata for contentMetadata parameter")},this.detachPlayer=function(e){this._released||this._exceptionCatcher.runProtected("Client.detachPlayer",function(){var t=l._sessionFactory.getVideoSession(e);null!=t&&t.detachPlayer()})},this.attachPlayer=function(e,t){return this._released?void 0:t instanceof a?void this._exceptionCatcher.runProtected("Client.attachPlayer",function(){var i=l._sessionFactory.getVideoSession(e);null!=i&&i.attachPlayer(t)}):void l._logger.error("attachPlayer(): expecting an instance of PlayerStateManager for playerStateManager parameter")},this.contentPreload=function(e){this._released||this._exceptionCatcher.runProtected("Client.contentPreload",function(){var t=l._sessionFactory.getVideoSession(e);null!=t&&t.contentPreload()})},this.contentStart=function(e){this._released||this._exceptionCatcher.runProtected("Client.contentStart",function(){var t=l._sessionFactory.getVideoSession(e);null!=t&&t.contentStart()})},this.sendCustomEvent=function(e,i,s){return this._released?void 0:I.isValidString(i)?void this._exceptionCatcher.runProtected("Client.sendCustomEvent",function(){if(e==t.NO_SESSION_KEY){if(l._globalSessionKey<0){var r=new n;l._globalSessionKey=l._sessionFactory.makeGlobalSession(r,null)}e=l._globalSessionKey}var a=I.ObjectShallowCopy(s),o=l._sessionFactory.getSession(e);null!=o&&o.sendCustomEvent(i,a)}):void l._logger.error("sendCustomEvent(): eventName parameter must be a valid string.")},this.adStart=function(e,i,n,s){return this._released?void 0:i!==t.AdStream.CONTENT&&i!==t.AdStream.SEPARATE?void this._logger.error("adStart(): ignored, invalid value for adStream parameter: "+i):n!==t.AdPlayer.CONTENT&&n!==t.AdPlayer.SEPARATE?void this._logger.error("adStart(): ignored, invalid value for adPlayer parameter: "+n):s!==t.AdPosition.PREROLL&&s!==t.AdPosition.MIDROLL&&s!==t.AdPosition.POSTROLL?void this._logger.error("adStart(): ignored, invalid value for adPosition parameter: "+s):void this._exceptionCatcher.runProtected("Client.adStart",function(){var t=l._sessionFactory.getVideoSession(e);null!=t&&t.adStart(i,n,s)})},this.adEnd=function(e){this._released||this._exceptionCatcher.runProtected("Client.adEnd",function(){var t=l._sessionFactory.getVideoSession(e);null!=t&&t.adEnd()})},this.cleanupSession=function(e){return this._released?void 0:e===t.NO_SESSION_KEY?void this._logger.warning("cleanupSession(): ignored, can't cleanup Client.NO_SESSION_KEY"):void this._exceptionCatcher.runProtected("Client.cleanupSession",function(){null!=l._sessionFactory.getVideoSession(e)&&l._sessionFactory.cleanupSession(e)})},this.getPlayerStateManager=function(){if(this._released)throw new Error("This instance of Conviva.Client has been released.");return new a(this._systemFactory)},this.releasePlayerStateManager=function(e){if(this._released)throw new Error("This instance of Conviva.Client has been released.");this._exceptionCatcher.runProtected("Client.releasePlayerStateManager",function(){e instanceof a&&e.release()})},this.getSettings=function(){return this._settings},this.getId=function(){return this._id}};t.version="2.121.0.32789",t.NO_SESSION_KEY=-2,t.AdPosition={PREROLL:"PREROLL",MIDROLL:"MIDROLL",POSTROLL:"POSTROLL"},t.AdStream={CONTENT:"CONTENT",SEPARATE:"SEPARATE"},t.AdPlayer={CONTENT:"CONTENT",SEPARATE:"SEPARATE"},t.ErrorSeverity={FATAL:0,WARNING:1},t.DeviceType={DESKTOP:"DESKTOP",CONSOLE:"Console",SETTOP:"Settop",MOBILE:"Mobile",TABLET:"Tablet",SMARTTV:"SmartTV",UNKNOWN:"Unknown"};var i=e.ClientSettings=function(e){function t(e){if(!I.isValidString(e))throw new Error("customerKey must be valid");this.customerKey=e}this._customerKey=null,I.defGet(this,"customerKey",function(){return this._customerKey}),I.defSet(this,"customerKey",function(e){I.isValidString(e)&&(this._customerKey=e)}),this._heartbeatInterval=i.defaultProductionHeartbeatInterval,I.defGet(this,"heartbeatInterval",function(){return this._heartbeatInterval}),I.defSet(this,"heartbeatInterval",function(e){if("number"==typeof e){var t=I.NumberToUnsignedInt(e);t===e&&(this._heartbeatInterval=t)}}),this._gatewayUrl=i.defaultProductionGatewayUrl,I.defGet(this,"gatewayUrl",function(){return this._gatewayUrl}),I.defSet(this,"gatewayUrl",function(e){I.isValidString(e)&&(this._gatewayUrl=e)}),t.apply(this,arguments),this.equals=function(e){return this.customerKey===e.customerKey&&this.gatewayUrl===e.gatewayUrl&&this.heartbeatInterval===e.heartbeatInterval},this.clone=function(){var e=new i(this.customerKey);return e.gatewayUrl=this.gatewayUrl,e.heartbeatInterval=this.heartbeatInterval,e}};i.defaultDevelopmentGatewayUrl="https://conviva.testonly.conviva.com",i.defaultProductionGatewayUrl="https://cws.conviva.com",i.defaultDevelopmentHeartbeatInterval=5,i.defaultProductionHeartbeatInterval=20;var n=e.ContentMetadata=function(){function e(){return this._custom}function t(e){return null!=e&&"undefined"!=e&&"null"!=e&&""!=e}function i(e){if("object"==typeof e){var i={};for(var n in e)if(t(n)){var s=e[n];t(s)&&(i[n]=s)}this._custom=i}}function s(){return this._defaultBitrateKbps}function r(e){this._defaultBitrateKbps=D.sanitizeSpecialIntegerValue(e)}function a(){return this._streamType}function o(e){(e===n.StreamType.UNKNOWN||e===n.StreamType.VOD||e===n.StreamType.LIVE)&&(this._streamType=e)}function l(){return this._duration}function c(e){this._duration=D.sanitizeSpecialIntegerValue(e)}function d(){return this._encodedFrameRate}function u(e){this._encodedFrameRate=D.sanitizeSpecialIntegerValue(e)}function h(){}this.assetName=null,this._custom={},I.defGet(this,"custom",e),I.defSet(this,"custom",i),this._defaultBitrateKbps=-2,I.defGet(this,"defaultBitrateKbps",s),I.defSet(this,"defaultBitrateKbps",r),this.defaultResource=null,this.viewerId=null,this.applicationName=null,this.streamUrl=null,this._streamType=n.StreamType.UNKNOWN,I.defGet(this,"streamType",a),I.defSet(this,"streamType",o),this._duration=-1,I.defGet(this,"duration",l),I.defSet(this,"duration",c),this._encodedFrameRate=-1,I.defGet(this,"encodedFrameRate",d),I.defSet(this,"encodedFrameRate",u),h.apply(this,arguments),this.clone=function(){var e=new n;e.assetName=this.assetName,e.applicationName=this.applicationName,e.streamUrl=this.streamUrl,e.viewerId=this.viewerId,e.defaultBitrateKbps=this.defaultBitrateKbps,e.defaultResource=this.defaultResource,e.streamType=this.streamType,e.duration=this.duration,e.encodedFrameRate=this.encodedFrameRate;for(var t in this.custom)e.custom[t]=this.custom[t];return e}};n.StreamType={UNKNOWN:"UNKNOWN",LIVE:"LIVE",VOD:"VOD"};var s=e.SystemFactory=function(e,t){function i(e,t){if(!(e instanceof u))throw new Error("systemInterface parameter should be an instance of SystemInterface.");this._systemInterface=e,this._timeInterface=this._systemInterface._timeInterface,this._timerInterface=this._systemInterface._timerInterface,this._httpInterface=this._systemInterface._httpInterface,this._storageInterface=this._systemInterface._storageInterface,this._metadataInterface=this._systemInterface._metadataInterface,this._loggingInterface=this._systemInterface._loggingInterface,this._settings=t instanceof r?t.clone():new r}var n=this;i.apply(this,arguments),this.configure=function(e,t){this._packageName=e,this._clientSettings=t},this.release=function(){this._systemInterface.release(),this._systemInterface=null,this._packageName=null,this._settings=null,this._logBuffer=null};var s={build:function(){return new R(n._loggingInterface,n._timeInterface,n.getSettings(),n._logBuffer,n._packageName)}};this.buildLogger=function(){return s.build()},this.buildSessionFactory=function(e,t,i){return new y(e,t,i,this)},this.buildPing=function(){return new L(this.buildLogger(),this.buildHttpClient(),this._clientSettings)},this.buildCallbackWithTimeout=function(){return new E(this.buildTimer())},this.buildCallbackWithTimeoutNoPing=function(){var e=new T(this.buildLogger(),null,this.getSettings()),t=new B(this.buildLogger(),this._timerInterface,e);return new E(t)},this.buildHttpClient=function(){return new P(this.buildLogger(),this._httpInterface,this.buildCallbackWithTimeoutNoPing(),this.getSettings())},this.buildExceptionCatcher=function(){return new T(this.buildLogger(),this.buildPing(),this.getSettings())},this.buildTime=function(){return new M(this._timeInterface,this.buildLogger())},
this.buildTimer=function(){return new B(this.buildLogger(),this._timerInterface,this.buildExceptionCatcher())},this.buildStorage=function(){return new O(this.buildLogger(),this._storageInterface,this.buildCallbackWithTimeout(),this.getSettings())},this.buildConfig=function(){return new k(this.buildLogger(),this.buildStorage(),this.buildJsonInterface())},this.buildSystemMetadata=function(){return new N(this.buildLogger(),this._metadataInterface,this.buildExceptionCatcher())},this.buildCwsProtocol=function(){return new p},this.buildGatewayControl=function(e){return new x(e,this.buildLogger(),this.buildHttpClient(),this.buildJsonInterface())},this.buildCwsSession=function(e,t,i){var n=this.buildGatewayControl(t);return new b(this.buildEventQueue(),e,t,this.buildLogger(),this.buildExceptionCatcher(),this.buildTimer(),n,this.buildCwsProtocol(),this.buildTime(),this.getLogBuffer(),i)},this.buildSession=function(e,t,i,n,s,r){var a=this.buildExceptionCatcher(),o=this.buildLogger(),l=this.buildCwsSession(e,t,i);return new S(n,s,r,i,this.buildSystemMetadata(),l,a,o)},this.buildEventQueue=function(){return new C},this.buildJsonInterface=function(){return new m},this.getLogBuffer=function(){return this._logBuffer},this.getSettings=function(){return this._settings},this._logBuffer=new w},r=e.SystemSettings=function(){function e(){}this._logLevel=r.defaultProductionLogLevel,I.defGet(this,"logLevel",function(){return this._logLevel}),I.defSet(this,"logLevel",function(e){if("number"==typeof e){var t=I.NumberToUnsignedInt(e);t===e&&t>=r.LogLevel.DEBUG&&t<=r.LogLevel.ERROR&&(this._logLevel=t)}}),this._allowUncaughtExceptions=r.defaultProductionAllowUncaughtExceptions,I.defGet(this,"allowUncaughtExceptions",function(){return this._allowUncaughtExceptions}),I.defSet(this,"allowUncaughtExceptions",function(e){I.isBoolean(e)&&(this._allowUncaughtExceptions=e)}),this._storageTimeout=r.defaultStorageTimeout,I.defGet(this,"storageTimeout",function(){return this._storageTimeout}),I.defSet(this,"storageTimeout",function(e){if("number"==typeof e){var t=I.NumberToUnsignedInt(e);t===e&&(this._storageTimeout=t)}}),this._httpTimeout=r.defaultHttpTimeout,I.defGet(this,"httpTimeout",function(){return this._httpTimeout}),I.defSet(this,"httpTimeout",function(e){if("number"==typeof e){var t=I.NumberToUnsignedInt(e);t===e&&(this._httpTimeout=t)}}),e.apply(this,arguments),this.equals=function(e){return this.logLevel===e.logLevel&&this.allowUncaughtExceptions===e.allowUncaughtExceptions&&this.storageTimeout===e.storageTimeout&&this.httpTimeout===e.httpTimeout},this.clone=function(){var e=new r;return e.logLevel=this.logLevel,e.allowUncaughtExceptions=this.allowUncaughtExceptions,e.storageTimeout=this.storageTimeout,e.httpTimeout=this.httpTimeout,e}};r.LogLevel={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},r.defaultDevelopmentLogLevel=r.LogLevel.DEBUG,r.defaultProductionLogLevel=r.LogLevel.ERROR,r.defaultDevelopmentAllowUncaughtExceptions=!0,r.defaultProductionAllowUncaughtExceptions=!1,r.defaultStorageTimeout=10,r.defaultHttpTimeout=10;var a=e.PlayerStateManager=function(e){function t(e){i._systemFactory=e,i._logger=i._systemFactory.buildLogger(),i._logger.setModuleName("PlayerStateManager"),i._exceptionCatcher=i._systemFactory.buildExceptionCatcher()}var i=this;i._monitorNotifier=null,i._bitrateKbps=-2,i._playerState=a.PlayerState.UNKNOWN,i._currentMetadata={},i._renderedFrameRate=-2,i._encodedFrameRate=-2,i._duration=-2,i._playheadTimeMs=-1,i._bufferLengthMs=-1,i._playerVersion=null,i._playerType=null,i._streamUrl=null,i._width=-1,i._height=-1,i._connectionType=null,i._ssid=null,i._signalStrength=1,i._linkEncryption=null,i._lastError=null,i._pendingErrors=[],i._released=!1,this.release=function(){i._released||i._exceptionCatcher.runProtected("PlayerStateManager.release",function(){null!=i._monitorNotifier&&i._monitorNotifier.onRelease(),i.removeMonitoringNotifier(),i._systemFactory=null,i._logger=null,i._exceptionCatcher=null,i._released=!0})},this.getPlayheadTime=function(){return i._playheadTimeMs},this.setPlayheadTime=function(e){i._released||i._exceptionCatcher.runProtected("PlayerStateManager.setPlayheadTime",function(){i._playheadTimeMs=D.Integer(e,-1,null,-1),null!=i._monitorNotifier&&i._monitorNotifier.onPlayheadTimeChange(i._playheadTimeMs)})},this.getBufferLength=function(){return i._bufferLengthMs},this.setBufferLength=function(e){i._released||i._exceptionCatcher.runProtected("PlayerStateManager.setBufferLength",function(){i._bufferLengthMs=D.Integer(e,-1,null,-1),null!=i._monitorNotifier&&i._monitorNotifier.onBufferLengthChange(i._bufferLengthMs)})},this.getRenderedFrameRate=function(){return i._renderedFrameRate},this.setRenderedFrameRate=function(e){i._released||i._exceptionCatcher.runProtected("PlayerStateManager.setRenderedFrameRate",function(){i._renderedFrameRate=D.Integer(e,-1,null,-1),null!=i._monitorNotifier&&i._monitorNotifier.onRenderedFrameRateChange(i._renderedFrameRate)})},this.getEncodedFrameRate=function(){return i._encodedFrameRate},this.setEncodedFrameRate=function(e){i._released||i._exceptionCatcher.runProtected("PlayerStateManager.setEncodedFrameRate",function(){var t=D.sanitizeSpecialIntegerValue(e);t>=-1&&(i._encodedFrameRate=t,null!=i._monitorNotifier&&i._monitorNotifier.onEncodedFrameRateChange(i._encodedFrameRate))})},this.getDuration=function(){return i._duration},this.setDuration=function(e){i._released||i._exceptionCatcher.runProtected("PlayerStateManager.setDuration",function(){var t=D.sanitizeSpecialIntegerValue(e);t>=-1&&(i._duration=t,null!=i._monitorNotifier&&i._monitorNotifier.onContentLengthChange(i._duration))})},this.getStreamUrl=function(){return i._streamUrl},this.setStreamUrl=function(e){i._released||i._exceptionCatcher.runProtected("PlayerStateManager.setStreamUrl",function(){i._streamUrl=e,null!=i._monitorNotifier&&i._monitorNotifier.onStreamUrlChange(i._streamUrl)})},this.getPlayerType=function(){return i._playerType},this.setPlayerType=function(e){i._released||i._exceptionCatcher.runProtected("PlayerStateManager.setPlayerType",function(){i._playerType=e,null!=i._monitorNotifier&&i._monitorNotifier.onPlayerTypeChange(i._playerType)})},this.getPlayerVersion=function(){return i._playerVersion},this.setPlayerVersion=function(e){i._released||i._exceptionCatcher.runProtected("PlayerStateManager.setPlayerVersion",function(){i._playerVersion=e,null!=i._monitorNotifier&&i._monitorNotifier.onPlayerVersionChange(i._playerVersion)})},this.setMonitoringNotifier=function(e,t){return i._released?void 0:null==i._monitorNotifier&&(i._monitorNotifier=e,i._logger.setSessionId(t),!0)},this.removeMonitoringNotifier=function(){i._released||(i._monitorNotifier=null,i._logger.setSessionId(null))},this.pushCurrentState=function(){i.setPlayerState(i.getPlayerState()),i.setBitrateKbps(i.getBitrateKbps()),i.setDuration(i.getDuration()),i.setEncodedFrameRate(i.getEncodedFrameRate()),i.setPlayheadTime(i.getPlayheadTime()),i.setBufferLength(i.getBufferLength()),i.setStreamUrl(i.getStreamUrl()),i.setPlayerType(i.getPlayerType()),i.setPlayerVersion(i.getPlayerVersion());for(var e=0;e<i._pendingErrors.length;e++){var t=i._pendingErrors[e];i.setError(t)}i._pendingErrors=[]},this.getPlayerState=function(){return i._playerState},this.setPlayerState=function(e){i._released||i._exceptionCatcher.runProtected("PlayerStateManager.setPlayerState",function(){a.isValidPlayerState(e)?(i._playerState=e,null!=i._monitorNotifier&&i._monitorNotifier.onPlayerStateChange(i._playerState)):i._logger.error("PlayerStateManager.SetPlayerState(): invalid state: "+e)})},this.getBitrateKbps=function(){return i._bitrateKbps},this.setBitrateKbps=function(e){i._released||i._exceptionCatcher.runProtected("PlayerStateManager.setBitrateKbps",function(){var t=D.sanitizeSpecialIntegerValue(e);t>=-1&&(i._bitrateKbps=t,null!=i._monitorNotifier&&i._monitorNotifier.onBitrateChange(i._bitrateKbps))})},this.setPlayerSeekStart=function(e){i._released||i._exceptionCatcher.runProtected("PlayerStateManager.setPlayerSeekStart()",function(){null!=i._monitorNotifier&&i._monitorNotifier.onSeekEvent(a.SEEK_ACTIONS_TYPE.SEEK_START,e)})},this.setPlayerSeekEnd=function(){i._released||i._exceptionCatcher.runProtected("PlayerStateManager.setPlayerSeekEnd()",function(){null!=i._monitorNotifier&&i._monitorNotifier.onSeekEvent(a.SEEK_ACTIONS_TYPE.SEEK_END,-1)})},this.setUserSeekButtonUp=function(){i._released||i._exceptionCatcher.runProtected("PlayerStateManager.setUserSeekButtonUp()",function(){null!=i._monitorNotifier&&i._monitorNotifier.onSeekEvent(a.SEEK_ACTIONS_TYPE.BUTTON_UP,-1)})},this.setUserSeekButtonDown=function(){i._released||i._exceptionCatcher.runProtected("PlayerStateManager.setUserSeekButtonDown()",function(){null!=i._monitorNotifier&&i._monitorNotifier.onSeekEvent(a.SEEK_ACTIONS_TYPE.BUTTON_DOWN,-1)})},this.setVideoResolutionWidth=function(e){i._released||i._exceptionCatcher.runProtected("PlayerStateManager.setVideoResolutionWidth()",function(){var t=D.sanitizeSpecialIntegerValue(e);t>=0&&(i._width=t),null!=i._monitorNotifier&&i._monitorNotifier.onStreamResolutionWidthChange(i._width)})},this.setVideoResolutionHeight=function(e){i._released||i._exceptionCatcher.runProtected("PlayerStateManager.setVideoResolutionHeight()",function(){var t=D.sanitizeSpecialIntegerValue(e);t>=0&&(i._height=t),null!=i._monitorNotifier&&i._monitorNotifier.onStreamResolutionHeightChange(i._height)})},this.setConnectionType=function(e){i._released||i._exceptionCatcher.runProtected("PlayerStateManager.setConnectionType()",function(){i._connectionType=e,null!=i._monitorNotifier&&i._monitorNotifier.onConnectionTypeChange(i._connectionType)})},this.setSSID=function(e){i._released||i._exceptionCatcher.runProtected("PlayerStateManager.setSsid()",function(){i._ssid=e,null!=i._monitorNotifier&&i._monitorNotifier.onSsidChange(i._ssid)})},this.setLinkEncryption=function(e){i._released||i._exceptionCatcher.runProtected("PlayerStateManager.setLinkEncryption()",function(){i._linkEncryption=e,null!=i._monitorNotifier&&i._monitorNotifier.onLinkEncryptionChange(i._linkEncryption)})},this.setSignalStrength=function(e){i._released||i._exceptionCatcher.runProtected("PlayerStateManager.setSignalStrength()",function(){i._signalStrength=e,null!=i._monitorNotifier&&i._monitorNotifier.onSignalStrengthChange(i._signalStrength)})},this.setError=function(e){if(i._lastError=e,null!=i._monitorNotifier){var t=e.errorCode,n=e.severity;i._monitorNotifier.onError(t,n)}else i._pendingErrors.push(e)},this.sendError=function(e,t){i._released||i._exceptionCatcher.runProtected("PlayerStateManager.sendError",function(){var n=new Conviva.PrivateLoader.StreamerError(e,t);i.setError(n)})},this.updateContentMetadata=function(e){i._released||i._exceptionCatcher.runProtected("PlayerStateManager.updateContentMetadata()",function(){i._updatedMetadata=e,null!=i._monitorNotifier&&i._monitorNotifier.onMetadataChange(i._updatedMetadata)})},this.reset=function(){i._released||i._exceptionCatcher.runProtected("PlayerStateManager.reset",function(){i._bitrateKbps=-2,i._playerState=a.PlayerState.UNKNOWN,i._currentMetadata={},i._renderedFrameRate=-1,i._encodedFrameRate=-1,i._duration=-1,i._playheadTimeMs=-1,i._bufferLengthMs=-1,i._playerVersion=null,i._playerType=null,i._streamUrl=null,i._lastError=null,i._pendingErrors=[]})},this.getError=function(){return i._lastError},t.apply(i,arguments)};a.PlayerState={STOPPED:"STOPPED",PLAYING:"PLAYING",BUFFERING:"BUFFERING",PAUSED:"PAUSED",UNKNOWN:"UNKNOWN",NOT_MONITORED:"NOT_MONITORED"},a.isValidPlayerState=function(e){return e===a.PlayerState.STOPPED||e===a.PlayerState.PLAYING||e===a.PlayerState.BUFFERING||e===a.PlayerState.PAUSED||e===a.PlayerState.UNKNOWN||e===a.PlayerState.NOT_MONITORED},a.SEEK_ACTIONS_TYPE={SEEK_START:"pss",SEEK_END:"pse",BUTTON_UP:"bu",BUTTON_DOWN:"bd"};var o=e.HttpInterface=function(){this.makeRequest=function(e,t,i,n,s,r){},this.release=function(){}},l=e.LoggingInterface=function(){this.consoleLog=function(e,t){},this.release=function(){}},c=e.MetadataInterface=function(){this.getBrowserName=function(){},this.getBrowserVersion=function(){},this.getDeviceBrand=function(){},this.getDeviceManufacturer=function(){},this.getDeviceModel=function(){},this.getDeviceType=function(){},this.getDeviceVersion=function(){},this.getFrameworkName=function(){},this.getFrameworkVersion=function(){},this.getOperatingSystemName=function(){},this.getOperatingSystemVersion=function(){},this.release=function(){}},d=e.StorageInterface=function(){this.saveData=function(e,t,i,n){},this.loadData=function(e,t,i){},this.release=function(){}},u=e.SystemInterface=function(e,t,i,n,s,r){function a(e,t,i,n,s,r){I.validateInterface(e,new h,"TimeInterface"),I.validateInterface(t,new _,"TimerInterface"),I.validateInterface(i,new o,"HttpInterface"),I.validateInterface(n,new d,"StorageInterface"),I.validateInterface(s,new c,"MetadataInterface"),I.validateInterface(r,new l,"LoggingInterface"),this._timeInterface=e,this._timerInterface=t,this._httpInterface=i,this._storageInterface=n,this._metadataInterface=s,this._loggingInterface=r}a.apply(this,arguments),this.release=function(){this._timeInterface.release(),this._timeInterface=null,this._timerInterface.release(),this._timerInterface=null,this._httpInterface.release(),this._httpInterface=null,this._storageInterface.release(),this._storageInterface=null,this._metadataInterface.release(),this._metadataInterface=null,this._loggingInterface.release(),this._loggingInterface=null}},h=e.TimeInterface=function(){this.getEpochTimeMs=function(){},this.release=function(){}},_=e.TimerInterface=function(){this.createTimer=function(e,t,i){},this.release=function(){}},g=e.JSON2={};!function(){function e(e){return 10>e?"0"+e:e}function t(e){return n.lastIndex=0,n.test(e)?'"'+e.replace(n,function(e){var t=a[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function i(e,n){var a,l,c,d,u,h=s,_=n[e];switch(_&&"object"==typeof _&&"function"==typeof _.toJSON&&(_=_.toJSON(e)),"function"==typeof o&&(_=o.call(n,e,_)),typeof _){case"string":return t(_);case"number":return isFinite(_)?String(_):"null";case"boolean":case"null":return String(_);case"object":if(!_)return"null";if(s+=r,u=[],Object.prototype.toString.apply(_)===Object.prototype.toString.apply([])){for(d=_.length,a=0;d>a;a+=1)u[a]=i(a,_)||"null";return c=0===u.length?"[]":s?"[\n"+s+u.join(",\n"+s)+"\n"+h+"]":"["+u.join(",")+"]",s=h,c}if(o&&"object"==typeof o)for(d=o.length,a=0;d>a;a+=1)"string"==typeof o[a]&&(l=o[a],(c=i(l,_))&&u.push(t(l)+(s?": ":":")+c));else for(l in _)Object.prototype.hasOwnProperty.call(_,l)&&(c=i(l,_))&&u.push(t(l)+(s?": ":":")+c);return c=0===u.length?"{}":s?"{\n"+s+u.join(",\n"+s)+"\n"+h+"}":"{"+u.join(",")+"}",s=h,c}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+e(this.getUTCMonth()+1)+"-"+e(this.getUTCDate())+"T"+e(this.getUTCHours())+":"+e(this.getUTCMinutes())+":"+e(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var n,s,r,a,o;"function"!=typeof g.stringify&&(n=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,a={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},g.stringify=function(e,t,n){var a;if(s="",r="","number"==typeof n)for(a=0;n>a;a+=1)r+=" ";else"string"==typeof n&&(r=n);if(o=t,t&&"function"!=typeof t&&("object"!=typeof t||"number"!=typeof t.length))throw new Error("JSON2.stringify");return i("",{"":e})})}();var f=e.JsonParse=function(){var e,t,i,n,s={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:"\n",r:"\r",t:"\t"},r=function(t){throw{name:"SyntaxError",message:t,at:e,text:i}},a=function(n){return n&&n!==t&&r("Expected '"+n+"' instead of '"+t+"'"),t=i.charAt(e),e+=1,t},o=function(){var e,i="";for("-"===t&&(i="-",a("-"));t>="0"&&"9">=t;)i+=t,a();if("."===t)for(i+=".";a()&&t>="0"&&"9">=t;)i+=t;if("e"===t||"E"===t)for(i+=t,a(),("-"===t||"+"===t)&&(i+=t,a());t>="0"&&"9">=t;)i+=t,a();return e=+i,isNaN(e)?void r("Bad number"):e},l=function(){var e,i,n,o="";if('"'===t)for(;a();){if('"'===t)return a(),o;if("\\"===t)if(a(),"u"===t){for(n=0,i=0;4>i&&(e=parseInt(a(),16),isFinite(e));i+=1)n=16*n+e;o+=String.fromCharCode(n)}else{if("string"!=typeof s[t])break;o+=s[t]}else o+=t}r("Bad string")},c=function(){for(;t&&" ">=t;)a()},d=function(){switch(t){case"t":return a("t"),a("r"),a("u"),a("e"),!0;case"f":return a("f"),a("a"),a("l"),a("s"),a("e"),!1;case"n":return a("n"),a("u"),a("l"),a("l"),null}r("Unexpected '"+t+"'")},u=function(){var e=[];if("["===t){if(a("["),c(),"]"===t)return a("]"),e;for(;t;){if(e.push(n()),c(),"]"===t)return a("]"),e;a(","),c()}}r("Bad array")},h=function(){var e,i={};if("{"===t){if(a("{"),c(),"}"===t)return a("}"),i;for(;t;){if(e=l(),c(),a(":"),Object.hasOwnProperty.call(i,e)&&r('Duplicate key "'+e+'"'),i[e]=n(),c(),"}"===t)return a("}"),i;a(","),c()}}r("Bad object")};return n=function(){switch(c(),t){case"{":return h();case"[":return u();case'"':return l();case"-":return o();default:return t>="0"&&"9">=t?o():d()}},function(s,a){var o;return i=s,e=0,t=" ",o=n(),c(),t&&r("Syntax error"),"function"==typeof a?function e(t,i){var n,s,r=t[i];if(r&&"object"==typeof r)for(n in r)Object.hasOwnProperty.call(r,n)&&(s=e(r,n),void 0!==s?r[n]=s:delete r[n]);return a.call(t,i,r)}({"":o},""):o}}(),p=e.CwsProtocol=function(){this.generateEvent=function(e,t,i,n){return n.seq=e,n.st=t,n.t=i,n},this.generateSessionEndEvent=function(e,t){var i=p.EVENT_TYPE_SESSION_END,n={};return this.generateEvent(e,t,i,n)}};p.version="2.4",p.gatewayPath="/0/wsg",p.DEFAULT_CLIENT_ID="0",p.DEFAULT_MAX_HEARTBEAT_INFOS=0,p.DEFAULT_PLAYHEAD_TIME=-1,p.DEFAULT_BUFFER_LENGTH=-1,p.SDK_METADATA_SCHEMA="sdk.js.1",p.EVENT_TYPE_STATE_CHANGE="CwsStateChangeEvent",p.EVENT_TYPE_ERROR="CwsErrorEvent",p.EVENT_TYPE_SESSION_END="CwsSessionEndEvent",p.EVENT_TYPE_CUSTOM="CwsCustomEvent",p.EVENT_TYPE_SEEK="CwsSeekEvent",p.EVENT_TYPE_DATA_SAMPLE="CwsDataSamplesEvent",p.RESPONSE_STATUS_NO_ERRORS="ok",p.RESPONSE_KEY_STATUS="err",p.RESPONSE_KEY_CLIENT_ID="clid",p.RESPONSE_KEY_CONFIG="cfg",p.RESPONSE_KEY_EVENTS="evs",p.RESPONSE_CONFIG_KEY_MAX_HEARTBEAT_INFOS="maxhbinfos",p.RESPONSE_CONFIG_KEY_SEND_LOGS="slg",p.RESPONSE_CONFIG_KEY_HEARTBEAT_INTERVAL="hbi",p.RESPONSE_CONFIG_KEY_GATEWAY_URL="gw",p.MESSAGE_TYPE_SESSION_HEARTBEAT="CwsSessionHb",p.REQUEST_KEY_MESSAGE_TYPE="t",p.REQUEST_KEY_SESSION_TIME="st",p.REQUEST_KEY_SESSION_START_TIME="sst",p.REQUEST_KEY_IS_LIVE="lv",p.REQUEST_KEY_SEQUENCE_NUMBER="seq",p.REQUEST_KEY_CUSTOMER_KEY="cid",p.REQUEST_KEY_CLIENT_ID="clid",p.REQUEST_KEY_CLIENT_VERSION="clv",p.REQUEST_KEY_PROTOCOL_VERSION="pver",p.REQUEST_KEY_INSTANCE_ID="iid",p.REQUEST_KEY_SESSION_ID="sid",p.REQUEST_KEY_VIEWER_ID="vid",p.REQUEST_KEY_ASSET_NAME="an",p.REQUEST_KEY_PLAYER_NAME="pn",p.REQUEST_KEY_TAGS="tags",p.REQUEST_KEY_SESSION_FLAGS="sf",p.REQUEST_KEY_EVENTS="evs",p.REQUEST_KEY_LOGS="lg",p.REQUEST_KEY_HEARTBEAT_INFOS="hbinfos",p.REQUEST_KEY_IS_SDK_CLIENT="sdk",p.REQUEST_KEY_PAUSE_JOIN="pj",p.REQUEST_KEY_PLAYER_STATE="ps",p.REQUEST_KEY_BITRATE="br",p.REQUEST_KEY_CONTENT_LENGTH="cl",p.REQUEST_KEY_ENCODED_FRAME_RATE="efps",p.REQUEST_KEY_AVERAGE_FRAME_RATE="afps",p.REQUEST_KEY_RESOURCE="rs",p.REQUEST_KEY_PLAYHEAD_TIME="pht",p.REQUEST_KEY_BUFFER_LENGTH="bl",p.REQUEST_KEY_STREAM_URL="url",p.REQUEST_KEY_CAPABILITIES="caps",p.REQUEST_KEY_PLATFORM_METADATA="pm",p.REQUEST_KEY_VIDEO_WIDTH="w",p.REQUEST_KEY_VIDEO_HEIGHT="h",p.REQUEST_KEY_CONNECTION_TYPE="ct",p.REQUEST_KEY_LINK_ENCRYPTION="le",p.REQUEST_KEY_SSID="ssid",p.REQUEST_KEY_SIGNAL_STRENGTH="ss",p.REQUEST_KEY_STREAM_METADATA_CHANGE="strmetadata",p.REQUEST_PLATFORM_METADATA_KEY_SCHEMA="sch",p.REQUEST_PLATFORM_METADATA_KEY_BROWSER_NAME="br",p.REQUEST_PLATFORM_METADATA_KEY_BROWSER_VERSION="brv",p.REQUEST_PLATFORM_METADATA_KEY_DEVICE_BRAND="dvb",p.REQUEST_PLATFORM_METADATA_KEY_DEVICE_MANUFACTURER="dvma",p.REQUEST_PLATFORM_METADATA_KEY_DEVICE_MODEL="dvm",p.REQUEST_PLATFORM_METADATA_KEY_DEVICE_TYPE="dvt",p.REQUEST_PLATFORM_METADATA_KEY_DEVICE_VERSION="dvv",p.REQUEST_PLATFORM_METADATA_KEY_FRAMEWORK_NAME="fw",p.REQUEST_PLATFORM_METADATA_KEY_FRAMEWORK_VERSION="fwv",p.REQUEST_PLATFORM_METADATA_KEY_OPERATING_SYSTEM_NAME="os",p.REQUEST_PLATFORM_METADATA_KEY_OPERATING_SYSTEM_VERSION="osv",p.REQUEST_KEY_PROTOCOL_CAPP="caps",p.REQUEST_EVENT_KEY_TYPE="t",p.REQUEST_EVENT_KEY_SEQUENCE_NUMBER="seq",p.REQUEST_EVENT_KEY_SESSION_TIME="st",p.REQUEST_EVENT_KEY_SEEK_ACT_TYPE="act",p.REQUEST_EVENT_KEY_SEEK_TO_POS="skto",p.REQUEST_ERROR_EVENT_KEY_MESSAGE="err",p.REQUEST_ERROR_EVENT_KEY_FATAL="ft",p.REQUEST_STATE_CHANGE_EVENT_KEY_NEW="new",p.REQUEST_STATE_CHANGE_EVENT_KEY_OLD="old",p.REQUEST_CUSTOM_EVENT_KEY_NAME="name",p.REQUEST_CUSTOM_EVENT_KEY_ATTRIBUTES="attr",p.REQUEST_HEARTBEAT_INFO_KEY_SEQUENCE_NUMBER="seq",p.REQUEST_HEARTBEAT_INFO_KEY_STATUS="err",p.REQUEST_HEARTBEAT_INFO_KEY_ROUNDTRIP_TIME="rtt",p.convertPlayerState=function(e){switch(e){case a.PlayerState.STOPPED:return p.eStopped;case a.PlayerState.PLAYING:return p.ePlaying;case a.PlayerState.BUFFERING:return p.eBuffering;case a.PlayerState.PAUSED:return p.ePaused;case a.PlayerState.NOT_MONITORED:return p.eNotMonitored;default:return p.eUnknown}},p.eStopped=1,p.ePlaying=3,p.eBuffering=6,p.ePaused=12,p.eNotMonitored=98,p.eUnknown=100,p.SessionFlags={GLOBAL:0,VIDEO:1,QUALITY_METRICS:2,BITRATE_METRICS:4},p.Capabilities={INSIGHTS:0};var m=(e.JSONInterface=function(){this.encode=function(e){},this.decode=function(e){}},e.LibJSONInterface=function(){this.encode=function(e){var t=null;try{t=g.stringify(e)}catch(e){}return t},this.decode=function(e){var t=null;try{t=f(e)}catch(e){}return I.isObject(t)||(t=null),t}}),v=e.CwsHeartbeat=function(){function e(){}this._data={},e.apply(this,arguments),this.get=function(){return this._data},this.setField=function(e,t){this._data[e]=t},this.setInnerField=function(e,t,i){this._data[e]||(this._data[e]={}),this._data[e][t]=i},this.setMessageType=function(e){this.setField(p.REQUEST_KEY_MESSAGE_TYPE,e)},this.setSessionTime=function(e){this.setField(p.REQUEST_KEY_SESSION_TIME,e)},this.setSessionStartTime=function(e){this.setField(p.REQUEST_KEY_SESSION_START_TIME,e)},this.setIsLive=function(e){this.setField(p.REQUEST_KEY_IS_LIVE,e)},this.setSequenceNumber=function(e){this.setField(p.REQUEST_KEY_SEQUENCE_NUMBER,e)},this.setCustomerKey=function(e){this.setField(p.REQUEST_KEY_CUSTOMER_KEY,e)},this.setClientId=function(e){this.setField(p.REQUEST_KEY_CLIENT_ID,e)},this.setClientVersion=function(e){this.setField(p.REQUEST_KEY_CLIENT_VERSION,e)},this.setProtocolVersion=function(e){this.setField(p.REQUEST_KEY_PROTOCOL_VERSION,e)},this.setCapfield=function(e){this.setField(p.REQUEST_KEY_PROTOCOL_CAPP,e)},this.setSessionId=function(e){this.setField(p.REQUEST_KEY_SESSION_ID,e)},this.setInstanceId=function(e){this.setField(p.REQUEST_KEY_INSTANCE_ID,e)},this.setViewerId=function(e){this.setField(p.REQUEST_KEY_VIEWER_ID,e)},this.setAssetName=function(e){this.setField(p.REQUEST_KEY_ASSET_NAME,e)},this.setPlayerName=function(e){this.setField(p.REQUEST_KEY_PLAYER_NAME,e)},this.setTags=function(e){this.setField(p.REQUEST_KEY_TAGS,e)},this.setSessionFlags=function(e){this.setField(p.REQUEST_KEY_SESSION_FLAGS,e)},this.setCapabilities=function(e){this.setField(p.REQUEST_KEY_CAPABILITIES,e)},this.setEvents=function(e){this.setField(p.REQUEST_KEY_EVENTS,e)},this.setIsSdkClient=function(e){this.setField(p.REQUEST_KEY_IS_SDK_CLIENT,e)},this.setLogs=function(e){this.setField(p.REQUEST_KEY_LOGS,e)},this.setHeartbeatInfos=function(e){this.setField(p.REQUEST_KEY_HEARTBEAT_INFOS,e)},this.setPlayerState=function(e){this.setField(p.REQUEST_KEY_PLAYER_STATE,e)},this.setPauseJoin=function(e){this.setField(p.REQUEST_KEY_PAUSE_JOIN,e)},this.setContentLength=function(e){this.setField(p.REQUEST_KEY_CONTENT_LENGTH,e)},this.setBitrate=function(e){this.setField(p.REQUEST_KEY_BITRATE,e)},this.setResource=function(e){this.setField(p.REQUEST_KEY_RESOURCE,e)},this.setEncodedFrameRate=function(e){this.setField(p.REQUEST_KEY_ENCODED_FRAME_RATE,e)},this.setAverageFrameRate=function(e){this.setField(p.REQUEST_KEY_AVERAGE_FRAME_RATE,e)},this.setPlatformMetadataSchema=function(e){this.setInnerField(p.REQUEST_KEY_PLATFORM_METADATA,p.REQUEST_PLATFORM_METADATA_KEY_SCHEMA,e)},this.setBrowserName=function(e){this.setInnerField(p.REQUEST_KEY_PLATFORM_METADATA,p.REQUEST_PLATFORM_METADATA_KEY_BROWSER_NAME,e)},this.setBrowserVersion=function(e){this.setInnerField(p.REQUEST_KEY_PLATFORM_METADATA,p.REQUEST_PLATFORM_METADATA_KEY_BROWSER_VERSION,e)},this.setDeviceBrand=function(e){this.setInnerField(p.REQUEST_KEY_PLATFORM_METADATA,p.REQUEST_PLATFORM_METADATA_KEY_DEVICE_BRAND,e)},this.setDeviceManufacturer=function(e){this.setInnerField(p.REQUEST_KEY_PLATFORM_METADATA,p.REQUEST_PLATFORM_METADATA_KEY_DEVICE_MANUFACTURER,e)},this.setDeviceModel=function(e){this.setInnerField(p.REQUEST_KEY_PLATFORM_METADATA,p.REQUEST_PLATFORM_METADATA_KEY_DEVICE_MODEL,e)},this.setDeviceType=function(e){this.setInnerField(p.REQUEST_KEY_PLATFORM_METADATA,p.REQUEST_PLATFORM_METADATA_KEY_DEVICE_TYPE,e)},this.setDeviceVersion=function(e){this.setInnerField(p.REQUEST_KEY_PLATFORM_METADATA,p.REQUEST_PLATFORM_METADATA_KEY_DEVICE_VERSION,e)},this.setFrameworkName=function(e){this.setInnerField(p.REQUEST_KEY_PLATFORM_METADATA,p.REQUEST_PLATFORM_METADATA_KEY_FRAMEWORK_NAME,e)},this.setFrameworkVersion=function(e){this.setInnerField(p.REQUEST_KEY_PLATFORM_METADATA,p.REQUEST_PLATFORM_METADATA_KEY_FRAMEWORK_VERSION,e)},this.setOperatingSystemName=function(e){this.setInnerField(p.REQUEST_KEY_PLATFORM_METADATA,p.REQUEST_PLATFORM_METADATA_KEY_OPERATING_SYSTEM_NAME,e)},this.setOperatingSystemVersion=function(e){this.setInnerField(p.REQUEST_KEY_PLATFORM_METADATA,p.REQUEST_PLATFORM_METADATA_KEY_OPERATING_SYSTEM_VERSION,e)},this.setPlayheadTime=function(e){this.setField(p.REQUEST_KEY_PLAYHEAD_TIME,e)},this.setBufferLength=function(e){this.setField(p.REQUEST_KEY_BUFFER_LENGTH,e)},this.setStreamUrl=function(e){this.setField(p.REQUEST_KEY_STREAM_URL,e)},this.setStreamWidth=function(e){this.setField(p.REQUEST_KEY_VIDEO_WIDTH,e)},this.setStreamHeight=function(e){this.setField(p.REQUEST_KEY_VIDEO_HEIGHT,e)},this.setConnectionType=function(e){this.setField(p.REQUEST_KEY_CONNECTION_TYPE,e)},this.setSsid=function(e){this.setField(p.REQUEST_KEY_SSID,e)},this.setLinkEncryption=function(e){this.setField(p.REQUEST_KEY_LINK_ENCRYPTION,e)}},b=e.CwsSession=function(e,i,n,s,r,o,l,c,d,u,h){function _(e,t,i,n,s,r,a,o,l,c,d){this._eventQueue=e,this._client=t,this._clientSettings=i,this._logger=n,this._logger.setModuleName("CwsSession"),this._exceptionCatcher=s,this._timer=r,this._gatewayControl=a,this._cwsProtocol=o,this._time=l,this._logBuffer=c,this._clientConfig=d}var g=this;g._heartbeatTimerCancel=null,g._startTimeMs=0,g._heartbeatSequenceNumber=0,g._sessionFlags=p.SessionFlags.GLOBAL,g._capabilities=p.Capabilities.INSIGHTS,g._heartbeatInfos=[],g._lastRequestSentMs=-1,g._bitrateKbps=-2,g._resource=null,g._playerState=a.PlayerState.NOT_MONITORED,g._encodedFrameRate=-1,g._contentLengthSec=-1,g._bufferLengthMs=p.DEFAULT_BUFFER_LENGTH,g._playheadTimeMs=p.DEFAULT_PLAYHEAD_TIME,g._streamUrl=null,g._averageFrameRate=-1,g._width=-1,g._height=-1,g._assetName=null,g._viewerId=null,g._playerName=null,g._isLive=null,g._tags={},g._browserName=null,g._browserVersion=null,g._deviceBrand=null,g._deviceManufacturer=null,g._deviceModel=null,g._deviceType=null,g._deviceVersion=null,g._frameworkName=null,g._frameworkVersion=null,g._operatingSystemName=null,g._operatingSystemVersion=null,g._connectionType=null,g._linkEncryption=null,g._ssid=null,g._signalStrength=1,g._pauseJoin=!1,g._hasJoined=!1,g._cleanedUp=!1,g._willEndSoon=!1,_.apply(this,arguments),this.cleanup=function(){this._clientConfig=null,this._logBuffer=null,this._systemSettings=null,this._time=null,this._cwsProtocol=null,this._gatewayControl=null,this._timer=null,this._exceptionCatcher=null,this._logger=null,this._clientSettings=null,this._client=null,this._eventQueue.flush(),this._eventQueue=null,this._cleanedUp=!0},this.start=function(e){this._session=e,this._global=this._session._global,this._logger.setSessionId(this._session._id),this._startTimeMs=this._time.current(),this.isVideoSession()&&(this._sessionFlags+=b.DEFAULT_VIDEO_SESSION_FLAGS)},this.willEndSoon=function(){this._willEndSoon=!0},this.initialize=function(){this._logger.debug("initialize()")},this.end=function(){this.isVideoSession()&&(this._logger.debug("end(): schedule the last hb before session cleanup"+g.sessionTypeTag()),this.enqueueSessionEndEvent()),this.cancelHeartbeatTimer(),this.sendHeartbeat()},this.startSendingHeartbeats=function(){this._willEndSoon||(this.sendHeartbeat(),this.resetHeartbeatTimer())},this.setBrowserName=function(e){g._logger.debug("setBrowserName(): "+e);var t=g._browserName;t!==e&&null!=e&&(g._logger.debug("Change browserName from "+t+" to "+e),g._browserName=e)},this.setBrowserVersion=function(e){g._logger.debug("setBrowserVersion(): "+e);var t=g._browserVersion;t!==e&&null!=e&&(g._logger.debug("Change browserVersion from "+t+" to "+e),g._browserVersion=e)},this.setDeviceBrand=function(e){g._logger.debug("setDeviceBrand(): "+e);var t=g._deviceBrand;t!==e&&null!=e&&(g._logger.debug("Change deviceBrand from "+t+" to "+e),g._deviceBrand=e)},this.setDeviceManufacturer=function(e){g._logger.debug("setDeviceManufacturer(): "+e);var t=g._deviceManufacturer;t!==e&&null!=e&&(g._logger.debug("Change deviceManufacturer from "+t+" to "+e),g._deviceManufacturer=e)},this.setDeviceModel=function(e){g._logger.debug("setDeviceModel(): "+e);var t=g._deviceModel;t!==e&&null!=e&&(g._logger.debug("Change deviceModel from "+t+" to "+e),g._deviceModel=e)},this.setDeviceType=function(e){g._logger.debug("setDeviceBrand(): "+e);var t=g._deviceType;t!==e&&null!=e&&(g._logger.debug("Change deviceType from "+t+" to "+e),g._deviceType=e)},this.setDeviceVersion=function(e){g._logger.debug("setDeviceVersion(): "+e);var t=g._deviceVersion;t!==e&&null!=e&&(g._logger.debug("Change deviceVersion from "+t+" to "+e),g._deviceVersion=e)},this.setOperatingSystemName=function(e){g._logger.debug("setOperatingSystemName(): "+e);var t=g._operatingSystemName;t!==e&&null!=e&&(g._logger.debug("Change operatingSystemName from "+t+" to "+e),g._operatingSystemName=e)},this.setOperatingSystemVersion=function(e){g._logger.debug("setOperatingSystemVersion(): "+e);var t=g._operatingSystemVersion;t!==e&&null!=e&&(g._logger.debug("Change operatingSystemVersion from "+t+" to "+e),g._operatingSystemVersion=e)},this.setBufferLengthMs=function(e){var t=g._bufferLengthMs;t!==e&&e>=-1&&(g._logger.debug("Change buffer length from "+t+" to "+e),g._bufferLengthMs=e)},this.getFrameworkName=function(){return g._frameworkName},this.setFrameworkName=function(e){g._logger.debug("setFrameworkName(): "+e);var t=g._frameworkName;t!==e&&null!=e&&(g._logger.debug("Change frameworkName from "+t+" to "+e),g._frameworkName=e)},this.getFrameworkVersion=function(){return g._frameworkVersion},this.setFrameworkVersion=function(e){g._logger.debug("setFrameworkVersion(): "+e);var t=g._frameworkVersion;t!==e&&null!=e&&(g._logger.debug("Change frameworkVersion from "+t+" to "+e),g._frameworkVersion=e)},this.setPlayheadTimeMs=function(e){var t=g._playheadTimeMs;t!==e&&e>=-1&&(g._logger.debug("Change playhead time from "+t+" to "+e),g._playheadTimeMs=e)},this.setStreamUrl=function(e){g._logger.debug("setStreamUrl(): "+e);var t=g._streamUrl;t!==e&&null!=e&&(g._logger.debug("Change stream url from "+t+" to "+e),g.enqueueStreamUrlChangeEvent(t,e),g._streamUrl=e)},this.setBitrateKbps=function(e){g._logger.debug("setBitrateKbps(): "+e);var t=g._bitrateKbps;t!==e&&e>=-1&&(g._logger.info("Change bitrate from "+t+" to "+e),g.enqueueBitrateChangeEvent(t,e),g._bitrateKbps=e)},this.setResource=function(e){g._logger.debug("setResource(): "+e);var t=g._resource
;t!==e&&null!=e&&(g._logger.info("Change resource from "+t+" to "+e),g.enqueueResourceChangeEvent(t,e),g._resource=e)},this.setAssetName=function(e){g._logger.debug("setAssetName(): "+e),g._assetName!==e&&null!=e&&(g._logger.info("Change assetName from "+g._assetName+" to "+e),g._assetName=e)},this.setIsLive=function(e){g._logger.debug("setIsLive(): "+e);var t=g._isLive;t!==e&&null!=e&&(g._logger.info("Change isLive from "+t+" to "+e),g._isLive=e)},this.setViewerId=function(e){g._logger.debug("setViewerId(): "+e);var t=g._viewerId;t!==e&&null!=e&&(g._logger.info("Change viewerId from "+t+" to "+e),g._viewerId=e)},this.setPlayerName=function(e){g._logger.debug("setPlayerName(): "+e);var t=g._playerName;t!==e&&null!=e&&(g._logger.info("Change playerName from "+t+" to "+e),g._playerName=e)},this.setTags=function(e){g._logger.debug("setTags()");var t=g._tags;I.ObjectShallowEquals(t,e)||null==e||(g._logger.info("Change tags from "+I.ObjectToString(t)+" to "+I.ObjectToString(e)),g.enqueueTagsChangeEvent(t,e),g._tags=e)},this.setEncodedFrameRate=function(e){g._logger.debug("setEncodedFrameRate(): "+e),g._encodedFrameRate=e},this.setAverageFrameRate=function(e){g._logger.debug("setAverageFrameRate(): "+e),g._averageFrameRate=e},this.setContentLength=function(e){g._logger.debug("setContentLength(): "+e),g._contentLengthSec=e},this.setPlayerState=function(e){g._logger.debug("setPlayerState(): "+e),g._hasJoined||e!=a.PlayerState.PLAYING||(g.togglePauseJoin(!1),g._hasJoined=!0);var t=g._playerState;g._logger.info("setPlayerState(): changing player state from "+t+" to "+e),g.enqueuePlayerStateChangeEvent(t,e),g._playerState=e},this.setStreamResolutionWidth=function(e){g._logger.debug("setStreamResolutionWidth(): "+e);var t=g._width;t!==e&&e>-1&&(g._logger.debug("Change stream resolution width from "+t+" to "+e),g.enqueueResolutionWidthChangeEvent(t,e),g._width=e)},this.setStreamResolutionHeight=function(e){g._logger.debug("setStreamResolutionHeight(): "+e);var t=g._height;t!==e&&e>-1&&(g._logger.debug("Change stream resolution height from "+t+" to "+e),g.enqueueResolutionHeightChangeEvent(t,e),g._height=e)},this.setConnectionType=function(e){g._logger.debug("setConnectionType(): "+e);var t=g._connectionType;t!==e&&null!=e&&(g._logger.debug("Change network connection type from "+t+" to "+e),g.enqueueConnectionTypeChangeEvent(t,e),g._connectionType=e)},this.setSsid=function(e){g._logger.debug("setSsid(): "+e);var t=g._ssid;t!==e&&null!=e&&(g._logger.debug("Change network SSID from "+t+" to "+e),g.enqueueSsidChangeEvent(t,e),g._ssid=e)},this.setLinkEncryption=function(e){g._logger.debug("setLinkEncryption(): "+e);var t=g._linkEncryption;t!==e&&null!=e&&(g._logger.debug("Change network link encryption from "+t+" to "+e),g.enqueueLinkEncryptionChangeEvent(t,e),g._linkEncryption=e)},this.setSignalStrength=function(e){g._logger.debug("setSignalStrength(): "+e);var t=g._signalStrength;t!==e&&0>=e&&(g._logger.debug("Change network signal strength from "+t+" to "+e),g._signalStrength=e)},this.togglePauseJoin=function(e){if(g._logger.debug("togglePauseJoin()"),g._pauseJoin===e)return void g._logger.debug("togglePauseJoin(): same value, ignoring");var t=g._pauseJoin,i=!g._pauseJoin;g.enqueuePauseJoinChangeEvent(t,i),g._pauseJoin=!g._pauseJoin},this.sendError=function(e,t){g.enqueueErrorEvent(e,t)},this.enqueueEvent=function(e,t){t[p.REQUEST_EVENT_KEY_TYPE]=e,t[p.REQUEST_EVENT_KEY_SESSION_TIME]=this.getSessionTime(),t[p.REQUEST_EVENT_KEY_SEQUENCE_NUMBER]=this._eventQueue.getNumber(),t[p.REQUEST_KEY_PLAYHEAD_TIME]=this._playheadTimeMs,t[p.REQUEST_KEY_BUFFER_LENGTH]=this._bufferLengthMs,this._eventQueue.enqueue(t)},this.enqueueSessionEndEvent=function(){var e=this.getSessionTime(),t=this.getNextEventNumber(),i=this._cwsProtocol.generateSessionEndEvent(t,e);this._eventQueue.enqueue(i)},this.enqueueTagsChangeEvent=function(e,t){var i=null;I.dictCount(e)>0&&(i={},i[p.REQUEST_KEY_TAGS]=e);var n={};n[p.REQUEST_KEY_TAGS]=t,this.declareStateChange(n,i)},this.enqueueAssetNameChangeEvent=function(e,t){var i={};i[p.REQUEST_KEY_ASSET_NAME]=t,this.declareStateChange(i,null)},this.enqueueErrorEvent=function(e,t){var i={};i[p.REQUEST_ERROR_EVENT_KEY_MESSAGE]=e,i[p.REQUEST_ERROR_EVENT_KEY_FATAL]=t,this.enqueueEvent(p.EVENT_TYPE_ERROR,i)},this.enqueueBitrateChangeEvent=function(e,t){var i={},n={};-1>e&&(e=-1),n[p.REQUEST_KEY_BITRATE]=e,i[p.REQUEST_KEY_BITRATE]=t,this.declareStateChange(i,n)},this.enqueueSeekEvent=function(e,t){var i={};i[p.REQUEST_EVENT_KEY_SEEK_ACT_TYPE]=e,t>=0&&(i[p.REQUEST_EVENT_KEY_SEEK_TO_POS]=t),this.enqueueEvent(p.EVENT_TYPE_SEEK,i)},this.enqueueResourceChangeEvent=function(e,t){var i={},n={};null!==e&&(n[p.REQUEST_KEY_RESOURCE]=e),i[p.REQUEST_KEY_RESOURCE]=t,this.declareStateChange(i,n)},this.enqueueStreamUrlChangeEvent=function(e,t){var i={},n={};null!==e&&(n[p.REQUEST_KEY_STREAM_URL]=e),i[p.REQUEST_KEY_STREAM_URL]=t,this.declareStateChange(i,n)},this.enqueueResolutionWidthChangeEvent=function(e,t){var i={},n={};-1!==e&&(n[p.REQUEST_KEY_VIDEO_WIDTH]=e),i[p.REQUEST_KEY_VIDEO_WIDTH]=t,this.declareStateChange(i,n)},this.enqueueResolutionHeightChangeEvent=function(e,t){var i={},n={};-1!==e&&(n[p.REQUEST_KEY_VIDEO_HEIGHT]=e),i[p.REQUEST_KEY_VIDEO_HEIGHT]=t,this.declareStateChange(i,n)},this.enqueueConnectionTypeChangeEvent=function(e,t){var i={},n={};null!==e&&(n[p.REQUEST_KEY_CONNECTION_TYPE]=e),i[p.REQUEST_KEY_CONNECTION_TYPE]=t,this.declareStateChange(i,n)},this.enqueueSsidChangeEvent=function(e,t){var i={},n={};null!==e&&(n[p.REQUEST_KEY_SSID]=e),i[p.REQUEST_KEY_SSID]=t,this.declareStateChange(i,n)},this.enqueueLinkEncryptionChangeEvent=function(e,t){var i={},n={};null!==e&&(n[p.REQUEST_KEY_LINK_ENCRYPTION]=e),i[p.REQUEST_KEY_LINK_ENCRYPTION]=t,this.declareStateChange(i,n)},this.enqueuePauseJoinChangeEvent=function(e,t){var i={},n={};n[p.REQUEST_KEY_PAUSE_JOIN]=e,i[p.REQUEST_KEY_PAUSE_JOIN]=t,this.declareStateChange(i,n)},this.enqueuePlayerStateChangeEvent=function(e,t){var i={},n={};i[p.REQUEST_KEY_PLAYER_STATE]=p.convertPlayerState(t),n[p.REQUEST_KEY_PLAYER_STATE]=p.convertPlayerState(e),this.declareStateChange(i,n)},this.enqueueDataSamplesEvent=function(){var e={};e[p.REQUEST_KEY_SIGNAL_STRENGTH]=g._signalStrength,this.enqueueEvent(p.EVENT_TYPE_DATA_SAMPLE,e)},this.declareStateChange=function(e,t){var i={};i[p.REQUEST_STATE_CHANGE_EVENT_KEY_NEW]=e,null!=t&&I.dictCount(t)>0&&(i[p.REQUEST_STATE_CHANGE_EVENT_KEY_OLD]=t),this.enqueueEvent(p.EVENT_TYPE_STATE_CHANGE,i)},this.enqueueCustomEvent=function(e,t){var i={};i[p.REQUEST_CUSTOM_EVENT_KEY_NAME]=e,i[p.REQUEST_CUSTOM_EVENT_KEY_ATTRIBUTES]=t,this.enqueueEvent(p.EVENT_TYPE_CUSTOM,i)},this.cancelHeartbeatTimer=function(){null!=g._heartbeatTimerCancel&&(g._heartbeatTimerCancel(),g._heartbeatTimerCancel=null)},this.resetHeartbeatTimer=function(){g.cancelHeartbeatTimer();var e=1e3*g._clientSettings.heartbeatInterval;g._heartbeatTimerCancel=g._timer.create(g.sendHeartbeat,e,"Session.sendHeartbeat")},this.createHeartbeatInfo=function(){var e={};e.err="pending",e.seq=g._heartbeatSequenceNumber-1,e.sentAt=g.getSessionTime(),e.rtt=-1,g._heartbeatInfos.push(e)},this.updateHeartbeatInfoOnFailure=function(e,t){for(var i=0;i<g._heartbeatInfos.length;i++){var n=g._heartbeatInfos[i];n.seq===e&&(n.rtt=g.getSessionTime()-n.sentAt,n.err=t)}},this.updateHeartbeatInfoOnSuccess=function(e){for(var t=0;t<g._heartbeatInfos.length;t++){var i=g._heartbeatInfos[t];i.seq===e&&(i.rtt=g.getSessionTime()-i.sentAt,i.err="ok")}},this.removeOutdatedHeartbeatInfos=function(){for(var e,t=g._clientConfig.get(k.CONFIG_KEY_MAX_HEARTBEAT_INFOS),i=[],n=0;n<g._heartbeatInfos.length;n++)e=g._heartbeatInfos[n],e.seq<g._heartbeatSequenceNumber-t&&i.push(n);for(var s=[],r=0;r<g._heartbeatInfos.length;r++)e=g._heartbeatInfos[r],e.seq,i.indexOf(r)<0&&s.push(g._heartbeatInfos[r]);g._heartbeatInfos=s},this.compileHeartbeatInfos=function(){g.removeOutdatedHeartbeatInfos();for(var e=[],t=0;t<g._heartbeatInfos.length;t++){var i=g._heartbeatInfos[t],n={};n[p.REQUEST_HEARTBEAT_INFO_KEY_SEQUENCE_NUMBER]=i.seq,n[p.REQUEST_HEARTBEAT_INFO_KEY_ROUNDTRIP_TIME]=i.rtt,n[p.REQUEST_HEARTBEAT_INFO_KEY_STATUS]=i.err,e.push(n)}return e},this.makeHeartbeat=function(){var e=new v;if(e.setMessageType(p.MESSAGE_TYPE_SESSION_HEARTBEAT),e.setCustomerKey(g._clientSettings.customerKey),e.setClientId(g._clientConfig.get(k.CONFIG_KEY_CLIENT_ID)),e.setSessionId(g._session._id),e.setSequenceNumber(g._heartbeatSequenceNumber),e.setProtocolVersion(p.version),e.setClientVersion(t.version),e.setInstanceId(g._client.getId()),e.setCapfield(0),null!=g._connectionType&&e.setConnectionType(g._connectionType),null!=g._ssid&&e.setSsid(g._ssid),null!=g._linkEncryption&&e.setLinkEncryption(g._linkEncryption),g._signalStrength<=0&&g.enqueueDataSamplesEvent(),e.setPlatformMetadataSchema(p.SDK_METADATA_SCHEMA),null!=g._browserName&&e.setBrowserName(g._browserName),null!=g._browserVersion&&e.setBrowserVersion(g._browserVersion),null!=g._deviceBrand&&e.setDeviceBrand(g._deviceBrand),null!=g._deviceManufacturer&&e.setDeviceManufacturer(g._deviceManufacturer),null!=g._deviceModel&&e.setDeviceModel(g._deviceModel),null!=g._deviceType&&e.setDeviceType(g._deviceType),null!=g._deviceVersion&&e.setDeviceVersion(g._deviceVersion),null!=g._frameworkName&&e.setFrameworkName(g._frameworkName),null!=g._frameworkVersion&&e.setFrameworkVersion(g._frameworkVersion),null!=g._operatingSystemName&&e.setOperatingSystemName(g._operatingSystemName),null!=g._operatingSystemVersion&&e.setOperatingSystemVersion(g._operatingSystemVersion),null!=g._viewerId&&e.setViewerId(g._viewerId),null!=g._playerName&&e.setPlayerName(g._playerName),I.dictCount(g._tags)>0&&e.setTags(g._tags),g.isVideoSession()){null!=g._assetName&&e.setAssetName(g._assetName),null!=g._isLive&&e.setIsLive(g._isLive),e.setSessionFlags(g._sessionFlags);var i=p.convertPlayerState(g._playerState);e.setPlayerState(i),e.setPauseJoin(g._pauseJoin),g._contentLengthSec>0&&e.setContentLength(g._contentLengthSec),g._bitrateKbps>0&&e.setBitrate(g._bitrateKbps),null!==g._resource&&e.setResource(g._resource),g._encodedFrameRate>0&&e.setEncodedFrameRate(g._encodedFrameRate),g._averageFrameRate>=0&&e.setAverageFrameRate(g._averageFrameRate),e.setPlayheadTime(g._playheadTimeMs),e.setBufferLength(g._bufferLengthMs),null!=g._streamUrl&&e.setStreamUrl(g._streamUrl),g._width>-1&&e.setStreamWidth(g._width),g._height>-1&&e.setStreamHeight(g._height)}else e.setSessionFlags(p.SessionFlags.GLOBAL);e.setCapabilities(g._capabilities);var n=g._eventQueue.flush();if(g.isGlobalSession()&&0===n.length)return null;if(e.setEvents(n),e.setIsSdkClient(!0),g._clientConfig.get(k.CONFIG_KEY_SEND_LOGS)&&e.setLogs(g._logBuffer.flush()),g._clientConfig.get(k.CONFIG_KEY_MAX_HEARTBEAT_INFOS)>0){var s=g.compileHeartbeatInfos();s.length>0&&e.setHeartbeatInfos(s)}return e.setSessionStartTime(g._startTimeMs),e.setSessionTime(g.getSessionTime()),g._heartbeatSequenceNumber++,e.get()},this.sendHeartbeat=function(){if(!g._cleanedUp){var e=g.makeHeartbeat();null!=e&&g.postHeartbeat(e)}},this.postHeartbeat=function(e){g.createHeartbeatInfo();var t=g._heartbeatSequenceNumber-1;g._logger.info("postHeartbeat(): Send HB["+t+"]"+g.sessionTypeTag());var i=function(e,i){g.onHeartbeatResponse(e,i,t)};g._gatewayControl.send(e,i)},this.onHeartbeatResponse=function(e,t,i){g._cleanedUp||g._exceptionCatcher.runProtected("onHeartbeatResponse",function(){if(e){var n=t;if(null!=n){g._logger.debug("onHeartbeatResponse(): received valid response for HB["+i+"]"),g.updateHeartbeatInfoOnSuccess(i);var s=n[p.RESPONSE_KEY_CLIENT_ID];null!=s&&s!=g._clientConfig.get(k.CONFIG_KEY_CLIENT_ID)&&(g._logger.debug("onHeartbeatResponse(): setting the client id to "+s+" (from gateway)"),g._clientConfig.set(k.CONFIG_KEY_CLIENT_ID,s),g._clientConfig.save());var r=n[p.RESPONSE_KEY_STATUS];null!=r&&r!=p.RESPONSE_STATUS_NO_ERRORS&&g._logger.error("onHeartbeatResponse(): error from gateway: "+r);var a=n[p.RESPONSE_KEY_CONFIG];if("object"==typeof a){var o=a[p.RESPONSE_CONFIG_KEY_MAX_HEARTBEAT_INFOS];null!=o&&g._clientConfig.get(k.CONFIG_KEY_MAX_HEARTBEAT_INFOS)!==o&&(g._logger.debug("onHeartbeatResponse(): setting Maximum Heartbeat Infos to "+o+" (from gateway)"),g._clientConfig.set(k.CONFIG_KEY_MAX_HEARTBEAT_INFOS,o));var l=a[p.RESPONSE_CONFIG_KEY_SEND_LOGS],c=null!=l&&I.AsBoolean(l);c!==g._clientConfig.get(k.CONFIG_KEY_SEND_LOGS)&&(g._logger.debug("onHeartbeatResponse(): turning "+(c?"on":"off")+" sending of logs"),g._clientConfig.set(k.CONFIG_KEY_SEND_LOGS,c));var d=a[p.RESPONSE_CONFIG_KEY_HEARTBEAT_INTERVAL];if(null!=d){var u=I.Int32.Cast(d),h=u;h!=g._clientSettings.heartbeatInterval&&(g._logger.debug("onHeartbeatResponse(): received hbIntervalMs from gateway: "+h),g._clientSettings.heartbeatInterval=h,null!=g._heartbeatTimerCancel&&g.resetHeartbeatTimer())}var _=a[p.RESPONSE_CONFIG_KEY_GATEWAY_URL];null!=_&&_!=g._clientSettings.gatewayUrl&&(g._logger.debug("onHeartbeatResponse(): received gatewayUrl from gateway: "+_),g._clientSettings.gatewayUrl=_)}}else g._logger.warning("onHeartbeatResponse(): decoded heartbeat response is null.")}else{var f=t;I.isValidString(f)?I.stringStartsWith(f,"HTTP timeout")?g._logger.warning("onHeartbeatResponse(): "+f):g._logger.error("onHeartbeatResponse(): failed to send heartbeat: "+f):(f=S.DEFAULT_HEARTBEAT_ERROR_MESSAGE,g._logger.error("onHeartbeatResponse(): "+f)),g.updateHeartbeatInfoOnFailure(i,f)}})},this.getSessionTime=function(){return I.Int32.Cast(g._time.current()-g._startTimeMs)},this.getNextEventNumber=function(){return this._eventQueue.getNumber()},this.sessionTypeTag=function(){return this.isGlobalSession()?" (global session)":""},this.isGlobalSession=function(){return this._global},this.isVideoSession=function(){return!this._global}};b.DEFAULT_VIDEO_SESSION_FLAGS=p.SessionFlags.VIDEO+p.SessionFlags.QUALITY_METRICS+p.SessionFlags.BITRATE_METRICS;var S=(e.IMonitor=function(){this.onPlayerStateChange=function(e){},this.onBitrateChange=function(e){},this.onSeekEvent=function(e,t){},this.onEncodedFrameRateChange=function(e){},this.onRenderedFrameRateChange=function(e){},this.onContentLengthChange=function(e){},this.onPlayheadTimeChange=function(e){},this.onStreamUrlChange=function(e){},this.onBufferLengthChange=function(e){},this.onPlayerTypeChange=function(e){},this.onPlayerVersionChange=function(e){},this.onStreamResolutionWidthChange=function(e){},this.onStreamResolutionHeightChange=function(e){},this.onConnectionTypeChange=function(e){},this.onSsidChange=function(e){},this.onLinkEncryptionChange=function(e){},this.onSignalStrengthChange=function(e){},this.onMetadataChange=function(e){},this.onError=function(e,t){},this.onRelease=function(){}},e.Session=function(){function e(e,t,i,n,s,r,a,o){this._id=e,this._global=t,this._contentMetadata=i,this._clientConfig=n,this._systemMetadata=s,this._cwsSession=r,this._exceptionCatcher=a,this._logger=o,this._logger.setModuleName("Session"),this._logger.setSessionId(I.ToString(this._id))}var t=this;t._contentMetadata=null,t._playerStateManager=null,t._id=0,t._global=!1,t._cleaningUp=!1,t._cleanedUp=!1,t._adPlaying=!1,t._adStream=null,t._adPlayer=null,t._adPosition=null,t._ignorePlayerState=!1,t._pooledPlayerState=a.PlayerState.NOT_MONITORED,t._ignoreBitrateAndResource=!1,t._ignorePlayheadTimeandBufferLength=!1,t._ignoreEncodedFrameRateAndDuration=!1,t._ignoreError=!1,t._playingFpsObservationCount=0,t._playingFpsTotal=0,e.apply(t,arguments),this.start=function(){if(t.isVideoSession()?t._logger.info("start(): assetName="+t._contentMetadata.assetName):t._logger.info("start()"+t.sessionTypeTag()),t._cwsSession.start(this),t._clientConfig.isReady())t.initiateSession();else{var e=function(){t.initiateSession()};t._clientConfig.register(e)}},this.cleanup=function(){if(t._logger.info("cleanup()"+t.sessionTypeTag()),t._cleaningUp=!0,t._cwsSession.willEndSoon(),t._clientConfig.isReady())t.endCwsSessionAndCleanupAll();else{var e=function(){t.endCwsSessionAndCleanupAll()};t._clientConfig.register(e)}},this.cleanupAll=function(){t._logger.debug("cleanupAll()"+t.sessionTypeTag()),t.isVideoSession()&&null!=t._playerStateManager&&t.detachPlayer(),t._contentMetadata=null,t._logger.setSessionId(null),t._logger=null,t._exceptionCatcher=null,t._client=null,t._clientConfig=null,t._systemMetadata=null,t._cwsSession.cleanup(),t._cwsSession=null,t._cleanedUp=!0},this.endCwsSessionAndCleanupAll=function(){t._cwsSession.end(),t.cleanupAll()},this.initiateSession=function(){t._cwsSession.initialize(),t.setStatesFromSystemMetadata(),t.isVideoSession()&&t.setStatesFromContentMetadata(),t._cwsSession.startSendingHeartbeats()},this.setStatesFromSystemMetadata=function(){t._logger.debug("setStatesFromSystemMetadata()");var e=t._systemMetadata.get(),i=e[N.BROWSER_NAME];null!=i&&t._cwsSession.setBrowserName(i);var n=e[N.BROWSER_VERSION];null!=n&&t._cwsSession.setBrowserVersion(n);var s=e[N.DEVICE_BRAND];null!=s&&t._cwsSession.setDeviceBrand(s);var r=e[N.DEVICE_MANUFACTURER];null!=r&&t._cwsSession.setDeviceManufacturer(r);var a=e[N.DEVICE_MODEL];null!=a&&t._cwsSession.setDeviceModel(a);var o=e[N.DEVICE_TYPE];null!=o&&t._cwsSession.setDeviceType(o);var l=e[N.DEVICE_VERSION];null!=l&&t._cwsSession.setDeviceVersion(l);var c=e[N.FRAMEWORK_NAME];null!=c&&t._cwsSession.setFrameworkName(c);var d=e[N.FRAMEWORK_VERSION];null!=d&&t._cwsSession.setFrameworkVersion(d);var u=e[N.OPERATING_SYSTEM_NAME];null!=u&&t._cwsSession.setOperatingSystemName(u);var h=e[N.OPERATING_SYSTEM_VERSION];null!=h&&t._cwsSession.setOperatingSystemVersion(h)},this.setStatesFromContentMetadata=function(){if(t._logger.debug("setStatesFromContentMetadata()"),t._contentMetadata.defaultBitrateKbps>0&&t._cwsSession._bitrateKbps<0&&t._cwsSession.setBitrateKbps(t._contentMetadata.defaultBitrateKbps),null!=t._contentMetadata.defaultResource&&null==t._cwsSession._resource&&t._cwsSession.setResource(t._contentMetadata.defaultResource),null!=t._contentMetadata.streamUrl&&null==t._cwsSession._streamUrl&&t._cwsSession.setStreamUrl(t._contentMetadata.streamUrl),t._contentMetadata.duration>0&&t._cwsSession.setContentLength(t._contentMetadata.duration),t._contentMetadata.encodedFrameRate>0&&t._cwsSession.setEncodedFrameRate(t._contentMetadata.encodedFrameRate),t._contentMetadata.streamType!==n.StreamType.UNKNOWN){var e=t._contentMetadata.streamType===n.StreamType.LIVE;t._cwsSession.setIsLive(e)}null!=t._contentMetadata.assetName&&t._cwsSession.setAssetName(t._contentMetadata.assetName),null!=t._contentMetadata.viewerId&&t._cwsSession.setViewerId(t._contentMetadata.viewerId),null!=t._contentMetadata.applicationName&&t._cwsSession.setPlayerName(t._contentMetadata.applicationName),I.dictCount(t._contentMetadata.custom)>0&&t._cwsSession.setTags(t._contentMetadata.custom)},this.setRenderedFrameRate=function(e){t._renderedFrameRate=e,t.updateAverageFrameRate()},this.updateAverageFrameRate=function(){if(t._cwsSession._playerState===a.PlayerState.PLAYING){var e=t._renderedFrameRate;if(e>=0){t._playingFpsTotal+=e,t._playingFpsObservationCount++;var i=I.Int32.Cast(1*t._playingFpsTotal/t._playingFpsObservationCount);t._cwsSession.setAverageFrameRate(i)}}},this.onPlayerStateChange=function(e){return t._logger.debug("onPlayerStateChange(): "+e),t._cwsSession._playerState!=e?(t._cwsSession._playerState==a.PlayerState.NOT_MONITORED&&e!=a.PlayerState.NOT_MONITORED&&(t._pooledPlayerState=e),t._ignorePlayerState?void t._logger.debug("onPlayerStateChange(): "+e+" (pooled, "+(t._adPlaying?"ad playing":"preloading")+")"):void t._cwsSession.setPlayerState(e)):void 0},this.onBitrateChange=function(e){return t._logger.debug("onBitrateChange(): "+e),t._ignoreBitrateAndResource?void t._logger.info("onBitrateChange(): ignored"):void t._cwsSession.setBitrateKbps(e)},this.onSeekEvent=function(e,i){t._cwsSession.enqueueSeekEvent(e,i)},this.onRenderedFrameRateChange=function(e){t._logger.debug("onRenderedFrameRateChange(): "+e),t._ignoreEncodedFrameRateAndDuration?t._logger.info("onRenderedFrameRateChange(): Ignored rendered frame rate data: "+e+" (ads)"):(t.setRenderedFrameRate(e),t._logger.info("onRenderedFrameRateChange(): Received rendered frame rate data: "+e))},this.onEncodedFrameRateChange=function(e){t._logger.debug("onEncodedFrameRateChange(): "+e),t._contentMetadata.encodedFrameRate>0||(e>0?t._ignoreEncodedFrameRateAndDuration?t._logger.info("onEncodedFrameRateChange(): Ignored encoded frame rate data: "+e+" (ads)"):(t._cwsSession.setEncodedFrameRate(e),t._logger.info("onEncodedFrameRateChange(): Received encoded frame rate data: "+e)):t._logger.warning("onEncodedFrameRateChange(): Ignored invalid encoded frame rate data: "+e))},this.onContentLengthChange=function(e){t._logger.debug("onContentLengthChange(): "+e),t._contentMetadata.duration>0||(e>0?t._ignoreEncodedFrameRateAndDuration?t._logger.info("setContentLength(): Ignored content length data: "+e+" (ads)"):(t._cwsSession.setContentLength(e),t._logger.info("setContentLength(): Received content length data: "+e)):t._logger.warning("setContentLength(): Ignored invalid content length data: "+e))},this.onStreamUrlChange=function(e){t._logger.debug("onStreamUrlChange(): "+e),t._cwsSession.setStreamUrl(e)},this.onMetadataChange=function(e){t.updateContentMetadata(e)},this.onPlayheadTimeChange=function(e){t._ignorePlayheadTimeandBufferLength||t._cwsSession.setPlayheadTimeMs(e)},this.onBufferLengthChange=function(e){t._ignorePlayheadTimeandBufferLength||t._cwsSession.setBufferLengthMs(e)},this.onStreamResolutionWidthChange=function(e){t._logger.debug("onStreamResolutionWidthChange(): "+e),t._cwsSession.setStreamResolutionWidth(e)},this.onStreamResolutionHeightChange=function(e){t._logger.debug("onStreamResolutionHeightChange(): "+e),t._cwsSession.setStreamResolutionHeight(e)},this.onConnectionTypeChange=function(e){t._logger.debug("onConnectionTypeChange(): "+e),t._cwsSession.setConnectionType(e)},this.onSsidChange=function(e){t._logger.debug("onSsidChange(): "+e),t._cwsSession.setSsid(e)},this.onLinkEncryptionChange=function(e){t._logger.debug("onLinkEncryptionChange(): "+e),t._cwsSession.setLinkEncryption(e)},this.onSignalStrengthChange=function(e){t._logger.debug("onSignalStrengthChange(): "+e),t._cwsSession.setSignalStrength(e)},this.onPlayerTypeChange=function(e){t._logger.debug("onPlayerTypeChange(): "+e),null==t._cwsSession.getFrameworkName()&&t._cwsSession.setFrameworkName(e)},this.onPlayerVersionChange=function(e){t._logger.debug("onPlayerVersionChange(): "+e),null==t._cwsSession.getFrameworkVersion()&&t._cwsSession.setFrameworkVersion(e)},this.onError=function(e,i){t._logger.debug("onError(): "+e+" ("+i+")"),t.reportError(e,i)},this.onRelease=function(){t._logger.debug("onRelease()"),t.detachPlayer()},this.adStart=function(e,i,n){return t._logger.debug("adStart(): adStream="+e+" adPlayer="+i+" adPosition="+n),t._adPlaying?void t._logger.warning("adStart(): multiple adStart calls, ignoring"):(t._adPlaying=!0,t._adStream=e,t._adPlayer=i,t._adPosition=n,t._cwsSession._hasJoined||t._cwsSession.togglePauseJoin(!0),void(t._adStream==Conviva.Client.AdStream.CONTENT||t._adPlayer==Conviva.Client.AdPlayer.SEPARATE?(t._cwsSession._playerState!==a.PlayerState.NOT_MONITORED&&(t._pooledPlayerState=t._cwsSession._playerState),t._cwsSession.setPlayerState(a.PlayerState.NOT_MONITORED),t._ignorePlayerState=!0):t._adStream==Conviva.Client.AdStream.SEPARATE&&t._adPlayer==Conviva.Client.AdPlayer.CONTENT&&(t._cwsSession._playerState!==a.PlayerState.NOT_MONITORED&&(t._pooledPlayerState=t._cwsSession._playerState),t._cwsSession.setPlayerState(a.PlayerState.NOT_MONITORED),t._ignorePlayerState=!0,t._ignoreBitrateAndResource=!0,t._ignoreEncodedFrameRateAndDuration=!0,t._ignorePlayheadTimeandBufferLength=!0,t._ignoreError=!0)))},this.adEnd=function(){return t._logger.debug("adEnd()"),t._adPlaying?(t._cwsSession._hasJoined||t._cwsSession.togglePauseJoin(!1),t._adStream==Conviva.Client.AdStream.CONTENT||t._adPlayer==Conviva.Client.AdPlayer.SEPARATE?t._preloading||(t._ignorePlayerState=!1,t._cwsSession.setPlayerState(t._pooledPlayerState)):t._adStream==Conviva.Client.AdStream.SEPARATE&&t._adPlayer==Conviva.Client.AdPlayer.CONTENT&&(t._ignoreBitrateAndResource=!1,t._ignoreEncodedFrameRateAndDuration=!1,t._ignorePlayheadTimeandBufferLength=!1,t._ignoreError=!1,t._preloading||(t._ignorePlayerState=!1,t._cwsSession.setPlayerState(t._pooledPlayerState))),t._adPlaying=!1,void(t._adStream=t._adPlayer=t._adPosition=null)):void t._logger.debug("adEnd(): called before adStart, ignoring")},this.detachPlayer=function(){t._logger.debug("detachPlayer()"),null!==t._playerStateManager&&(t._exceptionCatcher.runProtected("Session.detachPlayer",function(){t._playerStateManager.removeMonitoringNotifier()}),t._playerStateManager=null,t._cwsSession.setPlayerState(a.PlayerState.NOT_MONITORED))},this.attachPlayer=function(e){return t._logger.debug("attachPlayer()"),null!=t._playerStateManager?void t._logger.error("attachPlayer(): detach current PlayerStateManager first"):void t._exceptionCatcher.runProtected("Session.attachPlayer()",function(){e.setMonitoringNotifier(t,t._id)?(e.pushCurrentState(),t._playerStateManager=e):t._logger.error("attachPlayer(): instance of PlayerStateManager is already attached to a session")})},this.contentPreload=function(){return t._logger.debug("contentPreload()"),t._preloading?void t._logger.debug("contentPreload(): called twice, ignoring"):(t._preloading=!0,void(t._ignorePlayerState=!0))},this.contentStart=function(){return t._logger.debug("contentStart()"),t._preloading?(t._preloading=!1,void(t._adPlaying||(t._ignorePlayerState=!1,t._cwsSession.setPlayerState(t._pooledPlayerState)))):void t._logger.warning("contentStart(): called without contentPreload, ignoring")},this.reportError=function(e,i){if(t._logger.info("reportError(): "+e),!I.isValidString(e))return void t._logger.error("reportError(): invalid error message string: "+e);if(i!==Conviva.Client.ErrorSeverity.FATAL&&i!==Conviva.Client.ErrorSeverity.WARNING)return void t._logger.error("reportError(): invalid error severity: "+i);if(t._ignoreError)return void t._logger.debug("reportError(): ignored");var n=i===Conviva.Client.ErrorSeverity.FATAL;t._cwsSession.sendError(e,n)},this.updateContentMetadata=function(e){t._logger.debug("updateContentMetadata(): enter"),t._exceptionCatcher.runProtected("Session.updateContentMetadata",function(){t.mergeContentMetadata(e),t.setStatesFromContentMetadata()})},this.sendCustomEvent=function(e,i){t._logger.info("sendEvent(): eventName="+e+t.sessionTypeTag()),t._cwsSession.enqueueCustomEvent(e,i)},this.mergeContentMetadata=function(e){var i={},s={};i[p.REQUEST_KEY_STREAM_METADATA_CHANGE]={},s[p.REQUEST_KEY_STREAM_METADATA_CHANGE]={},I.isValidString(e.assetName)&&t._contentMetadata.assetName!=e.assetName?(i[p.REQUEST_KEY_ASSET_NAME]=t._contentMetadata.assetName,s[p.REQUEST_KEY_ASSET_NAME]=e.assetName,t._contentMetadata.assetName=e.assetName):t._logger.warning("mergeContentMetadata(): assetName was not changed."),I.isValidString(e.applicationName)&&t._contentMetadata.applicationName!=e.applicationName?(i[p.REQUEST_KEY_STREAM_METADATA_CHANGE][p.REQUEST_KEY_PLAYER_NAME]=t._contentMetadata.applicationName,s[p.REQUEST_KEY_STREAM_METADATA_CHANGE][p.REQUEST_KEY_PLAYER_NAME]=e.applicationName,t._contentMetadata.applicationName=e.applicationName):t._logger.warning("mergeContentMetadata(): applicationName was not changed."),I.isValidString(e.streamUrl)&&t._contentMetadata.streamUrl!=e.streamUrl?(i[p.REQUEST_KEY_STREAM_URL]=t._contentMetadata.streamUrl,s[p.REQUEST_KEY_STREAM_URL]=e.streamUrl,t._contentMetadata.streamUrl=e.streamUrl):t._logger.warning("mergeContentMetadata(): streamUrl was not changed."),I.isValidString(e.viewerId)&&t._contentMetadata.viewerId!=e.viewerId?(i[p.REQUEST_KEY_STREAM_METADATA_CHANGE][p.REQUEST_KEY_VIEWER_ID]=t._contentMetadata.viewerId,s[p.REQUEST_KEY_STREAM_METADATA_CHANGE][p.REQUEST_KEY_VIEWER_ID]=e.viewerId,t._contentMetadata.viewerId=e.viewerId):t._logger.warning("mergeContentMetadata(): viewerId was not changed."),t._contentMetadata.defaultBitrateKbps<=0&&e.defaultBitrateKbps>0?t._contentMetadata.defaultBitrateKbps=e.defaultBitrateKbps:t._logger.warning("mergeContentMetadata(): defaultBitrateKbps was not changed."),I.isValidString(e.defaultResource)&&t._contentMetadata.defaultResource!=e.defaultResource?(i[p.REQUEST_KEY_RESOURCE]=t._contentMetadata.defaultResource,s[p.REQUEST_KEY_RESOURCE]=e.defaultResource,t._contentMetadata.defaultResource=e.defaultResource):t._logger.warning("mergeContentMetadata(): defaultResource was not changed."),e.duration>0&&t._contentMetadata.duration!=e.duration?(i[p.REQUEST_KEY_CONTENT_LENGTH]=t._contentMetadata.duration,s[p.REQUEST_KEY_CONTENT_LENGTH]=e.duration,t._contentMetadata.duration=e.duration):t._logger.warning("mergeContentMetadata(): duration was not changed."),t._contentMetadata.encodedFrameRate<=0&&e.encodedFrameRate>0?(i[p.REQUEST_KEY_ENCODED_FRAME_RATE]=t._contentMetadata.encodedFrameRate,s[p.REQUEST_KEY_ENCODED_FRAME_RATE]=e.encodedFrameRate,t._contentMetadata.encodedFrameRate=e.encodedFrameRate):t._logger.warning("mergeContentMetadata(): encodedFrameRate was not changed."),t._contentMetadata.streamType!=e.streamType&&e.streamType!=n.StreamType.UNKNOWN?(i[p.REQUEST_KEY_IS_LIVE]=t._contentMetadata.streamType,s[p.REQUEST_KEY_IS_LIVE]=e.streamType,t._contentMetadata.streamType=e.streamType):t._logger.warning("mergeContentMetadata(): streamType was not changed.");var r={};for(var a in e.custom){t._contentMetadata.custom[a]!=e.custom[a]?r[a]=e.custom[a]:t._logger.warning("mergeContentMetadata(): custom."+a+" was not changed.")}if(I.dictCount(r)>0){var o={};for(a in t._contentMetadata.custom)o[a]=t._contentMetadata.custom[a];for(a in r)o[a]=r[a];t._contentMetadata.custom=o}t._cwsSession.declareStateChange(s,i)},this.isGlobalSession=function(){return t._global},this.isVideoSession=function(){return!t._global},this.sessionTypeTag=function(){return t.isGlobalSession()?" (global session)":""}});S.DEFAULT_HEARTBEAT_ERROR_MESSAGE="received no response (or a bad response) to heartbeat POST request";var y=e.SessionFactory=function(){function e(e,i,n,s){t._client=e,t._clientSettings=i,t._clientConfig=n,t._systemFactory=s,t._logger=t._systemFactory.buildLogger(),t._logger.setModuleName("SessionFactory"),t._nextSessionKey=0,t._sessionsByKey={}}var t=this;t._logger=null,t._logBuffer=null,t._nextSessionKey=0,t._sessionsByKey=null,e.apply(t,arguments),this.cleanup=function(){t._logger=null,t._logBuffer=null;for(var e in t._sessionsByKey){t._sessionsByKey[e].cleanup()}t._sessionsByKey=null,t._nextSessionKey=0},this.newSessionKey=function(){var e=t._nextSessionKey;return t._nextSessionKey++,e},this.makeVideoSession=function(e){return null==e&&(e=new n),t.makeSession(e,!1)},this.makeGlobalSession=function(e){return t.makeSession(e,!0)},this.generateSessionId=function(){return A.integer32()},this.makeSession=function(e,i){var n=e.clone(e),s=t.generateSessionId(),r=t._systemFactory.buildSession(t._client,t._clientSettings,t._clientConfig,s,i,n),a=t.newSessionKey();return t.addSession(a,r),r.start(),a},this.getSession=function(e){var i=t._sessionsByKey[e];return null==i&&t._logger.error("Client: invalid sessionKey. Did you cleanup that session previously?"),i},this.getVideoSession=function(e){var i=this.getSession(e);return null!=i&&(i.isVideoSession()||(t._logger.error("Client: invalid sessionKey. Did you cleanup that session previously?"),i=null)),i},this.addSession=function(e,i){t._sessionsByKey[e]=i},this.removeSession=function(e){delete t._sessionsByKey[e]},this.cleanupSession=function(e){var i=t.getSession(e);t.removeSession(e),i.cleanup()}},E=e.CallbackWithTimeout=function(e){this._timer=e,this.getWrapperCallback=function(e,t,i){var n=!1,s=function(){n||(n=!0,e(!1,i+" ("+t+" ms)"))};return this._timer.createOnce(s,t,"CallbackWithTimeout.wrap"),function(t,i){n||(n=!0,e(t,i))}}},k=e.Config=function(e,t,i){var n=this;this._logger=e,this._logger.setModuleName("Config"),this._storage=t,this._jsonInterface=i,this._defaultConfig={
clientId:p.DEFAULT_CLIENT_ID,sendLogs:!1,maxHbInfos:p.DEFAULT_MAX_HEARTBEAT_INFOS},this._config=I.ObjectShallowCopy(this._defaultConfig),this._loaded=!1,this._loadedEmpty=!1,this._waitingConsumers=[],this.isReady=function(){return this._loaded},this.load=function(){var e=function(e,t){e?(n._parse(t),n._logger.debug("load(): configuration successfully loaded from local storage"+(n._loadedEmpty?" (was empty)":"")+".")):n._logger.error("load(): error loading configuration from local storage: "+t),n._loaded=!0,n._notify()};this._storage.load(k.STORAGE_KEY,e)},this._parse=function(e){var t=this._jsonInterface.decode(e);if(null==t)return void(this._loadedEmpty=!0);var i=t[k.CONFIG_STORAGE_KEY_CLIENT_ID];null!=i&&i!=p.DEFAULT_CLIENT_ID&&""!=i&&"null"!=i&&(this._config[k.CONFIG_KEY_CLIENT_ID]=i,this._logger.debug("parse(): loaded clientId="+i+" (from local storage)"))},this._marshall=function(){var e={};return e[k.CONFIG_STORAGE_KEY_CLIENT_ID]=this._config.clientId,this._logger.debug("_marshall(): saving clientId="+this._config.clientId+" (to local storage)"),this._jsonInterface.encode(e)},this.save=function(){var e=function(e,t){e?n._logger.debug("save(): configuration successfully saved to local storage."):n._logger.error("save(): error saving configuration to local storage: "+t)};this._storage.save(k.STORAGE_KEY,this._marshall(),e)},this.register=function(e){return this.isReady()?void e():void this._waitingConsumers.push(e)},this.get=function(e){return this._loaded?this._config[e]:null},this.set=function(e,t){this._loaded&&(this._config[e]=t)},this._notify=function(){for(var e;null!=(e=this._waitingConsumers.shift());)e()}};k.STORAGE_KEY="sdkConfig",k.CONFIG_STORAGE_KEY_CLIENT_ID="clId",k.CONFIG_KEY_CLIENT_ID="clientId",k.CONFIG_KEY_SEND_LOGS="sendLogs",k.CONFIG_KEY_MAX_HEARTBEAT_INFOS="maxHbInfos";var C=e.EventQueue=function(){this._events=[],this._nextEventNumber=0,this.enqueue=function(e){this._events.push(e)},this.getNumber=function(){var e=this._nextEventNumber;return this._nextEventNumber++,e},this.flush=function(){var e=this._events;return this._events=[],e}},T=e.ExceptionCatcher=function(e,t,i){this._logger=e,this._logger.setModuleName("ExceptionCatcher"),this._ping=t,this._systemSettings=i,this.runProtected=function(e,t,i){try{t()}catch(t){if(null!=i)i(t);else{if(this._systemSettings.allowUncaughtExceptions)throw t;this.onUncaughtException(e,t)}}},this.onUncaughtException=function(e,t){var i="Uncaught exception: "+e+": "+t.toString();if(null!=this._ping)try{this._ping.send(i)}catch(e){this._logger.error("Caught exception while sending ping: "+e.toString())}this._logger.error(i)}},x=e.GatewayControl=function(e,t,i,n){var s=this;this._clientSettings=e,this._logger=t,this._logger.setModuleName("GatewayControl"),this._httpClient=i,this._jsonInterface=n,this.send=function(e,t){var i=this._jsonInterface.encode(e),n=this._clientSettings.gatewayUrl+p.gatewayPath,r=function(e,i){if(e){var n=s._jsonInterface.decode(i);t(e,n)}else{t(e,i)}};this._httpClient.request("POST",n,i,"application/json",r)}},I=e.Lang={};I.validateInterface=function(e,t,i){if(null==e)throw new Error("Expected "+i+" implementation is null.");for(var n in t)if("function"!=typeof e[n])throw new Error("Expected method "+n+" in "+i+" implementation.")},I.dictCount=function(e){var t,i=0;for(t in e)e.hasOwnProperty(t)&&i++;return i},I.ToString=function(e){return""+e},I.NumberToInt=function(e){return Math.floor(e)},I.NumberToUnsignedInt=function(e){return Math.abs(I.NumberToInt(e))},I.AsBoolean=function(e){return Boolean(e)},I.isValidString=function(e){return"string"==typeof e&&""!==e},I.stringStartsWith=function(e,t){return"string"==typeof e&&"string"==typeof t&&("function"==typeof e.indexOf&&0===e.indexOf(t))},I.isBoolean=function(e){return"boolean"==typeof e},I.UrlEncodeString=function(e){return escape(e)},I.isObject=function(e){return"object"==typeof e},I.ObjectToString=function(e){var t="";for(var i in e){t+=i+"="+e[i]}return"Object{"+t+"}"},I.ObjectShallowCopyOmitNull=function(e){var t=I.ObjectShallowCopy(e);for(var i in t)null==t[i]&&delete t[i];return t},I.ObjectShallowCopy=function(e){var t={};for(var i in e)t[i]=e[i];return t},I.ObjectShallowEquals=function(e,t){if(typeof e!=typeof t)return!1;if(e instanceof Object&&t instanceof Object){if(I.dictCount(e)!==I.dictCount(t))return!1;for(var i in e)if(!(e[i]===t[i]))return!1;return!0}return e===t},I.isInteger=function(e){return"number"==typeof e&&Math.round(e)===e},I.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)},I.ArrayEquals=function(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!=t.length)return!1;for(var i=0;i<e.length;++i)if(I.isArray(e[i])&&I.isArray(t[i])){if(!I.ArrayEquals(e[i],t[i]))return!1}else if(e[i]!==t[i])return!1;return!0},I.isObjectDefinePropertyPresent=function(){return void 0!==Object.defineProperty&&function(){try{return Object.defineProperty({},"x",{}),!0}catch(e){return!1}}()},I.defGet=function(e,t,i){if(I.isObjectDefinePropertyPresent())Object.defineProperty(e,t,{configurable:!0,enumerable:!0,get:i});else{if(void 0===e.__defineGetter__)throw new Error("JavaScript runtime must support either Object.defineProperty or __defineGetter__");e.__defineGetter__(t,i)}},I.defSet=function(e,t,i){if(I.isObjectDefinePropertyPresent())Object.defineProperty(e,t,{configurable:!0,set:i});else{if(void 0===e.__defineSetter__)throw new Error("JavaScript runtime must support either Object.defineProperty or __defineSetter__");e.__defineSetter__(t,i)}},function(){var e={};e.two32=4294967296,e.MaxValue=e.two32-1,e.MinValue=0,I.UInt32=e,I.UInt32.Cast=function(t){var i=parseInt(t,10);return i>e.MaxValue?i%=e.two32:i<e.MinValue&&(i=-i%e.two32,i=e.two32-i),i},I.UInt32.InRange=function(t){var i=parseInt(t,10);return i<=e.MaxValue&&i>=e.MinValue};var t={};t.MaxValue=2147483647,t.MinValue=-2147483648,I.Int32=t,I.Int32.Cast=function(e){var i=parseInt(e,10);return i>t.MaxValue?i%=t.MaxValue:i<t.MinValue&&(i=-i%t.MaxValue,i=t.MaxValue-i),i},I.Int32.InRange=function(e){var i=parseInt(e,10);return i<=t.MaxValue&&i>=t.MinValue}}();var w=e.LogBuffer=function(){this._buffer=[],this.add=function(e){this._buffer.length>=32&&this._buffer.shift(),this._buffer.push(e)},this.flush=function(){var e=this._buffer;return this._buffer=[],e}},L=e.Ping=function(e,i,n){this._isSendingPing=!1,this._cachedBasePingUrl=null,this._logger=e,this._logger.setModuleName("Ping"),this._httpClient=i,this._clientSettings=n,this.send=function(e){if(!this._isSendingPing){this._isSendingPing=!0;var t=this.getBasePingUrl()+"&d="+I.UrlEncodeString(e.toString());this._logger.error("send(): "+t),this._httpClient.request("GET",t,null,null,null),this._isSendingPing=!1}},this.getBasePingUrl=function(){if(!this._cachedBasePingUrl){var e=L.SERVICE_URL+"?comp="+L.COMPONENT_NAME+"&clv="+t.version;if(this._clientSettings&&(e+="&cid="+this._clientSettings.customerKey),e+="&sch="+p.SDK_METADATA_SCHEMA,!this._clientSettings)return e;this._cachedBasePingUrl=e}return this._cachedBasePingUrl}};L.COMPONENT_NAME="sdkjs",L.SERVICE_URL="https://pings.conviva.com/ping.ping";var A=e.Random={};A.maxUInt32=4294967295,A.maxInt32=2147483647,A.minInt32=-2147483648,A.integer32=function(){return Math.floor(Math.random()*A.maxUInt32)+A.minInt32},A.uinteger32=function(){return Math.floor(Math.random()*A.maxUInt32)};var D=e.Sanitize={};D.Integer=function(e,t,i,n){if(isNaN(e))return n;if("number"!=typeof e)return n;if(e==n)return n;var s=I.NumberToInt(e);return D.EnforceBoundaries(s,t,i)},D.EnforceBoundaries=function(e,t,i){return null!=i&&e>i?e=i:null!=t&&t>e&&(e=t),e},D.sanitizeSpecialIntegerValue=function(e){return-1==e||-2==e?e:e=D.Integer(e,0,null,-1)};var P=(e.StreamerError=function(){function e(e,t){i.errorCode=e,i.severity=t}var i=this;i.errorCode=null,i.severity=t.ErrorSeverity.FATAL,e.apply(i,arguments)},e.HttpClient=function(e,t,i,n){this._logger=e,this._logger.setModuleName("HttpClient"),this._httpInterface=t,this._callbackWithTimeout=i,this._systemSettings=n,this.request=function(e,t,i,n,s){var r=1e3*this._systemSettings.httpTimeout,a=this._callbackWithTimeout.getWrapperCallback(s,r,"HTTP timeout");this._logger.debug("request(): calling HttpInterface.makeRequest"),this._httpInterface.makeRequest(e,t,i,n,r,a)}}),R=e.Logger=function(e,t,i,n,s){this._loggingInterface=e,this._timeInterface=t,this._settings=i,this._logBuffer=n,this._packageName=s,this.debug=function(e){this.log(e,r.LogLevel.DEBUG)},this.info=function(e){this.log(e,r.LogLevel.INFO)},this.warning=function(e){this.log(e,r.LogLevel.WARNING)},this.error=function(e){this.log(e,r.LogLevel.ERROR)},this.log=function(e,t){var i=this.formatMessage(e,t);this._logBuffer.add(i),this._settings.logLevel<=t&&this._loggingInterface.consoleLog(i,t)},this.prependModuleName=function(e){var t=e;return t="["+this._moduleName+"] "+t},this.prependPackageName=function(e){var t=e;return t="["+this._packageName+"] "+t},this.prependConvivaNamespace=function(e){var t=e;return t="[Conviva] "+t},this.prependTime=function(e){return"["+(this._timeInterface.getEpochTimeMs()/1e3).toFixed(3).toString()+"] "+e},this.prependLogLevel=function(e,t){var i=R.getLogLevelString(t),n=e;return n="["+i+"] "+n},this.prependSessionId=function(e){var t=e;return null!=this._sessionId&&(t="sid="+this._sessionId+" "+t),t},this.setSessionId=function(e){this._sessionId=e},this.setModuleName=function(e){this._moduleName=e},this.formatMessage=function(e,t){return this.prependConvivaNamespace(this.prependTime(this.prependLogLevel(this.prependPackageName(this.prependModuleName(this.prependSessionId(e))),t)))}};R.getLogLevelString=function(e){var t;switch(e){case r.LogLevel.ERROR:t="ERROR";break;case r.LogLevel.WARNING:t="WARNING";break;case r.LogLevel.INFO:t="INFO";break;case r.LogLevel.DEBUG:t="DEBUG"}return t};var O=e.Storage=function(e,t,i,n){this._logger=e,this._logger.setModuleName("Storage"),this._storageInterface=t,this._callbackWithTimeout=i,this._systemSettings=n,this.load=function(e,t){var i=this._callbackWithTimeout.getWrapperCallback(t,1e3*this._systemSettings.storageTimeout,"storage load timeout");this._logger.debug("load(): calling StorageInterface.loadData"),this._storageInterface.loadData(O.STORAGE_SPACE,e,i)},this.save=function(e,t,i){var n=this._callbackWithTimeout.getWrapperCallback(i,1e3*this._systemSettings.storageTimeout,"storage save timeout");this._logger.debug("save(): calling StorageInterface.saveData"),this._storageInterface.saveData(O.STORAGE_SPACE,e,t,n)}};O.STORAGE_SPACE="Conviva";var N=e.SystemMetadata=function(e,i,n){this._logger=e,this._logger.setModuleName("SystemMetadata"),this._metadataInterface=i,this._exceptionCatcher=n,this._cachedMetadata=null,this.get=function(){return this._cachedMetadata||this.retrieve(),this._cachedMetadata},this.retrieve=function(){var e={};e[N.BROWSER_NAME]=this._metadataInterface.getBrowserName,e[N.BROWSER_VERSION]=this._metadataInterface.getBrowserVersion,e[N.DEVICE_BRAND]=this._metadataInterface.getDeviceBrand,e[N.DEVICE_MANUFACTURER]=this._metadataInterface.getDeviceManufacturer,e[N.DEVICE_MODEL]=this._metadataInterface.getDeviceModel,e[N.DEVICE_TYPE]=this._metadataInterface.getDeviceType,e[N.DEVICE_VERSION]=this._metadataInterface.getDeviceVersion,e[N.FRAMEWORK_NAME]=this._metadataInterface.getFrameworkName,e[N.FRAMEWORK_VERSION]=this._metadataInterface.getFrameworkVersion,e[N.OPERATING_SYSTEM_NAME]=this._metadataInterface.getOperatingSystemName,e[N.OPERATING_SYSTEM_VERSION]=this._metadataInterface.getOperatingSystemVersion;var i=this;this._logger.debug("retrieve(): calling MetadataInterface methods");for(var n in e)(function(e,t){i._exceptionCatcher.runProtected("Session.getSystemMetadataSchema(): "+e,function(){var n=t[e];t[e]=n.call(i._metadataInterface)})})(n,e),I.isValidString(e[n])||delete e[n];e[N.DEVICE_TYPE]!==t.DeviceType.DESKTOP&&e[N.DEVICE_TYPE]!==t.DeviceType.CONSOLE&&e[N.DEVICE_TYPE]!==t.DeviceType.SETTOP&&e[N.DEVICE_TYPE]!==t.DeviceType.MOBILE&&e[N.DEVICE_TYPE]!==t.DeviceType.TABLET&&e[N.DEVICE_TYPE]!==t.DeviceType.SMARTTV&&delete e[N.DEVICE_TYPE],this._cachedMetadata=I.ObjectShallowCopyOmitNull(e)}};N.BROWSER_NAME="browserName",N.BROWSER_VERSION="browserVersion",N.DEVICE_BRAND="deviceBrand",N.DEVICE_MANUFACTURER="deviceManufacturer",N.DEVICE_MODEL="deviceModel",N.DEVICE_TYPE="deviceType",N.DEVICE_VERSION="deviceVersion",N.FRAMEWORK_NAME="frameworkName",N.FRAMEWORK_VERSION="frameworkVersion",N.OPERATING_SYSTEM_NAME="operatingSystemName",N.OPERATING_SYSTEM_VERSION="operatingSystemVersion";var M=e.Time=function(e,t){this._timeInterface=e,this._logger=t,this._logger.setModuleName("Time"),this.current=function(){var e=this._timeInterface.getEpochTimeMs();return I.isInteger(e)||this._logger.error("current(): TimeInterface.getEpochTimeMs() did not return an integer ("+e+")"),e}},B=e.Timer=function(e,t,i){var n=this;this._logger=e,this._logger.setModuleName("Timer"),this._timerInterface=t,this._exceptionCatcher=i,this.create=function(e,t,i){var s=function(){n._exceptionCatcher.runProtected(i,function(){e()})};return this.createTimer(s,t,i)},this.createOnce=function(e,t,i){var s={cancel:null},r=function(){n._exceptionCatcher.runProtected(i,function(){s&&"function"==typeof s.cancel&&(s.cancel(),s.cancel=null,s=null),e()})},a=this.createTimer(r,t,i);return s.cancel=a,a},this.createTimer=function(e,t,i){return this._logger.debug("createTimer(): calling TimerInterface.create"),this._timerInterface.createTimer(e,t,i)}}}(),Conviva.Client=e.Client,Conviva.ContentMetadata=e.ContentMetadata,Conviva.PlayerStateManager=e.PlayerStateManager,Conviva.SystemSettings=e.SystemSettings,Conviva.ClientSettings=e.ClientSettings,Conviva.SystemInterface=e.SystemInterface,Conviva.HttpInterface=e.HttpInterface,Conviva.TimeInterface=e.TimeInterface,Conviva.TimerInterface=e.TimerInterface,Conviva.LoggingInterface=e.LoggingInterface,Conviva.MetadataInterface=e.MetadataInterface,Conviva.StorageInterface=e.StorageInterface,Conviva.SystemFactory=e.SystemFactory}})(),define("lib/conviva-core-sdk.min",function(){}),define("analytics/conviva/PlayerInterface",["xdk-base/class","xdk-base/device/Media","xdk-base/util","xdk-base/device"],function(e,t,i,n){"use strict";var s=t.singleton();return e.create({},{_playerStateManager:null,_pollInterval:null,_playerStateCue:[],_stateLimit:3,_seeking:!1,init:function(e){var t=this._getPlayerVersion();this._playerStateManager=e,this._onStateChange=i.bind(this._onStateChange,this),this._onError=i.bind(this._onError,this),s.addEventListener(s.EVT_STATE_CHANGED,this._onStateChange),s.addEventListener(s.EVT_ERROR,this._onError),this._playerStateManager.setPlayerType(n.platform),this._playerStateManager.setPlayerVersion(t),this._onStateChange(s.getState()),this._startPoll()},deinit:function(){this._stopPoll(),this._playerStateManager=null,s.removeEventListener(s.EVT_STATE_CHANGED,this._onStateChange),s.removeEventListener(s.EVT_ERROR,this._onError)},getPlayerStateManager:function(){return this._playerStateManager},_pollValues:["duration","bitrate"],_currentBitrate:null,_currentDuration:null,_poll:function(){var e,t;if(!this._pollValues.length)return this._stopPoll();for(e=this._pollValues.length-1;e>=0;e--)switch(this._pollValues[e]){case"duration":t=s.getDuration(),t&&this._currentDuration===t&&(this._pollValues.splice(e,1),this._playerStateManager.setDuration(t)),this._currentDuration=t;break;case"bitrate":"lg"!==n.platform&&(t=s.getBitrates())&&t.currentBitrate&&t.currentBitrate!==this._currentBitrate&&(t.currentBitrate>1e5&&(t.currentBitrate=t.currentBitrate/1e3),this._currentBitrate=t.currentBitrate,this._playerStateManager.setBitrateKbps(t.currentBitrate))}},_startPoll:function(){clearInterval(this._pollInterval),this._pollInterval=setInterval(i.bind(this._poll,this),1e3)},_stopPoll:function(){clearInterval(this._pollInterval)},_onError:function(e){console.log("[Conviva:PlayerInterface] - _onError",e),this._playerStateManager.sendError(e.errorMessage||e.errorCode,Conviva.Client.ErrorSeverity.FATAL)},_populateCue:function(e){this._playerStateCue.push(e),this._playerStateCue.length>this._stateLimit&&this._playerStateCue.shift()},_shouldBufferingBeTracked:function(){var e=!0;return i.each(this._playerStateCue,i.bind(function(t){switch(t){case s.SKIPPING:case s.CONNECTING:e=!1}},this)),e},_onStateChange:function(e){switch(e.toState){case s.SKIPPING:case s.CONNECTING:break;case s.BUFFERING:this._playerStateManager.setPlayerState(Conviva.PlayerStateManager.PlayerState.BUFFERING);break;case s.STOPPED:this._playerStateManager.setPlayerState(Conviva.PlayerStateManager.PlayerState.STOPPED);break;case s.PAUSED:this._playerStateManager.setPlayerState(Conviva.PlayerStateManager.PlayerState.PAUSED);break;case s.PAUSED:this._reportSeekEnd(),this._playerStateManager.setPlayerState(Conviva.PlayerStateManager.PlayerState.PAUSED);break;case s.PLAYING:this._reportSeekEnd(),this._playerStateManager.setPlayerState(Conviva.PlayerStateManager.PlayerState.PLAYING)}},_getPlayerVersion:function(){switch(n.platform){case"playstation":if(window.WM_devSettings&&window.WM_devSettings.version)return window.WM_devSettings.version}return!1},_reportSeekEnd:function(){this._seeking&&(this._seeking=!1,this._playerStateManager.setPlayerSeekEnd())},reportSeek:function(e){this._seeking=!0,this._playerStateManager.setPlayerSeekStart(e)},reportError:function(e){this._onError({message:e})}})}),define("analytics/conviva/system/Time",[],function(){"use strict";return function(){function e(){}e.apply(this,arguments),this.getEpochTimeMs=function(){return(new Date).getTime()},this.release=function(){}}}),define("analytics/conviva/system/Timer",[],function(){"use strict";return function(){function e(){}e.apply(this,arguments),this.createTimer=function(e,t,i){var n=setInterval(e,t);return function(){-1!==n&&(clearInterval(n),n=-1)}},this.release=function(){}}}),define("analytics/conviva/system/Http",[],function(){"use strict";return function(){function e(){}e.apply(this,arguments),this.makeRequest=function(e,t,i,n,s,r){return this.makeRequestStandard.apply(this,arguments)},this.makeRequestStandard=function(e,t,i,n,s,r){var a=new XMLHttpRequest;return a.open(e,t,!0),n&&a.overrideMimeType&&(a.overrideMimeType=n),n&&a.setRequestHeader&&a.setRequestHeader("Content-Type",n),s>0&&(a.timeout=s,a.ontimeout=function(){a.ontimeout=a.onreadystatechange=null,r&&r(!1,"timeout after "+s+" ms")}),a.onreadystatechange=function(){4===a.readyState&&(a.ontimeout=a.onreadystatechange=null,200===a.status?r&&r(!0,a.responseText):r&&r(!1,"http status "+a.status))},a.send(i),null},this.release=function(){}}}),define("analytics/conviva/system/CStorage",["xdk-base/device"],function(e){"use strict";return function(){function t(){}t.apply(this,arguments),this.saveData=function(t,i,n,s){var r=t+"."+i;try{e.storage.set(r,n),s(!0,null)}catch(e){s(!1,e.toString())}},this.loadData=function(t,i,n){var s,r=t+"."+i;try{s=e.storage.get(r),n(!0,s)}catch(e){n(!1,e.toString())}},this.release=function(){}}}),define("analytics/conviva/system/Metadata",["xdk-base/core","xdk-base/device","xdk-base/device/interface/Id","xdk-base/util"],function(e,t,i,n){"use strict";return function(){function s(){}s.apply(this,arguments),this.getBrowserName=function(){return"Non-Browser Apps"},this.getBrowserVersion=function(){return null},this.getDeviceBrand=function(){return null},this.getDeviceManufacturer=function(){switch(t.platform){case"playstation":return"Sony";case"samsung":case"tizen":return"Samsung";case"lg":case"webos":return"Lg"}return t.platform},this.getDeviceModel=function(){return n.isFunction(t.id.getModel)?t.id.getModel():null},this.getDeviceType=function(){if(n.isFunction(t.id.getHardwareType)){switch(t.id.getHardwareType()){case i.HARDWARE_TYPE.WORKSTATION:return Conviva.Client.DeviceType.DESKTOP;case i.HARDWARE_TYPE.STB:return Conviva.Client.DeviceType.SETTOP;case i.HARDWARE_TYPE.CONSOLE:case i.HARDWARE_TYPE.CONSOLE_MONITOR:return Conviva.Client.DeviceType.CONSOLE;case i.HARDWARE_TYPE.TV:case i.HARDWARE_TYPE.MONITOR:return Conviva.Client.DeviceType.SMARTTV;case i.HARDWARE_TYPE.BD:case i.HARDWARE_TYPE.HOME_THEATRE:return Conviva.Client.DeviceType.UNKNOWN}}return null},this.getDeviceVersion=function(){var e=t.id.getFirmware();return"playstation"===t.platform&&"dummyFirmware"===e&&(e=null),e||null},this.getFrameworkName=function(){return"XDK"},this.getFrameworkVersion=function(){return e.version},this.getOperatingSystemName=function(){switch(t.platform){case"tizen":return"TIZEN";case"webos":return"WEBOS";case"playstation":return"PLAYSTATION";case"samsung":return"SAMSUNG";case"lg":return"NETCAST"}return null},this.getOperatingSystemVersion=function(){return null},this.release=function(){}}}),define("analytics/conviva/system/Logging",["xdk-base/console"],function(e){"use strict";return function(){function t(){}t.apply(this,arguments),this.consoleLog=function(t,i){void 0!==e&&(e.log&&i===Conviva.SystemSettings.LogLevel.DEBUG||i===Conviva.SystemSettings.LogLevel.INFO?e.log(t):e.warn&&i===Conviva.SystemSettings.LogLevel.WARNING?e.warn(t):e.error&&i===Conviva.SystemSettings.LogLevel.ERROR&&e.error(t))},this.release=function(){}}}),define("storm/ConvivaHelper",["lib/conviva-core-sdk.min","xdk-base/class","xdk-base/config","xdk-base/console","xdk-base/device","analytics/conviva/PlayerInterface","analytics/conviva/system/Time","analytics/conviva/system/Timer","analytics/conviva/system/Http","analytics/conviva/system/CStorage","analytics/conviva/system/Metadata","analytics/conviva/system/Logging"],function(e,t,i,n,s,r,a,o,l,c,d,u){"use strict";return t.create({},{_debug:!1,_convivaAvailable:void 0!==Conviva&&Conviva!=={},_convivaKey:null,_gatewayUrl:null,_client:null,_system:null,_playerInterface:null,_currentSession:null,_currentAd:{position:1},_adPodEndEvent:null,_applicationName:null,_analyticsConfigs:null,_convivaConfigs:{},init:function(e){return this._convivaAvailable?(e=e||{},this._analyticsConfigs=i.get("analytics.config",{}),this._analyticsConfigs.conviva?(this._convivaConfigs=this._analyticsConfigs.conviva,this._convivaAvailable=this._convivaAvailable&&this._convivaConfigs.include,this._env=this._convivaConfigs.env):this._convivaAvailable=!1,this._convivaAvailable?(this._currentSession=Conviva.Client.NO_SESSION_KEY,this._convivaKey=e.convivaKey||this._convivaConfigs.convivaKey[this._env],this._gatewayUrl=e.gatewayUrl||this._convivaConfigs.gatewayUrl,this._convivaKey?(this._debug=e.debug||i.get("analytics.debug",!1),this._applicationName=e.applicationName||this._getApplicationName(),this._initializeSystem(),this._initializeClient(),void n.log("[ConvivaHelper:init()] Initialized.")):void n.error('[ConvivaHelper:init()] "conviva.key" not set in appgrid')):void n.error("[ConvivaHelper:init()] 2: Conviva object undefined. Can't initialize.")):void n.error("[ConvivaHelper:init()] 1: Conviva object undefined. Can't initialize.")},deinit:function(){this._client&&this._client.release(),this._system&&this._system.release()},createSession:function(e,t){if(n.log("[ConvivaHelper:createSession()] Initialized."),this._convivaAvailable&&this._client){this._currentSession&&this.cleanupSession(this._currentSession);var i=this._buildMetadata(e,t),s=this._client.getPlayerStateManager();this._playerInterface=new r(s),this._currentSession=this._client.createSession(i),this._client.attachPlayer(this._currentSession,this._playerInterface.getPlayerStateManager())}},cleanupSession:function(){n.log("[ConvivaHelper:cleanupSession()] Doing cleanup session."),this._currentAd={position:1},this._adPodEndEvent=clearTimeout(this._adPodEndEvent),this._convivaAvailable&&this._client&&(this._playerInterface&&(this._client.releasePlayerStateManager(this._playerInterface.getPlayerStateManager()),this._playerInterface.deinit(),this._playerInterface=null),this._currentSession!==Conviva.Client.NO_SESSION_KEY&&(this._client.detachPlayer(this._currentSession),this._client.cleanupSession(this._currentSession),this._currentSession=Conviva.Client.NO_SESSION_KEY))},reportSeek:function(e){this._convivaAvailable&&this._playerInterface?this._playerInterface.reportSeek(Math.floor(e)):n.warn("[Conviva:reportSeek()] Conviva not supported")},reportError:function(e){this._convivaAvailable&&this._playerInterface?this._playerInterface.reportError(e):n.warn("[Conviva:reportError()] Conviva not supported")},adPodBreak:function(e){return this._convivaAvailable&&this._client?e&&e!=={}?(this._currentAd=Object.assign(this._currentAd,e),this._client.sendCustomEvent(this._currentSession,(e.isEnd,"End"),{name:e.isEnd?"Conviva.PodEnd":"Conviva.PodStart",attr:{podDuration:this._currentAd.duration.toString(),podPosition:this._currentAd.type,podIndex:this._currentAd.position.toString(),absoluteIndex:this._currentAd.index.toString()}}),void(isNaN(this._currentAd.duration)||(this._adPodEndEvent=setTimeout(util.bind(function(){this.adPodBreak({isEnd:!0}),this._currentAd.position++},this),this._currentAd.duration)))):void n.log("[ConvivaHelper] Ad information is required"):void n.log("[ConvivaHelper] No available conviva client found")},_buildMetadata:function(e,t){n.log("[ConvivaHelper:_buildMetadata()]"),n.log(JSON.stringify(e)),n.log(JSON.stringify(t));var i=new Conviva.ContentMetadata;return i.assetName=e.title,i.streamUrl=e.url,i.streamType=e.streamType,i.viewerId=e.viewerId,i.applicationName=this._applicationName,i.custom=t,i},_extractCDNName:function(e){var t={akamai:"AKAMAI",amazon:"AMAZON",att:"ATT",bitgravity:"BITGRAVITY",bt:"BT",cdnnetworks:"CDNETWORKS",chinacache:"CHINACACHE",edgecast:"EDGECAST",highwinds:"HIGHWINDS",internap:"INTERNAP",level3:"LEVEL3",limelight:"LIMELIGHT",octoshape:"OCTOSHAPE",swarmcast:"SWARMCAST",velocix:"VELOCIX",telefonica:"TELEFONICA",microsoft:"MICROSOFT",cdnvideo:"CDNVIDEO",qbrick:"QBRICK",ngenix:"NGENIX",iponly:"IPONLY",talktalk:"TALKTALK",comcast:"COMCAST",nice:"NICE",telenor:"TELENOR",fastly:"FASTLY",telia:"TELIA",chinanetcenter:"CHINANETCENTER",mirrorimage:"MIRRORIMAGE"};for(var i in t)if(-1!==e.indexOf(i))return t[i];return"OTHER"},_initializeSystem:function(){n.log("[ConvivaHelper:_initializeSystem()]");var e=new Conviva.SystemInterface(new a,new o,new l,new c,new d,new u),t=this._setupSystemSettings();this._system=new Conviva.SystemFactory(e,t)},_initializeClient:function(){n.log("[ConvivaHelper:_initializeClient()] Key: "+this._convivaKey);var e=this._setupClientSettings(this._convivaKey);this._client=new Conviva.Client(e,this._system)},_setupClientSettings:function(e){n.log("[ConvivaHelper:_setupClientSettings()] GetwayURL: "+this._gatewayUrl);var t=new Conviva.ClientSettings(e);return this._gatewayUrl&&"test"===this._env&&(t.heartbeatInterval=5,t.gatewayUrl=this._gatewayUrl),t},_setupSystemSettings:function(){n.log("[ConvivaHelper:_setupSystemSettings()]");var e=new Conviva.SystemSettings;return this._debug&&(e.logLevel=Conviva.SystemSettings.LogLevel.DEBUG,e.allowUncaughtExceptions=!0),e},_getApplicationName:function(){n.log("[ConvivaHelper:_getApplicationName()]");var e="sky_ticket_";switch(s.platform){case"playstation":"PS4"===s.id.getModel()?e+="playstation4":e+="playstation3";break;case"tizen":e+="samsungtizen";break;case"samsung":e+="samsungorsay";break;case"webos":case"lg":e+="lgsmarttv";break;default:n.warn("[PlayerHandler:init()] Correct Application Name for Conviva not available"),e+="TEST"}return e}})}),define("tvedemo/tmpl/devices",["xdk-ui-basic/Layout","xdk-ui-basic/Label","xdk-ax/Container","xdk-ui-basic/Button","storm/mgr/sLanguageManager","storm/helper/util"],function(e,t,i,n,s,r){"use strict";return function(a){return{klass:e,id:"#deviceView",css:"subcontrollerPage",width:1,alignment:e.VERTICAL,children:[{klass:i,children:[{klass:t,css:"storm-page-title",text:s.getString("Settings.Settings_Devices_Headline")},{klass:i,id:"deviceContainer",children:[{klass:t,css:"storm-label",text:s.getString("Settings.Settings_devices_maxnumber")},{klass:e,alignment:e.HORIZONTAL,children:[{klass:t,css:"storm-label",text:s.getString("Settings.Settings_devices_freeslots")},{klass:t,css:"storm-label devices-left",id:"freeDevicesLeft"}]},{klass:t,css:"storm-label",id:"deviceStatus"},{klass:i,id:"devicesList",css:"device-list",children:r.repeater(function(){return{klass:e,width:2,alignment:e.HORIZONTAL,children:[{klass:t,css:"storm-label device-item"},{klass:t,css:"storm-label"}]}},a.rows)},{klass:n,id:"resetDeviceList",css:"storm-button disabled",text:s.getString("Settings.Settings_devicesResetButton")},{klass:t,css:"storm-label small",text:s.getString("Settings.Settings_devicesResetMessage")},{klass:t,css:"storm-label small",id:"nextResetDate"}]}]}]}}}),define("tvedemo/ctrl/Devices",["xdk-base/ax","xdk-base/device","tvedemo/ctrl/RoutableController","xdk-ax/mvc/view","tvedemo/tmpl/devices","tvedemo/mgr/sEndUserManager","tve/sServiceHolder","xdk-base/util","xdk-ax/evt/type","xdk-ax/focusManager","storm/mgr/sLanguageManager","storm/helper/silkResponseHelper","storm/helper/util","tvedemo/helper/dialogHelper","tvedemo/mgr/sHistoryManager","tvedemo/helper/sMoment"],function(e,t,i,n,s,r,a,o,l,c,d,u,h,_,g,f){return e.klass.create(i,{getDefaultState:function(){return{__forceReload:!0}}},{MAX_DEVICES:4,DATE_FORMAT_SRC:d.getString("ui.parsing.deviceDate"),DATE_FORMAT_DST:d.getString("ui.format.deviceDate"),_formatDate:function(e){return h.transcodeDateString(e,this.DATE_FORMAT_SRC,this.DATE_FORMAT_DST)},init:function(){this.setView(n.render(s,{rows:this.MAX_DEVICES}))},setup:function(e){var t=this.getView();if(!0===e.historyBack&&!r.getLoginStatus())return void g.back();this._freeDevicesLeft=t.find("freeDevicesLeft"),this._deviceStatus=t.find("deviceStatus"),this._deviceList=t.find("devicesList"),this._nextResetDate=t.find("nextResetDate"),this._resetListBtn=t.find("resetDeviceList"),this._resetListBtn.disable(),this._resetClickHandlerRef=o.bind(this._resetClickHandler,this),this._resetListBtn.addEventListener(l.CLICK,this._resetClickHandlerRef),e.setupPending=this._getDeviceDetailsPromise().then(o.bind(function(){r.getLoginStatus()&&(t.setOption("focusable",this._resetListBtn.isDisabled()),c.focus(t))},this))},_getDeviceDetailsPromise:function(){return r.getDeviceDetails().then(o.bind(function(e){this._freeDevicesLeft.setText(e.get("freeSlots")),this._nextResetDate.setText(d.getString("Settings.Settings_devicesNextDate")+": "+this._formatDate(e.get("resetNextDay")));for(var i,n,s=e.get("deviceList")||[],r=this._deviceList.getChildren(),l=t.id.getUniqueID(),c=0;c<r.length;c++)n=r[c].getChildren(),c<s.length?(n[0].addClass("highlighted"),n[0].setText(s[c].get("platform")),n[1].setText(this._formatDate(s[c].get("activationDate"))),i=i||s[c].get("id")===l):(n[0].removeClass("highlighted"),n[0].setText(d.getString("Settings.Settings_labelDeviceManagement_Missing_device"+(c+1))),n[1].setText("-"));return this._deviceStatus.setText(i?d.getString("Settings.Settings_devicesThisDeviceIsRegistered"):d.getString("Settings.Settings_devicesThisDeviceIsNotRegistered")),a.getDateTimeService().getServerDateTime().then(o.bind(function(t){f(t).diff(f(e.get("resetNextDay"),this.DATE_FORMAT_SRC),"hours")>=0&&s.length?this._resetListBtn.enable():this._resetListBtn.disable()},this))},this),_.fromSilkMessagePromise)},_resetClickHandler:function(){r.resetDeviceList().then(o.bind(function(){this._getDeviceDetailsPromise()},this),_.fromSilkMessagePromise)},reset:function(){this._resetListBtn&&this._resetListBtn.removeEventListener(l.CLICK,this._resetClickHandlerRef)}})}),define("xdk-ui-grid/gridStgy",["xdk-base/console","xdk-ax/Component","xdk-ax/Container","xdk-base/device/vKey","xdk-base/util","xdk-base/promise"],function(e,t,i,n,s,r){"use strict";var a=function(e,t){return 0===t?NaN:(e%t+t)%t},o={};return o.BASIC_PREREADY_STGY=function(e){e.selectedDsIndex=0,e.selectedGridRow=0},o.BASIC_CHECK_SCROLLABLE_STGY=function(e,t){var i=e.ds.getTotalCount();return!(t.firstSlotDsIndex<-e.cols||t.firstSlotDsIndex>=i+e.cols)&&(t.selectedDsIndex>=i&&(t.selectedDsIndex=i-1,t.selectedGridCol=(i-1)%e.cols),!0)},o.BASIC_CHECK_SELECTABLE_STGY=function(e,t){
var i,n,s=t.selectedDsIndex,r=e.ds.getTotalCount();return!(s<0)&&(-2===r||(s<r||(i=Math.floor(s/e.cols),n=Math.floor((r-1)/e.cols),i<=n&&(t.selectedDsIndex=r-1,t.selectedGridCol=a(r-1,this._cols),!0))))},o.BASIC_DATA_MAPPING_STGY=function(e,t,i,n,s){return s<0||s>=e.ds.getTotalCount()?null:t[i*e.cols+n]},o.BASIC_SCROLL_ENTRANCE_STGY=function(e,n,s,r,a){var o,l,c,d,u,h,_,g=a.gridComponents.slice(a.newRowsStart,a.newRowsStart+a.newRowsCount),f=a.newRowsCount,p=n.getChildren();if(p.length>0)if(s>p.length||-s>p.length)for(o=0;o<p.length&&p[o];o++)p[o].deinit();else if(s>0)for(o=0;o<s&&p[o];o++)p[o].deinit();else for(_=p.length,o=_+s;o<_&&p[o];o++)p[o].deinit();for(p=n.getChildren(),o=0;o<f;o++){for(d=[],l=0;l<r.cols&&(g[o]&&g[o][l]&&g[o][l].getRoot());l++)d.push(g[o][l]);c=new i({css:e?"wgt-grid-row-v":"wgt-grid-row-h",children:d}),p.length>0&&s<0&&r.gridComponents&&r.gridComponents[0]?(u=t.PLACE_BEFORE,h=r.gridComponents[0][0].getParent()):(u=t.PLACE_APPEND,h=null),n.attach(c,u,h)}},o.BASIC_SCROLL_SHIFT_STGY=function(t,i,n,s){var a="grid shifting...... do nothing for basic grid.";return e.info(a),r.resolve(a)},o.BASIC_SCROLL_EXIT_STGY=function(t,i,n,s){var a="grid exiting shift, remove items is already done in entrance function...... do nothing for basic grid.";return e.info(a),r.resolve(a)},o.BASIC_HORIZONTAL_KEY_NAVIGATION_STGY=function(e,t){switch(e){case n.UP.id:return{rowChange:-1};case n.DOWN.id:return{rowChange:1};case n.LEFT.id:return{colChange:-1};case n.RIGHT.id:return{colChange:1};default:return}},o.BASIC_VERTICAL_KEY_NAVIGATION_STGY=function(e,t){switch(e){case n.UP.id:return{colChange:-1};case n.DOWN.id:return{colChange:1};case n.LEFT.id:return{rowChange:-1};case n.RIGHT.id:return{rowChange:1};default:return}},o.BASIC_ONUPDATE_STGY=function(e,t,i){if("reset"===e.action)return!0;var n,s,r=i.getTotalCount(),o=e.index,l=o+e.length,c=t.firstSlotDsIndex,d=t.firstSlotDsIndex+t.rows*t.cols-1;if(d<0&&c>=-r&&a(c,r)>=l)return!1;if(c>0&&d<r&&d<o)return!1;if("fetch"===e.action&&(l<c||o>d))return!1;for(;r<=t.selectedDsIndex;)t.selectedDsIndex--;return n=Math.floor((r-1)/t.cols),s=Math.floor(r-c)/t.cols,"remove"===e.action&&n>=t.rows-1&&t.selectedGridRow<t.rows-1&&s<=t.rows-1&&(t.selectedDsIndex=t.selectedDsIndex-t.cols),t.selectedGridRow>n&&n<t.rows&&(t.selectedGridRow=n),!0},o.BASIC_DS_RANGE_CALCULATION_STGY=function(e,t,i){var n={},s=a(e,i.cols),r=i.ds.getTotalCount();return n.from=e-t*i.cols-s,n.to=n.from+i.rows*i.cols,-1===r?(n.actualFrom=n.from,n.actualTo=n.to,n):(n.actualFrom=a(n.from,r),n.actualTo=a(n.actualFrom+i.rows*i.cols,r),n)},o}),define("xdk-ui-grid/Grid",["xdk-base/class","xdk-ax/Container","xdk-ui-basic/AbstractScrollable","xdk-base/console","xdk-ax/data/Datasource","xdk-ax/evt/type","xdk-base/device/vKey","xdk-base/util","xdk-base/core","xdk-ax/focusManager","xdk-base/promise","xdk-ui-grid/gridStgy"],function(e,t,i,n,s,r,a,o,l,c,d,u){"use strict";var h=function(e,t){return 0===t?NaN:(e%t+t)%t},_=function(){throw l.createException("IncorrectState",'This Grid"s strategy has not been specified yet!')},g=function(e){n.info(e)},f=function(e){throw n.info(e),e},p=function(e){return n.info(e),d.resolve(e)},m=function(e){return n.info(e),d.reject(e)};return e.create(i,{VERTICAL:1,HORIZONTAL:2,SCROLL_BASE_ON_ITEM:1,SCROLL_BASE_ON_ROW:2,SCROLL_BASE_ON_PAGE:3},{_ready:!1,_cols:5,_rows:5,_scrollbarBehavior:3,_selectedDsIndex:0,_selectedGridRow:0,_selectedGridCol:0,_firstSlotDsIndex:0,_lastSlotDsIndex:0,_data:null,_ds:null,_gridComponents:null,_container:null,_prereadyStgy:_,_checkScrollableStgy:_,_checkSelectableStgy:_,_dataMappingStgy:_,_displayStgy:_,_scrollEntranceStgy:_,_scrollShiftStgy:_,_scrollExitStgy:_,_keyNavigationStgy:_,_onUpdateStgy:_,_dsRangeCalculationStgy:_,setPrereadyStgy:function(e){this._prereadyStgy=e},setCheckScrollableStgy:function(e){this._checkScrollableStgy=e},setCheckSelectableStgy:function(e){this._checkSelectableStgy=e},setDataMappingStgy:function(e){this._dataMappingStgy=e},setDisplayStgy:function(e){this._displayStgy=e},setScrollEntranceStgy:function(e){this._scrollEntranceStgy=e},setScrollShiftStgy:function(e){this._scrollShiftStgy=e},setScrollExitStgy:function(e){this._scrollExitStgy=e},setKeyNavigationStgy:function(e){this._keyNavigationStgy=e},setOnUpdateStgy:function(e){this._onUpdateStgy=e},setDsRangeCalculationStgy:function(e){this._dsRangeCalculationStgy=e},init:function(e){e=e||{},e.rows&&(this._rows=e.rows),e.cols&&(this._cols=e.cols),e.scrollbarBehavior&&(this._scrollbarBehavior=e.scrollbarBehavior),this._super(e),this._root.addClass("wgt-grid"),this._container=new t({css:"wgt-grid-scroll",parent:this}),this.addEventListener(r.KEY,this._keyHandler),this.addEventListener(r.FOCUS,o.bind(this._onFocusHandler,this)),this.setDsRangeCalculationStgy(u.BASIC_DS_RANGE_CALCULATION_STGY)},setDatasource:function(e){if(!(e instanceof s))return m("Cannot set an invalid datasource");if(this._ds===e)return m("Unable to set set the same datasource");this._ds&&this.__datasourceListener&&this._ds.removeEventListener(s.EVT_UPDATED,this.__datasourceListener),this.reset(),this._ready=!1,this._ds=e;var t,i;return i={selectedDsIndex:this._selectedDsIndex,selectedGridRow:this._selectedGridRow,cols:this._cols,rows:this._rows,ds:e},this._prereadyStgy(i),this._selectedDsIndex=i.selectedDsIndex,this._selectedGridRow=i.selectedGridRow,t=this._dsRangeCalculationStgy(this._selectedDsIndex,this._selectedGridRow,i),this._selectedGridCol=h(this._selectedDsIndex,this._cols),this._firstSlotDsIndex=t.from,this.__datasourceListener||(this.__datasourceListener=o.bind(this._onDatasourceUpdated,this)),this._ds.addEventListener(s.EVT_UPDATED,this.__datasourceListener),this.__validateDs(t.actualFrom,t.actualTo).then(o.bind(this.select,this,this._selectedDsIndex,this._selectedGridRow))},getDatasource:function(){return this._ds},getDatasouce:function(){return this.getDatasource()},scroll:function(e,t){if(!this._ready)return m("Grid is not ready yet");var i,n,s=e*this._cols,r=this._selectedGridRow-e,a=this._selectedDsIndex,o=this._firstSlotDsIndex+s,l=o+this._rows*this._cols-1;if(r<0?r=0:r>=this._rows&&(r=this._rows-1),a<o)do{a+=this._cols}while(a<o);else if(a>l)do{a-=this._cols}while(a>l);return n={selectedDsIndex:a,selectedGridRow:r,selectedGridCol:this._selectedGridCol,firstSlotDsIndex:o,lastSlotDsIndex:l},i={selectedDsIndex:this._selectedDsIndex,selectedGridRow:this._selectedGridRow,selectedGridCol:this._selectedGridCol,firstSlotDsIndex:this._firstSlotDsIndex,lastSlotDsIndex:this._firstSlotDsIndex+this._rows*this._cols-1,rows:this._rows,cols:this._cols,ds:this._ds},this._checkScrollableStgy(i,n)?this.select(n.selectedDsIndex,n.selectedGridRow,t).fail(f):m("Check scrollable strategy indicates scrolling bound has reached.")},select:function(e,t,i){this._ready=!1,i=i||{};var s,a,l,d,u,_,g,f,p={selectedDsIndex:this._selectedDsIndex,selectedGridRow:this._selectedGridRow,selectedGridCol:this._selectedGridCol,firstSlotDsIndex:this._firstSlotDsIndex,lastSlotDsIndex:this._firstSlotDsIndex+this._rows*this._cols-1,data:this._data,gridComponents:this._gridComponents,ds:this._ds,rows:this._rows,cols:this._cols},v=this._dsRangeCalculationStgy(this._selectedDsIndex,this._selectedGridRow,p),b={selectedDsIndex:e,selectedGridRow:t,selectedGridCol:h(e,this._cols),firstSlotDsIndex:-1,lastSlotDsIndex:-1,data:null,gridComponents:null},S=this,y=[],E=this._ds.getTotalCount();if(o.isNumber(t)||(t=e>=v.from&&e<v.to?this._selectedGridRow:e<v.from?0:this._rows-1,b.selectedGridRow=t),l=this._dsRangeCalculationStgy(e,t,p),b.firstSlotDsIndex=l.from,b.lastSlotDsIndex=l.to-1,s=this._checkSelectableStgy(p,b),i.forceRender&&!s)n.info("Grid: forced render.");else if(!s)return this._ready=!0,m("Putting item at datasource index "+e+", to row "+t+", is not posible.");return a=(b.firstSlotDsIndex-p.firstSlotDsIndex)/this._cols,_=function(){n.info("Grid: updating selection...");var e=b.gridComponents,t=b.selectedGridRow,i=b.selectedGridCol;try{p.gridComponents[p.selectedGridRow][p.selectedGridCol].removeClass("wgt-grid-selected")}catch(e){}e[t][i].addClass("wgt-grid-selected"),S._ready=!0,c.isCompChildFocused(S)&&c.focus(e[t][i]),s?S.setOption("forwardFocus",e[t][i]):S.setOption("forwardFocus",void 0),S.dispatchEvent(r.SELECTION_CHANGED,b)},d=l.actualFrom,u=l.actualTo,f=o.wrap(m,function(e,t){return S._ready=!0,n.info("fail to selection changed"),S.dispatchEvent(r.SELECTION_CHANGED,b),e(t)}),g=function(e){return y=y.concat(e),b.data=y,S._scroll(y,a,p,b,i)},d>=u||this._rows*this._cols>E?this._ds.getRange(d,E).then(function(e){if(0===d)return e;if(p.rows*p.cols>E)u=d;else if(0===u)return e;return y=y.concat(e),S._ds.getRange(0,u)}).then(g).then(_).fail(f):this._ds.getRange(d,u).then(g).then(_).fail(f)},_scroll:function(e,t,i,n,s){var r,a,o,l,c,u=Math.min(Math.abs(t),this._rows),_=t>0?this._rows-u:0,g=this._ds.getTotalCount(),f=!i.gridComponents,m=[],v=i.gridComponents,b=this,S=h(n.selectedDsIndex,g);for(c=function(){b._selectedDsIndex=n.selectedDsIndex,b._selectedGridRow=n.selectedGridRow,b._selectedGridCol=n.selectedGridCol,b._firstSlotDsIndex=n.firstSlotDsIndex,b._lastSlotDsIndex=n.lastSlotDsIndex,b._data=n.data,b._gridComponents=n.gridComponents},f&&(u=this._rows,_=0,v=[]),r=_;r<_+u;r++)for(a=0;a<this._cols;a++)(l=this._dataMappingStgy(i,e,r,a,n.firstSlotDsIndex+r*this._cols+a))&&(o=this._displayStgy(l),o.getRoot().addClass("wgt-grid-item"),m[r-_]=m[r-_]||[],m[r-_].push(o));switch(v=0===_?m.concat(v).slice(0,this._rows):v.concat(m).slice(u,this._rows+u),n.newRowsStart=_,n.newRowsCount=u,n.gridComponents=v,this._scrollbarBehavior){case this.constructor.SCROLL_BASE_ON_ITEM:this.dispatchScrolledInfo(S,1,g);break;case this.constructor.SCROLL_BASE_ON_ROW:this.dispatchScrolledInfo(S-h(S,this._cols),this._cols,g);break;case this.constructor.SCROLL_BASE_ON_PAGE:this.dispatchScrolledInfo(h(n.firstSlotDsIndex,g),this._cols*this._rows,g)}return f||0!==t?d.when(this._scrollEntranceStgy(this._container,t,i,n),function(){return f?(c(),p("Currently initializing grid, no shift animation will be performed.")):!0===s.noAnimation?d.when(b._scrollExitStgy(b._container,t,i,n),function(){return c(),p("Animation is turned off, no shift animation will be performed.")}):b._scrollShiftStgy(b._container,t,i,n).then(function(){return b._scrollExitStgy(b._container,t,i,n),c(),!0})}):(c(),p("No scroll needed."))},reset:function(){this._gridComponents=null,o.each(this._container.getChildren(),function(e){e.detach()}),this.setOption("forwardFocus",void 0),this._selectedDsIndex=0,this._selectedGridRow=0,this._selectedGridCol=0,this._firstSlotDsIndex=0,this._lastSlotDsIndex=0,this._data=null},isReady:function(){return this._ready},_keyHandler:function(e){if(!this._ready)return!1;var t,i,n,s,r,l,u,h,_,f,p,m,v,b=e.id;switch(b){case a.UP.id:case a.DOWN.id:case a.LEFT.id:case a.RIGHT.id:t=c.directionalFocusChangeByKey(e,this);break;default:return!0}if(t)return!1;for(i=c.getCurFocus(),s=i,n=s.getParent();n&&n!==this&&!s.getRoot().hasClass("wgt-grid-item");)s=n,n=s.getParent();return!n||n===this||(f={selectedDsIndex:this._selectedDsIndex,selectedGridRow:this._selectedGridRow,selectedGridCol:this._selectedGridCol,firstSlotDsIndex:this._firstSlotDsIndex,lastSlotDsIndex:this._firstSlotDsIndex+this._rows*this._cols-1,data:this._data,gridComponents:this._gridComponents,ds:this._ds,rows:this._rows,cols:this._cols},_=this._keyNavigationStgy(e.id,f),_=o.extend({rowChange:0,colChange:0,scroll:0,forceRender:!1},_),l=this._selectedGridRow+_.rowChange,r=this._selectedGridCol+_.colChange,h=_.scroll,m=this._rows,v=h<0?this._cols:this._gridComponents[this._selectedGridRow].length<this._cols?this._gridComponents[this._selectedGridRow].length:this._cols,l<0?(l=0,h+=l):l>=m&&(h+=l-(m-1),l=m-1),r<0?r=0:r>=v&&(r=v-1),u=this._selectedDsIndex+_.rowChange*this._cols+_.scroll*this._cols+(r-this._selectedGridCol),this._selectedDsIndex===u&&this._selectedGridRow===l&&this._selectedGridCol===r||(p=this.select(u,l,{forceRender:_.forceRender}),p.fail(g).done(),d.isRejected(p)))},_onFocusHandler:function(e){if(this._ready){var t,i,n,s,a,o=0,l=0;if(e.target===this)return void c.focus(this._gridComponents[this._selectedGridRow][this._selectedGridCol]);for(t=this._gridComponents.length,o=0;o<t&&this._gridComponents[o];o++)for(n=this._gridComponents[o],i=n.length,l=0;l<i&&n[l];l++)if(s=this._gridComponents[o][l],c.isCompFocused(s)||c.isCompChildFocused(s)){if(this._gridComponents[this._selectedGridRow][this._selectedGridCol].removeClass("wgt-grid-selected"),s.addClass("wgt-grid-selected"),a=this._firstSlotDsIndex+o*this._cols+l,o===this._selectedGridRow&&l===this._selectedGridCol&&this._selectedDsIndex===a)return;return this._selectedGridRow=o,this._selectedGridCol=l,this._selectedDsIndex=a,this.setOption("forwardFocus",s),void this.dispatchEvent(r.SELECTION_CHANGED,{selectedDsIndex:this._selectedDsIndex,selectedGridRow:this._selectedGridRow,selectedGridCol:this._selectedGridCol,firstSlotDsIndex:this._firstSlotDsIndex,lastSlotDsIndex:this._lastSlotDsIndex,data:this._data,gridComponents:this._gridComponents})}}},_onDatasourceUpdated:function(e){if(n.info("Grid: datasource updated!"),!this._ready)return void n.info("Grid: not yet ready to react to datasource update!");var t,i,s,r,a,l=!0;t={selectedDsIndex:this._selectedDsIndex,selectedGridRow:this._selectedGridRow,selectedGridCol:this._selectedGridCol,firstSlotDsIndex:this._firstSlotDsIndex,cols:this._cols,rows:this._rows,ds:this._ds},(i=this._onUpdateStgy(e,t,this._ds))&&(s=t.selectedDsIndex,r=t.selectedGridRow,a=this._dsRangeCalculationStgy(s,r,t),this.reset(),"reset"===e.action&&(l=!1),this.__validateDs(a.actualFrom,a.actualTo).then(o.bind(this.select,this,s,r,{forceRender:l})).fail(function(){n.info("fail to update grid")}).done())},__validateDs:function(e,t){return-1===this._ds.getTotalCount()?this._ds.getRange(e,t).then(o.bind(function(){if(-1===this._ds.getTotalCount())return m("Unable to initialize the datasource, totalCount still equals -1")},this)):(0===this._ds.getTotalCount()&&n.warn("tried to set an datasource 0 total count, grid can will only be updated if it's notified by EVT_UPDATED from datasource with new total count"),d.resolve())},getSelectedDsIndex:function(){var e;return this._ds&&(e=this._ds.getTotalCount())>0?h(this._selectedDsIndex,e):-1},getSelectedComp:function(){return this._gridComponents[this._selectedGridRow][this._selectedGridCol]},getSelectedData:function(){var e=this.getDatasource(),t=this.getSelectedDsIndex();return e&&e.getFetchedData&&t>-1?e.getFetchedData(t):null},getSelectedPosition:function(){return{row:this._selectedGridRow,col:this._selectedGridCol}},getCompByCoor:function(e,t){if(!(e<0||t<0||e>=this._gridComponents.length||t>=this._gridComponents[e].length))return this._gridComponents[e][t]}})}),define("xdk-ui-grid/boundedGridStgy",["xdk-base/device/vKey","xdk-ui-grid/gridStgy"],function(e,t){"use strict";var i=function(e,t){return(e%t+t)%t},n={};return n.SCROLL_BOUNDARY_CHECK_SELECTABLE_STGY=function(e,t,n,s){var r,a,o=s.selectedDsIndex,l=s.selectedGridRow,c=n.ds.getTotalCount();return!(o<0)&&(r=Math.floor(o/n.cols),a=Math.floor((c-1)/n.cols),!((l<e||l>=n.rows-t)&&r>e&&r<a-t)&&(o<c||r<=a&&(s.selectedDsIndex=c-1,s.selectedGridCol=i(c-1,this._cols),!0)))},n.SCROLL_BOUNDARY_KEY_NAVIGATION_STGY=function(t,i,n,s,r){var a,o,l,c,d=r.selectedDsIndex,u=r.ds.getTotalCount(),h=r.selectedGridRow;if(t)switch(s){case e.UP.id:return{colChange:-1};case e.DOWN.id:return{colChange:1};case e.LEFT.id:a=-1;break;case e.RIGHT.id:a=1}else switch(s){case e.UP.id:a=-1;break;case e.DOWN.id:a=1;break;case e.LEFT.id:return{colChange:-1};case e.RIGHT.id:return{colChange:1}}return i<=0&&n<=0?{rowChange:a}:(o=h+a,c=Math.floor(d/r.cols)+a,l=Math.floor((u-1)/r.cols),o<i||o>=r.rows-n?c<i||c>l-n?{rowChange:a}:{scroll:a}:{rowChange:a})},n.ONUPDATE_STGY=function(e,i,n,s,r){var a=t.BASIC_ONUPDATE_STGY(n,s,r),o=r.getTotalCount(),l=s.firstSlotDsIndex;if(s.firstSlotDsIndex+s.rows*s.cols-1<o-1){var c=s.selectedGridRow-(s.rows-1-i);if(c>=0)return s.selectedDsIndex=s.selectedDsIndex-c*s.cols,s.selectedGridRow-=c,!0}if(0!==l){var d=e-s.selectedGridRow;if(d>=0)return s.selectedDsIndex=s.selectedDsIndex+d*s.cols,s.selectedGridRow+=d,!0}return a},n}),define("css!xdk-ui-grid/css/Grid",[],function(){}),define("xdk-ui-grid/BoundedGrid",["xdk-base/class","xdk-ui-grid/Grid","xdk-ui-grid/gridStgy","xdk-ui-grid/boundedGridStgy","xdk-base/util","css!./css/Grid"],function(e,t,i,n,s){"use strict";return e.create(t,{},{init:function(e){this._super(e);var r=e.alignment===t.VERTICAL,a=e.scrollFrontBoundary||0,o=e.scrollEndBoundary||0;this.setPrereadyStgy(i.BASIC_PREREADY_STGY),this.setCheckScrollableStgy(i.BASIC_CHECK_SCROLLABLE_STGY),this.setCheckSelectableStgy(s.bind(n.SCROLL_BOUNDARY_CHECK_SELECTABLE_STGY,this,a,o)),this.setDataMappingStgy(i.BASIC_DATA_MAPPING_STGY),this.setScrollEntranceStgy(s.bind(i.BASIC_SCROLL_ENTRANCE_STGY,this,r)),this.setScrollShiftStgy(i.BASIC_SCROLL_SHIFT_STGY),this.setScrollExitStgy(i.BASIC_SCROLL_EXIT_STGY),this.setOnUpdateStgy(s.bind(n.ONUPDATE_STGY,this,a,o)),this.setKeyNavigationStgy(s.bind(n.SCROLL_BOUNDARY_KEY_NAVIGATION_STGY,this,r,a,o)),this.setDsRangeCalculationStgy(i.BASIC_DS_RANGE_CALCULATION_STGY)}})}),define("css!tvedemo/wgt/css/BasicGrid",[],function(){}),define("tvedemo/wgt/BasicGrid",["xdk-base/class","xdk-ui-grid/BoundedGrid","xdk-ax/Container","xdk-ax/evt/type","xdk-ui-basic/Button","xdk-base/util","xdk-ax/Component","xdk-base/device/vKey","css!./css/BasicGrid"],function(e,t,i,n,s,r,a,o){"use strict";return e.create(t,{},{_arrows:[],_alignment:0,init:function(e){e=e||{};var i,n=e.alignment||t.VERTICAL,s=e.rows,a=e.cols;e.isPaginated=e.isPaginated||!1,e.isPaginated?this._alignment=t.HORIZONTAL:this._alignment=e.alignment=n,i=this._alignment===t.VERTICAL,e.rows=i?a||7:s||2,e.cols=i?s||2:a||7,e.forwardFocus=!0,this._super(e),e.isPaginated&&(this.setScrollEntranceStgy(r.bind(this.__scroll_entrance_stgy,this,i)),this.setKeyNavigationStgy(r.bind(this.__vertical_key_navigation_stgy,this,i))),this.addClass("wgt-basicgrid"),this._initArrows()},setDatasource:function(e){return this._super(e).then(r.bind(this._updateArrows,this))},getSelectionStates:function(){if(this.getDatasource()&&this.getDatasource().getTotalCount()){var e=Math.ceil(this.getDatasource().getTotalCount()/this._cols),i=this._cols,n=Math.floor(this._selectedDsIndex/i),s=this._selectedGridCol,r=this.getDatasource().getTotalCount(),a=this._rows*this._cols,o=Math.floor(this._selectedDsIndex/a)+1,l=Math.ceil(r/a),c=r-this._firstSlotDsIndex>a,d=0!==this._firstSlotDsIndex;if(this._alignment===t.VERTICAL){var u;u=e,e=i,i=u,u=n,n=s,s=u}return{selectedDsIndex:this._selectedDsIndex,isFirstRow:0===n,isLastRow:n===e-1,isFirstCol:0===s,isLastCol:s===i-1,row:n,col:s,pageSize:a,pageNumber:o,maxPage:l,canScrollForward:c,canScrollBackward:d}}},_initArrows:function(){this._alignment===t.VERTICAL||this.getOption("isPaginated")?(this._arrows[3]=new s({css:"wgt-grid-arrow"}).addClass("left"),this._arrows[1]=new s({css:"wgt-grid-arrow"}).addClass("right"),this.attach(this._arrows[3],i.PLACE_BEFORE,this._container),this.attach(this._arrows[1],i.PLACE_APPEND),this._arrows[3].hide(),this._arrows[1].hide()):(this._arrows[0]=new s({css:"wgt-grid-arrow"}).addClass("top"),this._arrows[2]=new s({css:"wgt-grid-arrow"}).addClass("bottom"),this.attach(this._arrows[0],i.PLACE_BEFORE,this._container),this.attach(this._arrows[2],i.PLACE_APPEND),this._arrows[0].hide(),this._arrows[2].hide()),this.addEventListener(n.FOCUS,this._updateArrows)},_updateArrows:function(){var e=this.getSelectionStates();this._alignment===t.VERTICAL||this.getOption("isPaginated")?(e&&e.canScrollBackward?this._arrows[3].show():this._arrows[3].hide(),e&&e.canScrollForward?this._arrows[1].show():this._arrows[1].hide()):(e&&e.canScrollBackward?this._arrows[0].show():this._arrows[0].hide(),e&&e.canScrollForward?this._arrows[2].show():this._arrows[2].hide())},__vertical_key_navigation_stgy:function(e,t,i){var n,s,r=i.selectedDsIndex,a=i.ds.getTotalCount(),l=i.selectedGridRow,c=i.selectedGridCol;if(s=Math.floor(r/i.cols),n=Math.floor((a-1)/i.cols),e)switch(t){case o.UP.id:return{colChange:-1};case o.DOWN.id:return{colChange:1};case o.LEFT.id:return{rowChange:-1};case o.RIGHT.id:return{rowChange:1}}else switch(t){case o.UP.id:if(l>0)return{rowChange:-1};break;case o.DOWN.id:if(l<i.rows-1)return{rowChange:1};break;case o.LEFT.id:if(c>0)return{colChange:-1};if(s-i.rows>=0)return{scroll:-i.rows,colChange:i.cols-1-c};if(s-(i.rows-l)>0)return{scroll:i.rows-l,colChange:i.cols-1-c};break;case o.RIGHT.id:if(c<i.cols-1)return{colChange:1};if(s+i.rows<=n)return{scroll:i.rows,colChange:0-c};if(s+(i.rows-l)<=n)return{scroll:i.rows,rowChange:0-l,colChange:0-c}}},__scroll_entrance_stgy:function(e,t,n,s,r){var o,l,c,d,u,h,_,g=r.gridComponents.slice(r.newRowsStart,r.newRowsStart+r.newRowsCount),f=r.newRowsCount,p=t.getChildren();if(p.length>0)if(n>0)for(o=0;o<n&&p[o];o++)p[o].deinit();else for(_=p.length,o=_+n;o<_&&p[o];o++)p[o].deinit();for(p=t.getChildren(),o=0;o<f;o++){for(d=[],l=0;l<s.cols&&(g[o]&&g[o][l]&&g[o][l].getRoot());l++)d.push(g[o][l]);c=new i({css:e?"wgt-grid-row-v":"wgt-grid-row-h",children:d}),p.length>0&&n<0&&s.gridComponents&&s.gridComponents[0]?(u=a.PLACE_BEFORE,h=s.gridComponents[0][0].getParent()):(u=a.PLACE_APPEND,h=null),t.attach(c,u,h)}}})}),define("tve/model/Resource",["xdk-base/class","tve/model/ImmutableModel"],function(e,t){return e.create(t,{defaults:{id:null,url:null,mimeType:null,metadata:{},duration:null,geoLock:null,width:null,height:null,parentalRating:null}},{})}),define("tvedemo/wgt/ChannelLogo",["xdk-base/class","xdk-ui-basic/Image","xdk-base/util"],function(e,t,i){"use strict";var n="img/placeholders/channel_placeholder.png";return e.create(t,{},{init:function(e){e.src=e.src||n,this._super(e),this.setErrorCallback(i.bind(function(){this.setSrc(n)},this))}})}),define("tve/model/Episode",["xdk-base/class","tve/model/Asset","xdk-base/util"],function(e,t,i){return e.create(t,{defaults:i.extend(i.clone(t.defaults),{tvSeasonId:null,tvShowId:null,episodeNumber:null,category:null},!0)},{})}),define("tve/model/TVChannel",["xdk-base/class","tve/model/Asset","xdk-base/util"],function(e,t,i){return e.create(t,{defaults:i.extend(i.clone(t.defaults),{channelNumber:null,mobilepc:null,packageCode:null},!0)},{})}),define("tve/model/AssetBuilder",["xdk-base/class","tve/model/Asset"],function(e,t){return e.create({},{_attrs:{},setId:function(e){return this._attrs.id=e,this},setTitle:function(e){return this._attrs.title=e,this},setDescription:function(e){return this._attrs.description=e,this},setGeoLock:function(e){return this._attrs.geoLock=e,this},setPublishedDate:function(e){return this._attrs.publishedDate=e,this},setAvailableDate:function(e){return this._attrs.availableDate=e,this},setMetadata:function(e){return this._attrs.metadata=e,this},setCredits:function(e){return this._attrs.credits=e,this},setCategories:function(e){return this._attrs.categories=e,this},setParentalRatings:function(e){return this._attrs.parentalRatings=e,this},setImages:function(e){return this._attrs.images=e,this},setVideos:function(e){return this._attrs.videos=e,this},build:function(){return new t(this._attrs)}})}),define("tve/model/EpisodeBuilder",["xdk-base/class","tve/model/AssetBuilder","tve/model/Episode"],function(e,t,i){return e.create(t,{},{setTVSeasonId:function(e){return this._attrs.tvSeasonId=e,this},setTVShowId:function(e){return this._attrs.tvShowId=e,this},setEpisodeNumber:function(e){return this._attrs.episodeNumber=e,this},build:function(){return new i(this._attrs)}})}),define("tve/model/MediaCategory",["xdk-base/class","tve/model/ImmutableModel"],function(e,t){return e.create(t,{defaults:{id:null,title:null,description:null,categories:[]}},{})}),define("tve/model/MediaCategoryBuilder",["xdk-base/class","tve/model/MediaCategory"],function(e,t){return e.create({},{_attrs:{},setId:function(e){return this._attrs.id=e,this},setTitle:function(e){return this._attrs.title=e,this},setDescription:function(e){return this._attrs.description=e,this},setCategories:function(e){return this._attrs.categories=e,this},build:function(){return new t(this._attrs)}})}),define("tve/model/ResourceBuilder",["xdk-base/class","tve/model/Resource"],function(e,t){return e.create({},{_attrs:{},setId:function(e){return this._attrs.id=e,this},setUrl:function(e){return this._attrs.url=e,this},setMimeType:function(e){return this._attrs.mimeType=e,this},setMetadata:function(e){return this._attrs.metadata=e,this},setDuration:function(e){return this._attrs.duration=e,this},setGeoLock:function(e){return this._attrs.geoLock=e,this},setWidth:function(e){return this._attrs.width=e,this},setHeight:function(e){return this._attrs.height=e,this},setParentalRating:function(e){return this._attrs.parentalRating=e,this},build:function(){return new t(this._attrs)}})}),define("tve/model/TVSeason",["xdk-base/class","tve/model/Asset","xdk-base/util"],function(e,t,i){return e.create(t,{defaults:i.extend(i.clone(t.defaults),{seasonNumber:null,tvShowId:null,startYear:null,endYear:null,episodeIds:[]},!0)},{})}),define("tve/model/TVSeasonBuilder",["xdk-base/class","tve/model/AssetBuilder","tve/model/TVSeason"],function(e,t,i){return e.create(t,{},{setSeasonNumber:function(e){return this._attrs.seasonNumber=e,this},setTVShowId:function(e){return this._attrs.tvShowId=e,this},setStartYear:function(e){return this._attrs.startYear=e,this},setEndYear:function(e){return this._attrs.endYear=e,this},setEpisodeIds:function(e){return this._attrs.episodeIds=e,this},build:function(){return new i(this._attrs)}})}),define("tve/model/TVShowBuilder",["xdk-base/class","tve/model/AssetBuilder","tve/model/TVShow"],function(e,t,i){return e.create(t,{},{setSeasonIds:function(e){return this._attrs.seasonIds=e,this},setEpisodeIds:function(e){return this._attrs.episodeIds=e,this},build:function(){return new i(this._attrs)}})}),define("tve/mgr/sVODManager",["xdk-base/class","xdk-base/config","xdk-base/util","tve/sServiceHolder","xdk-ax/data/LocalDatasource","xdk-base/core","xdk-base/promise","tve/util/CacheHelper","lib/base64","tve/TVEError","tve/model/AssetBuilder","tve/model/EpisodeBuilder","tve/model/MediaCategoryBuilder","tve/model/ResourceBuilder","tve/model/TVSeasonBuilder","tve/model/TVShowBuilder"],function(e,t,i,n,s,r,a,o,l,c,d,u,h,_,g,f){"use strict";var p={TV_SHOWS:"tvshows",MOVIES:"movies",EPISODES:"episodes",TV_SEASONS:"tvseasons",ALL_TV_SHOWS:"all_tvshows",ALL_TV_SEASONS:"all_tvseasons",ALL_MOVIES:"all_movies",ALL_EPISODES:"all_episodes",ALL_CATEGORIES:"all_categories",ALL_TV_SHOWS_DS:"all_tvshows_ds",ALL_TV_SEASONS_DS:"all_tvseasons_ds",ALL_MOVIES_DS:"all_movies_ds",ALL_EPISODES_DS:"all_episodes_ds",MOVIE_COVER:"movie_cover",MOVIE_THUMBNAIL:"movie_thumbnail",MOVIE_TRAILER:"movie_trailer",MOVIE_CONTENT:"movie_content",TV_SHOW_THUMBNAIL:"tvshow_thumbnail",TV_SHOW_CONTENT:"tvshow_content",TV_SEASON_THUMBNAIL:"tvseason_thumbnail",TV_SEASON_CONTENT:"tvseason_content",EPISODE_THUMBNAIL:"episode_thumbnail",EPISODE_CONTENT:"episode_content"},m=c.FACILITY,v=c.ERROR,b=n.getVODContentService(),S=function(){var e={},t={COVER:"cover",THUMBNAIL:"thumbnail"},n=function(e,t){var i,n,s,r,a={},o=t[0],l=t[1];for(s=e.length,r=0;r<s;r++)i=e[r][o],n=e[r][l],i&&n&&(a[i]=n);return a},s=function(e){if(!e.id||!e.title)throw new c(m.VOD_MANAGER,v.INVALID,"Cannot parse asset: no id/title");var s,r={id:e.id,title:e.title,description:e.description||"",publishedDate:e.publishedDate?new Date(e.publishedDate):null,availableDate:e.publishedDate?new Date(e.availableDate):null,metadata:{},credits:e.credits?n(e.credits,["role","name"]):[],categories:[],parentalRatings:e.parentalRatings||[],images:[]},a=!1,o=!1;return e.categories&&i.each(e.categories,function(e){r.categories.push(b(e))}),e.images&&i.each(e.images,function(e){return a&&o?i.breaker:!a&&i.indexOf(e.type,t.THUMBNAIL)>-1?(r.images.push(S(e)),r.metadata.thumbnail$resId=e.id,void(a=!0)):!o&&i.indexOf(e.type,t.COVER)>-1?(r.images.push(S(e)),r.metadata.cover$resId=e.id,void(o=!0)):void 0}),e.videos&&(r.videos=[],i.each(e.videos,function(e){if(!s)return void(s=e);s&&e.width>s.width&&(s=e)}),s&&(r.videos.push(S(s)),r.metadata.trailer$resId=s.id,r.metadata.content$resId=s.id)),r},r=function(e,t){var n=e.images||[];i.isArray(t.images)&&i.each(t.images,function(e){i.indexOf(e.type,"banner")>-1&&n.push(S(e))})},a=function(e){var t=new d,i=s(e);return r(i,e),t.setId(i.id).setTitle(i.title).setDescription(i.description).setPublishedDate(i.publishedDate).setAvailableDate(i.AvailableDate).setMetadata(i.metadata).setCredits(i.credits).setCategories(i.categories).setParentalRatings(i.parentalRatings).setImages(i.images).setVideos(i.videos).build()};e.parseAsset=a;var o=function(e){var t=new f,n=s(e);return r(n,e),n.seasonIds=[],e.tvSeasons&&i.each(e.tvSeasons,function(e){n.seasonIds.push(e.id)}),n.episodeIds=[],e.episodes&&i.each(e.episodes,function(e){n.episodeIds.push(e.id)}),t.setId(n.id).setTitle(n.title).setDescription(n.description).setPublishedDate(n.publishedDate).setAvailableDate(n.AvailableDate).setMetadata(n.metadata).setCredits(n.credits).setCategories(n.categories).setParentalRatings(n.parentalRatings).setImages(n.images).setVideos(n.videos).setSeasonIds(n.seasonIds).setEpisodeIds(n.episodeIds).build()};e.parseTVShow=o;var l=function(e){var t=new g,n=s(e);return n.tvShowId=e.tvShowId,n.seasonNumber=e.tvSeasonNumber,n.startYear=e.startYear,n.endYear=e.endYear,n.episodeIds=[],e.episodes&&i.each(e.episodes,function(e){n.episodeIds.push(e.id)}),t.setId(n.id).setTitle(n.title).setDescription(n.description).setPublishedDate(n.publishedDate).setAvailableDate(n.AvailableDate).setMetadata(n.metadata).setCredits(n.credits).setCategories(n.categories).setParentalRatings(n.parentalRatings).setImages(n.images).setTVShowId(n.tvShowId).setSeasonNumber(n.seasonNumber).setStartYear(n.startYear).setEndYear(n.endYear).setEpisodeIds(n.episodeIds).setVideos(n.videos).build()};e.parseTVSeason=l;var p=function(e){var t=new u,n=s(e);return n.tvSeasonId=e.tvSeasonId,n.tvShowId=e.tvShowId,n.episodeNumber=e.episodeNumber,n.episodeNumber||i.each(e.metadata,function(e){if("VOD$episodeNumber"===e.name)return n.episodeNumber=e.value,i.breaker}),t.setId(n.id).setTitle(n.title).setDescription(n.description).setPublishedDate(n.publishedDate).setAvailableDate(n.AvailableDate).setMetadata(n.metadata).setCredits(n.credits).setCategories(n.categories).setParentalRatings(n.parentalRatings).setImages(n.images).setTVShowId(n.tvShowId).setEpisodeNumber(n.episodeNumber).setVideos(n.videos).build()};e.parseEpisode=p;var b=function(e){var t=new h,n={id:e.id,title:e.title,description:e.description||"",categories:[]};return e.categories&&i.each(e.categories,function(e){n.categories.push(b(e))}),t.setId(n.id).setTitle(n.title).setDescription(n.description).build()};e.parseMediaCategory=b;var S=function(e){var t=new _,i={id:e.id,url:e.url||"",mimeType:e.format||"",metadata:{},language:e.language||"",duration:e.duration||0,geoLock:e.geoLock||!1,width:e.width||0,height:e.height||0};return e.type&&(i.metadata.type=e.type),t.setId(i.id).setUrl(i.url).setMimeType(i.mimeType).setMetadata(i.metadata).setDuration(i.duration).setGeoLock(i.geoLock).setWidth(i.width).setHeight(i.height).build()};return e.parseResource=S,e}();return new(e.create({SORT_BY:{DEFAULT:"",TITLE:"title|asc",LATEST:"publishedDate|desc"},SORT_BY_TXT:{DEFAULT:"Default",TITLE:"Title",LATEST:"Latest"}},{_cache:new o({ttl:18e5,size:1e3}),_resourceCache:new o({ttl:18e5,size:4e3}),getTVShows:function(e){if(e=e||{},!i.isObject(e))return a.reject(new c(m.VOD_MANAGER,v.INTERNAL,"Incorrect parameter type"));var t,n,s,r,o={},l=e.startIndex,d=e.count,u=e.ids,h=!1;return e.sortBy&&(r=e.sortBy.split("|"),o.sortingKey=r[0],o.sortingOrder=r[1]),u&&(o.ids=u,i.isNumber(l)&&d&&(h=!0)),t=this.__generateCacheKey(p.ALL_TV_SHOWS,o),(n=this._cache.getCache(t))?(h&&(n=n.slice(l,l+d)),a.resolve(n)):(s=i.bind(function(e){return n=i.reduce(e.entries,function(e,t){
return e.push(S.parseTVShow(t)),e},[]),this.__modelCacheHandler(n,p.TV_SHOWS),this._cache.setObject(t,n),h?n.slice(l,l+d):n},this),u?b.getTVShowsByIds(u,o).then(s).then(i.bind(this.__prefetchTVSeasonsForTVShows,this)):b.getAllTVShows(o).then(s).then(i.bind(this.__prefetchTVSeasonsForTVShows,this)))},getTVShowsDs:function(e){e=e||{};var t,n,s,r,a,o={},l=this.__generateCacheKey(p.ALL_TV_SHOWS_DS,e),c=this._cache.getCache(l),d=e.categoryId;return c||(e.sortBy&&(r=e.sortBy.split("|"),o.sortingKey=r[0],o.sortingOrder=r[1]),t=e.ids&&e.ids.join?e.ids:null,n=t?i.bind(b.getTVShowsByIds,b,t):d?i.bind(b.getTVShowsByCategoryId,b,d):i.bind(b.getAllTVShows,b),a=i.bind(function(e){return n(e).then(i.bind(this.__prefetchTVSeasonsForTVShows,this))},this),s=this.__dataListToDsHelper(a,S.parseTVShow,o),this._cache.setObject(l,s),s)},getTVShowById:function(e){var t=this.__generateCacheKey(p.TV_SHOWS,{id:e}),n=this._cache.getCache(t);return n?a.resolve(n):b.getTVShowById(e).then(i.bind(function(e){return e=S.parseTVShow(e),this._cache.setObject(t,e),e},this))},getTVShowsByCategoryId:function(e,t){t=t||{};var n,s=this.__generateCacheKey(p.TV_SHOWS,i.extend({categoryId:e},t)),r=this._cache.getCache(s),o={};return r?a.resolve(r):(t.sortBy&&(n=t.sortBy.split("|"),o.sortingKey=n[0],o.sortingOrder=n[1]),b.getTVShowsByCategoryId(e,o).then(i.bind(function(e){return r=i.reduce(e.entries,function(e,t){return e.push(S.parseTVShow(t)),e},[]),this.__modelCacheHandler(r,p.TV_SHOWS),this._cache.setObject(s,r),r},this)))},searchTVShows:function(e,t){t=t||{};var n,s,r={};return t.sortBy&&(s=t.sortBy.split("|"),r.sortingKey=s[0],r.sortingOrder=s[1]),b.searchTVShows(e,r).then(i.bind(function(e){return n=i.reduce(e.entries,function(e,t){return e.push(S.parseTVShow(t)),e},[]),this.__modelCacheHandler(n,p.TV_SHOWS),n},this))},getTVShowThumbnail:function(e,t){var i=this.__generateCacheKey(p.TV_SHOW_THUMBNAIL+e.get("id")),n=this._resourceCache.getCache(i);return n?a.resolve(n):this.__getImageAndCacheWithFallback(e,"thumbnail",i,t)},getTVShowContent:function(e){var t=this.__generateCacheKey(p.TV_SHOW_CONTENT+e.get("id")),i=this._resourceCache.getCache(t);return i?a.resolve(i):(i=e.get("videos")[0],i?(this._resourceCache.setObject(t,i),a.resolve(i)):a.reject(new c(m.VOD_MANAGER,v.INTERNAL,"no content found")))},getMovies:function(e){if(e=e||{},!i.isObject(e))return a.reject(new c(m.VOD_MANAGER,v.INTERNAL,"Incorrect parameter type"));var t,n,s,r,o={},l=e.startIndex,d=e.count,u=e.ids,h=!1;return e.sortBy&&(r=e.sortBy.split("|"),o.sortingKey=r[0],o.sortingOrder=r[1]),u&&(o.ids=u,i.isNumber(l)&&d&&(h=!0)),t=this.__generateCacheKey(p.ALL_MOVIES,o),(n=this._cache.getCache(t))?(h&&(n=n.slice(l,l+d)),a.resolve(n)):(s=i.bind(function(e){return n=i.reduce(e.entries,function(e,t){return e.push(S.parseAsset(t)),e},[]),this.__modelCacheHandler(n,p.MOVIES),this._cache.setObject(t,n),h?n.slice(l,l+d):n},this),u?b.getMoviesByIds(u,o).then(s):b.getAllMovies(o).then(s))},getMoviesDs:function(e){e=e||{};var t,n,s,r,a={},o=this.__generateCacheKey(p.ALL_MOVIES_DS,e),l=this._cache.getCache(o),c=e.categoryId;return l||(e.sortBy&&(r=e.sortBy.split("|"),a.sortingKey=r[0],a.sortingOrder=r[1]),t=e.ids&&e.ids.join?e.ids:null,n=t?i.bind(b.getMoviesByIds,b,t):c?i.bind(b.getMoviesByCategoryId,b,c):i.bind(b.getAllMovies,b),s=this.__dataListToDsHelper(n,S.parseAsset,a),this._cache.setObject(o,s),s)},getMovieById:function(e){var t=this.__generateCacheKey(p.MOVIES,{id:e}),n=this._cache.getCache(t);return n?a.resolve(n):b.getMovieById(e).then(i.bind(function(e){return e=S.parseAsset(e),this._cache.setObject(t,e),e},this))},getMoviesByCategoryId:function(e,t){t=t||{};var n,s=this.__generateCacheKey(p.MOVIES,i.extend({categoryId:e},t)),r=this._cache.getCache(s),o={};return r?a.resolve(r):(t.sortBy&&(n=t.sortBy.split("|"),o.sortingKey=n[0],o.sortingOrder=n[1]),b.getMoviesByCategoryId(e,o).then(i.bind(function(e){return r=i.reduce(e.entries,function(e,t){return e.push(S.parseAsset(t)),e},[]),this.__modelCacheHandler(r,p.MOVIES),this._cache.setObject(s,r),r},this)))},searchMovies:function(e,t){t=t||{};var n,s,r={};return t.sortBy&&(s=t.sortBy.split("|"),r.sortingKey=s[0],r.sortingOrder=s[1]),b.searchMovies(e,r).then(i.bind(function(e){return n=i.reduce(e.entries,function(e,t){return e.push(S.parseAsset(t)),e},[]),this.__modelCacheHandler(n,p.MOVIES),n},this))},getMovieCover:function(e,t){var i=this.__generateCacheKey(p.MOVIE_COVER+e.get("id")),n=this._resourceCache.getCache(i);return n?a.resolve(n):this.__getImageAndCacheWithFallback(e,"cover",i,t)},getMovieThumbnail:function(e,t){var i=this.__generateCacheKey(p.MOVIE_THUMBNAIL+e.get("id")),n=this._resourceCache.getCache(i);return n?a.resolve(n):this.__getImageAndCacheWithFallback(e,"thumbnail",i,t)},getMovieTrailer:function(e){var t=this.__generateCacheKey(p.MOVIE_TRAILER+e.get("id")),i=this._resourceCache.getCache(t);return i?a.resolve(i):(i=e.get("videos")[0],i?(this._resourceCache.setObject(t,i),a.resolve(i)):a.reject(new c(m.VOD_MANAGER,v.INTERNAL,"no trailer found")))},getMovieContent:function(e){var t=this.__generateCacheKey(p.MOVIE_CONTENT+e.get("id")),i=this._resourceCache.getCache(t);return i?a.resolve(i):(i=e.get("videos")[0],i?(this._resourceCache.setObject(t,i),a.resolve(i)):a.reject(new c(m.VOD_MANAGER,v.INTERNAL,"no content found")))},getEpisodes:function(e){if(e=e||{},!i.isObject(e))return a.reject(new c(m.VOD_MANAGER,v.INTERNAL,"Incorrect parameter type"));var t,n,s,r={};return e.sortBy&&(s=e.sortBy.split("|"),r.sortingKey=s[0],r.sortingOrder=s[1]),t=this.__generateCacheKey(p.ALL_EPISODES,r),n=this._cache.getCache(t),n?a.resolve(n):b.getAllEpisodes(r).then(i.bind(function(e){return n=i.reduce(e.entries,function(e,t){return e.push(S.parseEpisode(t)),e},[]),this.__modelCacheHandler(n,p.EPISODES),this._cache.setObject(t,n),n},this))},getEpisodesDs:function(e){e=e||{};var t,n,s,r={},a=this.__generateCacheKey(p.ALL_EPISODES_DS,e),o=this._cache.getCache(a),l=e.showId,c=e.seasonId;return o||(e.sortBy&&(s=e.sortBy.split("|"),r.sortingKey=s[0],r.sortingOrder=s[1]),e.ids&&e.ids.join?e.ids:null,t=l?i.bind(b.getEpisodesByTVShowId,b,l):c?i.bind(b.getEpisodesByTVSeasonId,b,c):i.bind(b.getAllEpisodes,b),n=this.__dataListToDsHelper(t,S.parseEpisode,r),this._cache.setObject(a,n),n)},getEpisodeById:function(e){var t=this.__generateCacheKey(p.EPISODES,{id:e}),n=this._cache.getCache(t);return n?a.resolve(n):b.getEpisodeById(e).then(i.bind(function(e){return e=S.parseEpisode(e),this._cache.setObject(t,e),e},this))},getEpisodesByTVShowId:function(e,t){t=t||{};var n,s=this.__generateCacheKey(p.EPISODES,i.extend({showId:e},t)),r=this._cache.getCache(s),o={};return r?a.resolve(r):(t.sortBy&&(n=t.sortBy.split("|"),o.sortingKey=n[0],o.sortingOrder=n[1]),b.getEpisodesByTVShowId(e,o).then(i.bind(function(e){return r=i.reduce(e.entries,function(e,t){return e.push(S.parseEpisode(t)),e},[]),this.__modelCacheHandler(r,p.EPISODES),this._cache.setObject(s,r),r},this)))},searchEpisodes:function(e,t){t=t||{};var n,s,r={};return t.sortBy&&(s=t.sortBy.split("|"),r.sortingKey=s[0],r.sortingOrder=s[1]),b.searchEpisodes(e,r).then(i.bind(function(e){return n=i.reduce(e.entries,function(e,t){return e.push(S.parseEpisode(t)),e},[]),this.__modelCacheHandler(n,p.EPISODES),n},this))},getEpisodeThumbnail:function(e,t){var i=this.__generateCacheKey(p.EPISODE_THUMBNAIL+e.get("id")),n=this._resourceCache.getCache(i);return n?a.resolve(n):this.__getImageAndCacheWithFallback(e,"thumbnail",i,t)},getEpisodeContent:function(e){var t=this.__generateCacheKey(p.EPISODE_CONTENT+e.get("id")),i=this._resourceCache.getCache(t);return i?a.resolve(i):(i=e.get("videos")[0],i?(this._resourceCache.setObject(t,i),a.resolve(i)):a.reject(new c(m.VOD_MANAGER,v.INTERNAL,"no content found")))},getTVSeasonById:function(e){var t=this.__generateCacheKey(p.TV_SEASONS,{id:e}),n=this._cache.getCache(t);return n?a.resolve(n):b.getTVSeasonById(e).then(i.bind(function(e){return e=S.parseTVSeason(e),this._cache.setObject(t,e),e},this))},searchTVSeasons:function(e,t){t=t||{};var n,s,r={};return t.sortBy&&(s=t.sortBy.split("|"),r.sortingKey=s[0],r.sortingOrder=s[1]),b.searchTVSeasons(e,r).then(i.bind(function(e){return n=i.reduce(e.entries,function(e,t){return e.push(S.parseTVSeason(t)),e},[]),this.__modelCacheHandler(n,p.TV_SEASONS),n},this))},getTVSeasonThumbnail:function(e,t){var i=this.__generateCacheKey(p.TV_SEASON_THUMBNAIL+e.get("id")),n=this._resourceCache.getCache(i);return n?a.resolve(n):this.__getImageAndCacheWithFallback(e,"thumbnail",i,t)},getTVSeasonContent:function(e){var t=this.__generateCacheKey(p.TV_SEASON_CONTENT+e.get("id")),i=this._resourceCache.getCache(t);return i?a.resolve(i):(i=e.get("videos")[0],i?(this._resourceCache.setObject(t,i),a.resolve(i)):a.reject(new c(m.VOD_MANAGER,v.INTERNAL,"no content found")))},__modelCacheHandler:function(e,t){var i,n,s;for(n=0,s=e.length;n<s;n++)i=this.__generateCacheKey(t,{id:e[n].get("id")}),this._cache.setObject(i,e[n])},__dataListToDsHelper:function(e,t,n){n=n||{};var r=new s,a=[],o=i.bind(function(s,r){var o=i.extend({pageSize:30,pageNumber:1+Math.ceil(s/30)},n);return e(o).then(i.bind(function(e){return a=a.concat(i.reduce(e.entries,function(e,i){return e.push(t(i)),e},[])),{data:a.slice(s,s+r),total:e.totalCount}},this))},this);return r.setDataLoader(o),r},__generateCacheKey:function(e,t){var n=t?i.toQueryString(t):"",s=e+"?"+n;return window.btoa?window.btoa(s):l.encode(s)},__getImageForResourceArrayByType:function(e,t){for(var i=0,n=e.length;i<n;i++)if(e[i].get("metadata").type===t)return e[i];return null},getTVShowsDsByCategoryId:function(e,t){return this.getTVShowsDs(i.extend({categoryId:e},t))},getTVShowsByIds:function(e,t){return this.getTVShows(i.extend({ids:e},t))},getMoviesDsByCategoryId:function(e,t){return this.getMoviesDs(i.extend({categoryId:e},t))},getMoviesByIds:function(e,t){return this.getMovies(i.extend({ids:e},t))},getEpisodesDsByTVShowId:function(e,t){return this.getEpisodesDs(i.extend({showId:e,sortBy:this.constructor.SORT_BY.LATEST},t))},getRelatedMoviesDs:function(e,t){var n=function(t){return this.getMovieById(e).then(i.bind(function(t){var n=t.get("categories")[0]?t.get("categories")[0].get("id"):null;return(n?b.getMoviesByCategoryId(n):b.getAllMovies()).then(i.bind(function(t){return i.each(t.entries,function(n,s){if(n.id===e)return t.entries.splice(s,1),t.totalCount--,i.breaker}),t}))},this))};return this.__dataListToDsHelper(i.bind(n,this),S.parseAsset,t)},getMovieSearchResultDs:function(e,t){var n=function(t){return b.searchMovies(e)};return this.__dataListToDsHelper(i.bind(n,this),S.parseAsset,t)},getTVShowSearchResultDs:function(e,t){var n=function(t){return b.searchTVShows(e)};return this.__dataListToDsHelper(i.bind(n,this),S.parseTVShow,t)},getMovieBanner:function(e){var t=this.__generateCacheKey("movie_banner"+e.get("id")),i=this._resourceCache.getCache(t);return i?a.resolve(i):(i=this.__getImageForResourceArrayByType(e.get("images"),"banner"),i?(this._resourceCache.setObject(t,i),a.resolve(i)):a.reject(new c(m.VOD_MANAGER,v.INTERNAL,"no banner found")))},getTVShowBanner:function(e){var t=this.__generateCacheKey("tvshow_banner"+e.get("id")),i=this._resourceCache.getCache(t);return i?a.resolve(i):(i=this.__getImageForResourceArrayByType(e.get("images"),"banner"),i?(this._resourceCache.setObject(t,i),a.resolve(i)):a.reject(new c(m.VOD_MANAGER,v.INTERNAL,"no banner found")))},getTVShowByEpisode:function(e){var t=e.get("metadata"),i=t.VOD$tvShowId;return i?this.getTVShowById(i):a.reject(new c(m.VOD_MANAGER,v.INTERNAL,"No associated TV Show"))},getMovieRentalInfo:function(e){var t=e.get("metadata"),i=t.rental$period||7,n=t.rental$price||2.99;return a.resolve({days:i,price:n})},getTVSeasons:function(e){if(e=e||{},!i.isObject(e))return a.reject(new c(m.VOD_MANAGER,v.INTERNAL,"Incorrect parameter type"));var t,n,s,r,o={},l=e.startIndex,d=e.count,u=e.ids,h=!1;return e.sortBy&&(r=e.sortBy.split("|"),o.sortingKey=r[0],o.sortingOrder=r[1]),u&&(o.ids=u,i.isNumber(l)&&d&&(h=!0)),t=this.__generateCacheKey(p.ALL_TV_SHOWS,o),(n=this._cache.getCache(t))?(h&&(n=n.slice(l,l+d)),a.resolve(n)):(s=i.bind(function(e){return n=i.reduce(e.entries,function(e,t){return e.push(S.parseTVSeason(t)),e},[]),this.__modelCacheHandler(n,p.TV_SEASONS),this._cache.setObject(t,n),h?n.slice(l,l+d):n},this),u?b.getTVSeasonsByIds(u,o).then(s):b.getAllTVSeasons(o).then(s))},getTVSeasonsDs:function(e){e=e||{};var t,n,s,r,a={},o=this.__generateCacheKey(p.ALL_TV_SEASONS_DS,e),l=this._cache.getCache(o);return l||(e.sortBy&&(r=e.sortBy.split("|"),a.sortingKey=r[0],a.sortingOrder=r[1]),t=e.ids&&e.ids.join?e.ids:null,n=t?i.bind(b.getTVSeasonsByIds,b,t):i.bind(b.getAllTVSeasons,b),s=this.__dataListToDsHelper(n,S.parseTVSeason,a),this._cache.setObject(o,s),s)},getTVSeasonsByIds:function(e,t){return this.getTVSeasons(i.extend({ids:e},t))},getTVSeasonsDsByIds:function(e,t){return this.getTVSeasonsDs(i.extend({ids:e},t))},getTVSeasonsByTVShowId:function(e,t){return this.getTVShowById(e).then(i.bind(function(e){var t=e.get("seasonIds");return t.length>0?this.getTVSeasonsByIds(t):[]},this)).fail(function(e){throw new c(m.VOD_MANAGER,v.NOT_FOUND,"Cannot get the required TV show.")})},getEpisodesDsByTVSeasonId:function(e,t){return this.getEpisodesDs(i.extend({seasonId:e,sortBy:this.constructor.SORT_BY.LATEST},t))},__prefetchTVSeasonsForTVShows:function(e){var t,i=e.length,n=[];for(t=0;t<i;t++)n=n.concat(e[t].get("seasonIds"));return 0===n.length?e:this.getTVSeasonsByIds(n).then(function(t){return e})},__getImageAndCacheWithFallback:function(e,t,i,n){var s=this.__getImageForResourceArrayByType(e.get("images"),t);return s?(this._resourceCache.setObject(i,s),a.resolve(s)):n?a.resolve(n):a.reject(new c(m.VOD_MANAGER,v.INTERNAL,t+" not found"))}}))}),define("tvedemo/model/Asset",["xdk-base/class","tve/model/ImmutableModel"],function(e,t){"use strict";return e.create(t,{defaults:{id:null,licensing:null,apixId:null,eventId:null,type:null,title:null,synopsis:null,cast:null,country:null,year:null,parentalRating:null,packageCode:null,packageColourCode:null,genreList:null,logoUrl:null,images:null,dvdCover:null,blackedOut:null,catalog:null,isHD:null,bookmark:{}}},{})}),define("tvedemo/model/AssetBuilder",["xdk-base/class","tvedemo/model/Asset"],function(e,t){"use strict";return e.create({},{_attrs:{},setId:function(e){return this._attrs.id=e,this},setLicensing:function(e){return this._attrs.licensing=e,this},setTitle:function(e){return this._attrs.title=e,this},setSynopsis:function(e){return this._attrs.synopsis=e,this},setParentalRating:function(e){return this._attrs.parentalRating=e,this},setApixId:function(e){return this._attrs.apixId=e,this},setEventId:function(e){return this._attrs.eventId=e,this},setType:function(e){return this._attrs.type=e,this},setCast:function(e){return this._attrs.cast=e,this},setGenreList:function(e){return this._attrs.genreList=e,this},setCountry:function(e){return this._attrs.country=e,this},setYear:function(e){return this._attrs.year=e,this},setPackageCode:function(e){return this._attrs.packageCode=e,this},setPackageColourCode:function(e){return this._attrs.packageColourCode=e,this},setLogoUrl:function(e){return this._attrs.logoUrl=e,this},setImages:function(e){return this._attrs.images=e,this},setDvdCover:function(e){return this._attrs.dvdCover=e,this},setBlackedOut:function(e){return this._attrs.blackedOut=e,this},setCatalog:function(e){return this._attrs.catalog=e,this},setIsHD:function(e){return this._attrs.isHD=e,this},build:function(){return new t(this._attrs)}})}),define("tvedemo/model/FilmAsset",["xdk-base/class","xdk-base/util","tvedemo/model/Asset"],function(e,t,i){"use strict";return e.create(i,{defaults:t.extend(t.clone(i.defaults),{live:null,videoQuality:null,video:null,trailer:null,length:null,date:null},!0)},{})}),define("tvedemo/model/FilmAssetBuilder",["xdk-base/class","tvedemo/model/FilmAsset","tvedemo/model/AssetBuilder"],function(e,t,i){return e.create(i,{},{setVideoQuality:function(e){return this._attrs.videoQuality=e,this},setVideo:function(e){return this._attrs.video=e,this},setTrailer:function(e){return this._attrs.trailer=e,this},setLive:function(e){return this._attrs.live=e,this},setLength:function(e){return this._attrs.length=e,this},setDate:function(e){return this._attrs.date=e,this},build:function(){return new t(this._attrs)}})}),define("tvedemo/model/SerieAsset",["xdk-base/class","xdk-base/util","tvedemo/model/Asset"],function(e,t,i){"use strict";return e.create(i,{defaults:t.extend(t.clone(i.defaults),{seasons:null,numberOfSeasons:null,bingeWatching:null},!0)},{})}),define("tvedemo/model/SerieAssetBuilder",["xdk-base/class","tvedemo/model/SerieAsset","tvedemo/model/AssetBuilder"],function(e,t,i){"use strict";return e.create(i,{},{setSeasons:function(e){return this._attrs.seasons=e,this},setNumberOfSeasons:function(e){return this._attrs.numberOfSeasons=e,this},setBingeWatching:function(e){return this._attrs.bingeWatching=e||"inactive",this},build:function(){return new t(this._attrs)}})}),define("tvedemo/model/SeasonAsset",["xdk-base/class","xdk-base/util","tvedemo/model/Asset"],function(e,t,i){"use strict";return e.create(i,{defaults:t.extend(t.clone(i.defaults),{seasonNumber:null,episodes:null,numberOfEpisodes:null,serieId:null},!0)},{})}),define("tvedemo/model/SeasonAssetBuilder",["xdk-base/class","tvedemo/model/SeasonAsset","tvedemo/model/AssetBuilder"],function(e,t,i){"use strict";return e.create(i,{},{setSeasonNumber:function(e){return this._attrs.seasonNumber=e,this},setEpisodes:function(e){return this._attrs.episodes=e,this},setNumberOfEpisodes:function(e){return this._attrs.numberOfEpisodes=e,this},setSerieId:function(e){return this._attrs.serieId=e,this},build:function(){return new t(this._attrs)}})}),define("tvedemo/model/EpisodeAsset",["xdk-base/class","xdk-base/util","tvedemo/model/Asset"],function(e,t,i){"use strict";return e.create(i,{defaults:t.extend(t.clone(i.defaults),{episodeNumber:null,video:null,seasonNumber:null,serieTitle:null,serieId:null,seasonId:null,bingeTrigger:null,flagOV:null,subtitleType:null,length:null},!0)},{})}),define("tvedemo/model/EpisodeAssetBuilder",["xdk-base/class","tvedemo/model/EpisodeAsset","tvedemo/model/AssetBuilder"],function(e,t,i){return e.create(i,{},{setEpisodeNumber:function(e){return this._attrs.episodeNumber=e,this},setVideo:function(e){return this._attrs.video=e,this},setSeasonNumber:function(e){return this._attrs.seasonNumber=e,this},setSerieTitle:function(e){return this._attrs.serieTitle=e,this},setSeasonId:function(e){return this._attrs.seasonId=e,this},setSerieId:function(e){return this._attrs.serieId=e,this},setCategory:function(e){return this._attrs.category=e&&e.main&&e.main.content,this},setBingeTrigger:function(e){if("number"==typeof(e=e||"00:00:00:00"))return this._attrs.bingeTrigger=e,this;for(var t=[3600,60,1,0],i=e.split(":"),n=0,s=0,r=i.length;s<r&&s<t.length;s++)n+=(i[s]>>0)*t[s];return this._attrs.bingeTrigger=n,this},setFlagOV:function(e){return this._attrs.flagOV=e,this},setSubtitleType:function(e){return this._attrs.subtitleType=e,this},setLength:function(e){return this._attrs.length=e,this},build:function(){return new t(this._attrs)}})}),define("tvedemo/model/SportAsset",["xdk-base/class","xdk-base/util","tvedemo/model/Asset"],function(e,t,i){"use strict";return e.create(i,{defaults:t.extend(t.clone(i.defaults),{subtitle:null,channelCode:null,channelName:null,currentType:null,licensing:null,live:null,simulCast:null,length:null,license:null,video:null,mediaUrl:null,mediaUrlHls:null,onAir:null,startTime:null,endTime:null,date:null,previewPath:null,webvodCanonicalUrl:null},!0)},{})}),define("tvedemo/model/SportAssetBuilder",["xdk-base/class","tvedemo/model/SportAsset","tvedemo/model/AssetBuilder"],function(e,t,i){"use strict";return e.create(i,{},{setSubtitle:function(e){return this._attrs.subtitle=e,this},setChannelCode:function(e){return this._attrs.channelCode=e,this},setChannelName:function(e){return this._attrs.channelName=e,this},setCurrentType:function(e){return this._attrs.currentType=e,this},setLicensing:function(e){return this._attrs.licensing=e,this},setLive:function(e){return this._attrs.live=e,this},setSimulCast:function(e){return this._attrs.simulCast=e,this},setLength:function(e){return this._attrs.length=e,this},setLicense:function(e){return this._attrs.license=e,this},setVideo:function(e){return this._attrs.video=e,this},setMediaUrl:function(e){return this._attrs.mediaUrl=e,this},setMediaUrlHls:function(e){return this._attrs.mediaUrlHls=e,this},setOnAir:function(e){return this._attrs.onAir=e,this},setStartTime:function(e){return this._attrs.startTime=e,this},setEndTime:function(e){return this._attrs.endTime=e,this},setDate:function(e){return this._attrs.date=e,this},setPreviewPath:function(e){return this._attrs.previewPath=e,this},setWebvodCanonicalUrl:function(e){return this._attrs.webvodCanonicalUrl=e,this},build:function(){return new t(this._attrs)}})}),define("tvedemo/model/PlaceholderAsset",["xdk-base/class","xdk-base/util","tve/model/ImmutableModel"],function(e,t,i){"use strict";return e.create(i,{defaults:{type:"placeholder",title:null}},{})}),define("tvedemo/mgr/sAssetManager",["xdk-base/class","xdk-base/util","xdk-base/core","xdk-base/promise","tve/util/CacheHelper","lib/base64","tve/TVEError","tve/sServiceHolder","tve/model/ResourceBuilder","tvedemo/model/AssetBuilder","tvedemo/model/FilmAssetBuilder","tvedemo/model/SerieAssetBuilder","tvedemo/model/SeasonAssetBuilder","tvedemo/model/EpisodeAssetBuilder","tvedemo/model/SportAssetBuilder","tvedemo/model/PlaceholderAsset","storm/mgr/sAppConfigManager","storm/helper/util","xdk-base/console","tvedemo/mgr/sEndUserManager","storm/mgr/sLanguageManager"],function(e,t,i,n,s,r,a,o,l,c,d,u,h,_,g,f,p,m,v,b,S){"use strict";var y={ASSET:"asset",FILMS:"films",SERIE:"serie",SEASON:"season",EPISODE:"episode",EPISODES:"episodes",SPORT:"sport"},E=o.getStormAssetService(),k=function(){var e={},i=function(e){var t=new l,i={id:e.id,url:e.url||"",mimeType:e.format||"",metadata:{},language:e.language||"",duration:e.duration||0,geoLock:e.geoLock||!1,width:e.width||0,height:e.height||0,parentalRating:e.parentalRating};return e.type&&(i.metadata.type=e.type),t.setId(i.id).setUrl(i.url).setMimeType(i.mimeType).setMetadata(i.metadata).setDuration(i.duration).setGeoLock(i.geoLock).setWidth(i.width).setHeight(i.height).setParentalRating({value:i.parentalRating?i.parentalRating.value||i.parentalRating:null,display:i.parentalRating?i.parentalRating.value||i.parentalRating:null}).build()};e.parseResource=i;var n=function(e){return{id:e.id,apixId:e.apix_id,eventId:e.event_id,type:e.asset_type,title:e.title,synopsis:e.synopsis||"",cast:e.cast_list&&e.cast_list.cast,category:e.category,genreList:e.genre,country:e.country&&e.country.iso_code,year:e.year_of_production,parentalRating:e.parental_rating,packageColourCode:e.package_color_code,packageCode:e.package_code,logoUrl:e.logo,images:e.main_picture&&e.main_picture.picture,dvdCover:e.dvd_cover,blackedOut:e.epgBlackout||!1,catalog:e.catalog,isHD:e.hd&&"yes"===e.hd}},s=function(e){var t=n(e),s=e.ms_media_url?i({url:e.ms_media_url}):null,r=e.main_trailer&&e.main_trailer.trailer?i(e.main_trailer.trailer):null;return t.video=s,t.trailer=r,t.live="yes"===e.flag_live,t.videoQuality=e.quality,t.date=e.on_air&&e.on_air.start_date?new Date(e.on_air.start_date):null,t.length=e.lenght?60*e.lenght*1e3:null,t.licensing=e.extended_license,t},r=function(e){var t,i,s=n(e),r=[];for(s.year=e.year_of_production_start,s.seasons=e.seasons&&e.seasons.season,s.numberOfSeasons=e.seasons&&e.seasons.count,s.bingeWatching=e.binge_watching,r.push(e.category.main),i=e.category.other?e.category.other.length:0,t=0;t<i;t++)r.push(e.category.other[t]);return s.genreList=r,s},a=function(e){var t=n(e);return t.serieId=e.serie_id,t.seasonNumber=e.nr||e.season_nr,t.episodes=e.episodes&&e.episodes.episode,t.numberOfEpisodes=e.episodes&&e.episodes.count,t},o=function(e){var t=n(e),s=e.ms_media_url?i({url:e.ms_media_url}):null;return t.video=s,t.episodeNumber=e.episode_nr,t.seasonNumber=e.season_nr,t.serieTitle=e.serie_title,t.serieId=e.serie_id,t.seasonId=e.season_id,t.bingeTrigger=e.binge_trigger,t.flagOV=e.flagOV&&"yes"===e.flagOV,t.subtitleType=e.subtitle_type,t.length=e.lenght?60*e.lenght*1e3:null,t},c=function(e){var t=n(e),s=e.media_url?i({url:e.media_url}):null;if(t.video=s,t.subtitle=e.subtitle,t.channelCode=e.channel_code,t.channelName=e.channel_name,t.currentType=e.current_type,t.licensing=e.extended_license,t.live="yes"===e.flag_live,t.simulCast="yes"===e.flag_simulcast,t.length=e.lenght?60*e.lenght*1e3:null,t.license=e.license,t.mediaUrl=e.media_url,t.mediaUrlHls=e.media_url_hls,t.onAir=e.on_air,e.on_air){var r=e.on_air;t.startTime=r.start_date&&r.start_time&&m.parseSkyDateTimeToDate(r.start_date,r.start_time).getTime(),t.endTime=r.end_date&&r.end_time&&m.parseSkyDateTimeToDate(r.end_date,r.end_time).getTime(),t.date=r.start_date?new Date(r.start_date):null}return t.previewPath=e.preview_path,t.webvodCanonicalUrl=e.webvod_canonical_url,t},p=function(e,t){e.setId(t.id).setTitle(t.title).setSynopsis(t.synopsis).setParentalRating(t.parentalRating).setApixId(t.apixId).setEventId(t.eventId).setType(t.type).setCast(t.cast).setGenreList(t.genreList).setCountry(t.country).setYear(t.year).setPackageCode(t.packageCode).setPackageColourCode(t.packageColourCode).setLogoUrl(t.logoUrl).setImages(t.images).setDvdCover(t.dvdCover).setBlackedOut(t.blackedOut).setCatalog(t.catalog).setLicensing(t.licensing).setIsHD(t.isHD)},v=function(e){var t=new d,i=s(e);return p(t,i),t.setVideoQuality(i.videoQuality).setVideo(i.video).setTrailer(i.trailer).setLive(i.live).setLength(i.length).build()};e.parseStormFilmAsset=v;var b=function(e){var t=new _,i=o(e);return p(t,i),t.setEpisodeNumber(i.episodeNumber).setVideo(i.video).setSeasonNumber(i.seasonNumber).setSerieTitle(i.serieTitle).setSeasonId(i.seasonId).setSerieId(i.serieId).setCategory(i.category).setBingeTrigger(i.bingeTrigger).setFlagOV(i.flagOV).setSubtitleType(i.subtitleType).setLength(i.length).build()};e.parseStormEpisodeAsset=b;var y=function(e){var i=new h,n=a(e),s=[];return p(i,n),n.episodes&&n.episodes.length>0&&(s=t.map(n.episodes,function(t){return t.season_id=e.id,t.serie_id=e.serie_id,t.catalog=e.catalog,b(t)})),i.setEpisodes(s).setNumberOfEpisodes(n.numberOfEpisodes).setSeasonNumber(n.seasonNumber).setSerieId(n.serieId).build()};e.parseStormSeasonAsset=y;var E=function(e){var i=new u,n=r(e),s=[];return p(i,n),n.seasons&&n.seasons.length>0&&(s=t.map(n.seasons,function(t){return t.serie_id=e.id,t.catalog=e.catalog,y(t)})),i.setSeasons(s).setNumberOfSeasons(n.numberOfSeasons).setBingeWatching(n.bingeWatching).build()};e.parseStormSerieAsset=E;var k=function(e){var t=new g,i=c(e);return p(t,i),t.setSubtitle(i.subtitle).setChannelCode(i.channelCode).setChannelName(i.channelName).setCurrentType(i.currentType).setLicensing(i.licensing).setLive(i.live).setSimulCast(i.simulCast).setLength(i.length).setLicense(i.license).setVideo(i.video).setMediaUrl(i.mediaUrl).setMediaUrlHls(i.mediaUrlHls).setOnAir(i.onAir).setStartTime(i.startTime).setEndTime(i.endTime).setDate(i.date).setPreviewPath(i.previewPath).setWebvodCanonicalUrl(i.webvodCanonicalUrl).build()};e.parseStormSportAsset=k;var C=function(e,t,i){var n=S.getString("Binge.Binge_Extended_episode_not_available_msg",{season_number:e,episode_number:t});return i>1&&(n=S.getString("Binge.Binge_Extended_many_episodes_not_available_msg",{season_number:e,first_episode_number:t,last_episode_number:t+i-1})),new f({title:n})},T=function(e,i,n,s,r){var a,o,l,c,d=t.isArray(i)?i:i.get("episodes"),u=0,h=d.length,_=d[0]&&d[0].get("seasonNumber")?d[0].get("seasonNumber"):"",g=[],f=0,p=e.get("flagOV"),m=e.get("subtitleType");for(n=n||1,c=n-1;u<h;u++)a=d[u],o=a.get("episodeNumber"),"active"!==r&&(o!==n&&o-c>1&&(g.push(C(_,c+1,o-c-1)),f++),c=o),l&&l.get("episodeNumber")!=o&&(g.push(l),l=null),a.get("flagOV")===p&&m&&a.get("subtitleType")===m?l=a:l||a.get("flagOV")!==p?l||(l=a):l=a,u===h-1&&l&&g.push(l);return s&&s-c>0&&g.push(C(_,c+1,s-c)),{episodeList:g,placeHolderCount:f}};return e.parseExtendedBingeEpisodes=T,e}();return new(e.create({},{ASSET_TYPES:{FILM:"Film",EPISODE:"Episode",SPORT:"Sport"},SPORT_ASSET_CURRENT_TYPES:{REPLAY:"Replay",LIVE:"Live"},_cache:new s({ttl:18e5,size:1e3}),__generateCacheKey:function(e,i){var n=i?t.toQueryString(i):"",s=e+"?"+n;return window.btoa?window.btoa(s):r.encode(s)},getAssets:function(e,i){e=e||{};var s,r=this.__generateCacheKey(i===this.ASSET_TYPES.FILM?y.FILMS:y.EPISODES,e),a=this._cache.getCache(r);if(a)return a;s=e.ids&&e.ids.join?e.ids:null;var o=[];if(s){t.each(s,function(e){o.push(E.getAssetById(e.get("assetId"),e.get("catalog")).then(function(e){return e.asset.catalog=e.product,e},function(e){v.warn("Get asset promise failed: "+e)}))});var l=[];return n.all(o).then(t.bind(function(e){return t.each(e,t.bind(function(e){void 0!==e&&(e.asset.asset_type===this.ASSET_TYPES.FILM?l.push(k.parseStormFilmAsset(e.asset)):e.asset.asset_type===this.ASSET_TYPES.EPISODE?l.push(k.parseStormEpisodeAsset(e.asset)):e.asset.asset_type===this.ASSET_TYPES.SPORT&&l.push(k.parseStormSportAsset(e.asset)))},this)),{data:l,total:l.length}},this),function(e){v.log(e)})}},getDataLoaderFromArray:function(e){return function(t,i){var s=n.defer(),r=e.data;return s.resolve({data:r,total:r.length}),s.promise}},getAssetById:function(e,i){var s=this.__generateCacheKey(y.ASSET+e),r=this._cache.getCache(s);return r?n.resolve(r):E.getAssetById(e,i).then(t.bind(function(e){return e.asset.catalog=e.product,e="Sport"===e.asset.asset_type?k.parseStormSportAsset(e.asset):k.parseStormFilmAsset(e.asset),this._cache.setObject(s,e),e},this))},getEpisodeById:function(e,i){var s=this.__generateCacheKey(y.EPISODE+e),r=this._cache.getCache(s);return r?n.resolve(r):E.getAssetById(e,i).then(t.bind(function(e){return e.asset.catalog=e.product,e=k.parseStormEpisodeAsset(e.asset),this._cache.setObject(s,e),e},this))},getSportAssetById:function(e,i){var s=this.__generateCacheKey(y.SPORT+e),r=this._cache.getCache(s);return r?n.resolve(r):E.getAssetById(e,i).then(t.bind(function(e){return e.asset.catalog=e.product,e=k.parseStormSportAsset(e.asset),this._cache.setObject(s,e),e},this))},getStormAssetImageBySize:function(e,t,i){return E.getAssetImageBySize(e,t,i).then(function(e){return e=k.parseResource(e)})},getStormAssetChannelLogo:function(e){return E.getAssetChannelLogo(e).then(function(e){return e=k.parseResource(e)})},getStormAssetDvdCover:function(e){return E.getAssetDvdCover(e).then(function(e){return e=k.parseResource(e)})},getSerieAssetById:function(e,i){var s=this.__generateCacheKey(y.SERIE+i+e),r=this._cache.getCache(s);return r?n.resolve(r):E.getSerieAssetById(e,i).then(t.bind(function(e){var t=e&&e.serieRecap&&e.serieRecap.serie;return t.catalog=e.product,t=k.parseStormSerieAsset(t),this._cache.setObject(s,t),t},this))},getSeasonAssetById:function(e,i){var s=this.__generateCacheKey(y.SEASON+i+e),r=this._cache.getCache(s);return r?n.resolve(r):E.getSeasonAssetById(e,i).then(t.bind(function(e){var t=e&&e.season;return t.catalog=e.product,t=k.parseStormSeasonAsset(t),this._cache.setObject(s,t),t},this))},getRelatedEpisodesBySerieAndSeason:function(e,i,n){return this.getSerieAssetById(e,n).then(function(e){var n,s=e.get("seasons");return t.each(s,function(e){if(e.get("id")===i)return n=e.get("episodes"),t.breaker}),n})},getExtendedBingeWatchingData:function(e){var t=e&&e.get("serieId"),i=e&&e.get("catalog");return t&&i?this.getSerieAssetById(t,i).then(function(t){var i,n,s,r,a={},o=t.get("seasons");if(a.seasons=[],a.bingeWatching=t.get("bingeWatching"),"disabled"===a.bingeWatching)return a;if(1===o.length&&o[0].get("episodes").length>50){o=o.slice(0,1);var l,c,d=o[0].get("episodes").splice(0),u=[],h=[];for(l=0,i=0;i<d.length;i++)if(d[i].get("episodeNumber")<=50*l+50)h.push(d[i]);else{if(u.push(h),h=[],l++,i===d.length-1)break;--i}for(i=0;i<u.length;i++)c=50*i,s={seasonIndicator:{title:c+1+" - "+(c+50),
firstSeason:0===i,lastSeason:i===u.length-1},episodeListData:{season:"",episodes:null}},r=k.parseExtendedBingeEpisodes(e,u[i],c+1,c+50,a.bingeWatching),s.episodeListData.episodes=r.episodeList,s.episodeListData.placeHolderCount=r.placeHolderCount,a.seasons.push(s)}else for(i=0,n=o.length;i<n;i++)s={seasonIndicator:{title:"S"+o[i].get("seasonNumber"),firstSeason:0===i,lastSeason:i===n-1},episodeListData:{season:o[i].get("seasonNumber"),episodes:null}},r=k.parseExtendedBingeEpisodes(e,o[i],null,null,a.bingeWatching),s.episodeListData.episodes=r.episodeList,s.episodeListData.placeHolderCount=r.placeHolderCount,a.seasons.push(s);return a}).fail(function(){return{}}):n.reject()},getContinueWatch:function(){return b.getRecentlyWatched().then(t.bind(function(e){var i,n=[],s=[],r=new Date;for(i=0;i<e.length;i++){var a=e[i],o=new Date(a.get("startDate")),l=new Date(a.get("endDate"));o<r&&r<l&&n.push(a)}if(n.length>0){if(null!==n[0].get("bookmark")){for(i=0;i<n.length;i++){var a=n[i];if(a.get("bookmark")>0&&"W"!==a.get("watchedFlag")&&s.push(a),4===s.length)break}return s}var c=t.map(n,function(e){return e.get("assetId")});return b.getBookmarkForAssetList(c.join(",")).then(function(e){if(e&&e.length>0){return t.map(e,function(e){var i=t.find(n,function(t){return t.get("assetId")==e.assetId});return i.set("percentage",e.percentage),i.set("duration",e.duration),i.set("bookmark",e.bookmark),i.set("watchedFlag",e.watchedState),i})}return n})}return n}))}}))}),define("tve/model/TVChannelBuilder",["xdk-base/class","tve/model/AssetBuilder","tve/model/TVChannel"],function(e,t,i){return e.create(t,{},{setChannelNumber:function(e){return this._attrs.channelNumber=e,this},setMobilepc:function(e){return this._attrs.mobilepc=e,this},setPackageCode:function(e){return this._attrs.packageCode=e,this},build:function(){return new i(this._attrs)}})}),define("tve/model/ChannelListing",["xdk-base/class","tve/model/ImmutableModel"],function(e,t){return e.create(t,{defaults:{channelId:null,startTime:null,endTime:null,programs:[]}},{})}),define("tve/model/ChannelListingBuilder",["xdk-base/class","tve/model/ChannelListing"],function(e,t){return e.create({},{_attrs:{},setChannelId:function(e){return this._attrs.channelId=e,this},setStartTime:function(e){return this._attrs.startTime=e,this},setEndTime:function(e){return this._attrs.endTime=e,this},setPrograms:function(e){return this._attrs.programs=e,this},build:function(){return new t(this._attrs)}})}),define("tve/model/Program",["xdk-base/class","tve/model/Asset","xdk-base/util"],function(e,t,i){return e.create(t,{defaults:i.extend(i.clone(t.defaults),{startTime:null,endTime:null,inlineMetadata:"",epgBlackout:null},!0)},{})}),define("tve/model/ProgramBuilder",["xdk-base/class","tve/model/AssetBuilder","tve/model/Program"],function(e,t,i){return e.create(t,{},{setStartTime:function(e){return this._attrs.startTime=e,this},setEndTime:function(e){return this._attrs.endTime=e,this},setInlineMetadata:function(e){return this._attrs.inlineMetadata=e,this},setEpgBlackout:function(e){return this._attrs.epgBlackout=e,this},build:function(){return new i(this._attrs)}})}),define("tvedemo/model/SportNews",["xdk-base/class","tve/model/ImmutableModel"],function(e,t){"use strict";return e.create(t,{defaults:{id:null,images:null,title:null,synopsis:null,date:null,categoryName:null}},{})}),define("tvedemo/model/SportNewsBuilder",["xdk-base/class","tvedemo/model/SportNews"],function(e,t){return e.create({},{_attrs:{},setId:function(e){return this._attrs.id=e,this},setImages:function(e){return this._attrs.images=e,this},setTitle:function(e){return this._attrs.title=e,this},setSynopsis:function(e){return this._attrs.synopsis=e,this},setDate:function(e){return this._attrs.date=e,this},setCategoryName:function(e){return this._attrs.categoryName=e,this},build:function(){return new t(this._attrs)}})}),define("tvedemo/mgr/sTrackingManager",["xdk-base/class","tve/sServiceHolder","xdk-ax/mediator","tve/videoPlaybackService/evt/VideoPlaybackStatusEvent","tve/videoPlaybackService/evt/VideoPlaybackControlsEvent","xdk-base/util","xdk-base/device/Media"],function(e,t,i,n,s,r,a){"use strict";var o,l;return l=e.create({singleton:function(){return o||(o=new l),o}},{_curAsset:null,_mediaType:null,_duration:null,_trackingSessionActive:!1,_analytics:t.getAnalyticsService(),_mediaState:"STOPPED",callbacks:{},trackingEnabled:!0,init:function(){},trackOpenMedia:function(e,t,i){this.__debounce(function(){this._curAsset=e,this._mediaType=t,this._duration=i,this._trackingSessionActive=!0,this._analytics.mediaOpen(e,t,i),this._mediaState="PLAYING"},1e3)},trackPlayMedia:function(e){this.__debounce(function(){this._trackingSessionActive?("STOPPED"!==this._mediaState&&this._analytics.mediaStop(this._curAsset,this._mediaType,e),this._analytics.mediaPlay(this._curAsset,this._mediaType,e),this._mediaState="PLAYING"):console.warn("[sTrackingManager: trackPlayMedia] Playback tracking is not activated. Exiting.")},1e3)},trackPauseMedia:function(e){this.__debounce(function(){this._trackingSessionActive?(this._analytics.mediaStop(this._curAsset,this._mediaType,e),this._mediaState="STOPPED"):console.warn("[sTrackingManager: trackPauseMedia] Playback tracking is not activated. Exiting")},1e3)},trackVideoStateChangeSetupCallback:function(){this.callbacks={play:r.bind(this.__trackPlayMediaCallback,this),pause:r.bind(this.__trackPauseMediaCallback,this),timeupdate:r.bind(this.mediaSetPosition,this)},i.subscribe(n.PlayState,this.callbacks.play),i.subscribe(n.PauseState,this.callbacks.pause),i.subscribe(n.BufferState,this.callbacks.pause);var e=a.singleton();e.addEventListener(e.EVT_TIME_UPDATE,this.callbacks.timeupdate)},__trackCloseMediaCallback:function(e){this.trackPauseMedia(e.currentPlaybackTime),this.trackCloseMedia(e.currentPlaybackTime)},__trackPlayMediaCallback:function(e){this.trackPlayMedia(e.currentPlaybackTime)},__trackPauseMediaCallback:function(e){this.trackPauseMedia(e.currentPlaybackTime)},trackCloseMedia:function(e){this.__debounce(function(){this._analytics.mediaClose(this._curAsset,this._mediaType,e),this._curAsset=null,this._mediaType=null,this._duration=null,this._trackingSessionActive=!1},1e3),i.unsubscribe(n.PlayState,this.callbacks.play),i.unsubscribe(n.PauseState,this.callbacks.pause),i.unsubscribe(n.BufferState,this.callbacks.pause);var t=a.singleton();t.removeEventListener(t.EVT_TIME_UPDATE,this.callbacks.timeupdate)},mediaSetPosition:function(e){this._analytics.mediaSetPosition(e)},mediaSetDuration:function(e){this._analytics.mediaSetDuration(e)},trackSearch:function(e){this._analytics.trackSearch(e)},mediaMonitor:function(){this._analytics.mediaMonitor()},__debounce:function(e,t,i){var n,s=this;!function(){function r(){i||e.apply(s,a),n=null}var a=arguments;n?clearTimeout(n):i&&e.apply(s,a),n=setTimeout(r,t)}()}}),l.singleton(),l}),define("tve/mgr/sLinearManager",["xdk-base/class","xdk-base/config","xdk-base/util","tve/sServiceHolder","tve/util/CacheHelper","xdk-ax/data/LocalDatasource","xdk-base/promise","lib/base64","xdk-base/core","xdk-base/console","tve/TVEError","tve/model/TVChannelBuilder","tve/model/ChannelListingBuilder","tve/model/ProgramBuilder","tve/model/MediaCategoryBuilder","tve/model/ResourceBuilder","require","tve/mgr/sVODManager","tvedemo/helper/sMoment","storm/helper/util","tvedemo/model/SportNewsBuilder","storm/mgr/sLanguageManager","storm/mgr/sAppConfigManager","storm/mgr/sLinearChannelManager","tvedemo/mgr/sEndUserManager","xdk-base/device","tvedemo/mgr/sTrackingManager"],function(e,t,i,n,s,r,a,o,l,c,d,u,h,_,g,f,p,m,v,b,S,y,E,k,C,T,x){"use strict";var I,w={PROGRAM:"program",CHANNEL:"channel",CHANNELS:"channels",CHANNELS_DS:"channels_ds",ALL_CHANNELS:"all_channels",ALL_CHANNELS_DS:"all_channels_ds",ALL_CATEGORIES:"all_categories",TV_LISTING:"tv_listing",TV_LISTINGS:"tv_listings",TV_LISTINGS_DS:"tv_listings_ds",CURRENT_PROGRAM:"current_program",CHANNEL_LOGO:"channel_logo",CHANNEL_STREAM:"channel_stream",PROGRAM_THUMBNAIL:"program_thumbnail",PROGRAM_CONTENT:"program_content"},L=d.FACILITY,A=d.ERROR,D=5e3,P=5e3,R=4e3,O=n.getLinearContentService(),N=function(){var e={},t=function(e,t){var i,n,s,r,a={},o=t[0],l=t[1];for(s=e.length,r=0;r<s;r++)i=e[r][o],n=e[r][l],i&&n&&(a[i]=n);return a},n=function(e){if(!e.id||!e.name)throw new d(L.LINEAR_MANAGER,A.INVALID,"The asset cannot be parsed: either id or title is not valid");var n={id:e.id,title:e.name,description:e.description||"",publishedDate:e.publishedDate?new Date(e.publishedDate):null,availableDate:e.publishedDate?new Date(e.availableDate):null,metadata:{},credits:e.credits?t(e.credits,["role","name"]):[],categories:[],parentalRatings:e.parentalRatings||[],images:[k({id:e.id,url:e.logo?I+e.logo:void 0,type:"logo"})]};return e.categories&&i.each(e.categories,function(e){n.categories.push(c(e))}),e.mediaurl&&(n.videos=[k({id:e.id,url:e.mediaurl,mimeType:"ism"})]),n},s=function(e){var t=new u,i=n(e);return i.channelNumber=e.channelNumber,t.setId(i.id).setTitle(i.title).setDescription(i.description).setMetadata(i.metadata).setCategories(i.categories).setGeoLock(i.geoLock).setImages(i.images).setVideos(i.videos).setChannelNumber(i.channelNumber).setMobilepc(e.mobilepc).setPackageCode(e.mobilepc).build()};e.parseTVChannel=s;var r=function(e){var t=new _,i={id:e.id,title:e.title,description:e.subtitle||"",publishedDate:null,availableDate:null,metadata:{},credits:[],categories:[],parentalRatings:[],images:[],epgBlackout:e.epgBlackout};return i.startTime=b.parseSkyDateTimeToDate(e.startDate,e.startTime).getTime(),i.endTime=b.parseSkyDateTimeToDate(e.endDate,e.endTime).getTime(),i.inlineMetadata=a(i),t.setId(i.id).setTitle(i.title).setDescription(i.description).setMetadata(i.metadata).setImages(i.images).setStartTime(i.startTime).setEndTime(i.endTime).setVideos(i.videos).setInlineMetadata(i.inlineMetadata).setEpgBlackout(i.epgBlackout).build()};e.parseProgram=r;var a=function(e){var t="";return e.startTime&&e.endTime&&(t+=v(e.startTime).format(y.getString("ui.format.epgEventTime"))+" - ",t+=v(e.endTime).format(y.getString("ui.format.epgEventTime")),t+=" ("+(0|v(e.endTime).diff(v(e.startTime)))/6e4+y.getString("ui.format.minutesDurationSuffix")+")"),e.category&&(t+=" | "+e.category),e.country&&e.year?t+=" | "+e.country+" "+e.year:e.country?t+=" | "+e.country:e.year&&(t+=" | "+e.year),e.fsk&&(t+=" | "+e.fsk),t},o=function(e,t){var i=t.title2?t.title2+". ":"";return t.detailTxt&&(i+=t.detailTxt),t.startTime=e.get("startTime"),t.endTime=e.get("endTime"),e.set("id",t.id).set("title",t.title1).set("description",i).set("images",[{file:t.imageUrl,path:"",width:557,height:313}]).set("inlineMetadata",a(t)).set("synopsis",t.detailTxt).set("country",t.country).set("parentalRating",{display:t.fskInfo}).set("year",t.year).set("assetId",t.assetid).set("catalog",t.catalog).set("licensing",t.eLicense)};e.parseFullProgram=o;var l=function(t){var n=new h,s={};return s.channelId=t.channelId,t.programs&&(s.programs=[],i.each(t.programs,function(t){s.programs.push(e.parseProgram(t))})),n.setChannelId(s.channelId).setPrograms(s.programs).build()};e.parseChannelListing=l;var c=function(e){if(!e.id||!e.title)throw new d(L.LINEAR_MANAGER,A.INVALID,"Cannot parse category: either id or title is not valid");var t=new g,n={id:e.id,title:e.title,description:e.description||"",categories:[]};return e.categories&&i.each(e.categories,function(e){n.categories.push(c(e))}),t.setId(n.id).setTitle(n.title).setDescription(n.description).build()};e.parseMediaCategory=c;var p=function(e){return{id:e.id,title:e.item_title,synopsis:e.item_body,date:e.item_Create_Date,categoryName:e.item_category_name,images:[{file:e.item_image,path:"",width:557,height:313}]}},m=function(e){var t=new S,i=p(e);return t.setId(i.id).setImages(i.images).setTitle(i.title).setSynopsis(i.synopsis).setDate(i.date).setCategoryName(i.categoryName).build()},E=function(e){var t=[];return i.each(e,function(e){t.push(m(e))}),t};e.parseSportNewsList=E;var k=function(e){var t=new f,i={id:e.id,url:e.url||"",mimeType:e.format||"",metadata:{},language:e.language||"",duration:e.duration||0,geoLock:e.geoLock||!1,width:e.width||0,height:e.height||0};return e.type&&(i.metadata.type=e.type),t.setId(i.id).setUrl(i.url).setMimeType(i.mimeType).setMetadata(i.metadata).setDuration(i.duration).setGeoLock(i.geoLock).setWidth(i.width).setHeight(i.height).build()};return e.parseResource=k,e}();return new(e.create({SORT_BY:{TITLE:"title|asc",LATEST:"publishedDate|desc"}},{init:function(){O.acquireCMSRoot().then(function(e){I=e}),this.__initializeCache()},__initializeCache:function(){"playstation"===T.platform&&(D=1e3,P=1e3,R=1e3),this._programsCache=new s({ttl:18e5,size:P}),this._cache=new s({ttl:18e5,size:D}),this._resourceCache=new s({ttl:18e5,size:R})},getChannelListingsByDate:function(e,t){var n={};e=e||new Date,t&&t.length>0&&(n.channelId=t);var s=this.__generateCacheKey(w.TV_LISTINGS,{date:e.getTime()}),r=this._cache.getCache(s);return r||(r=O.getAllChannelListings(e.setHours(0,0,0,0),e.setHours(23,59,59,999),n).then(i.bind(function(t){for(var n=i.reduce(t.entries,function(e,t){return e.push(N.parseChannelListing(t)),e},[]),s=e.setHours(0,0,0,0),r=0,a=n.length;r<a;r++){var o=n[r].get("programs"),l=this.__generateCacheKey(w.TV_LISTING,{channelId:n[r].get("channelId"),date:s});this._cache.setObject(l,o);for(var c,d=0,u=o.length;d<u;d++){var h=o[d];c=this.__generateCacheKey(w.PROGRAM,{id:h.get("id")}),this._programsCache.setObject(c,h)}}return n},this)),this._cache.setObject(s,r),r)},getChannelListingsByChannelIds:function(e,t){t=t||new Date;var n=this.__generateCacheKey(w.TV_LISTING,{data:Math.floor(t.getTime()/864e5),channelIds:e.join("")}),s=this._cache.getCache(n);return s||(s=O.getChannelListingsByChannelIds(e,t.setHours(0,0,0,0),t.setHours(23,59,59,999)).then(i.bind(function(e){return i.reduce(e.entries,function(e,t){return e.push(N.parseChannelListing(t)),e},[])},this)),this._cache.setObject(n,s),s)},getChannels:function(e){if(e=e||{},e.sortBy){var t=e.sortBy.split("|");e.sortingKey=t[0],e.sortingOrder=t[1]}var n=this.__generateCacheKey(w.ALL_CHANNELS,e),s=this._cache.getCache(n);if(s)return a.resolve(s);var r=i.bind(function(e){for(var t,i=0,n=e.length;i<n;i++)t=this.__generateCacheKey(w.CHANNEL,{channelId:e[i].get("id")}),this._cache.setObject(t,e[i])},this);return e.channelIds?O.getChannelsByIds(e.channelIds,e).then(i.bind(function(t){return s=i.reduce(t.entries,function(e,t){return e.push(N.parseTVChannel(t)),e},[]),r(s),"number"==typeof e.startIndex&&e.count&&(s=s.slice(e.startIndex,e.startIndex+e.count)),this._cache.setObject(n,s),s},this)):O.getAllChannels(e).then(i.bind(function(e){return s=i.reduce(e.entries,function(e,t){var i=N.parseTVChannel(t);return e.push(i),e},[]),r(s),this._cache.setObject(n,s),s},this))},getChannelsDs:function(e){if(e=e||{},e.sortBy){var t=e.sortBy.split("|");e.sortingKey=t[0],e.sortingOrder=t[1]}var n,s=new r,a=this.__generateCacheKey(w.ALL_CHANNELS_DS,e),o=this._cache.getCache(a);return o||(n=i.bind(function(t){var n=i.extend({pageSize:50,pageNumber:1+Math.floor(t/50)},e),s=i.bind(function(e){return{total:e.totalCount,data:i.reduce(e.entries,function(e,t){return e.push(N.parseTVChannel(t)),e},[])}},this);return e.channelIds?O.getChannelsByIds(e.channelIds,n).then(s):O.getPermittedChannels(n).then(s)},this),s.setDataLoader(n),this._cache.setObject(a,s),s)},getChannelById:function(e){var t=this.__generateCacheKey(w.CHANNEL,{channelId:e}),i=this._cache.getCache(t);return i?a.resolve(i):(c.warn("getChannelById("+e+") failed due to cache miss"),a.reject())},getChannelLogo:function(e,t){var i=this.__generateCacheKey(w.CHANNEL_LOGO+e.get("id")),n=this._resourceCache.getCache(i);return n?a.resolve(n):this.__getImageAndCacheWithFallback(e,"logo",i,t)},getChannelLogoUrl:function(e){return this.getChannelLogo(e).then(function(e){return e.get("url")})},getChannelStream:function(e){var t=this.__generateCacheKey(w.CHANNEL_STREAM+e.get("id")),i=this._resourceCache.getCache(t);return i?a.resolve(i):(i=e.get("videos")[0],i?(this._resourceCache.setObject(t,i),a.resolve(i)):a.reject(new d(L.LINEAR_MANAGER,A.INTERNAL,"no stream found")))},getCurrentProgramByChannelId:function(e){var t,n=(new Date).getTime(),s=this.__generateCacheKey(w.TV_LISTING,{channelId:e,date:(new Date).setHours(0,0,0,0)}),r=this._cache.getCache(s),o=function(e){for(var t=0,i=e.length;t<i;t++){var s=e[t],r=s.get("startTime"),a=s.get("endTime");if(n>=r&&n<a)return s}};return r?(t=o(r),t?a.resolve(t):a.reject(new d(d.FACILITY.LINEAR_MANAGER,d.ERROR.INVALID,"Cannot get the program"))):this.getChannelListingsByDate().then(i.bind(function(){var e=this._cache.getCache(s),t=o(e);if(t)return t;throw new d(d.FACILITY.LINEAR_MANAGER,d.ERROR.INVALID,"Cannot get the program")},this))},getProgramByChannelId:function(e,t){var n=this.__generateCacheKey(w.PROGRAM,{channelId:e,programStartTime:t}),s=this._programsCache.getCache(n);return s?a.resolve(s):O.getChannelListingByChannelId(e,t,t+1e3).then(i.bind(function(e){var t=e.programs;if(t&&t.length){var i=N.parseProgram(t[0]);return this._programsCache.setObject(n,i),i}throw new d(d.FACILITY.LINEAR_MANAGER,d.ERROR.INVALID,"Cannot get the program")},this))},getProgramById:function(e,t){if(0===e)return O.getEventDetails(e,t).then(i.bind(function(e){return r=(new _).build(),N.parseFullProgram(r,e)},this));var n=this._programsCache,s=this.__generateCacheKey(w.PROGRAM,{id:e}),r=n.getCache(s)||(new _).build();if(!i.isUndefined(t)){var o=this.__generateCacheKey(w.PROGRAM,{id:e,channelId:t}),l=n.getCache(o);return l?a.resolve(l):O.getEventDetails(e,t).then(i.bind(function(e){return l=N.parseFullProgram(r,e),n.setObject(o,l),l},this))}return r?a.resolve(r):void 0},getProgramThumbnail:function(e,t){var i=this.__generateCacheKey(w.PROGRAM_THUMBNAIL+e.get("id")),n=this._resourceCache.getCache(i);return n?a.resolve(n):this.__getImageAndCacheWithFallback(e,"thumbnail",i,t)},getProgramContent:function(e){var t=this.__generateCacheKey(w.PROGRAM_CONTENT+e.get("id")),i=this._resourceCache.getCache(t);return i?a.resolve(i):(i=e.get("videos")[0],i?(this._resourceCache.setObject(t,i),a.resolve(i)):a.reject(new d(L.LINEAR_MANAGER,A.INTERNAL,"no content found")))},__generateCacheKey:function(e,t){var n=t?i.toQueryString(t):"",s=e+"?"+n;return window.btoa?window.btoa(s):o.encode(s)},__getImageForResourceArrayByType:function(e,t){for(var i,n=0,s=e.length;n<s;n++)if(e[n].get("metadata").type===t){i=e[n];break}return i},__getImageAndCacheWithFallback:function(e,t,i,n){var s=this.__getImageForResourceArrayByType(e.get("images"),t);return s?(this._resourceCache.setObject(i,s),a.resolve(s)):n?a.resolve(n):a.reject(new d(L.VOD_MANAGER,A.INTERNAL,t+" not found"))},getEpgEventByEventIdAndChannelId:function(e,t){return this.getChannels().then(i.bind(function(){return a.all([this.getProgramById(e,t),this.getChannelById(t)]).then(i.bind(function(t){var i=t&&t[0],n=t&&t[1];return i.set("packageCode",n.get("mobilepc")),i.set("packageColorCode",n.get("mobilepc")),i.set("channel",n),i.get("id")||i.set("id",e),i},this))},this))},getChannelsByIds:function(e){var t=this.__generateCacheKey(w.CHANNELS,{channelIds:e.join("")}),i=this._cache.getCache(t);return i||(i=this.getChannels({channelIds:e}),this._cache.setObject(t,i),i)},getChannelsDsByIds:function(e){return this.getChannelsDs({channelIds:e})},getChannelListingDsByDate:function(e){e=e||new Date;var t=new r,i=function(){return n.getLinearContentService().getAllTVListings(e.setHours(0,0,0,0),e.setHours(23,59,59,999)).then(function(e){if(e.totalCount)return{total:e.totalCount,data:e.entries};throw new d(L.LINEAR_MANAGER,A.INTERNAL,"The data format is unexpected.")})};return t.setDataLoader(i),t},getProgramGuideDatasource:function(e){var t=a.defer();return e=e||null,p(["tvedemo/ext/ui/programguide/ChannelListingDatasource"],function(i){t.resolve(new i(e))},function(e){t.reject(new d(L.LINEAR_MANAGER,A.INTERNAL,"ChannelListingDatasource cannot be loaded"))}),t.promise},getVODAsset:function(e){var t=e.get("metadata");switch(t.VOD$type){case"movie":return m.getMovieById(t.VOD$movie);case"episode":return m.getEpisodeById(t.VOD$episode);default:return a.reject(new d(L.LINEAR_MANAGER,A.INTERNAL,"No associated VOD asset"))}},getCurrentlyRunningEvents:function(){return O.getCurrentlyRunningEvents().then(function(e){return E.getPermittedLinearChannels().then(function(t){var n="|"+t.join("|")+"|";return e=e.filter(function(e){try{return!!(-1!==n.indexOf("|"+e.channel.id+"|")&&!e.event.epgBlackout&&i.isString(e.channel.mediaurl)&&e.channel.mediaurl.length>4)||!i.isUndefined(e.event.assetid)&&e.event.assetid>0}catch(e){return c.warn("Filtering out an event that can't be inspected successfully: "+e),!1}})})})},getAssetListing:function(e){return e&&e.length?O.getAssetList(e):(c.error("path is empty"),a.reject("path is empty"))},getLetterHeaderListing:function(e){return e&&e.length?O.getLetterList(e):(c.error("path is empty"),a.reject("path is empty"))},constructCMSUrlPromise:function(e){return e&&e.length?O.acquireCMSRoot().then(function(t){return t+e}):a.resolve("")},getSportNewsAssetsByCategory:function(e){return O.getSportNewsByCategory(e).then(i.bind(function(e){var t=e&&e.listing&&e.listing.listing&&e.listing.listing.item;return t=N.parseSportNewsList(t)},this))},getSearchResults:function(e,t){return e&&e.length?((new x).trackSearch(e),O.searchFor(e,{catalog:t})):(c.error("empty keyword!"),a.reject("empty keyword!"))}}))}),define("css!tvedemo/wgt/css/AssetButton",[],function(){}),define("tvedemo/wgt/AssetButton",["xdk-base/class","xdk-base/core","xdk-ax/Container","xdk-ui-basic/Image","xdk-ui-basic/Label","xdk-base/util","xdk-ax/Component","tvedemo/helper/sMoment","xdk-ax/evt/type","tve/model/Resource","tve/model/Asset","tvedemo/wgt/ChannelLogo","tve/model/Episode","tve/model/TVShow","tve/model/TVChannel","xdk-base/console","tve/mgr/sVODManager","tvedemo/mgr/sEndUserManager","tvedemo/mgr/sAssetManager","tve/mgr/sLinearManager","xdk-base/promise","css!./css/AssetButton"],function(e,t,i,n,s,r,a,o,l,c,d,u,h,_,g,f,p,m,v,b,S){"use strict";var y="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAAlwSFlzAAALEwAACxMBAJqcGAAAAA1JREFUCNdjYGBgMAYAADgANNF/knAAAAAASUVORK5CYII=",E={EPISODE:"episode",MOVIE:"movie",TV_SHOW:"tvShow",PROGRAM:"program",TV_CHANNEL:"tvChannel"},k=function(e){var t=E.MOVIE;return e instanceof h?t=E.EPISODE:e instanceof _?t=E.TV_SHOW:e instanceof g&&(t=E.TV_CHANNEL),t};return e.create(i,{},{_asset:null,__title:"",_thumbnailImage:null,_labelContainer:null,_titleLabel:null,_thumbnail:null,_showEpisodeNumber:!1,_showPrice:!1,_showExpiry:!1,init:function(e){if(!e.asset||!e.asset instanceof d)throw t.createException("IncorrectParam","opts.asset must be an instance of tve/model/Asset.");e.focusable=!0,e.clickable=!0,this._super(e),this.addClass("wgt-assetbtn"),this._asset=e.asset,this.__title=this._asset.get("title"),this.__assetType=k(this._asset),this._showEpisodeNumber=e.showEpisodeNumber||!1,this._showSeasonNumber=e.showSeasonNumber||!1,this._showPrice=e.showPrice||!1,this._showExpiry=e.showExpiry||!1,this._icon=e.icon||!1,this._transition=e.transition||!0,this._labelContainer=new i({css:"wgt-assetbtn-container"}),this._transition&&(this.addClass("transparent"),this.__attachedToDom=r.defer().then(r.bind(function(){this.removeClass("transparent"),this.removeEventListener(l.ATTACHED_TO_DOM,this.__attachedToDom)},this)),this.addEventListener(l.ATTACHED_TO_DOM,this.__attachedToDom)),this.__assetType===E.TV_CHANNEL?this._thumbnailImage=new u({css:"wgt-assetbtn-thumbnail",src:y}):this._thumbnailImage=new n({css:"wgt-assetbtn-thumbnail",src:y}),this._getThumbnail(),this.attach(this._thumbnailImage),this.attach(this._labelContainer),this._setupContainer()},_getThumbnail:function(){v.getStormAssetDvdCover(this._asset).fail(r.bind(function(e){return f.warn("[AssetButton] failed to get thumbnail for "+this._asset.get("title")+": "+e),this._getPlaceholder()},this)).then(r.bind(function(e){this._thumbnail=e,this._thumbnailImage.setSrc(this._thumbnail)},this)).done()},_getPlaceholder:function(){var e;switch(this.__assetType){case E.TV_SHOW:case E.EPISODE:e="img/placeholders/show_placeholder.png";break;case E.MOVIE:e="img/placeholders/movie_placeholder.png";break;default:e=y}return e},_setupContainer:function(){if(this._showEpisodeNumber&&this.__assetType===E.EPISODE){var e=this._asset.get("episodeNumber");e&&new s({css:"wgt-assetbtn-episode",text:"Episode "+e,parent:this._labelContainer})}this._titleLabel=new s({css:"wgt-assetbtn-title",text:this.__title,parent:this._labelContainer}),this._showSeasonNumber&&this.__assetType===E.TV_SHOW&&this._setUpSeasonNumberLabel(),this._icon&&new a({css:"wgt-assetbtn-icon",parent:this})},_setUpSeasonNumberLabel:function(){var e,t,i,n,r,a,o,l=this._labelContainer;if(t=this._asset.get("seasonIds"),(n=t.length)>0){for(e=new s({css:"wgt-assetbtn-season",text:"",parent:this._labelContainer}),r=[],i=0;i<n;i++)r.push(p.getTVSeasonById(t[i]));S.all(r).then(function(t){if(n=t.length,a=t[0],o=a.get("seasonNumber")||0,a){for(i=1;i<n;i++)t[i].get("seasonNumber")>o&&(a=t[i],o=a.get("seasonNumber"));e.setText("Season "+o),l.addClass("with-season")}})}}})}),define("tvedemo/wgt/AssetGrid",["xdk-base/class","tvedemo/wgt/BasicGrid","tvedemo/wgt/AssetButton","xdk-base/util"],function(e,t,i,n){return e.create(t,{},{_arrows:[],_alignment:0,init:function(e){this._super(e),this.addClass("wgt-assetgrid"),this.setButton(e.button)},setDatasource:function(e){return this._super(e).then(n.bind(this._updateArrows,this))},setButton:function(e){this.setDisplayStgy(function(t){var s={css:"wgt-assetbutton",asset:t};return e&&(s=n.extend(s,e)),new i(s)})}})}),define("tvedemo/tmpl/epgEvent",["xdk-ui-basic/Layout","xdk-ui-basic/Label","storm/wgt/Image","xdk-ax/Container","xdk-ui-basic/Button","tvedemo/wgt/AssetGrid","tvedemo/wgt/ScrollLabel","tvedemo/wgt/ImageButton","storm/mgr/sAppConfigManager"],function(e,t,i,n,s,r,a,o,l){"use strict";return function(){return{klass:e,alignment:e.VERTICAL,id:"#epgEvent",children:[{klass:e,alignment:e.VERTICAL,children:[{klass:e,id:"#upContainer",children:[{klass:i,id:"#thumbnail",placeHolderPromise:l.getPlaceholderLandscape},{klass:e,id:"#blackoutMessageContainer",children:[{klass:t,id:"#blackoutMessage"}]},{klass:n,css:"informationContainer",children:[{klass:t,id:"#title"},{klass:e,id:"#metaDataContainer",alignment:e.HORIZONTAL},{klass:i,id:"#channelLogo"},{klass:n,id:"missingPackage",css:"missingPackage",children:[{klass:i,id:"missingPackageLogo",css:"missingPackageLogo"},{klass:t,id:"missingPackageText",css:"missingPackageText"}]}]}]},{klass:e,alignment:e.HORIZONTAL,id:"#videoButtonContainer",children:[{klass:o,id:"epgEventTuneIn",text:"",nextRight:"detailDescription"},{klass:o,id:"epgEventStartVod",text:"",nextRight:"detailDescription",nextLeft:"epgEventStartVod"},{klass:o,id:"epgEventWatchTrailer",text:"",nextLeft:"epgEventWatchTrailer",nextRight:"detailDescription"},{klass:o,id:"addToWatchlist",text:"",nextRight:"detailDescription",nextLeft:"addToWatchlist"}]},{klass:a,id:"detailDescription",scrollStep:72,nextLeft:"videoButtonContainer",nextUp:"header",nextDown:"detailDescription"}]}]}}}),define("tvedemo/wgt/FooterButton",["xdk-base/class","xdk-base/util","xdk-ui-basic/Layout","xdk-base/Element","xdk-ui-basic/Image","xdk-ui-basic/Label"],function(e,t,i,n,s,r){return e.create(i,{},{_label:null,_icon:null,init:function(e){e.focusable=e.focusable||!1,e.clickable=!1,e.children=[],e.icon&&(this._icon=new s({src:e.icon}),e.children.push(this._icon)),this._label=new r({text:e.text||"",isPureText:e.isPureText||!1}),e.children.push(this._label),this._super(e),this.getRoot().addClass("footer-button")},setText:function(e,t){this._label.setText(e,t)}})}),define("tvedemo/wgt/Footer",["xdk-base/class","xdk-ui-basic/Layout","xdk-base/util","xdk-ui-basic/Image","tvedemo/wgt/FooterButton","xdk-ax/evt/type","xdk-base/device","xdk-base/device/vKey"],function(e,t,i,n,s,r,a,o){return e.create(t,{},{_iconSet:null,_buttons:{},_enabled:[],init:function(e){if(e=e||{},!e.iconSet)throw new Error("icon set not defined");this._iconSet=e.iconSet;var t=e.btnTextMap||{};this._createBtns(),this.update(t),e.children=i.values(this._buttons),this._super(e)},_createBtns:function(){i.each(this._iconSet.keys,i.bind(function(e){var t=e.key,i=null;this._iconSet.imgs[t]&&(i="img/nav_bar/"+this._iconSet.imgs[t]+".png"),this._buttons[t]=new s({icon:i,text:""}),this._buttons[t].hide()},this))},isCaptureKey:function(e){var t=!1;return i.each(this._enabled,i.bind(function(n){if(i.indexOf(this._iconSet.keys[n],e.id)>-1)return t=!0,i.breaker},this)),t},update:function(e){this._enabled=[],i.each(this._iconSet.keys,i.bind(function(t){var i=t.key,n=this._buttons[i],s=e[i];n.hide(),s&&(n.setText(s),n.show(),this._enabled.push(i))},this))}})}),define("tvedemo/wgt/FooterIconMap",["xdk-base/device","xdk-base/device/vKey"],function(e,t){var i={DEFAULT:{keys:{colorRed:[t.RED.id],colorGreen:[t.GREEN.id],colorYellow:[t.YELLOW.id],colorBlue:[t.BLUE.id],playPause:[t.PLAY.id,t.PAUSE.id,t.PLAY_PAUSE.id,t.STOP.id,t.FF.id,t.RW.id],controls:[t.PLAY.id,t.PAUSE.id,t.STOP.id,t.RW.id,t.FF.id],liveControls:[t.STOP.id],prevNext:[t.PREV.id,t.NEXT.id,"device:kb-vkey:p","device:kb-vkey:n",t.FF.id,t.RW.id],menu:["samsung:vkey:tools","device:kb-vkey:m"],arrowAll:[t.UP.id,t.DOWN.id,t.LEFT.id,t.RIGHT.id],arrowUpDown:[t.UP.id,t.DOWN.id],arrowLeftRight:[t.LEFT.id,t.RIGHT.id],num:[t.KEY_0.id,t.KEY_1.id,t.KEY_2.id,t.KEY_3.id,t.KEY_4.id,t.KEY_5.id,t.KEY_6.id,t.KEY_7.id,t.KEY_8.id,t.KEY_9.id],enter:[t.OK.id],back:[t.BACK.id],exit:[t.EXIT.id]},imgs:{colorRed:"red",colorGreen:"green",colorBlue:"blue",colorYellow:"yellow",prevNext:"prev_next",playPause:"video_control",menu:"top",arrowAll:"move",arrowUpDown:"up_down",arrowLeftRight:"left_right",num:"num",enter:"enter",back:"back",exit:"exit",controls:"fs-controls",liveControls:"fs-live-controls"}},ALERT:{keys:{enter:[t.OK.id],back:[t.BACK.id]},imgs:{enter:"enter",back:"back"}},CONFIRM:{keys:{enter:[t.OK.id],back:[t.BACK.id]},imgs:{enter:"enter",back:"back"}},DIALOG:{keys:{arrowAll:[t.UP.id,t.DOWN.id,t.LEFT.id,t.RIGHT.id],arrowUpDown:[t.UP.id,t.DOWN.id],arrowLeftRight:[t.LEFT.id,t.RIGHT.id],enter:[t.OK.id],back:[t.BACK.id]},imgs:{arrowAll:"move",arrowUpDown:"up_down",arrowLeftRight:"left_right",enter:"enter",back:"back"}},SORT:{keys:{enter:[t.OK.id],back:[t.BACK.id]},imgs:{enter:"enter",back:"back"}}};return"playstation"===e.platform&&(i={DEFAULT:{keys:{colorYellow:["playstation:vkey:triangle"],arrowLeftRight:[t.LEFT.id,t.RIGHT.id],enter:[t.OK.id],back:[t.BACK.id]},imgs:{colorYellow:"triangle",arrowLeftRight:"left_right",enter:"cross",back:"circle"}},ALERT:{keys:{enter:[t.OK.id],back:[t.BACK.id]},imgs:{enter:"cross",back:"circle"}},CONFIRM:{keys:{enter:[t.OK.id],back:[t.BACK.id]},imgs:{enter:"cross",back:"circle"}},DIALOG:{keys:{arrowAll:[t.UP.id,t.DOWN.id,t.LEFT.id,t.RIGHT.id],arrowUpDown:[t.UP.id,t.DOWN.id],arrowLeftRight:[t.LEFT.id,t.RIGHT.id],enter:[t.OK.id],back:[t.BACK.id]},imgs:{arrowAll:"move",arrowUpDown:"up_down",arrowLeftRight:"left_right",enter:"cross",back:"circle"}},SORT:{keys:{enter:[t.OK.id],back:[t.BACK.id]},imgs:{enter:"enter",back:"back"}}}),i}),define("xdk-ui-grid/ScrollingGrid",["xdk-base/class","xdk-ui-grid/Grid","xdk-ui-grid/gridStgy","xdk-base/util","css!./css/Grid"],function(e,t,i,n){"use strict";return e.create(t,{},{init:function(e){this._super(e);var s=e.alignment===t.VERTICAL;this.setPrereadyStgy(i.BASIC_PREREADY_STGY),this.setCheckScrollableStgy(i.BASIC_CHECK_SCROLLABLE_STGY),this.setCheckSelectableStgy(i.BASIC_CHECK_SELECTABLE_STGY),this.setDataMappingStgy(i.BASIC_DATA_MAPPING_STGY),this.setScrollEntranceStgy(n.bind(i.BASIC_SCROLL_ENTRANCE_STGY,this,s)),this.setScrollShiftStgy(i.BASIC_SCROLL_SHIFT_STGY),this.setScrollExitStgy(i.BASIC_SCROLL_EXIT_STGY),this.setOnUpdateStgy(i.BASIC_ONUPDATE_STGY),this.setKeyNavigationStgy(s?i.BASIC_VERTICAL_KEY_NAVIGATION_STGY:i.BASIC_HORIZONTAL_KEY_NAVIGATION_STGY),
this.setDsRangeCalculationStgy(i.BASIC_DS_RANGE_CALCULATION_STGY)}})}),define("tvedemo/wgt/TextSelectionList",["xdk-base/class","xdk-ui-grid/ScrollingGrid","xdk-ui-basic/Button"],function(e,t,i){"use strict";return e.create(t,{},{init:function(e){e.rows=e.rows||5,e.cols=1,e.forwardFocus=!0,e.alignment=t.HORIZONTAL,this._super(e),this.addClass("wgt-selectionlist"),this.setDisplayStgy(function(e){return new i({css:"wgt-selectionlist-option",text:e.text})})},getSelectionState:function(){return{row:this._selectedGridRow,col:this._selectedGridCol,canScrollForward:this.getDatasource().getTotalCount()-this._firstSlotDsIndex>this._rows,canScrollBackward:0!==this._firstSlotDsIndex}}})}),define("tvedemo/wgt/TextSelectionListDialog",["xdk-base/class","fix/Dialog","xdk-base/util","xdk-ax/Container","tvedemo/wgt/Footer","tvedemo/wgt/FooterIconMap","tvedemo/wgt/TextSelectionList","storm/helper/util","xdk-ui-basic/Label","xdk-ui-basic/Image","xdk-ax/focusManager","xdk-ax/evt/type"],function(e,t,i,n,s,r,a,o,l,c,d,u){return e.create(t,{EVT_SELECTED:"evt:selected"},{init:function(e){e=e||{},e.items=e.items||[],e.size=e.size||5,e.headerText=e.headerText||"Sort by",e.footerIcon=e.footerIcon||{arrowUpDown:"Move",enter:"Select",back:"Back"},e.header=this._createHeader(e),e.content=this._createContent(e),e.footer=this._createFooter(e),this._super(e),this.setOption("forwardFocus","list"),this.addClass("wgt-textselection-dialog")},_createHeader:function(e){return new n({css:"header-container",children:[new l({css:"header-text",text:e.headerText}),new c({css:"header-line",src:"img/popup_date_sortby/divider.png"})]})},_createList:function(e){return new a({id:"list",rows:e.size})},_createContent:function(e){var t,s,r=o.arrayToDs(e.items),a=this._createList(e);return a.setDatasource(r).then(function(){d.focus(a)}),a.addEventListener(u.CLICK,i.bind(function(){this.dispatchEvent(this.constructor.EVT_SELECTED,a.getSelectedDsIndex())},this)),t=new c({css:"arrow_up",src:"img/arrow_up.png"}),s=new c({css:"arrow_down",src:"img/arrow_down.png"}),a.addEventListener(u.SELECTION_CHANGED,function(e){var i=a.getSelectionState();i.canScrollForward?s.enable():s.disable(),i.canScrollBackward?t.enable():t.disable()}),new n({css:"content-container",children:[t,a,s]})},_createFooter:function(e){var t=new s({css:"footer",iconSet:r.SORT});return t.update(e.footerIcon),new n({css:"footer-container",children:[new c({css:"footer-line",src:"img/popup_date_sortby/divider.png"}),t]})},open:function(){this._super(),this._lastFocus=d.getCurFocus()},close:function(){this._super(),this.deinit()}})}),define("storm/mgr/sGeolocationManager",["xdk-base/class","xdk-base/util","xdk-base/promise","xdk-base/console","xdk-base/ajax","storm/mgr/sAppConfigManager"],function(e,t,i,n,s,r){"use strict";return new(e.create({},{getLocationCode:function(){return this._getLocationCodePromise||(this._getLocationCodePromise=r.getGeolocationSettings().then(function(e){return"DE"},function(e){n.warn("Trouble getting geo-location settings: "+e)})),this._getLocationCodePromise}}))}),define("storm/mgr/sLicensingManager",["xdk-base/class","xdk-base/util","xdk-base/promise","xdk-base/console","tve/TVEError","storm/helper/util","storm/mgr/sEditorialManager","storm/mgr/sGeolocationManager"],function(e,t,i,n,s,r,a,o){"use strict";return new(e.create({},{getContentLicence:function(e){if(!e||0===e.length)return i.resolve("No licence scope means automatically licensed");if(-1!==e.indexOf("&"))return i.reject("Old-style license scope descriptions not yet supported");var n=e.split(",");return o.getLocationCode().then(function(e){return a.getEditorialContent(a.CONTENT.PLATFORM_LICENSES).then(function(s){var r,a=s.responseJSON;return t.each(n,function(i){var n=a[i];if(n){var s=n.split("/");if(("ALL"===s[0]||s[0]===e)&&"IPAD"===s[2])return r=i,t.each.breaker}}),r?i.resolve("Licensed, thanks to matching chunk "+r):i.reject("Not licensed; no matching chunk found in "+n)})})}}))}),define("storm/mgr/sEhubDataManager",["xdk-base/ax","xdk-base/core","xdk-base/util","xdk-base/class","xdk-base/promise","tve/sServiceHolder","tvedemo/helper/sMoment","storm/mgr/sLanguageManager"],function(e,t,i,n,s,r,a,o){"use strict";var l=r.getLinearContentService(),c=r.getDateTimeService();return new(n.create({},{checkIfChannelIsOnAir:function(e){return c.getServerDateTime().then(function(t){var n=a(t).format(o.getString("ui.format.epgEventTime"));return l.getChannelListingsByChannelIds([e],t,t).then(function(t){var r=t&&t.entries&&t.entries[0]&&t.entries[0][e],a=!1;return i.each(r,function(e){if(e.startTime<=n&&n<e.endTime)return a=!0,i.breaker}),s.resolve(a)},function(){return s.resolve(!1)})},function(){return s.resolve(!1)})}}))}),define("tvedemo/helper/sPlaybackHelper",["xdk-base/ax","xdk-base/class","tvedemo/wgt/Loading","tvedemo/mgr/sEndUserManager","xdk-base/promise","storm/mgr/sLanguageManager","tvedemo/helper/dialogHelper","xdk-base/util","xdk-ax/focusManager","storm/mgr/sSilkMessagesManager","storm/mgr/sAppConfigManager","xdk-base/device","xdk-ax/mediator","storm/helper/silkResponseHelper","storm/helper/util","storm/mgr/sLicensingManager","tvedemo/mgr/sAssetManager","storm/mgr/sEhubDataManager","storm/mgr/sLinearChannelManager","tvedemo/mgr/sHistoryManager"],function(e,t,i,n,s,r,a,o,l,c,d,u,h,_,g,f,p,m,v,b){"use strict";return new(t.create({},{RECENTLYWATCHED_IMAGE_HEIGHT:383,RECENTLYWATCHED_IMAGE_WIDTH:680,__adultContent:16,watchTrailer:function(e){if(i.open(),e){var t=e.get("trailer"),s=t&&t.get("url"),r=t&&t.get("parentalRating").value;s?r>=this.__adultContent?(i.close(),n.loginCheck().then(o.bind(function(){this.__checkFsk(t).then(o.bind(function(t){this.playVideo({url:s,useDrm:!1,isMovie:!1,videoAsset:e})},this))},this))):this.playVideo({url:s,useDrm:!1,isMovie:!1,videoAsset:e}):i.close()}else i.close()},__checkFsk:function(e,t,d){if(d||(d=s.defer()),e.get("parentalRating")&&e.get("parentalRating").value>=this.__adultContent){var u,h;switch(console.log("Remaining attempts: "+t),t){case 1:h=r.getString("PinEntry.PinEntry_YP_labelpin_entry_3_hl"),u=r.getString("PinEntry.PinEntry_YP_labelpin_entry_3_message");break;case 2:h=r.getString("PinEntry.PinEntry_YP_labelpin_entry_2_hl"),u=r.getString("PinEntry.PinEntry_YP_labelpin_entry_2_message");break;default:h=r.getString("PinEntry.PinEntry_YP_labelpin_entry_1_hl"),u=r.getString("PinEntry.PinEntry_YP_labelpin_entry_ge1_message")}i.close(),a.input({dialogCss:"pin-dialog",finishedTextInput:o.bind(function(t){if(t)n.checkFskPin(t).then(o.bind(function(e){d.resolve("PIN correct")},this),o.bind(function(t){if(t&&t.remainingAttempt>0)this.__checkFsk(e,t.remainingAttempt,d);else if(t&&t.remainingAttempt<=0)a.error({title:r.getString("PinEntry.PinEntry_YP_labelpin_entry_4_hl"),reason:r.getString("PinEntry.PinEntry_YP_labelpin_entry_4_message"),closeAction:o.bind(function(){d.reject("PIN not entered correctly")},this),buttonText:r.getString("Global.Global_Continue")});else{var i=t&&t.resultCode;c.getSilkMessageForCode(i).then(function(e){var t=e&&e.get("title"),i=e&&e.get("description");a.error({title:t,reason:i,closeAction:o.bind(function(){d.reject("PIN not entered correctly")},this),buttonText:r.getString("Global.Global_Continue")})},function(){a.error({reason:r.getString("Global.Global_generalError"),closeAction:o.bind(function(){d.reject("PIN not entered correctly")},this),buttonText:r.getString("Global.Global_Continue")})})}},this));else{var i=l.getLastActiveFocus();l.focus(i),d.reject("No PIN entered")}},this),canceledTextInput:o.bind(function(){var e=l.getLastActiveFocus();l.focus(e),d.reject("PIN entry cancelled")},this),doNegativeActionOnClose:!0,title:h,message:u,maxLength:4,isPassword:!0,inputCss:"keyboard-number",keyMap:"number",positiveText:r.getString("Global.Global_Continue"),negativeText:r.getString("Global.Global_buttonBack_button")})}else n.checkUserSessionIsValid().then(function(){return d.resolve("No FSK required")},function(){return d.resolve("No FSK required")});return d.promise},playVideo:function(t){if(!t)return s.resolve(!1);var l={},g=t.useDrm?d.getDRMSettings():e.promise.resolve(!1),f=d.getSamsungSpecificConfig(),p=s.defer();return s.all([g,f]).then(o.bind(function(e){var l=e[0],d=e[1],g={},f=u.id.getUniqueID();if(l){var m="sessionId="+n.getUserSessionId()+"&apixId="+t.apixId+"&deviceId="+f+"&platformId="+l.get("platformId")+"&product="+l.get("product")+"&download=N&DeviceFriendlyName="+l.get("deviceFriendlyName")+(t.isLinear?"&channelId="+t.channelId:"");g=o.extend(g,{drm:"playready",drmUrl:l.get("root"),denseServiceId:l.get("denseServiceId"),serviceId:l.get("serviceId"),serviceIdFormat:l.get("serviceIdFormat"),customData:m}),d&&d.videoInitialValues&&o.isString(d.videoInitialValues.startBitrate)&&(g=o.extend(g,{startBitrate:d.videoInitialValues.startBitrate}))}if(t&&!1===t.isMovie)return i.close(),h.publish("navigate",{path:"FullscreenPlayer",historySkip:t.historySkip,state:{isLinear:t.isLinear,mediaTitle:t.title,mediaUrl:t.url,mediaType:t.isMovie?"movie":"trailer",startTime:t.startTime,drmAttributes:t.useDrm?g:null,asset:t.videoAsset,channelInfo:t.channelInfo}}),s.resolve(!0);n.getDeviceDetails().then(function(e){var n=e&&e.get("freeSlots"),s=e&&e.get("deviceList"),l=!1;f=o.isString(f)?f:f.toString(),o.isArray(s)&&(s.length>0&&n<=0?o.each(s,function(e){if(e.get("id")===f)return l=!0,o.breaker}):l=!0),l?h.publish("navigate",{path:"FullscreenPlayer",historySkip:t.historySkip,state:{isLinear:t.isLinear,mediaTitle:t.title,mediaUrl:t.url,mediaType:t.isMovie?"movie":"trailer",startTime:t.startTime,drmAttributes:t.useDrm?g:null,asset:t.videoAsset,channelInfo:t.channelInfo}}):(i.close(),c.getSilkMessageForCode(_.SILK_CODE.USER_HAS_TOO_MANY_DEVICES_REGISTERED).then(function(e){a.error({title:e.get("title"),reason:e.get("description"),buttonText:r.getString("Global.Global_Continue")})},function(){a.error({reason:r.getString("Global.Global_generalError"),buttonText:r.getString("Global.Global_Continue")})})),p.resolve(l)},function(){i.close(),console.error("[detailsBase] playVideo - Could not play the video"),p.resolve(!1)})},this),function(){h.publish("navigate",{path:"FullscreenPlayer",historySkip:t.historySkip,state:{isLinear:t.isLinear,mediaTitle:t.title,mediaUrl:t.url,mediaType:t.isMovie?"movie":"trailer",startTime:t.startTime,drmAttributes:t.useDrm?l:null,asset:t.videoAsset,channelInfo:t.channelInfo}}),p.resolve(!0)}),p.promise},__checkUserPrivileges:function(e){return n.checkUserPrivileges(e)},__checkContentLicensing:function(e){var t=e.get("licensing");return f.getContentLicence(t).then(null,function(e){var t=s.defer();return a.error({title:r.getString("Player.Player_LicensingCheckTitle"),reason:r.getString("Player.Player_LicensingCheckText"),closeAction:o.bind(function(){t.reject(e)},this),buttonText:r.getString("Global.Global_Continue")}),t.promise})},sequencePermissionPromises:function(e){var t=this.__checkContentLicensing(e);return t=t.then(o.bind(this.__checkFsk,this,e)),t=t.then(o.bind(this.__checkUserPrivileges,this,e)),g.probePromise(t),t},isCurrentControllerVideoPlayback:function(){var e=b.getHistoryStack(),t=e&&e[e.length-1];return!(!t||!t.controller.isVideoPlayback)},__continueVodFlow:function(e,t,l){return this.sequencePermissionPromises(e).then(o.bind(function(c){if(c)if(e){var h=e.get("video"),_=h&&h.get("url"),g=e.get("eventId"),f=this.isCurrentControllerVideoPlayback();if(_){var p;p="playstation"===u.platform?d.getPlaystationSpecificConfig().then(o.bind(function(e){if(!0===e.vodurloverride&&e.vodurlreplace.find){var t=e.vodurlreplace.find,i=e.vodurlreplace.replace_value;_=i?_.replace(t,i):_}},this)):s.resolve(),p.then(o.bind(function(){this.playVideo({url:_,useDrm:!0,apixId:g,isMovie:!0,videoAsset:e,channelInfo:l,startTime:t,historySkip:f}).then(o.bind(function(t){!0===t&&this.__addToRecentlyWatched(e)},this))},this))}else i.close(),a.error({reason:r.getString("Errormessages.Errormessages_labelVideoNotAvailable"),buttonText:r.getString("Global.Global_buttonBack_button")})}else i.close();else i.close(),n.getLoginStatus()&&a.error({reason:r.getString("DetailPage.DetailPage_MissingEntitlement_OTHER"),closeAction:o.bind(b.back,b),buttonText:r.getString("Global.Global_buttonBack_button")})},this),function(e){return i.close(),console.log("Not playing VOD, because "+e),s.reject(e)})},__addToRecentlyWatched:function(e){p.getStormAssetImageBySize(e,this.RECENTLYWATCHED_IMAGE_WIDTH,this.RECENTLYWATCHED_IMAGE_HEIGHT).then(o.bind(function(e){return e.get("url")},this)).fail(function(){return""}).done(function(t){n.addAssetToRecentlyWatched({apixId:e.get("eventId"),assetId:e.get("id"),title:function(e){var t="";return e.get("seasonNumber")&&(t+="S"+e.get("seasonNumber")),e.get("episodeNumber")&&(t.length&&(t+=" "),t+="E"+e.get("episodeNumber")),t.length&&(t+=": "),e.get("title")&&(t+=e.get("title")),t}(e),color:e.get("packageCode"),isHD:e.get("isHD"),fsk:e.get("parentalRating").display,imageUrl:t,type:e.get("type")})})},_showResumePopup:function(e,t,n){i.close();var l=s.defer();return a.confirm({dialogCss:"resume-dialog",title:r.getString("CustomerMessages.CustomerMessages_labelBasicBookmarkingAlertTitle"),message:r.getString("CustomerMessages.CustomerMessages_labelBasicBookmarkingAlertMessage"),positiveText:r.getString("CustomerMessages.CustomerMessages_labelBasicBookmarkingAlertConfirm"),negativeText:r.getString("CustomerMessages.CustomerMessages_labelBasicBookmarkingAlertCancel"),positiveAction:o.bind(function(){i.open(),this.__continueVodFlow(e,t,n).fail(function(e){l.reject(e)})},this),negativeAction:o.bind(function(){i.open(),this.__continueVodFlow(e,0,n).fail(function(e){l.reject(e)})},this),buttonLayout:a.VERTICAL_BUTTON_LAYOUT}),l.promise},_checkBookmark:function(e,t){return console.log("[detailsBase] _checkBookmark - getting bookmark"),this.getBookmarkForAsset(e.get("id")).then(o.bind(function(i){return 0==i?this.__continueVodFlow(e,0,t):i>0?this._showResumePopup(e,i,t):void 0},this),o.bind(function(){return console.error("[detailsBase] error checking bookmark, promise was rejected"),this.__continueVodFlow(e,0,t)},this))},getBookmarkForAsset:function(e){return n.getCustomerBookmark(e).then(o.bind(function(e){return e},this))},watchVod:function(e,t,s){return i.open(),n.loginCheck().then(o.bind(function(){return o.isUndefined(t)?this._checkBookmark(e,s):this.__continueVodFlow(e,t,s)},this),function(e){return i.close(),console.log("loginCheck fail, because "+e),e})},assetIsPlayable:function(e){var t=e&&e.get("type")===p.ASSET_TYPES.SPORT,i=e&&e.get("video"),n=i&&i.get("url");return t&&e.get("currentType")===p.SPORT_ASSET_CURRENT_TYPES.REPLAY?(console.warn("Sport events do not allow Replays to be watched"),!1):!(!n||""===n)},checkIfChannelIsPermitted:function(e){return e?v.checkIfChannelIdPermitted(e.get("id")).then(function(e){return!0},function(){return!1}).fail(function(){return!1}):s.resolve(!1)},checkIfChannelIsPlayable:function(e){if(!e)return s.resolve(!1);var t,i,n=s.defer(),r=e.get("videos")&&e.get("videos")[0],a=r&&r.get("url");return s.all([m.checkIfChannelIsOnAir(e.get("id")).then(function(e){t=e}),v.checkIfChannelIdPermitted(e.get("id")).then(function(e){i=e},function(){i=!1})]).then(function(){i&&t&&a?n.resolve(!0):n.resolve(!1)}),n.promise},checkIfUserIsLoggedIn:function(){var e=!1;return n.getUserSessionId()&&(e=!0),e},directPlay:function(e,t,n,r){if(!e&&!t)return s.reject({message:"Asset or catalog undefined"});i.open();var a=o.bind(p.getAssetById,p);return r===p.ASSET_TYPES.EPISODE&&(a=o.bind(p.getEpisodeById,p)),a(e,t).then(o.bind(function(e){return this.watchVod(e,n)},this))}}))}),define("tvedemo/ctrl/DetailsBase",["xdk-base/class","tvedemo/ctrl/RoutableController","xdk-ax/focusManager","xdk-base/util","xdk-base/promise","xdk-ui-basic/Label","tvedemo/helper/sMoment","tvedemo/mgr/sEndUserManager","tvedemo/helper/dialogHelper","storm/mgr/sAppConfigManager","xdk-base/console","storm/mgr/sLanguageManager","tvedemo/mgr/sAssetManager","storm/mgr/sLinearChannelManager","lib/moment","tvedemo/wgt/Loading","tvedemo/mgr/sNavigationManager","tvedemo/helper/sPlaybackHelper"],function(e,t,i,n,s,r,a,o,l,c,d,u,h,_,g,f,p,m){"use strict";return e.create(t,{getDefaultState:function(){return{__forceReload:!0}}},{IMAGE_MIN_WIDTH:300,IMAGE_MIN_HEIGHT:200,__HTMLNewLine:"<br>",__detailInformation:{},init:function(){this._super()},setup:function(e){this._super(e);var t=this.getView(),i=t.find("blackoutMessageContainer"),s=t.find("thumbnailProgress");s&&s.hide(),i&&i.hide(),this.setButtonContainersVisible(!1),this.updateButtons=n.wrap(this.updateButtons,n.bind(function(e,t){this.setButtonContainersVisible(!0),e(t)},this)),e.historyBack&&e.__menuClone&&0===e.__menuClone.navigationTrace.length&&p.triggerResetMenu(!0)},setButtonContainersVisible:function(e){var t=this.getView();n.each(["serieButtonContainer","seasonSelectionButtonContainer","episodeSelectionButtonContainer","videoButtonContainer"],function(i){(i=t.find(i))&&i[e?"show":"hide"]()})},parseOnAirDate:function(e){return e?a(e).format(u.getString("ui.format.onAirDate")):""},parseOnAirTime:function(e){return e?a(e).format(u.getString("ui.format.onAirTime")):""},parseEventTime:function(e){return e?a(e).format(u.getString("ui.format.epgEventTime")):""},parseNewsTime:function(e){return e?a(e).format(u.getString("ui.format.newsTime")):""},parseStartTimeEndTime:function(e,t){return this.parseOnAirDate(e)+"; "+this.parseEventTime(e)+" - "+this.parseEventTime(t)},__checkIfChannelIsPlayable:function(e){return m.checkIfChannelIsPlayable(e)},__checkIfChannelIsPermitted:function(e){return m.checkIfChannelIsPermitted(e)},__checkUserPrivileges:function(e){return o.checkUserPrivileges(e)},__hasTrailer:function(e){var t=e.get("trailer")&&e.get("trailer").get("url");return!(!t||""===t)},__checkIfAssetIsPresentInWatchlist:function(e){return e?o.checkIfAssetIsInUserWatchList([e.get("id").toString()]):s.resolve(!1)},__checkIfSeasonIsPresentInWatchlist:function(e){var t=e&&e.get("episodes"),i=[];return n.each(t,function(e){i.push(e.get("id").toString())}),o.checkIfAssetIsInUserWatchList(i)},__updateWatchList:function(e){f.open();var t;return e.remove?t=this.__removeFromWatchlist(e):e.add&&(t=this.__addToWatchlist(e)),t.then(n.bind(function(e,t){return f.close(),t?{added:e.add,removed:e.remove}:{added:!1,removed:!1}},{},e)).fail(function(e){f.close(),d.warn("updateWatchlistPromise error:"+e)})},__addToWatchlist:function(e){return o.loginCheck().then(function(){return o.addAssetToUserWatchList(e)})},__removeFromWatchlist:function(e){return o.loginCheck().then(function(){return o.removeAssetFromWatchList(e)})},__sequencePermissionPromises:function(e){return m.sequencePermissionPromises(e)},__assetIsPlayable:function(e){return m.assetIsPlayable(e)},__tuneIn:function(e){var t=e&&e.get("channel"),i=t&&t.get("videos")&&t.get("videos")[0],s=i&&i.get("url"),r=e&&e.get("id");s?_.checkIfChannelIdPermitted(t.get("id")).then(n.bind(function(){o.loginCheck().then(n.bind(function(){this.__sequencePermissionPromises(e).then(n.bind(function(i){i&&this.__playVideo({url:s,useDrm:!0,apixId:r,isMovie:!0,isLinear:!0,channelId:t.get("id"),videoAsset:t,channelInfo:e})},this),function(e){d.log("Not tuning in, because "+e)})},this))},this),function(e){d.log("Not tuning in, because "+e)}):(d.log("Not tuning in, because no video available for this channel"),l.error({reason:u.getString("Errormessages.Errormessages_labelVideoNotAvailable"),buttonText:u.getString("Global.Global_buttonBack_button")}))},__getBookmarkForAsset:function(e){return m.getBookmarkForAsset(e)},getBookmarkAsObject:function(e){return o.getBookmarkForAssetList(e).then(function(e){if(e)return{percentage:e[0].percentage,duration:e[0].duration,bookmark:e[0].bookmark,watchedState:e[0].watchedState}},this)},__watchTrailer:function(e){m.watchTrailer(e)},__watchVod:function(e,t,i){m.watchVod(e,t,i)},__playVideo:function(e){m.playVideo(e)},updateCommonDetailInformation:function(e,t){var i="",s=this.getView(),r=s.find("missingPackage"),a=s.find("thumbnailProgress"),o=e&&e.get("bookmark");a&&(o?(a.removepProgressAndIcon(),a.update(o.percentage,o.watchedState),a.show()):a.hide()),r&&(r.addClass("hidden"),this.checkIfUserIsLoggedIn()&&(t.userHasPrivileges||t.userHasPrivilegeForAsset||t.userHasPrivilegeForChannel||t.userHasPrivilegeToWatchVod||t.userHasPrivilegeToWatchChannel||this.setMissingPackage(t.packageCode).then(n.bind(function(){r.removeClass("hidden");var e=document.createElement("div");e.appendChild(r.getRoot().getHTMLElement()),this.setSynopsis(e.innerHTML+i)},this)))),n.isArray(t.cast)&&t.cast.length>0&&(i+=u.getString("DetailPage.DetailPage_labelcast")+this.__HTMLNewLine,n.each(t.cast,n.bind(function(e,n){e&&e.content&&(i+=n<t.cast.length-1?e.content+", ":e.content)},this)),i+=this.__HTMLNewLine+this.__HTMLNewLine),i+=t.synopsis,this.setSynopsis(i),this.setMetadata(t),this.setThumbnail(e),this.setLogo(e,t.fallbackChannelLogo),t.isBlackedOut&&this.displayBlackedOutMessage(),f.close()},displayBlackedOutMessage:function(){var e=this.getView(),t=e.find("blackoutMessageContainer");e.find("blackoutMessage").setText(u.getString("Epg.blackoutShort")),t.show()},setMissingPackage:function(e){var t=this.getView(),i=t.find("missingPackageLogo"),n=t.find("missingPackageText"),s="DetailPage.DetailPage_MissingEntitlement_"+e,r=u.getString(s);return r===s&&(r=u.getString("DetailPage.DetailPage_MissingEntitlement_OTHER")),n.setText(r),c.getPackageImageForCode(e).then(function(e){i.setSrc(e),i.removeClass("hidden")},function(){i.addClass("hidden")})},setThumbnail:function(e){var t=this.getView(),i=t.find("thumbnail");h.getStormAssetImageBySize(e,this.IMAGE_MIN_WIDTH,this.IMAGE_MIN_HEIGHT).then(n.bind(function(e){i.setSrc(e.get("url"))},this)).fail(function(t){d.warn("[Movie] failed to get the cover image for "+e.get("title")+": "+t),i.fallback()}).done()},setLogo:function(e,t){var i=this.getView(),n=i.find("channelLogo");h.getStormAssetChannelLogo(e).then(function(e){n.setSrc(e.get("url"))}).fail(function(){t?n.setSrc(t):n.fallback()})},setSynopsis:function(e){this.getView().find("detailDescription").setText(e)},setMetadata:function(e){var t=this.getView(),i=t.find("title"),s=t.find("metaDataContainer");if(i.setText(e.title.toUpperCase()),s.detachAll(),e.onAirDate||e.startTime&&e.endTime||e.newsDate){var a=e.newsDate?this.parseNewsTime(e.newsDate):e.onAirDate?this.parseOnAirDate(e.onAirDate):this.parseStartTimeEndTime(e.startTime,e.endTime);new r({css:"on-air",text:a,parent:s}),!e.length&&e.startTime&&e.endTime&&(e.length=e.endTime-e.startTime)}if(e.parentalRating&&new r({text:e.parentalRating.display,parent:s}),e.length&&new r({text:g.duration(e.length).asMinutes()+u.getString("ui.format.minutesDurationSuffix"),parent:s}),e.country&&new r({text:e.country,parent:s}),e.year)try{new r({text:e.year.toString(),parent:s})}catch(e){d.warn("[Movie] "+e)}if(e.genres){var o=[];if(n.isArray(e.genres))n.each(e.genres,function(e){-1===o.indexOf(e.content)&&o.push(e.content)});else{var l=e.genres.main,c=e.genres.second;l&&l.content&&o.push(l.content),c&&c.content&&-1===o.indexOf(c.content)&&o.push(c.content)}o.length&&new r({css:"category",text:o.join(" & "),parent:s})}e.isHD&&new r({text:u.getString("Settings.Settings_PackageHD"),parent:s})},focusFirstVisibleComponent:function(e){var t,s=this.getView(),r=s.getParent().getParent()?s.getParent().getParent().find("list-main-menu"):null;n.each(e,function(e){var i=e.isHidden&&e.isHidden(),s=e.isInactive&&e.isInactive();if(!i&&!s)return t=e,n.breaker}),setTimeout(function(){t?i.focus(t):i.focus(r)},500)},setButtonNavigation:function(e,t){if(e){for(var i,n,s,r=0,a=e.length;r<a;r++)s=e[r],s.hidden?s.button.hide():s.greyedOut?(s.button.show(),s.button.inactivate()):s.button&&(s.button.show(),s.button.activate(),i?s.button.setOption("nextUp",i):s.button.setOption("nextUp",!1),i=s.button);for(r=e.length-1;r>=0;r--)s=e[r],s.hidden||s.greyedOut||!s.button||(n&&s.button.setOption("nextDown",n),n=s.button);t&&t.setOption("forwardFocus",n)}},checkIfUserIsLoggedIn:function(){return m.checkIfUserIsLoggedIn()},reset:function(e){this._super(e)}})}),define("tvedemo/ctrl/EpgEvent",["xdk-base/ax","xdk-base/class","xdk-ax/mvc/view","tvedemo/tmpl/epgEvent","xdk-ax/evt/type","xdk-ax/focusManager","xdk-base/device/vKey","xdk-base/util","xdk-ax/mediator","tvedemo/wgt/TextSelectionListDialog","xdk-base/promise","xdk-ui-basic/Label","tvedemo/helper/sMoment","tvedemo/mgr/sEndUserManager","tvedemo/mgr/sHistoryManager","tvedemo/helper/dialogHelper","tvedemo/wgt/AlertDialog","storm/mgr/sAppConfigManager","xdk-base/console","storm/mgr/sLanguageManager","tvedemo/mgr/sAssetManager","tvedemo/ctrl/DetailsBase","tve/mgr/sLinearManager","storm/event/UserEvent","storm/helper/util"],function(e,t,i,n,s,r,a,o,l,c,d,u,h,_,g,f,p,m,v,b,S,y,E,k,C){"use strict";return t.create(y,{getDefaultState:function(){return{}}},{__epgEvent:null,init:function(){this._super(),this.setView(i.render(n))},setup:function(e){this._super(e);var t=e&&e.context&&e.context.get("data");if(this.__handleUserDataUpdate=o.bind(function(){this.__epgEvent&&this.__detailInformation.hasVodAsset&&this.displayDetailInformation(this.__epgEvent,this.__detailInformation.hasVodAsset)},this),l.subscribe(k.UserDataUpdated,this.__handleUserDataUpdate),this.setupButtons(),e.historyBack)return void this.displayDetailInformation(this.__epgEvent,this.__detailInformation.hasVodAsset);e.setupPending=this.setupDetailsInformation(t.eventId,t.channelId,t.epgExcerptEvent)},assetIsPlayable:function(e){return e&&e.get("type")===S.ASSET_TYPES.SPORT?(v.warn("Sport EPG events do not allow the 'VOD' to be played"),!1):this.__assetIsPlayable(e)},setupButtons:function(){var e=this.getView(),t=e.find("epgEventTuneIn"),i=e.find("epgEventStartVod"),n=e.find("epgEventWatchTrailer"),r=e.find("addToWatchlist");this.__tuneInRef=o.bind(function(){this.__tuneIn(this.__epgEvent)},this),this.__watchVodRef=o.bind(function(){this.__watchVod(this.__epgEvent.get("asset"),null,this.__epgEvent.get("channel"))},this),this.__watchTrailerRef=o.bind(function(){this.__watchTrailer(this.__epgEvent.get("asset"))},this),this.__addToWatchlistRef=o.bind(function(){var e=this.__epgEvent.get("asset");this.__updateWatchList({remove:!!this.__detailInformation.isInWatchlist,add:!this.__detailInformation.isInWatchlist,catalog:e.get("catalog"),assetId:e.get("id"),assetType:e.get("type")}).then(o.bind(function(e){e.added?this.__detailInformation.isInWatchlist=!0:e.removed&&(this.__detailInformation.isInWatchlist=!1),this.updateButtons({epgEvent:this.__epgEvent,channelPermitted:this.__detailInformation.channelPermitted,channelPlayable:this.__detailInformation.channelPlayable,userHasPrivilegeForChannel:this.__detailInformation.userHasPrivilegeForChannel,hasVodAsset:this.__detailInformation.hasVodAsset,userHasPrivilegeForAsset:this.__detailInformation.userHasPrivilegeForAsset,assetIsPlayable:this.assetIsPlayable(this.__epgEvent.get("asset")),isInWatchlist:this.__detailInformation.isInWatchlist,userIsLoggedIn:this.checkIfUserIsLoggedIn()})},this))},this),t.addEventListener(s.CLICK,this.__tuneInRef),i.addEventListener(s.CLICK,this.__watchVodRef),n.addEventListener(s.CLICK,this.__watchTrailerRef),r.addEventListener(s.CLICK,this.__addToWatchlistRef)},setupDetailsInformation:function(t,i,n){var s;return t&&i?(s=E.getEpgEventByEventIdAndChannelId(t,i),s.then(o.bind(function(e){n&&n.startDate&&n.startTime&&n.endDate&&n.endTime&&(v.warn("Overriding running times from epgExcerptEvent"),e.set("startTime",C.parseSkyDateTimeToDate(n.startDate,n.startTime).getTime()),e.set("endTime",C.parseSkyDateTimeToDate(n.endDate,n.endTime).getTime())),e.get("assetId")&&e.get("catalog")?S.getAssetById(e.get("assetId"),e.get("catalog")).then(o.bind(function(t){e.set("asset",t),this.displayDetailInformation(e,!0)},this)).fail(o.bind(function(){this.displayDetailInformation(e,!1)},this)):this.displayDetailInformation(e,!1)},this)).fail(function(){o.defer().then(function(){f.error({reason:b.getString("Global.Global_NoResults"),closeAction:o.bind(g.back,g),buttonText:b.getString("Global.Global_buttonBack_button")})})})):s=e.promise.reject().fail(function(){o.defer().then(function(){f.error({reason:b.getString("Global.Global_NoResults"),closeAction:o.bind(g.back,g),buttonText:b.getString("Global.Global_buttonBack_button")})})})},displayDetailInformation:function(e,t){d.all([this.__checkIfChannelIsPermitted(e.get("channel")),this.__checkIfChannelIsPlayable(e.get("channel")),this.__checkUserPrivileges(e.get("channel")),this.__checkUserPrivileges(e.get("asset")),this.__checkIfAssetIsPresentInWatchlist(e.get("asset")),E.getChannelLogoUrl(e.get("channel"))]).then(o.bind(function(i){var n=i[0],s=i[1],r=i[2],a=i[3],o=i[4],l=i[5];this.__epgEvent=e,this.__detailInformation.title=this.__epgEvent.get("title"),this.__detailInformation.synopsis=""!==this.__epgEvent.get("synopsis")?this.__epgEvent.get("synopsis"):b.getString("Global.Global_NoResults"),this.__detailInformation.cast=this.__epgEvent.get("cast"),this.__detailInformation.parentalRating=this.__epgEvent.get("parentalRating"),this.__detailInformation.length=this.__epgEvent.get("length"),this.__detailInformation.year=this.__epgEvent.get("year"),this.__detailInformation.genres=this.__epgEvent.get("genreList"),this.__detailInformation.onAirDate=this.__epgEvent.get("date"),this.__detailInformation.startTime=this.__epgEvent.get("startTime"),this.__detailInformation.endTime=this.__epgEvent.get("endTime"),this.__detailInformation.packageCode=this.__epgEvent.get("packageCode"),this.__detailInformation.packageColorCode=this.__epgEvent.get("packageColorCode"),this.__detailInformation.isHD=this.__epgEvent.get("isHD"),this.__detailInformation.channelPermitted=n,this.__detailInformation.channelPlayable=s,this.__detailInformation.userHasPrivilegeForChannel=r,this.__detailInformation.userHasPrivilegeForAsset=a,this.__detailInformation.isInWatchlist=o,this.__detailInformation.hasVodAsset=t,this.trackPage(this.__epgEvent.get("title"),e.get("channel")._attrs.title),this.__detailInformation.fallbackChannelLogo=l,this.updateCommonDetailInformation(this.__epgEvent.get("asset")||this.__epgEvent,this.__detailInformation),this.updateButtons({epgEvent:this.__epgEvent,channelPermitted:this.__detailInformation.channelPermitted,channelPlayable:this.__detailInformation.channelPlayable,userHasPrivilegeForChannel:this.__detailInformation.userHasPrivilegeForChannel,hasVodAsset:this.__detailInformation.hasVodAsset,userHasPrivilegeForAsset:this.__detailInformation.userHasPrivilegeForAsset,assetIsPlayable:this.assetIsPlayable(this.__epgEvent.get("asset")),isInWatchlist:this.__detailInformation.isInWatchlist,userIsLoggedIn:this.checkIfUserIsLoggedIn(),liveSupported:!0})},this))},updateButtons:function(e){if(e){var t=this.getView(),i=t.find("epgEventTuneIn"),n=t.find("epgEventStartVod"),s=t.find("epgEventWatchTrailer"),r=t.find("addToWatchlist"),a=t.find("detailDescription"),o=t.find("videoButtonContainer"),l=e.epgEvent,c=e.userIsLoggedIn,d=e.channelPlayable,u=e.userHasPrivilegeForChannel,h=e.channelPermitted,_=e.hasVodAsset,g=e.userHasPrivilegeForAsset,f=e.assetIsPlayable,p=this.__hasTrailer(l),m=e.isInWatchlist,v=e.liveSupported||!0,y=this.__epgEvent.get("asset"),E=y&&y.get("currentType")===S.SPORT_ASSET_CURRENT_TYPES.LIVE;i.setText(b.getString("DetailPage.DetailPage_labelTuneIn")),n.setText(b.getString("DetailPage.DetailPage_labelwatch_now_label")),s.setText(b.getString("DetailPage.DetailPage_labelwatch_trailer_label")),r.setText(m?b.getString("DetailPage.DetailPage_removeWatchlist"):b.getString("DetailPage.DetailPage_labeladd_to_watchlist")),this.setButtonNavigation([{button:i,hidden:!h,greyedOut:!(d&&u&&v)&&!(!c&&v)},{button:n,hidden:!_||!f,greyedOut:!(v||!E)||!g&&!!c},{button:s,hidden:!p,greyedOut:!1},{button:r,hidden:!_,greyedOut:!1}],o),(h||p||_)&&a.setFocusable(!1),this.focusFirstVisibleComponent([i,n,s,r,a])}},reset:function(e){var t=this.getView(),i=t.find("epgEventTuneIn"),n=t.find("epgEventStartVod"),r=t.find("epgEventWatchTrailer"),a=t.find("addToWatchlist");this._super(e),
i.removeEventListener(s.CLICK,this.__tuneInRef),n.removeEventListener(s.CLICK,this.__watchVodRef),r.removeEventListener(s.CLICK,this.__watchTrailerRef),a.removeEventListener(s.CLICK,this.__addToWatchlistRef),l.unsubscribe(k.UserDataUpdated,this.__handleUserDataUpdate)}})}),define("tvedemo/wgt/Progressbar",["xdk-base/class","xdk-ax/Container","xdk-ui-basic/Label","xdk-base/util","storm/mgr/sLanguageManager"],function(e,t,i,n,s){"use strict";return e.create(t,{},{init:function(e){e=e||{},e.css=e.css||"progressbar-widget",this._super(e),e.width&&this.getRoot().css("width",e.width),n.isUndefined(e.progress)||this.update(e.progress)},_createProgressContainer:function(){this._progressContainer=new t({css:"progressbar-widget-progress",parent:this})},_createAlreadyWatchedLabel:function(){this._alreadyWatchedLabel=new i({css:"progressbar-widget-alreadywatchedlabel",text:s.getString("Binge.Binge_already_watched"),parent:this})},_setAlreadyWatchedState:function(){this.addClass("progressbar-widget-alreadywatched"),this._alreadyWatchedLabel||this._createAlreadyWatchedLabel(),this._alreadyWatchedLabel.show()},removepProgressAndIcon:function(){this._alreadyWatchedLabel&&(this._alreadyWatchedLabel.deinit(),this._alreadyWatchedLabel=null),this._progressContainer&&(this._progressContainer.deinit(),this._progressContainer=null)},update:function(e,t){if(!n.isUndefined(t)&&"W"===t)return void this._setAlreadyWatchedState();if(n.isUndefined(e))return void this.hide();this.removeClass("progressbar-widget-alreadywatched");var i=e;e>100?i=100:e<0&&(i=0),this._progressContainer||this._createProgressContainer(),this._progressContainer.getRoot().css("width",i+"%")}})}),define("tvedemo/tmpl/episode",["xdk-ui-basic/Layout","xdk-ui-basic/Label","storm/wgt/Image","xdk-ax/Container","xdk-ui-basic/Button","tvedemo/wgt/AssetGrid","tvedemo/wgt/ScrollLabel","tvedemo/wgt/ImageButton","storm/mgr/sLanguageManager","storm/mgr/sAppConfigManager","tvedemo/wgt/Progressbar"],function(e,t,i,n,s,r,a,o,l,c,d){"use strict";return function(){return{klass:e,alignment:e.VERTICAL,id:"#episode",children:[{klass:e,alignment:e.VERTICAL,children:[{klass:e,id:"#upContainer",children:[{klass:n,children:[{klass:i,id:"#thumbnail",placeHolderPromise:c.getPlaceholderLandscape},{klass:d,id:"#thumbnailProgress"}]},{klass:e,id:"#blackoutMessageContainer",children:[{klass:t,id:"#blackoutMessage"}]},{klass:n,css:"informationContainer",children:[{klass:t,id:"#title"},{klass:e,id:"#metaDataContainer",alignment:e.HORIZONTAL},{klass:i,id:"#channelLogo"},{klass:n,id:"missingPackage",css:"missingPackage",children:[{klass:i,id:"missingPackageLogo",css:"missingPackageLogo"},{klass:t,id:"missingPackageText",css:"missingPackageText"}]}]}]},{klass:e,alignment:e.HORIZONTAL,id:"#videoButtonContainer",children:[{klass:o,id:"episodeStartFromVod",text:"",nextRight:"detailDescription",nextLeft:"episodeStartFromVod"},{klass:o,id:"episodeWatchTrailer",text:"",nextLeft:"episodeWatchTrailer",nextRight:"detailDescription"},{klass:o,id:"addToWatchlist",text:"",nextRight:"detailDescription",nextLeft:"addToWatchlist"}]},{klass:e,alignment:e.HORIZONTAL,id:"#episodeSelectionButtonContainer",children:[{klass:o,id:"viewAllEpisodes",text:l.getString("DetailPage.DetailPage_labelAllEpisodes"),nextUp:"addToWatchlist",nextDown:"previousEpisode",nextRight:"detailDescription",nextLeft:"addToWatchlist"},{klass:o,id:"previousEpisode",css:"previousEpisode",text:"",nextUp:"viewAllEpisodes",nextDown:"nextEpisode",nextRight:"nextEpisode",nextLeft:"addToWatchlist"},{klass:o,id:"nextEpisode",css:"nextEpisode",text:"",nextUp:"viewAllEpisodes",nextDown:"nextEpisode",nextRight:"detailDescription",nextLeft:"previousEpisode"}]},{klass:a,id:"detailDescription",scrollStep:72,nextLeft:"videoButtonContainer",nextUp:"header",nextDown:"detailDescription"}]}]}}}),define("tvedemo/ctrl/Episode",["xdk-base/ax","xdk-base/class","xdk-ax/mvc/view","tvedemo/tmpl/episode","xdk-ax/evt/type","xdk-ax/focusManager","xdk-base/device/vKey","xdk-base/util","xdk-ax/mediator","tvedemo/wgt/TextSelectionListDialog","xdk-base/promise","xdk-ui-basic/Label","tvedemo/helper/sMoment","tvedemo/mgr/sEndUserManager","tvedemo/mgr/sHistoryManager","tvedemo/helper/dialogHelper","tvedemo/wgt/AlertDialog","storm/mgr/sAppConfigManager","xdk-base/console","storm/mgr/sLanguageManager","tvedemo/mgr/sAssetManager","tvedemo/ctrl/DetailsBase","storm/helper/util","storm/event/UserEvent","tvedemo/wgt/Loading"],function(e,t,i,n,s,r,a,o,l,c,d,u,h,_,g,f,p,m,v,b,S,y,E,k,C){"use strict";return t.create(y,{getDefaultState:function(){return{}}},{__episode:null,__currentlySelectedIndex:null,__episodes:null,init:function(){this._super(),this.setView(i.render(n))},setup:function(e){if(this._super(e),this.__handleUserDataUpdate=o.bind(function(){this.__episode&&(this.isInitialized=!1,this.displayDetailInformation(this.__episode))},this),l.subscribe(k.UserDataUpdated,this.__handleUserDataUpdate),this.setupButtons(),e.historyBack)return this.isInitialized=!1,void this.displayDetailInformation(this.__episode);this._autoPlayRef=o.bind(function(){this.__watchVod(this.__episode)},this),!0===e.autoPlay&&l.subscribe("navigated",this._autoPlayRef,!0),e.setupPending=this.setupDetailsInformation(e.selectedEpisodeId,e.catalog,e.seasonEpisodes)},setupButtons:function(){var e=this.getView(),t=e.find("episodeStartFromVod"),i=e.find("episodeWatchTrailer"),n=e.find("addToWatchlist"),r=e.find("previousEpisode"),a=e.find("nextEpisode"),l=e.find("viewAllEpisodes");this.__watchTrailerRef=o.bind(function(){this.__watchTrailer(this.__episode)},this),this.__watchEpisodeRef=o.bind(function(){this.__watchVod(this.__episode)},this),this.__addToWatchlistRef=o.bind(function(){this.__updateWatchList({remove:!!this.__detailInformation.isInWatchlist,add:!this.__detailInformation.isInWatchlist,catalog:this.__detailInformation.catalog,assetId:this.__episode.get("id"),assetType:this.__episode.get("type")}).then(o.bind(function(e){e.added?this.__detailInformation.isInWatchlist=!0:e.removed&&(this.__detailInformation.isInWatchlist=!1),this.updateButtons({episode:this.__episode,userHasPrivileges:this.__detailInformation.userHasPrivileges,isBlackedOut:this.__detailInformation.isBlackedOut,isPlayable:this.__assetIsPlayable(this.__episode),userIsLoggedIn:this.checkIfUserIsLoggedIn(),isInWatchlist:this.__detailInformation.isInWatchlist})},this))},this),this.__displayPreviousEpisodeRef=o.bind(this.__displayPreviousEpisode,this),this.__displayNextEpisodeRef=o.bind(this.__displayNextEpisode,this),this.__gotoViewAllEpisodesRef=o.bind(this.__gotoViewAllEpisodes,this),i.addEventListener(s.CLICK,this.__watchTrailerRef),t.addEventListener(s.CLICK,this.__watchEpisodeRef),n.addEventListener(s.CLICK,this.__addToWatchlistRef),r.addEventListener(s.CLICK,this.__displayPreviousEpisodeRef),a.addEventListener(s.CLICK,this.__displayNextEpisodeRef),l.addEventListener(s.CLICK,this.__gotoViewAllEpisodesRef)},setupDetailsInformation:function(t,i,n){var s;return t&&i?(s=S.getEpisodeById(t,i).then(o.bind(function(e){var s=e.get("serieId"),r=e.get("seasonId");return(n?d.resolve(n):S.getRelatedEpisodesBySerieAndSeason(s,r,i)).then(o.bind(function(e){if(this.__episodes=e,o.each(e,o.bind(function(e,i){if(E.areAssetIdsEqual(e.get("id"),t))return this.__currentlySelectedIndex=i,o.breaker},this)),this.isEpisodeIndexAvailable(this.__currentlySelectedIndex))return this.displayDetailInformation(this.__episodes[this.__currentlySelectedIndex])},this))},this),function(){o.defer().then(function(){f.error({reason:b.getString("Global.Global_NoResults"),closeAction:o.bind(g.back,g),buttonText:b.getString("Global.Global_buttonBack_button")})})}),s.fail(function(){o.defer().then(function(){f.error({reason:b.getString("Global.Global_NoResults"),closeAction:o.bind(g.back,g),buttonText:b.getString("Global.Global_buttonBack_button")})})})):s=e.promise.reject().fail(function(){o.defer().then(function(){f.error({reason:b.getString("Global.Global_NoResults"),closeAction:o.bind(g.back,g),buttonText:b.getString("Global.Global_buttonBack_button")})})})},_getEpisodeInformation:function(e){return S.getEpisodeById(e.get("id"),e.get("catalog")).then(o.bind(function(e){return e},this),o.bind(function(){return e},this))},displayDetailInformation:function(e){return C.open(),this._getEpisodeInformation(e).then(o.bind(function(t){return d.all([this.__checkUserPrivileges(t),this.__checkIfAssetIsPresentInWatchlist(t),this.getBookmarkAsObject(e.get("id"))]).then(o.bind(function(i){var n=i[0],s=i[1],r=i[2]?i[2].bookmark:void 0;t.set("bookmark",i[2]),this.__episode=t,this.__detailInformation.title=this.__episode.get("serieTitle")+this.__wrapEpisodeTitle(this.__episode),this.__detailInformation.season=this.__episode.get("seasonNumber"),this.__detailInformation.episode=this.__episode.get("episodeNumber"),this.__detailInformation.serieTitle=this.__episode.get("serieTitle"),this.__detailInformation.synopsis=this.__episode.get("synopsis"),this.__detailInformation.cast=this.__episode.get("cast"),this.__detailInformation.parentalRating=this.__episode.get("parentalRating"),this.__detailInformation.length=this.__episode.get("length"),this.__detailInformation.year=this.__episode.get("year"),this.__detailInformation.genres=this.__episode.get("genreList"),this.__detailInformation.onAirDate=this.__episode.get("date"),this.__detailInformation.packageCode=this.__episode.get("packageCode"),this.__detailInformation.packageColorCode=this.__episode.get("packageColorCode"),this.__detailInformation.isBlackedOut=this.__episode.get("blackedOut"),this.__detailInformation.isInWatchlist=s,this.__detailInformation.userHasPrivileges=n,this.__detailInformation.catalog=this.__episode.get("catalog"),this.__detailInformation.isHD=this.__episode.get("isHD");var a=this.__episode.get("serieTitle")+" S"+e.get("seasonNumber")+" E"+e.get("episodeNumber")+": "+e.get("title");this.trackPage(a),this.updateCommonDetailInformation(this.__episode,this.__detailInformation),this.updateButtons({episode:this.__episode,userHasPrivileges:this.__detailInformation.userHasPrivileges,isBlackedOut:this.__detailInformation.isBlackedOut,isPlayable:this.__assetIsPlayable(this.__episode),userIsLoggedIn:this.checkIfUserIsLoggedIn(),isInWatchlist:this.__detailInformation.isInWatchlist,bookmark:r})},this))},this))},updateButtons:function(e){if(e){var t=this.getView(),i=t.find("episodeStartFromVod"),n=t.find("episodeWatchTrailer"),s=t.find("addToWatchlist"),r=t.find("detailDescription"),a=t.find("viewAllEpisodes"),o=t.find("videoButtonContainer"),l=e.episode,c=e.userHasPrivileges,d=e.isBlackedOut,u=e.isPlayable,h=e.userIsLoggedIn,_=e.isInWatchlist,g=this.__hasTrailer(l);l.get("bookmark")&&"W"!==l.get("bookmark").watchedState?i.setText(b.getString("DetailPage.DetailPage_continue_now_btn")):i.setText(b.getString("DetailPage.DetailPage_watch_now_btn")),n.setText(b.getString("DetailPage.DetailPage_labelwatch_trailer_label")),s.setText(_?b.getString("DetailPage.DetailPage_removeWatchlist"):b.getString("DetailPage.DetailPage_labeladd_to_watchlist")),this.setButtonNavigation([{button:i,hidden:!(!d&&u),greyedOut:!c&&!!h},{button:n,hidden:!g,greyedOut:!1},{button:s,hidden:!!d,greyedOut:!1},{button:a,hidden:!1,greyedOut:!1}],o),r.setFocusable(!1),this.isInitialized||(this.focusFirstVisibleComponent([i,n,s,a,r]),this.isInitialized=!0)}},isEpisodeIndexAvailable:function(e){var t=this.getView(),i=t.find("previousEpisode"),n=t.find("nextEpisode"),s=t.find("viewAllEpisodes"),a=(t.find("detailDescription"),!0);return(e<0||e>=(this.__episodes&&this.__episodes.length))&&(a=!1),e<=0?i.hide():i.show(),e>=(this.__episodes&&this.__episodes.length-1)?(n.hide(),i.setOption("nextRight","detailDescription")):(n.show(),i.setOption("nextRight","selectNextEpisode")),(!this.__episodes||this.__episodes.length<=1)&&(i.hide(),n.hide(),s.setOption("nextDown",s)),n.isHidden()&&!i.isHidden()&&(r.isCompFocused(n)&&r.focus(i),s.setOption("nextDown",i)),i.isHidden()&&!n.isHidden()&&(r.isCompFocused(i)&&r.focus(n),s.setOption("nextDown",n)),a},__displayNextEpisode:function(){if(this.isEpisodeIndexAvailable(this.__currentlySelectedIndex+1)){this.__currentlySelectedIndex++;var e=this.__episodes&&this.__episodes[this.__currentlySelectedIndex];this.displayDetailInformation(e)}},__displayPreviousEpisode:function(){if(this.isEpisodeIndexAvailable(this.__currentlySelectedIndex-1)){this.__currentlySelectedIndex--;var e=this.__episodes&&this.__episodes[this.__currentlySelectedIndex];this.displayDetailInformation(e)}},__gotoViewAllEpisodes:function(){var e=this.__episode.get("serieId"),t=this.__episode.get("catalog");l.publish("navigate",{path:"Main/TVShow",state:{serieId:e,catalog:t}})},__wrapEpisodeTitle:function(e){return e?"<span> S"+e.get("seasonNumber")+" E"+e.get("episodeNumber")+": "+e.get("title")+"</span>":""},reset:function(e){this._super(e);var t=this.getView(),i=t.find("episodeStartFromVod"),n=t.find("episodeWatchTrailer"),r=t.find("addToWatchlist"),a=t.find("previousEpisode"),o=t.find("nextEpisode"),c=t.find("viewAllEpisodes");n.removeEventListener(s.CLICK,this.__watchTrailerRef),i.removeEventListener(s.CLICK,this.__watchEpisodeRef),r.removeEventListener(s.CLICK,this.__addToWatchlistRef),a.removeEventListener(s.CLICK,this.__displayPreviousEpisodeRef),o.removeEventListener(s.CLICK,this.__displayNextEpisodeRef),c.removeEventListener(s.CLICK,this.__gotoViewAllEpisodesRef),l.unsubscribe(k.UserDataUpdated,this.__handleUserDataUpdate),l.unsubscribe("navigated",this._autoPlayRef)}})}),define("tvedemo/wgt/FocusableButton",["xdk-base/class","xdk-ui-basic/Button"],function(e,t){"use strict";return e.create(t,{},{_focusableHidden:!1,setFocusableHidden:function(e){this._focusableHidden=e},isFocusableHidden:function(){return this._focusableHidden}})}),define("xdk-ui-grid/loopedGridStgy",["xdk-base/device/vKey","xdk-ax/data/interface/Datasource"],function(e,t){"use strict";var i=function(e,t){return(e%t+t)%t},n={};return n.LOOPED_PREREADY_STGY=function(e,t){t.selectedDsIndex=e*t.cols,t.selectedGridRow=e},n.LOOPED_CHECK_SCROLLABLE_STGY=function(e,t){return!0},n.LOOPED_ONUPDATE_STGY=function(e,t,n){if("reset"===e.action)return!0;var s=n.getTotalCount(),r=t.firstSlotDsIndex,a=r+t.cols*t.rows-1,o=e.index,l=e.index+e.length;return!("fetch"===e.action&&s>t.cols*t.rows&&(l<i(r,s)&&l<i(a,s)||o>i(r,s)&&o>i(a,s)))&&(t.selectedDsIndex=r+t.selectedGridRow*t.cols+t.selectedGridCol,0===s&&(t.selectedGridRow=-1,t.selectedDsIndex=-1),"insert"===e.action&&s===e.newData.length&&this._prereadyStgy(t),!0)},n.LOOPED_FINITEDS_ONUPDATE_STGY=function(e,n,s){if(e.action===t.ACTION.RESET)return!0;var r,a,o,l,c,d=s.getTotalCount(),u=n.firstSlotDsIndex,h=u+n.cols*n.rows-1,_=[];if(e.action===t.ACTION.FETCH&&d>n.cols*n.rows)for(_=e.segments,o=0;o<_.length;o++)if(r=_[o].index,a=r+_[o].length,l=i(u,d),c=i(h,d),l>c&&r<l&&r>c&&a>c&&a<l||l<c&&r>l&&r>c&&a>l&&a>c)return!1;return n.selectedDsIndex=u+n.selectedGridRow*n.cols+n.selectedGridCol,0===d&&(n.selectedGridRow=-1,n.selectedDsIndex=-1),e.action===t.ACTION.INSERT&&d===e.newData.length&&this._prereadyStgy(n),!0},n.LOOPED_CHECK_SELECTABLE_STGY=function(e,t,i,n){return!(i.ds.getTotalCount()<=0)},n.LOOPED_DATA_MAPPING_STGY=function(e,t,n,s,r){return t[i(n*e.cols+s,t.length)]},n.LOOPED_BOUNDARY_KEY_NAVIGATION_STGY=function(t,i,n,s,r){var a,o,l=r.selectedDsIndex,c=r.ds.getTotalCount(),d=r.selectedGridRow;if(t)switch(s){case e.UP.id:return{colChange:-1};case e.DOWN.id:return{colChange:1};case e.LEFT.id:a=-1;break;case e.RIGHT.id:a=1}else switch(s){case e.UP.id:a=-1;break;case e.DOWN.id:a=1;break;case e.LEFT.id:return{colChange:-1};case e.RIGHT.id:return{colChange:1}}return i<=0&&n<=0?{rowChange:a}:(o=d+a,Math.floor(l/r.cols)+a,Math.floor((c-1)/r.cols),o<i||o>=r.rows-n?{scroll:a}:{rowChange:a})},n}),define("xdk-ax/data/FiniteDatasource",["xdk-base/class","xdk-base/core","xdk-base/util","xdk-base/promise","xdk-base/console","xdk-base/exception","xdk-ax/data/Datasource","xdk-ax/data/interface/Datasource"],function(e,t,i,n,s,r,a,o){"use strict";function l(e,t){return 0===t?NaN:(e%t+t)%t}return e.create(a,{EVT_UPDATED:a.EVT_UPDATED,EVT_FINITEDS_UPDATED:"ui:finiteds:updated"},{_load:function(e,s){return i.isFunction(this._dataLoader)?(e=e||0,s=s||0,this._dataLoader(e,s)):n.reject(t.createException(r.ILLEGAL_STATE,"Datasource: invalid data loader function."))},getRange:function(e,t){var s,r,a=this.getTotalCount(),o=this,l=[],c=[],d=[];i.isUndefined(t)&&(t=a);try{l=this.__updateRange(e,t)}catch(e){return n.reject(e)}for(i.each(l,function(e){c=c.concat(o.__checkFetchedData(e.from,e.to))}),r=n.resolve(),s=0;s<c.length;s++)r=r.then(i.bind(function(e,t){var s,r;return o.hasData(e,t)?n.resolve():(s=e,r=t-s,o._load(s,r).then(i.bind(function(e,t,i){d.push({fetchOpts:{from:e,size:t},loadedObj:i})},this,s,r)))},null,c[s].from,c[s].to));return r.then(function(){i.each(d,function(e){o._processFetchedData(e.fetchOpts,e.loadedObj)})}).then(i.bind(this.__getOverflowFetchedData,this,e,t))},__getOverflowFetchedData:function(e,t){var i=this.getTotalCount(),n=[],s=e,r=t,a=l(s,i),o=l(r,i);if(s>r&&(r=i+r),r<i)return n=n.concat(this.__getFetchedData(a,r));for(n=n.concat(this.__getFetchedData(a,i)),s=s+i-a;r-s>=i;)a=l(s,i),n=n.concat(this.__getFetchedData(0,i)),s+=i;return r>s&&(a=l(s,i),n=n.concat(this.__getFetchedData(a,o))),n},hasData:function(e,t){var n=!0,s=[];if(!this.__checkRange(e,t))return!1;try{s=this.__updateRange(e,t)}catch(e){return!1}return i.each(s,i.bind(function(e){if(!(n=this.__hasFetchedData(e.from,e.to)))return i.breaker},this)),n},fetch:function(e,s){var a,l,c,d,u=[],h=[],_=[],g=[],f=this,p=this.getTotalCount();if(-1===p)return n.reject(t.createException(r.ILLEGAL_STATE,"Datasource: Total count is not set."));if(i.isNumber(s)||(s=1),e>=p||s>p||e<0)return n.reject(t.createException(r.ILLEGAL_ARGUMENT,"Datasource: invalid range."));a=e+s;try{h=this.__updateRange(e,a,!0)}catch(e){return n.reject(e)}for(l=0;l<h.length;l++)c=h[l].from,d=h[l].to-c,u.push(this._load(c,d).then(i.bind(function(e,t,i){_.push({fetchOpts:{from:e,size:t},loadedObj:i}),g.push({index:e,newData:i.data,length:i.data.length})},this,c,d)));return n.all(u).then(function(){i.each(_,function(e){f._processFetchedData(e.fetchOpts,e.loadedObj)}),g.length>0&&g[0]&&f.dispatchEvent(f.constructor.EVT_UPDATED,i.extend({action:o.ACTION.FETCH},g[0])),f.dispatchEvent(f.constructor.EVT_FINITEDS_UPDATED,{action:o.ACTION.FETCH,segments:g})})},remove:function(e,s){var a,l,c,d=[],u=[],h=[],_=this;if(!i.isFunction(this._dataUpdater))return n.reject(t.createException(r.ILLEGAL_STATE,"Datasource: invalid data updater function."));if(!i.isNumber(e))return n.reject(t.createException(r.ILLEGAL_ARGUMENT,"Datasource: invalid from index"));i.isNumber(s)||(s=e+1);try{c=this.__checkRange(e,s)}catch(e){return n.reject(e)}if(!c)return n.reject(t.createException(r.ILLEGAL_ARGUMENT,"Datasource: invalid range."));try{d=this.__updateRange(e,s)}catch(e){return n.reject(e)}for(a=n.resolve(),l=d.length-1;l>-1;l--)a=a.then(i.bind(this._dataUpdater,this,o.ACTION.REMOVE,{from:d[l].from,to:d[l].to})).then(function(e){if(!e)throw t.createException("Datasource: invalid data update via remove: no removed data received");var n=e.from,s=e.to;i.isNumber(n)&&(u=_.__removeFetchedData(n,s)),h.push({index:n,removedData:u,length:u.length})});return d.length>0?a.then(function(){_.dispatchEvent(_.constructor.EVT_UPDATED,i.extend({action:o.ACTION.REMOVE},h[0])),_.dispatchEvent(_.constructor.EVT_FINITEDS_UPDATED,{action:o.ACTION.REMOVE,segments:h})}):n.resolve()},insert:function(e,s){var a=this.getTotalCount();return i.isFunction(this._dataUpdater)?-1===a?n.reject(t.createException(r.ILLEGAL_STATE,"Datasource: Total count is not set.")):s>a||s<0?n.reject(t.createException(r.ILLEGAL_ARGUMENT,"Datasource: invalid index.")):(i.isArray(e)||(e=[e]),i.isNumber(s)||(s=a),this._dataUpdater(o.ACTION.INSERT,{newData:e,from:s}).then(i.bind(function(e){if(!e)throw t.createException("Datasource: invalid data update via insert: no new data received");var n=e.newData,s=e.index;i.isArray(n)&&this.__insertFetchedData(s,n),this.dispatchEvent(this.constructor.EVT_UPDATED,{action:o.ACTION.INSERT,index:s,length:n.length,newData:n}),this.dispatchEvent(this.constructor.EVT_FINITEDS_UPDATED,{action:o.ACTION.INSERT,index:s,length:n.length,newData:n})},this))):n.reject(t.createException(r.ILLEGAL_STATE,"Datasource: invalid data updater function."))},reset:function(){this._super(),this.dispatchEvent(this.constructor.EVT_FINITEDS_UPDATED,{action:o.ACTION.RESET})},__updateRange:function(e,i,n){var s,a=this.getTotalCount(),o=[];if(-1===a)throw t.createException(r.ILLEGAL_STATE,"Datasource: Total count is not set.");if(0===a)throw t.createException(r.ILLEGAL_STATE,"Datasource: No more data.");return i<e&&(i+=a),i-e>=a?(o.push({from:0,to:a}),o):(l(e,a),s=l(i,a),i>a?n?(o.push({from:e,to:a}),o.push({from:0,to:s}),o):(o.push({from:0,to:s}),o.push({from:e,to:a}),o):(o.push({from:e,to:i}),o))},__checkRange:function(e,i){if(-1===this.getTotalCount())throw t.createException(r.ILLEGAL_STATE,"Datasource: Total count is not set.");return!(!this.__checkIndex(e)||!this.__checkIndex(i-1))},__checkIndex:function(e){var t=this.getTotalCount();return-1!==t&&!(e<0||e>=t)},getFetchedData:function(e){var t=this.getTotalCount();return e<0||t<1?null:(e=l(e,t),this._data[e])}})}),define("xdk-ui-grid/LoopedGrid",["xdk-base/class","xdk-ui-grid/Grid","xdk-ui-grid/gridStgy","xdk-ui-grid/loopedGridStgy","xdk-base/util","xdk-ax/data/Datasource","xdk-ax/data/FiniteDatasource","xdk-base/promise","xdk-base/core","xdk-base/exception","xdk-base/console","css!./css/Grid"],function(e,t,i,n,s,r,a,o,l,c,d){"use strict";var u=function(e,t){return 0===t?NaN:(e%t+t)%t},h=function(e){return d.info(e),o.reject(e)};return e.create(t,{},{__isFiniteDatasource:!1,init:function(e){this._super(e);var r=e.alignment===t.VERTICAL,a=e.scrollFrontBoundary||0,o=e.scrollEndBoundary||0;this.setPrereadyStgy(s.bind(n.LOOPED_PREREADY_STGY,this,a)),this.setCheckScrollableStgy(n.LOOPED_CHECK_SCROLLABLE_STGY),this.setCheckSelectableStgy(s.bind(n.LOOPED_CHECK_SELECTABLE_STGY,this,a,o)),this.setDataMappingStgy(n.LOOPED_DATA_MAPPING_STGY),this.setScrollEntranceStgy(s.bind(i.BASIC_SCROLL_ENTRANCE_STGY,this,r)),this.setScrollShiftStgy(i.BASIC_SCROLL_SHIFT_STGY),this.setScrollExitStgy(i.BASIC_SCROLL_EXIT_STGY),this.setOnUpdateStgy(this.__onUpdateStgy),this.setKeyNavigationStgy(s.bind(n.LOOPED_BOUNDARY_KEY_NAVIGATION_STGY,this,r,a,o)),this.setDsRangeCalculationStgy(i.BASIC_DS_RANGE_CALCULATION_STGY)},__onUpdateStgy:function(){return this.__isFiniteDatasource?n.LOOPED_FINITEDS_ONUPDATE_STGY.apply(this,arguments):n.LOOPED_ONUPDATE_STGY.apply(this,arguments)},setDatasource:function(e){if(!(e instanceof r))return h("Cannot set an invalid datasource");if(this._ds===e)return h("Unable to set set the same datasource");this.__isFiniteDatasource?this._ds&&this.__datasourceListener&&this._ds.removeEventListener(a.EVT_FINITEDS_UPDATED,this.__datasourceListener):this._ds&&this.__datasourceListener&&this._ds.removeEventListener(r.EVT_UPDATED,this.__datasourceListener),this.reset(),this._ready=!1,this._ds=e,this.__isFiniteDatasource=e instanceof a;var t,i;return i={selectedDsIndex:this._selectedDsIndex,selectedGridRow:this._selectedGridRow,cols:this._cols,rows:this._rows,ds:this._ds},this._prereadyStgy(i),this._selectedDsIndex=i.selectedDsIndex,this._selectedGridRow=i.selectedGridRow,t=this._dsRangeCalculationStgy(this._selectedDsIndex,this._selectedGridRow,i),this._selectedGridCol=u(this._selectedDsIndex,this._cols),this._firstSlotDsIndex=t.from,this.__datasourceListener||(this.__datasourceListener=s.bind(this._onDatasourceUpdated,this)),this.__isFiniteDatasource?(this._ds.addEventListener(a.EVT_FINITEDS_UPDATED,this.__datasourceListener),-1===this._ds.getTotalCount()?o.reject(l.createException(c.ILLEGAL_STATE,"Datasource Total count is not set.")):this.select(this._selectedDsIndex,this._selectedGridRow)):(this._ds.addEventListener(r.EVT_UPDATED,this.__datasourceListener),-1===this._ds.getTotalCount()?this._ds.getRange(t.from,t.to).then(s.bind(function(){return-1===this._ds.getTotalCount()?h("Unable to initialize the datasource, totalCount still equals -1"):this.select(this._selectedDsIndex,this._selectedGridRow)},this)):(0===this._ds.getTotalCount()&&d.warn("tried to set an datasource 0 total count, grid can will only be updated if it's notified by EVT_UPDATED from datasource with new total count"),this.select(this._selectedDsIndex,this._selectedGridRow)))}})}),define("tvedemo/ext/ui/grid/LoopedGrid",["xdk-base/class","xdk-ui-grid/LoopedGrid","xdk-ui-grid/Grid","xdk-ax/evt/type","xdk-ui-grid/gridStgy","xdk-ui-grid/loopedGridStgy","xdk-base/util","xdk-ax/data/Datasource","xdk-ax/data/FiniteDatasource","xdk-base/promise","xdk-base/core","xdk-base/exception","xdk-base/console","xdk-ax/evt/eventManager","xdk-base/device/vKey","css!xdk-ui-grid/css/Grid"],function(e,t,i,n,s,r,a,o,l,c,d,u,h,_,g){"use strict";return e.create(t,{},{__focused:!1,__okToScroll:!0,__scrollWheelThreshold:125,init:function(e){this._super(e),this._onFocusRef=a.bind(this._onFocus,this),this.addEventListener(n.FOCUS,this._onFocusRef),this._onBlurRef=a.bind(this._onBlur,this),this.addEventListener(n.BLUR,this._onBlurRef),this.getRoot().addEventListener("mousewheel",a.bind(this._onScrollWheel,this))},_onFocus:function(e){this.__focused=!0},_onBlur:function(e){this.__focused=!1},_onScrollWheel:function(e){if(this.__focused&&this.__okToScroll){this.__okToScroll=!1,setTimeout(a.bind(function(){this.__okToScroll=!0},this),this.__scrollWheelThreshold);var t=e||window.event,i=t.detail?-120*t.detail:t.wheelDelta,s=require("xdk-ax/focusManager").getCurFocus();s=s||this.getView(),i>0?(h.log("Scroll forward"),_.trigger(n.KEY,s,{id:g.LEFT.id})):(h.log("Scroll backward"),_.trigger(n.KEY,s,{id:g.RIGHT.id}))}},reset:function(e){this._super();for(var t in e)this._opts[t]=e[t];var n=this._opts.alignment===i.VERTICAL,o=this._opts.scrollFrontBoundary,l=this._opts.scrollEndBoundary;this.setPrereadyStgy(a.bind(r.LOOPED_PREREADY_STGY,this,o)),this.setCheckScrollableStgy(r.LOOPED_CHECK_SCROLLABLE_STGY),this.setCheckSelectableStgy(a.bind(r.LOOPED_CHECK_SELECTABLE_STGY,this,o,l)),this.setDataMappingStgy(r.LOOPED_DATA_MAPPING_STGY),this.setScrollEntranceStgy(a.bind(s.BASIC_SCROLL_ENTRANCE_STGY,this,n)),this.setScrollShiftStgy(s.BASIC_SCROLL_SHIFT_STGY),this.setScrollExitStgy(s.BASIC_SCROLL_EXIT_STGY),this.setOnUpdateStgy(this.__onUpdateStgy),this.setKeyNavigationStgy(a.bind(r.LOOPED_BOUNDARY_KEY_NAVIGATION_STGY,this,n,o,l)),this.setDsRangeCalculationStgy(s.BASIC_DS_RANGE_CALCULATION_STGY)}})}),define("tvedemo/wgt/ExtendedBinge/AllEpisodeButton",["xdk-base/class","xdk-base/util","xdk-ui-basic/Button"],function(e,t,i){"use strict";return e.create(i,{},{_disabled:!1,init:function(e){e=e||{},this._super(e)},show:function(){!0!==this._disabled&&this._super()},hide:function(){!0!==this._disabled&&this._super()},disable:function(){this.hide(),this._disabled=!0},enable:function(){this._disabled=!1}})}),define("tvedemo/wgt/MiniBinge/MiniBinge",["xdk-base/class","xdk-base/util","xdk-ui-basic/Layout","xdk-ax/Container","xdk-ax/focusManager","xdk-ui-basic/Label","xdk-ui-basic/Button","xdk-ax/evt/type","storm/mgr/sLocalStorageManager","tvedemo/mgr/sNavigationManager","storm/mgr/sLanguageManager"],function(e,t,i,n,s,r,a,o,l,c,d){"use strict";var u="mini-binge-watch",h=[0,5,10,15,20,25,30,35,40,45,50,55,60,65,70,75,80,85,90,95,100];return e.create(i,{PLAY:"mini-binge-play",CLOSE:"mini-binge-close",SHOW:"mini-binge-show",MORE_INFO:"mini-binge-more-info",AUTO_PLAY_READY:"mini-binge-autoplay",AUTO_PLAY_RECOMMENDED:"mini-binge-autoplay-recommended",AUTO_PLAY_OFF:"mini-binge-autoplay-off"},{init:function(e){e=e||{},e.css=u+(e.css?" "+e.css:""),e.focusable=!1,e.forwardFocus="leftContainer",e.alignment=i.HORIZONTAL,this._super(e),this.createContainers(),this.addEventHandlers(),this._noShow=!1,this._disabled=!0,e.data&&this.setData(e.data)},createAlreadyWatchedIcon:function(){this._alreadyWatchedIcon=new n({css:"mini-binge-watch-alreadywatched",parent:this._metaContainer})},createContainers:function(){this._leftContainer=new i({id:"leftContainer",focusable:!1,forwardFocus:!0,alignment:i.VERTICAL,parent:this}),this._informationContainer=new n({css:u+"-info",focusable:!0,clickable:!0,parent:this._leftContainer}),this._metaContainer=new n({css:u+"-metainfo-container",parent:this._informationContainer}),this._titleInfo=new r({css:u+"-titleInfo",parent:this._metaContainer}),this._metaTitle=new r({css:u+"-metatitle",parent:this._metaContainer}),this._metaInfo=new r({css:u+"-metainfo",parent:this._metaContainer}),this._playIcon=new n({css:u+"-playicon",parent:this._informationContainer}),this._timerLabel=new r({css:u+"-timer",parent:this._informationContainer}),this._closeButton=new n({css:u+"-close-button",focusable:!0,clickable:!0,parent:this}),this._moreInfo=new a({css:u+"-more-info",focusable:!0,clickable:!0,text:d.getString("Binge.Binge_more_info_text"),parent:this._leftContainer}),this._moreInfo.hide()},show:function(){!1===this._noShow&&this.isHidden()&&(this._super(),this._moreInfo.isHidden()||s.focus(this._moreInfo),this.dispatchEvent(this.constructor.SHOW))},hide:function(e){!0===e&&(this._noShow=!0,this._currentlyHidden=!0),this._bingeTriggeredTime=null,this._bingeEndTrigger=null,this._super()},enableShow:function(){this._noShow=!1},storeStateAndHide:function(){this._currentlyHidden=this.isHidden(),this.hide()},restore:function(){t.isUndefined(this._currentlyHidden)||this.setVisibility(!this._currentlyHidden)},update:function(e,t,i){if(!this._disabled){var n;(!this._bingeTriggeredTime||e<this._bingeTriggeredTime)&&(this._bingeTriggeredTime=e,this._bingeEndTrigger=e+t>i?i-1:e+t),n=this._bingeEndTrigger-e,console.log("time: "+n),n>=0&&this._timerLabel.setText(Math.round(n));if("true"!==l.getStoredValue(l.KEYS.BINGE_AUTO_PLAY)||this._autoPlayStatus===this.constructor.AUTO_PLAY_OFF)this._timerLabel.hide();else{this._playIcon._root.setClass(u+"-playicon");var s=~~(100*(1-n/(this._bingeEndTrigger-this._bingeTriggeredTime))),r=0;console.log(s);for(var a=h.length;a>0;a--)if(s>=h[a]){r=h[a];break}this._playIcon.addClass("progress-"+r)}return n<0?!this._noShow&&!this.isHidden():(this.show(),!1)}},addEventHandlers:function(){this._onCloseButtonClick=t.bind(function(){this.hide(!0),this.dispatchEvent(this.constructor.CLOSE)},this),this._onPlayButtonClick=t.bind(function(){this._autoPlayStatus!==this.constructor.AUTO_PLAY_OFF&&this.dispatchEvent(this.constructor.PLAY,this._asset)},this),this._onMoreInfoClick=t.bind(function(){this.dispatchEvent(this.constructor.MORE_INFO,{autoPlayStatus:this._autoPlayStatus,asset:this._asset})},this),this._informationContainer.addEventListener(o.CLICK,this._onPlayButtonClick),this._closeButton.addEventListener(o.CLICK,this._onCloseButtonClick),this._moreInfo.addEventListener(o.CLICK,this._onMoreInfoClick)},getAsset:function(){return this._asset},getAutoPlayStatus:function(){return this._autoPlayStatus},setData:function(e,i){if(!e)return void(this._disabled=!0);this._disabled=!1,this._autoPlayStatus=this.constructor.AUTO_PLAY_READY,this._asset=e.asset;var n,s=this._asset.get("seasonNumber"),r=this._asset.get("episodeNumber"),a=this._asset.get("serieTitle"),o=this._asset.get("parentalRating").display,l=this._asset.get("category"),u=this._asset.get("bookmark"),h=[""],_=e.currentlyPlayingSeasonNumber;u&&!t.isUndefined(u.watchedState)&&"W"===u.watchedState&&this.createAlreadyWatchedIcon(),e.episodeDifference>1&&"active"!==i?(n=d.getString("Binge.Binge_Mini_episode_gap_msg",{season_number:s,episode_number:r,fsk:o,partner_channel:l}),"active_restrictive"!==i&&(this._autoPlayStatus=this.constructor.AUTO_PLAY_RECOMMENDED),this._moreInfo.show()):!1===e.sameSeason?(n=d.getString("Binge.Binge_Mini_season_break_msg",{current_season_number:_,season_number:s,episode_number:r,fsk:o,partner_channel:l}),this._autoPlayStatus=this.constructor.AUTO_PLAY_READY):!0===e.endOfSeries?(n=d.getString("Binge.Binge_Mini_series_break_msg",{series_title:a}),
this._autoPlayStatus=this.constructor.AUTO_PLAY_OFF,c.hasSeriesBaseNavigationItem()&&this._moreInfo.show(),this._playIcon.hide()):(n=d.getString("Binge.Binge_next_episode"),this._metaTitle.setText("S"+s+" E"+r),this._asset.get("category")&&h.push(this._asset.get("category")),this._asset.get("parentalRating")&&h.push(this._asset.get("parentalRating").display),this._metaInfo.setText(h.join(" | "))),this._titleInfo.setText(n)}})}),define("tvedemo/tmpl/fullscreenPlayer",["xdk-ax/Container","xdk-ui-basic/Button","tvedemo/wgt/FocusableButton","xdk-ui-basic/Image","xdk-ui-basic/Label","xdk-ui-basic/Layout","tvedemo/ext/ui/grid/LoopedGrid","xdk-ui-basic/Checkbox","tvedemo/wgt/Footer","tvedemo/wgt/FooterIconMap","tvedemo/wgt/ExtendedBinge/AllEpisodeButton","tvedemo/wgt/MiniBinge/MiniBinge","storm/mgr/sLanguageManager"],function(e,t,i,n,s,r,a,o,l,c,d,u,h){"use strict";return function(){return{klass:r,id:"#fullscreenPlayerView",width:1,alignment:r.HORIZONTAL,children:[{klass:e,id:"playerControllerContainer",css:"player-controller-container",children:[{klass:i,id:"playAndPause",css:"play-and-pause"},{klass:e,id:"progressBarContainer",css:"progress-bar-container",children:[{klass:e,id:"progressBar",css:"progress-bar"}]},{klass:s,id:"time",css:"time"},{klass:s,id:"title",css:"title"},{klass:n,id:"channel-logo",css:"channel-logo"}]},{klass:u,id:"miniBinge",css:""},{klass:d,id:"allEpisodes",css:"binge-watch-all-episodes-button",text:h.getString("Binge.Binge_all_episodes")},{klass:r,id:"footer-container",css:"footer-container",alignment:r.HORIZONTAL,forwardFocus:!0,children:[{klass:n,id:"footerline",src:"img/vod_fullscreen/nav_bar.png"},{klass:l,id:"footer",css:"footer",iconSet:c.DEFAULT},{klass:r,css:"playback-controls-container",children:[{klass:i,id:"playcta",css:"playcta"},{klass:i,id:"pausecta",css:"pausecta"},{klass:i,id:"stopcta",css:"stopcta"},{klass:i,id:"rewindcta",css:"rewindcta"},{klass:i,id:"forwardcta",css:"forwardcta"},{klass:s,id:"playback-controls-text",css:"playback-controls-text"},{klass:i,id:"backcta",css:"backcta"},{klass:s,id:"playback-back-text",css:"playback-back-text"}]}]}]}}}),define("tve/mgr/sPlaybackManager",["xdk-base/class","xdk-base/config","xdk-base/util","tve/sServiceHolder","xdk-base/core","xdk-base/promise","storm/helper/silkResponseHelper","tvedemo/mgr/sEndUserManager"],function(e,t,i,n,s,r,a,o){"use strict";return new(e.create({},{playSessionToken:null,playSessionHeartbeat:null,_playedTime:null,_duration:null,setHeartbeatPlayedTime:function(e){this._playedTime=e},setHeartbeatDuration:function(e){this._duration=e},heartbeat:function(e,t){t=t||!1;var s,l,c=n.getLinearContentService(),d=!1;return c?(l=r.defer(),this._playedTime/this._duration*100>90&&(d=!0),s=i.bind(function(){c.heartbeat({assetId:e,skygoSessionId:o.getUserSessionId(),playSessionToken:this.playSessionToken,playedTime:this._playedTime,duration:this._duration,watched:d?"Y":"N"}).then(i.bind(function(n){if(o.setLocalBookmark({assetId:e,playedTime:this._playedTime,duration:this._duration,watched:d?"W":"P"}),!0===t)return void l.resolve({stopVideo:!1});a.skimSilkResponse(n,a.MODE.SILENT).then(i.bind(function(){if(n&&n.resultCode===a.SILK_CODE.NO_ERRORS){var e=1e3*n.delay;this.playSessionToken=n.playSessionToken,this.playSessionHeartbeat=setTimeout(s,e)}else l.resolve({stopVideo:!0,reason:n&&n.resultCode})},this))},this))},this),s(),l.promise):r.resolve({stopVideo:!0,reason:"Heartbeat service unavailable."})},resetVariables:function(){this._playedTime=null,this._duration=null},killHeartbeat:function(){this.playSessionHeartbeat&&(clearTimeout(this.playSessionHeartbeat),this.playSessionHeartbeat=null,this.playSessionToken=null)}}))}),define("tvedemo/wgt/vLoading",["xdk-ax/Container","xdk-ui-basic/Image","xdk-base/class","xdk-base/Env","xdk-ax/mvc/AppRoot","xdk-base/device/vKey"],function(e,t,i,n,s,r){"use strict";var a=s.singleton(),o=n.singleton(),l=i.create(e,{_shared:null,getShared:function(){return this._shared||(this._shared=new l),this._shared},open:function(e){return this.getShared().open(e)},close:function(){return this.getShared().close()}},{init:function(i){i=i||{},i.css=i.css||"",i.css+="wgt-dialog-modal wgt-loading",i.parent=a.getView(),this._super(i),this._overlay=new e({parent:this,css:"wgt-dialog-overlay"}),new t({klass:t,css:"load",src:"img/loading/load.gif",parent:this._overlay})},open:function(e){e&&o.addNotBlockedKey(r.BACK.id),this.show(),o.blockKeys()},close:function(){o.removeWhitelistedKey(r.BACK.id),o.unblockKeys(),this.hide()}});return l}),define("tvedemo/ext/device/shared/ConvivaDefault",["storm/ConvivaHelper","xdk-base/config","xdk-base/console","xdk-base/device"],function(e,t,i,n){return{_convivaHelper:null,_convivaInclude:!1,_convivaPlatforms:[],_platformValid:null,_configs:null,init:function(){i.log("[Device::Shared::ConvivaDefault] init()"),i.log("[Device::Shared::ConvivaDefault] platform: "+n.platform),this._configs=t.get("analytics.config",{}),this._configs.conviva&&(this._convivaInclude=this._configs.conviva.include,this._convivaPlatforms=this._configs.conviva.platforms),this._convivaPlatforms&&(this._platformValid=this._convivaPlatforms.indexOf(n.platform)>-1),this._convivaInclude&&this._platformValid&&(this._convivaHelper=new e)},createSession:function(e,t){i.log("[Device::Shared::ConvivaDefault] createSession()"),e=e||{},this._convivaBaseData=e.convivaBaseData,this._convivaCustomData=e.convivaCustomData,this._convivaHelper&&this._convivaBaseData&&this._convivaCustomData&&this._convivaHelper.createSession(this._convivaBaseData,this._convivaCustomData)},cleanUpSession:function(){i.log("[Device::Shared::ConvivaDefault] cleanUpSession()"),this._convivaHelper&&this._convivaHelper.cleanupSession()},reportError:function(e){i.log("[Device::Shared::ConvivaDefault] reportError()"),this._convivaHelper&&this._convivaHelper.reportError(e)},reportSeek:function(e){this._convivaHelper&&this._convivaHelper.reportSeek(e)},__setPlayerName:function(){},__enableTouchstone:function(){}}}),define("tvedemo/wgt/ExtendedBinge/SeasonIndicator",["xdk-base/class","xdk-ax/Container","xdk-ui-basic/Label","xdk-base/util","xdk-ax/evt/type"],function(e,t,i,n,s){"use strict";return e.create(t,{UP_ARROW_CLICKED:"extendedbinge-season-uparrow",DOWN_ARROW_CLICKED:"extendedbinge-season-downarrow"},{init:function(e){e=e||{},e.css=e.css?e.css+" extendedbinge-season-indicator":"extendedbinge-season-indicator",e.focusable=!0,this._super(e);var r=e.data;if(!r.firstSeason){new t({css:"extendedbinge-season-indicator-uparrow",clickable:!0,parent:this}).addEventListener(s.CLICK,n.bind(this.dispatchEvent,this,this.constructor.UP_ARROW_CLICKED))}if(this._label=new i({css:"extendedbinge-season-indicator-label",text:r.title,parent:this}),!r.lastSeason){new t({css:"extendedbinge-season-indicator-downarrow",clickable:!0,parent:this}).addEventListener(s.CLICK,n.bind(this.dispatchEvent,this,this.constructor.DOWN_ARROW_CLICKED))}}})}),define("tvedemo/wgt/ExtendedBinge/EpisodeButton",["xdk-base/class","xdk-ax/Component","xdk-ax/Container","xdk-ui-basic/Button","xdk-ui-basic/Label","xdk-base/promise","xdk-base/util","tvedemo/wgt/Progressbar","storm/mgr/sLanguageManager"],function(e,t,i,n,s,r,a,o,l){"use strict";return e.create(i,{},{init:function(e){e=e||{},e.clickable=!0,e.focusable=!0,e.css=e.css||"extended-binge-episode-list-button",e.data&&"placeholder"===e.data.get("type")&&(e.clickable=!1),this._super(e),this._setupContainers(),e.data&&this._createMetadata(e.data,e.isCurrentAsset)},setupProgress:function(e){e&&!a.isUndefined(e.watchedState)&&"W"===e.watchedState?this._createAlreadyWatchedIcon():e&&!a.isUndefined(e.percentage)&&this._createProgressBar(e.percentage)},updateProgressBar:function(e,t){if(this._opts.data.get("id")===t){if(this._alreadyWatchedIcon&&this._alreadyWatchedIcon._root)return this._alreadyWatchedIcon.deinit(),void this.setupProgress(e);this._progressBar&&this._progressBar.update(e.percentage,e.watchedState)}},_setupContainers:function(){this._metaContainer=new i({css:"extended-binge-episode-list-button-metacontainer",parent:this})},_createMetadata:function(e,t){if("placeholder"===e.get("type"))this.addClass("placeholder"),this._createTitleLabel(e.get("title"));else{var i=[""],n="",s=e.get("parentalRating").display,r=e.get("bookmark");n=e.get("category")||"",n+=e.get("isHD")?" HD":"",n&&i.push(n),i.push(s),this._createPlayIcon(),t&&!0===t&&(this.addClass("current-asset"),this._createCurrentAssetLabel()),this._createTitleLabel("S"+e.get("seasonNumber")+" E"+e.get("episodeNumber")),this._createInfoLabel(i.join(" | ")),this.setupProgress(r)}},_createCurrentAssetLabel:function(){this._currentAssetLabel=new s({text:l.getString("Binge.Binge_now_playing")+":",css:"episode-button-currentasset",parent:this._metaContainer})},_createTitleLabel:function(e){this._titleLabel=new s({text:e,css:"episode-button-title",parent:this._metaContainer})},_createInfoLabel:function(e){this._infoLabel=new s({text:e,css:"episode-button-info",parent:this._metaContainer})},_createPlayIcon:function(){this._playIcon=new i({css:"episode-button-playicon",parent:this})},_createProgressBar:function(e){this._progressBar=new o({progress:e,parent:this._metaContainer})},_createAlreadyWatchedIcon:function(){this._alreadyWatchedIcon=new i({css:"episode-button-alreadywatched",parent:this._metaContainer})}})}),define("tvedemo/wgt/ExtendedBinge/extendedBingeGridStgy",["xdk-ax/Component","xdk-ax/Container","xdk-base/device/vKey","xdk-base/util","xdk-base/promise"],function(e,t,i,n,s){"use strict";function r(){if(this._focusComponent&&this._animationTarget&&this._animationTarget.elementToFocus&&this._animationTarget.elementToFocus._root&&this._animationTarget.elementToFocus._root._dom){var e=(window.innerHeight,window.innerWidth,this._animationTarget.elementToFocus._root._dom.offsetParent===this._root._dom?0:this._container._root._dom.offsetTop),t=this._focusComponent._root._dom,i=this._animationTarget.elementToFocus._root._dom,s={width:t.offsetWidth,height:t.offsetHeight,top:t.offsetTop,left:t.offsetLeft},o={width:i.offsetWidth,height:i.offsetHeight,top:e+i.offsetTop,left:i.offsetLeft},l=!0;for(var c in s)s.hasOwnProperty(c)&&a(this._focusComponent,s[c],o[c],c)&&(l=!1);!1===l&&u(n.bind(r,this))}}function a(e,t,i,n){var s,r=t<i?1:-1;return t!==i&&(s=t+25*r,s=i,e._root._dom.style[n]=s+"px",s!==i)}function o(e,t,i,r){var a,o,l,c=r.newRowsCount,d=s.defer();return a=e.getChildren(),u(function(){if(a.length>0)if(t>0)for(o=0;o<c;o++)a[o].deinit();else for(l=a.length,o=l-c;o<l&&a[o];o++)a[o].deinit();var i=t>0?1:0,s=a[i],r=0;s&&(s&&s.hide(),r=s.getRoot()._dom.offsetTop),console.log("CHILDHEIGHT: "+r),e.getRoot().removeClass("animate"),e.getRoot()._dom.style.top=r+"px",n.delay(.3).then(function(){d.resolve("grid exiting shift, remove items from animated grid.")})}),d.promise}var l,c=function(e,t){return(e%t+t)%t},d={},u=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame;return"ontransitionend"in window?("transition",l="transitionend"):"onwebkittransitionend"in window&&("webkitTransition",l="webkitTransitionEnd"),d.ANIMATED_SCROLL_ENTRANCE_STGY=function(i,n,s,r,a){var o,l,c,d,u,h,_=a.gridComponents.slice(a.newRowsStart,a.newRowsStart+a.newRowsCount),g=a.newRowsCount,f=n.getChildren();for(o=0;o<g;o++){for(d=[],l=0;l<r.cols&&(_[o]&&_[o][l]);l++)d.push(_[o][l]);c=new t({css:i?"wgt-grid-row-v":"wgt-grid-row-h",children:d}),f.length>0&&s<0&&r.gridComponents&&r.gridComponents[0]?(u=e.PLACE_BEFORE,h=r.gridComponents[0][0].getParent()):(u=e.PLACE_APPEND,h=null),n.attach(c,u,h)}},d.ANIMATED_SCROLL_SHIFT_STGY=function(e,t,i,r,a){var c,d,u=t.getChildren(),h=s.defer();if(!i||u.length<1)return c="grid shifting...... do nothing",console.info(c),s.resolve(c);d=n.bind(function(i){i.propertyName!==e&&-1===e.indexOf(i.propertyName)||(t.getRoot().removeEventListener(l,d),h.resolve())},this);var _=i>0?0:1,g=u&&u[_];return g&&g.show(),h.resolve(),h.promise.then(n.bind(o,this,t,i,r,a))},d.ANIMATED_SCROLL_EXIT_STGY=function(e,t,i,n){return s.resolve("grid exiting shift, remove items from animated grid.")},d.SCROLL_BOUNDARY_CHECK_SELECTABLE_STGY=function(e,t,i,n){var s,r,a=n.selectedDsIndex,o=n.selectedGridRow,l=i.ds.getTotalCount();return!(a<0)&&(s=Math.floor(a/i.cols),r=Math.floor((l-1)/i.cols),!((o<e||o>=i.rows-t)&&s>e&&s<r-t)&&((!i.ds._data[a]||"emptyItem"!==i.ds._data[a].type)&&(a<l||s<=r&&(n.selectedDsIndex=l-1,n.selectedGridCol=c(l-1,this._cols),!0))))},d.FLOATING_FOCUS_HANDLING=function(e){this._animationTarget={elementToFocus:e.target},console.log("focus handling called animationFrame"),u(n.bind(r,this))},d}),define("tvedemo/wgt/ExtendedBinge/EpisodeList",["xdk-base/class","xdk-ax/Component","xdk-ui-grid/BoundedGrid","xdk-ax/Container","xdk-ui-basic/Button","xdk-ui-basic/Label","fix/Scrollbar","xdk-ax/evt/type","xdk-ax/data/Datasource","xdk-base/promise","xdk-base/util","tvedemo/wgt/ExtendedBinge/EpisodeButton","tvedemo/wgt/ExtendedBinge/extendedBingeGridStgy","storm/mgr/sLanguageManager"],function(e,t,i,n,s,r,a,o,l,c,d,u,h,_){"use strict";return e.create(i,{},{_onEpisodeRowSelectionChangedHandler:null,init:function(e){e=e||{},e.rows=e.rows||4,e.cols=e.cols||1,e.scrollFrontBoundary=e.scrollFrontBoundary||1,e.scrollEndBoundary=e.scrollEndBoundary||1,e.css=e.css||"extended-binge-episode-list",e.alignment=e.alignment||i.HORIZONTAL,this._super(e),this._onEpisodeRowSelectionChangedHandler=d.bind(this._onEpisodeRowSelectionChanged,this),this._createHeader(),e.data&&(this.setData(e.data,e.preselectAsset,e.currentAsset),e.data.episodes.length>e.rows&&this._createScrollbar())},_onEpisodeRowSelectionChanged:function(e){if(e&&this.__scrollbar){var t=(e.selectedDsIndex>0?e.selectedDsIndex+1:e.selectedDsIndex)/this._opts.data.episodes.length;this.__scrollbar.update(t)}},_createScrollbar:function(){this.__scrollbar=new a({css:"scrollbar",parent:this});var e=this._opts.data.episodes.length>this._opts.rows?this._opts.rows:this._opts.data.episodes.length,t=71*e;this.__scrollbar.set(0,71,71,7,t),this.addEventListener(o.SELECTION_CHANGED,this._onEpisodeRowSelectionChangedHandler),this.__scrollbar.hide()},_createHeader:function(){var e=this._container,i=this._opts.data,s=i&&i.season,a="",o="",l=new n({css:"extended-binge-episode-list-header"});s&&(a=_.getString("Binge.Binge_season_text")+" "+s+" |  ",l.attach(new r({css:"extended-binge-episode-list-header-season",text:a}))),o=i.episodes.length-i.placeHolderCount+" "+_.getString("Binge.Binge_episodes_text"),l.attach(new r({css:"extended-binge-episode-list-header-episode",text:o})),this.attach(l,t.PLACE_BEFORE,e)},getSelectedEpisode:function(){return this.getSelectedData()},showScrollbar:function(){this.__scrollbar&&this.__scrollbar.show()},hideScrollbar:function(){this.__scrollbar&&this.__scrollbar.hide()},updateProgressBar:function(e,t){var i=this.getSelectedComp();i&&i.updateProgressBar&&i.updateProgressBar(e,t)},displayHelper:function(e,t){var i={css:"extended-binge-episode-list-button",data:t};return e&&t.get("episodeNumber")===e.get("episodeNumber")&&(i.isCurrentAsset=!0,this.showScrollbar()),new u(i)},dataLoader:function(e,t,i){return c.resolve({data:e.slice(t,t+i),total:e.length})},setData:function(e,t,i){var n=new l,s=0,r=0,a=e.episodes.length-1-(this._rows-1);return n.setDataLoader(d.bind(this.dataLoader,this,e.episodes)),this.setDisplayStgy(d.bind(this.displayHelper,this,i)),t&&!d.isUndefined(i)&&(d.each(e.episodes,function(e,t,n){if(i.get("episodeNumber")===e.get("episodeNumber"))return s=t,n.length>1&&0!==t&&(r=1),d.breaker}),e.episodes.length<=this._rows?r=s:s>a&&(r=s-a),this.setPrereadyStgy(function(e){e.selectedDsIndex=s,e.selectedGridRow=r})),this.setDatasource(n)},selectLastEpisode:function(){var e=this.getDatasource().getTotalCount(),t=e>=this._rows?this._rows-1:e-1;return this.select(e-1,t)},selectFirstEpisode:function(){return this.select(0,0)}})}),define("tvedemo/wgt/ExtendedBinge/ExtendedBingeSeasonRow",["xdk-base/class","xdk-ui-grid/BoundedGrid","xdk-ax/data/Datasource","xdk-base/promise","xdk-base/util","tvedemo/mgr/sEndUserManager","tvedemo/wgt/ExtendedBinge/SeasonIndicator","tvedemo/wgt/ExtendedBinge/EpisodeList"],function(e,t,i,n,s,r,a,o){"use strict";return e.create(t,{},{init:function(e){e.rows=2,e.cols=1,e.css=e.css||"extended-binge-season-row",e.alignment=e.alignment||t.VERTICAL,this._super(e),e.data&&this.setData(e.data,e.preselectAsset,e.currentAsset)},select:function(e,t,i){return!0===this._ready&&this._selectedDsIndex===e?n.defer().promise:this._super(e,t,i)},displayHelper:function(e,t,i){if(i&&i.episodes&&s.isArray(i.episodes))return new o({preselectAsset:e,currentAsset:t,data:i});var n=new a({data:i});return n.addEventListener(a.UP_ARROW_CLICKED,s.bind(this.dispatchEvent,this,a.UP_ARROW_CLICKED)),n.addEventListener(a.DOWN_ARROW_CLICKED,s.bind(this.dispatchEvent,this,a.DOWN_ARROW_CLICKED)),n},dataLoader:function(e,t,i){return n.resolve({data:e.slice(t,t+i),total:e.length})},updateProgressBar:function(e,t){var i=this.getSelectedComp();i&&i.updateProgressBar&&i.updateProgressBar(e,t)},getSelectedEpisode:function(){var e=this.getSelectedComp();return e.getSelectedEpisode&&e.getSelectedEpisode()},getBookmarks:function(e){var t,i,n,s,a=[],o=e&&e.length||0;for(t=0;t<o;t++)(s=e[t]&&e[t].get("id"))&&a.push(s);return r.getBookmarkForAssetList(a.join(",")).then(function(r){if(r)for(n=r.length,i=0;i<n;i++)for(t=0;t<o;t++)(s=e[t]&&e[t].get("id"))&&r[i]&&s==r[i].assetId&&e[t].set("bookmark",{bookmark:r[i].bookmark,duration:r[i].duration,percentage:r[i].percentage,watchedState:r[i].watchedState})})},setData:function(e,t,n){var r=[],a=new i;return r.push(e.seasonIndicator),r.push(e.episodeListData),a.setDataLoader(s.bind(this.dataLoader,this,r)),t&&n&&this.setPrereadyStgy(function(e){e.selectedDsIndex=1,e.selectedGridRow=1}),this.setDisplayStgy(s.bind(this.displayHelper,this,t,n)),this.getBookmarks(e.episodeListData.episodes).then(s.bind(function(){return this.setDatasource(a)},this))},isEpisodeListSelected:function(){return 1===this._selectedGridRow},selectLastEpisode:function(){return this._gridComponents&&this._gridComponents[1]&&this._gridComponents[1][0]?this._gridComponents[1][0].selectLastEpisode():n.resolve()},selectFirstEpisode:function(){return this._gridComponents&&this._gridComponents[1]&&this._gridComponents[1][0]?this._gridComponents[1][0].selectFirstEpisode():n.resolve()}})}),define("tvedemo/wgt/ExtendedBinge/ExtendedBinge",["xdk-base/class","xdk-ax/Component","xdk-ui-grid/BoundedGrid","xdk-base/util","xdk-ax/data/Datasource","xdk-base/promise","xdk-ax/Container","xdk-ax/evt/type","tvedemo/wgt/ExtendedBinge/ExtendedBingeSeasonRow","tvedemo/wgt/ExtendedBinge/extendedBingeGridStgy","tvedemo/wgt/ExtendedBinge/SeasonIndicator"],function(e,t,i,n,s,r,a,o,l,c,d){"use strict";var u;return u=e.create(i,{EVT_CLOSE:"extended-binge-closed",EVT_CLICK:"extended-binge-click"},{init:function(e){e.nextUp=e.nextUp||null,e.nextLeft=e.nextLeft||null,e.neDownUp=e.nextDown||null,e.nextRight=e.nextRight||null,e.rows=e.rows||4,e.cols=e.cols||1,e.css=e.css||"extended-binge",e.alignment=e.alignment||i.HORIZONTAL,e.scrollFrontBoundary=e.scrollFrontBoundary||1,e.scrollEndBoundary=e.scrollEndBoundary||e.rows-2,this._currentPlayedAsset=e.currentPlayedAsset,this._firstDisplay=!0,this._super(e),this._setGridStrategies(),this._setupFocusHandling(),this._setupCloseHandling(),e.data&&this.setData(e.data)},_setGridStrategies:function(){this.setScrollEntranceStgy(n.bind(c.ANIMATED_SCROLL_ENTRANCE_STGY,this,this._opts.alignment===i.VERTICAL)),this.setScrollShiftStgy(n.bind(c.ANIMATED_SCROLL_SHIFT_STGY,this,"top")),this.setScrollExitStgy(n.bind(c.ANIMATED_SCROLL_EXIT_STGY,this)),this.setCheckSelectableStgy(n.bind(c.SCROLL_BOUNDARY_CHECK_SELECTABLE_STGY,this,this._opts.scrollFrontBoundary,this._opts.scrollEndBoundary))},_setupFocusHandling:function(){this._focusComponent=new a({css:"focus-square"}),this._onFocus=n.bind(c.FLOATING_FOCUS_HANDLING,this),this.addEventListener(o.FOCUS,this._onFocus),this._onSelect=n.bind(this._onSelectionChanged,this),this.addEventListener(o.CLICK,n.bind(this._handleGridClick,this))},_handleGridClick:function(){var e=this.getSelectedEpisode();e.get("id")!==this._currentPlayedAsset.get("id")?this.dispatchEvent(this.constructor.EVT_CLICK,e):this.hide()},_setupCloseHandling:function(){this._closeButton=new a({focusable:!0,clickable:!0,css:"extended-binge-close-button",nextLeft:this}),this.attach(this._closeButton,t.PLACE_BEFORE,this._container),this.setOption("nextRight",this._closeButton),this._closeButton.addEventListener(o.CLICK,n.bind(this._onClose,this))},_onClose:function(){return this.hide(),!1},hide:function(e){this._super(),e||this.dispatchEvent(u.EVT_CLOSE,this._currentPlayingState)},_toggleScrollbar:function(e){var t,i,n,s=this._gridComponents;if(s&&e>0&&e<=this._opts.data.length)for(t=0,i=s.length;t<i;t++)(n=s[t]&&s[t][0]&&s[t][0]._gridComponents?s[t][0]._gridComponents[1][0]:null)&&(n.hideScrollbar(),s[t][0]._opts.data.seasonIndicator.title===this._opts.data[e-1].seasonIndicator.title&&n.showScrollbar())},select:function(e,t){return this._toggleScrollbar(e),this._super(e,t)},_onSelectionChanged:function(e){var t,i;if(n.isUndefined(this._previousSelection))return void(this._previousSelection=e.selectedDsIndex);t=e.selectedGridRow,i=e.gridComponents&&e.gridComponents[t]&&e.gridComponents[t][0],i&&i.isEpisodeListSelected()&&(this._previousSelection>e.selectedDsIndex?i.selectLastEpisode():i.selectFirstEpisode()),this._previousSelection=e.selectedDsIndex},_onSeasonrowSelectionChanged:function(e){if(e&&!this._processingSelectionChange){this._processingSelectionChange=!0;var t,i,s=this._gridComponents,a=[];if(!e.newRowsCount)for(t=0,i=s.length;t<i;t++)s[t]&&s[t][0]&&s[t][0].select&&(s[t][0].select(e.selectedDsIndex,e.selectedGridRow),this._selectedGridRow>t?a.push(s[t][0].selectLastEpisode()):this._selectedGridRow<t&&a.push(s[t][0].selectFirstEpisode()));r.spread(a,n.bind(function(){this._processingSelectionChange=!1},this))}},updateProgressBar:function(e,t){var i=this.getSelectedComp();i&&i.updateProgressBar&&i.updateProgressBar(e,t)},getSelectedEpisode:function(){var e=this.getSelectedComp();return e.getSelectedEpisode&&e.getSelectedEpisode()},displayHelper:function(e){if("emptyItem"===e.type)return new a({css:"empty"});var t={data:e,preselectAsset:this._firstDisplay};e.episodeListData&&e.episodeListData.season===this._currentPlayedAsset.get("seasonNumber")&&(t.currentAsset=this._currentPlayedAsset,this._firstDisplay=!1);var i=new l(t);if(i.addEventListener(o.SELECTION_CHANGED,n.bind(this._onSeasonrowSelectionChanged,this)),i.addEventListener(d.UP_ARROW_CLICKED,n.bind(this._onSeasonUpArrow,this)),i.addEventListener(d.DOWN_ARROW_CLICKED,n.bind(this._onSeasonDownArrow,this)),this._gridComponents){var s=this.getSelectedComp();i.setPrereadyStgy(function(e){e.selectedDsIndex=s._selectedDsIndex,e.selectedGridRow=s._selectedGridRow})}return i},_onSeasonUpArrow:function(){var e=this.getSelectedPosition(),t=e.row,i=this.getSelectedDsIndex(),n=i-1;2===t&&2===i||!1===this._ready||(2===t&&(n=i-2),this.select(n,1))},_onSeasonDownArrow:function(){var e=this.getSelectedPosition(),t=e.row,i=this.getSelectedDsIndex(),n=i+1;!1!==this._ready&&(2===t&&(n=i),this.select(n,1))},dataLoader:function(e,t,i){return r.resolve({data:e.slice(t,t+i),total:e.length})},setData:function(e){var t,i,r=new s;for(e.unshift({type:"emptyItem"}),t=0,i=this._opts.scrollEndBoundary;t<i;t++)e.push({type:"emptyItem"});var a=1;for(t=0,i=e.length;t<i;t++)if(e[t]&&e[t].episodeListData&&e[t].episodeListData.season===this._currentPlayedAsset.get("seasonNumber")){a=t,this.currentPlayedSeasonDSIndex=t;break}return this.setPrereadyStgy(function(e){e.selectedDsIndex=a,e.selectedGridRow=1}),this._firstDisplay=!0,r.setDataLoader(n.bind(this.dataLoader,this,e)),this.setDisplayStgy(n.bind(this.displayHelper,this)),this.setDatasource(r).then(n.bind(function(){this.attach(this._focusComponent);for(var e,t=this.getSelectedPosition().row,i=this._container.getChildren(),n=0;n<t;n++)(e=i[n])&&e.hide()},this))},show:function(e){this._currentPlayingState=e,this._super()},deinit:function(){this._currentPlayedAsset=null,this._super()}})}),define("tvedemo/ctrl/FullscreenPlayer",["xdk-base/ax","xdk-base/Env","xdk-base/config","xdk-ax/mvc/AppRoot","tvedemo/ctrl/RoutableController","xdk-ax/mvc/view","tvedemo/tmpl/fullscreenPlayer","xdk-ax/evt/type","xdk-ax/focusManager","xdk-ax/mediator","xdk-base/util","xdk-base/device/vKey","tve/videoPlaybackService/model/Playlist","tve/videoPlaybackService/model/PlaylistItem","tve/videoPlaybackService/evt/VideoPlaybackControlsEvent","tve/videoPlaybackService/evt/VideoControlsStatusEvent","storm/mgr/sVideoManager","xdk-base/console","tve/mgr/sPlaybackManager","tve/videoPlaybackService/evt/VideoPlaybackStatusEvent","tvedemo/helper/dialogHelper","storm/mgr/sLanguageManager","storm/mgr/sSilkMessagesManager","tvedemo/mgr/sEndUserManager","storm/helper/silkResponseHelper","storm/event/UserEvent","xdk-mouse/mouseHandler","tvedemo/wgt/vLoading","xdk-base/device","tvedemo/ext/device/shared/ConvivaDefault","tvedemo/mgr/sTrackingManager","tvedemo/mgr/sHistoryManager","tvedemo/mgr/sAssetManager","tvedemo/wgt/ExtendedBinge/ExtendedBinge","tvedemo/wgt/MiniBinge/MiniBinge","tvedemo/helper/sPlaybackHelper","storm/mgr/sAppConfigManager","storm/mgr/sLocalStorageManager","tvedemo/mgr/sNavigationManager","xdk-base/device/interface/System","xdk-base/device/Media"],function(e,t,i,n,s,r,a,o,l,c,d,u,h,_,g,f,p,m,v,b,S,y,E,k,C,T,x,I,w,L,A,D,P,R,O,N,M,B,F,U,G){"use strict";var H=n.singleton(),V=t.singleton(),K=!0,Y={timeleft:30,timeelapsed:0,min_duration:5,max_duration:10},W=G.singleton();return e.klass.create(s,{getDefaultState:function(){return{__forceReload:!0}}},{isVideoPlayback:!0,milliSecondsToSeconds:1e3,_sTrackingManager:null,_analyticsOpenTracked:!1,_playbackHasinitiated:!1,_executingDirectPlay:!1,_handledFinish:!1,__recommendedEpisodes:[],_isVideoPlayer:!0,init:function(){m.info("[TVEDemo FullscreenPlayer] init"),this.setView(r.render(a)),this._sTrackingManager=new A},__setupConvivaStatsTracking:function(e){this.closeMediaSetupCallback();var t=e.asset.get("type"),n=e.asset.get("genreList")||{},s=k.getEntitlements()||"",r="",a="",o="",l=e.channelInfo?e.channelInfo.get("title"):"",c=e.asset.get("title"),d=e.asset.get("live");t===P.ASSET_TYPES.EPISODE&&(r=e.asset.get("episodeNumber")||"",a=e.asset.get("seasonNumber")||"",o="S"+a+":E"+r),this.__isLinear&&(c=l,l=e.asset.get("title"));var u={convivaBaseData:{title:c,url:e.mediaUrl,streamType:Conviva?this.__isLinear||d?Conviva.ContentMetadata.StreamType.LIVE:Conviva.ContentMetadata.StreamType.VOD:"",viewerId:k.getCustomerID()},convivaCustomData:{product:i.get("app.name","SkyOnline"),appVersion:i.get("version","0.0.0"),channelName:l,connectionType:this._getConnectionType(),contentName:c,contentType:t,"entitlement.id":"["+s.toString()+"]",episode:r.toString(),season:a.toString(),serialNumber:o,asset_media_url:e.mediaUrl,genre:n.main?n.main.content:"",subGenre:n.second?n.second.content:""}};L.init(),L.createSession(u,0,e)},closeMediaSetupCallback:function(){var e=this._sTrackingManager;c.subscribe(b.StopState,function(t){e.trackCloseMedia()})},_getConnectionType:function(){var e,t;try{switch(w.platform){case"tizen":switch(window.webapis.network.getActiveConnectionType()){case window.webapis.network.NetworkActiveConnectionType.DISCONNECTED:break;case window.webapis.network.NetworkActiveConnectionType.WIFI:t="WiFi";break;case window.webapis.network.NetworkActiveConnectionType.ETHERNET:t="Ethernet";break;case window.webapis.network.NetworkActiveConnectionType.CELLULAR:t="4G"}break;case"samsung":switch(e=amd.require("xdk-ext-device-samsung/globals"),e.networkPlugin.GetActiveType()){case 1:t="Ethernet";break;case 0:t="WiFi"}break;case"webos":var i=amd.require("xdk-ext-device-webos/Network");if(i&&i.__status)switch(i.__status.networkType){case"wifi":t="WiFi";break;case"ethernet":t="Ethernet"}break;case"lg":switch(e=amd.require("xdk-ext-device-lg/globals"),e.netcastInfo.networkType){case 0:t="Ethernet";break;case 1:t="WiFi"}break;case"playstation":switch(e=w.system.getConnectionType()){case"wired":t="Ethernet";break;case"wifi":t="WiFi";break;case"phone":t="4G"}}}catch(e){}return t},setup:function(e){K=!0,H.getView().addClass("fullscreen-video-mode"),this.__play=d.bind(this.play,this),this.__pause=d.bind(this.pause,this),this.__stop=d.bind(this.stop,this),this.__rewind=d.bind(this.rewind,this),this.__forward=d.bind(this.forward,this),this.__back=d.bind(this.back,this),this.__footerButtonFocus=d.bind(this.__showUI,this),v.resetVariables();var t=this.populateVariables(e);this.__isLinear&&(t.find("progressBarContainer").hide(),this.__timeLabel.hide(),this.__channelLogo.setSrc(e.asset.get("images")[0].get("url"))),this._miniBinge.addEventListener(O.SHOW,d.bind(this.__showAllEpisodeButton,this)),this._miniBinge.addEventListener(O.CLOSE,d.bind(this.__hideUI,this)),this._miniBinge.addEventListener(O.PLAY,d.bind(this._onBingeWatchClick,this)),this._miniBinge.addEventListener(O.MORE_INFO,d.bind(this._onBingeMoreInfoClick,this)),this._miniBinge.hide(),this.getMiniBingeSettings(e.asset),this.__onKeyRef=d.bind(this.onKey,this),t.addEventListener(o.KEY,this.__onKeyRef),l.focus(this.playPauseButton),this.playPauseButton.setFocusableHidden(!0),this.__setPlayback(e),this._setFooter(""),this.__handleUserDataUpdated=d.bind(function(){k.checkUserPrivileges(this.__currentAsset).then(d.bind(function(e){e||this.__transitionToPlayingStoppedEvent()},this))},this),c.subscribe(T.UserDataUpdated,this.__handleUserDataUpdated),this.__userHasBeenLoggedOutHandler=d.bind(function(){this.__transitionToPausedState(),this.displayErrorDialog(y.getString("Errormessages.Errormessages_labelSessionExpired")),L.reportError("Users session has expired and has been logged out"),this._sTrackingManager.trackCloseMedia(),L.cleanUpSession()},this),c.subscribe(T.UserHasBeenLoggedOut,this.__userHasBeenLoggedOutHandler),this.__mouseOnRef=d.bind(this.__mouseOn,this),this.__mouseOffRef=d.bind(this.__mouseOff,this),c.subscribe("mouseOn",this.__mouseOnRef),c.subscribe("mouseOff",this.__mouseOffRef),this.__setupConvivaStatsTracking(e),this._sTrackingManager.trackVideoStateChangeSetupCallback(),this._analyticsOpenTracked=!1,this.__boundAllEpisodeClick=d.bind(this._onAllEpisodesButtonClick,this),this.__boundOnNetworkStatusChange=d.bind(this._onNetworkStatusChange,this),w.system.addEventListener(U.EVT_NETWORK_STATUS_CHANGED,this.__boundOnNetworkStatusChange),this.setupExtendedBinge(e.asset)},getMiniBingeSettings:function(e){Y.timeelapsed=e.get("bingeTrigger"),M.getMiniBingeSetting().then(function(e){e&&!0===e.useOverride&&(Y.timeleft=e.timeleft,Y.min_duration=e.min_duration,Y.max_duration=e.max_duration)})},_onAllEpisodesButtonClick:function(){var e=this.__videoIsPlaying;this.__videoIsPlaying&&!this.__isLinear&&this.__transitionToPausedState(),this._miniBinge.storeStateAndHide(),this.__hideUI(!0,!0),this.extendedBingeGrid.show(e),l.focus(this.extendedBingeGrid)},setupExtendedBinge:function(e){if(e&&e.get("type")===P.ASSET_TYPES.EPISODE){var t=this.getView();P.getExtendedBingeWatchingData(e).then(d.bind(function(i){if(!i||i.seasons.length<=0)return this._allEpisodesButton.disable(),K=!1,void(this._bingeWatchingSetting=i.bingeWatching||"disabled");this._bingeWatchingSetting=i.bingeWatching;var n=B.getStoredValue(B.KEYS.BINGE_AUTO_PLAY);"false"!==n&&"true"!==n&&(n="true",B.setStoredValue(B.KEYS.BINGE_AUTO_PLAY,n)),this.__extendedBingeData=i.seasons,this.extendedBingeGrid=new R({data:i.seasons,currentPlayedAsset:e}),t.attach(this.extendedBingeGrid),this.extendedBingeGrid.hide();var s=this.getNextEpisode(e,i.seasons);this._miniBinge.setData(s,this._bingeWatchingSetting),this.createRecommendedList(s),this._allEpisodesButton.removeEventListener(o.CLICK,this.__boundAllEpisodeClick),this._allEpisodesButton.addEventListener(o.CLICK,this.__boundAllEpisodeClick),
this.extendedBingeGrid.addEventListener(R.EVT_CLICK,d.bind(this._onBingeWatchClick,this)),this.extendedBingeGrid.addEventListener(R.EVT_CLOSE,d.bind(this._onExtendedBingeClose,this))},this)).fail(d.bind(function(){this._allEpisodesButton.disable()},this))}else K=!1,this._allEpisodesButton.disable()},findFirstEpisodeInSeason:function(e){if(!e)return null;for(var t=0,i=e.length;t<i;t++)if(e[t]&&e[t].get("type")===P.ASSET_TYPES.EPISODE)return e[t]},getNextEpisode:function(e,t){for(var i,n,s,r=e.get("seasonNumber"),a=e.get("seasonNumber"),o=e.get("episodeNumber"),l=e.get("subtitleType"),c=e.get("flagOV"),d=[],u=0;u<t.length;u++)t[u].episodeListData&&t[u].episodeListData.episodes&&t[u].episodeListData.episodes.length>0&&t[u].episodeListData.season>=r&&(d=d.concat(t[u].episodeListData.episodes));for(var u=0;u<d.length;u++)if(i=d[u],i.get("seasonNumber")>r&&(r=i.get("seasonNumber"),s=i.get("episodeNumber")),!s&&i.get("episodeNumber")>o&&(s=i.get("episodeNumber")),s){if(i.get("seasonNumber")===r&&i.get("episodeNumber")===s){if(i.get("flagOV")===c&&l&&i.get("subtitleType")===l){n=i;break}i.get("flagOV")===c?n=i:n||(n=i)}if(i.get("episodeNumber")>s)break}return n?{sameSeason:r===a,currentlyPlayingSeasonNumber:a,asset:n||e,episodeDifference:r===a?n.get("episodeNumber")-o:1}:{endOfSeries:!0,seriesTitle:e.get("serieTitle"),asset:e}},createRecommendedList:function(e){var t=[];!0===e.endOfSeries?t.push(e):t.push(e.asset),this.__recommendedEpisodes=t},_onBingeMoreInfoClick:function(e){if(e){var t=e.autoPlayStatus,i=e.asset;switch(t){case O.AUTO_PLAY_RECOMMENDED:var n=i.get("id")||i.get("assetId");c.publish("navigate",{path:"Main/Episode",historySkip:!0,state:{selectedEpisodeId:n,catalog:i.get("catalog")}});break;case O.AUTO_PLAY_OFF:F.navigateToSeriesBasePage(!0)}}},_onBingeWatchClick:function(e){if(e&&!this._handledFinish&&!this._executingDirectPlay){this._miniBinge.hide(!0),this.extendedBingeGrid&&(this.extendedBingeGrid.hide(),this._allEpisodesButton.hide()),this.__playerControllerContainer.hide(),this.__footerContainer.hide();var t=e.get("id"),i=e.get("catalog"),n=e.get("type");c.publish(f.DismissSelected),this._executingDirectPlay=!0,I.open(),N.directPlay(t,i,void 0,n).fail(d.bind(function(e){if(this.__recommendedEpisodes=[],e.message)return this.displayErrorDialog(e.message);this.doHistoryBack()},this))}},populateVariables:function(e){var t=this.getView();return this.playPauseButton=t.find("playAndPause"),this.playcta=t.find("playcta"),this.pausecta=t.find("pausecta"),this.stopcta=t.find("stopcta"),this.rewindcta=t.find("rewindcta"),this.forwardcta=t.find("forwardcta"),this.backcta=t.find("backcta"),this.controlInfoText=t.find("playback-controls-text"),this.backInfoText=t.find("playback-back-text"),this.__fullscreenPlayerView=t.find("fullscreenPlayerView"),this.__playerControllerContainer=t.find("playerControllerContainer"),this.__progressBar=t.find("progressBar"),this.__timeLabel=t.find("time"),this.__title=t.find("title"),this.__footer=t.find("footer"),this.__footerContainer=t.find("footer-container"),this.__mediaType=e.mediaType,this.__isLinear=e.isLinear,this.__channelLogo=t.find("channel-logo"),this.__numberOfAudioTracks=1,this._allEpisodesButton=t.find("allEpisodes"),this._miniBinge=t.find("miniBinge"),t},setCtaListeners:function(){this.playcta.addEventListener(o.CLICK,this.__play),this.pausecta.addEventListener(o.CLICK,this.__pause),this.stopcta.addEventListener(o.CLICK,this.__stop),this.rewindcta.addEventListener(o.CLICK,this.__rewind),this.forwardcta.addEventListener(o.CLICK,this.__forward),this.backcta.addEventListener(o.CLICK,this.__back),this.playcta.addEventListener(o.FOCUS,this.__footerButtonFocus),this.pausecta.addEventListener(o.FOCUS,this.__footerButtonFocus),this.stopcta.addEventListener(o.FOCUS,this.__footerButtonFocus),this.rewindcta.addEventListener(o.FOCUS,this.__footerButtonFocus),this.forwardcta.addEventListener(o.FOCUS,this.__footerButtonFocus),this.backcta.addEventListener(o.FOCUS,this.__footerButtonFocus)},removeCtaListeners:function(){this.playcta.removeEventListener(o.CLICK,this.__play),this.pausecta.removeEventListener(o.CLICK,this.__pause),this.stopcta.removeEventListener(o.CLICK,this.__stop),this.rewindcta.removeEventListener(o.CLICK,this.__rewind),this.forwardcta.removeEventListener(o.CLICK,this.__forward),this.backcta.removeEventListener(o.CLICK,this.__back),this.playcta.removeEventListener(o.FOCUS,this.__footerButtonFocus),this.pausecta.removeEventListener(o.FOCUS,this.__footerButtonFocus),this.stopcta.removeEventListener(o.FOCUS,this.__footerButtonFocus),this.rewindcta.removeEventListener(o.FOCUS,this.__footerButtonFocus),this.forwardcta.removeEventListener(o.FOCUS,this.__footerButtonFocus),this.backcta.removeEventListener(o.FOCUS,this.__footerButtonFocus)},play:function(){this.__videoManager.playResume()},pause:function(){this.__videoManager.pause()},stop:function(){this._sTrackingManager.trackCloseMedia(),L.cleanUpSession(),V.dispatchEvent(V.EVT_ONKEY,{id:u.BACK.id})},rewind:function(){var e=this.__currentTime-5;L.reportSeek(e),this.__videoManager.seek(e)},forward:function(){var e=this.__currentTime+5;L.reportSeek(e),this.__videoManager.seek(e)},skip:function(e){if(e&&e.sec){this._seekTimer&&this.clearSeektimer(),W._onSkipping();var t=this.__currentTime+e.sec;this.updateTime(t),this._seekTimer=setTimeout(d.bind(function(){L.reportSeek(1e3*t),this.__videoManager.seek(t),this.clearSeektimer()},this),1e3*(e.delaySec||1))}},clearSeektimer:function(){clearTimeout(this._seekTimer),this._seekTimer=null},back:function(){this._sTrackingManager.trackCloseMedia(),L.cleanUpSession(),V.dispatchEvent(V.EVT_ONKEY,{id:u.BACK.id})},generateButtonPress:function(e){var t=document.createEvent("Event");t.initEvent("keydown",!0,!0),t.target=document,t.currentTarget=document,t.isSimulated=!0,t.keyCode=e,t.keyCodeVal=e,document.dispatchEvent(t)},hideExtendedBinge:function(e){this.extendedBingeGrid&&!this.extendedBingeGrid.isHidden()&&this.__videoIsPlaying&&(this.extendedBingeGrid.hide(!0),e&&l.focus(this.playPauseButton))},__setPlayback:function(e){this.__setControlsInErrorState=d.bind(this._setControlsInErrorState,this),this.__setControlsInPlayStateRef=d.bind(this._setControlsInPlayState,this),this.__setControlsInPauseStateRef=d.bind(this._setControlsInPauseState,this),this.__updatePlayheadStateRef=d.bind(this._updatePlayheadState,this),this.__dismissControlsRef=d.bind(this._dismissControls,this),this.__playStateRef=d.bind(function(e){this.__currentAsset=e&&e.metadata&&e.metadata.asset,this.__mediaType=e&&e.metadata&&e.metadata.mediaType;var t=e&&e.metadata&&e.metadata.mediaType,i=this.__currentAsset&&this.__currentAsset.get("id"),n=this.__currentAsset&&this.__currentAsset.get("duration");void 0===n&&(n=0),this.setUIForState(),this.killHeartbeat(),"movie"===t&&this.startHeartbeat(i),this.__videoIsPlaying=!0,I.close()},this),this.__stopStateRef=d.bind(function(){this._sTrackingManager.trackCloseMedia(),d.delay(.1).then(function(){L.cleanUpSession()}),I.close()},this),this.__pauseStateRef=d.bind(function(){this.setUIForState("paused"),I.close()},this),this.__bufferStateRef=d.bind(function(){this.hideExtendedBinge(!0),this.__videoIsPlaying=!1,I.open(!0)},this),this.__skippingStateRef=d.bind(function(){this.hideExtendedBinge(!0),I.close()},this),this.__audioTracksRef=d.bind(function(e){this.__numberOfAudioTracks=e,m.info("[TVEDemo FullscreenPlayer] Number of audio tracks: "+e),this.__numberOfAudioTracks>1&&this.__videoManager.setDefaultAudioLanguage()},this),this.__audioTracksChangeRef=d.bind(function(e){this._setFooter(e)},this),c.subscribe(g.SetControlsInPlayState,this.__setControlsInPlayStateRef),c.subscribe(g.SetControlsInPauseState,this.__setControlsInPauseStateRef),c.subscribe(g.UpdatePlayheadState,this.__updatePlayheadStateRef),c.subscribe(g.DismissControls,this.__dismissControlsRef),c.subscribe(g.NotifyError,this.__setControlsInErrorState),c.subscribe(b.PlayState,this.__playStateRef),c.subscribe(b.StopState,this.__stopStateRef),c.subscribe(b.PauseState,this.__pauseStateRef),c.subscribe(b.BufferState,this.__bufferStateRef),c.subscribe(b.SkippingState,this.__skippingStateRef),c.subscribe("onAudioTracks",this.__audioTracksRef),c.subscribe("onAudioTrackChange",this.__audioTracksChangeRef),this.setCtaListeners(),this.__playPauseButtonPressedRef=d.bind(this.__playPauseButtonPressed,this),this.playPauseButton.addEventListener(o.CLICK,this.__playPauseButtonPressedRef),this.__videoManager=new p;var t;t="workstation"!==w.platform?[new _({url:e.mediaUrl,metadata:{title:e.asset.get("title"),duration:e.duration/this.milliSecondsToSeconds,seasonNo:e.asset.get("seasonNumber"),episodeNo:e.asset.get("episodeNumber"),asset:e.asset,mediaType:e.mediaType},drmAttributes:e.drmAttributes})]:[new _({url:"https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4",metadata:{title:e.asset.get("title"),duration:e.duration/this.milliSecondsToSeconds,seasonNo:e.asset.get("seasonNumber"),episodeNo:e.asset.get("episodeNumber"),asset:e.asset,mediaType:e.mediaType}})];var i=new h({items:t});this.__videoManager.setVideoLoadedCallback(d.bind(this.closeLoadingCallback,this)),I.open(!0),this.__videoManager.setPlaylist(i),this.__videoManager.playPlaylistItem(t[0],e.startTime)},closeLoadingCallback:function(){I.close()},_setFooter:function(e){if("lg"!==w.platform){this.__footerContainer.setOption("forwardFocus",!1),this.__footerContainer.setOption("focusable",!1),this.playcta.hide(),this.pausecta.hide(),this.stopcta.hide(),this.rewindcta.hide(),this.forwardcta.hide(),this.backcta.hide();var t={colorYellow:e,back:y.getString("Global.Global_buttonBack_button")};this.__isLinear?t.liveControls=y.getString("Player.Player_Control_UI_Text"):t.controls=y.getString("Player.Player_Control_UI_Text"),this.__footer.update(t)}else this.controlInfoText.setText(y.getString("Player.Player_Control_UI_Text")),this.backInfoText.setText(y.getString("Global.Global_buttonBack_button")),this.__isLinear&&(this.playcta.hide(),this.pausecta.hide(),this.rewindcta.hide(),this.forwardcta.hide())},_setControlsInErrorState:function(e){I.close();var t=e&&e.error,n=t&&t.errorCode,s=t&&t.errorMessage,r=y.getString("Player.Player_labelPlaybackFailed");n===this.__videoManager.ERROR_CODES.FIRMWARE_UPDATE_REQUIRED&&(r=y.getString("ui.maintenance.firmware"));try{var a=i.get("environment");s=e.error.errorMessage,n=e.error.errorCode,"test"===a&&(s?r=r+" ("+s+")":n&&(r=r+" ("+n+")"))}catch(e){m.warn("Unable to get error detail: "+e)}d.delay(.1).then(d.bind(function(){L.cleanUpSession()},this)),this.displayErrorDialog(r),this._sTrackingManager.trackCloseMedia()},_setControlsInPlayState:function(e){if(this.__transitionToPlayingStateNotFiringEvent(),e&&e.metadata){var t="";e.metadata.seasonNo&&(t+="S"+e.metadata.seasonNo),e.metadata.episodeNo&&(t.length&&(t+=" "),t+="E"+e.metadata.episodeNo),t.length&&(t+=": "),e.metadata.title&&this.__title.setText(t+e.metadata.title)}},_setControlsInPauseState:function(){this.__transitionToPausedStateNotFiringEvent()},_debounceTimeUpdateEvent:function(e,t,i){t||(t=1e3);var n,s;return function(){var r=i||this,a=new Date,o=arguments;n&&a<n+t?(clearTimeout(s),s=setTimeout(function(){n=a,e.apply(r,o)},t)):(n=a,e.apply(r,o))}},_updatePlayheadState:function(e){this.__currentAsset&&(I.close(),this.updateTime(e.pos),this._sTrackingManager.mediaSetDuration(e.duration),e.duration&&!1===this._analyticsOpenTracked&&(this._sTrackingManager.trackOpenMedia(this.__currentAsset,this.__mediaType,e.duration),this._analyticsOpenTracked=!0),e.duration&&!this.__duration&&(this.__duration=e.duration))},_dismissControls:function(){this._sTrackingManager.trackCloseMedia(),L.cleanUpSession(),this.setUIForStoppedState(),this.updateTime(0)},__playPauseButtonPressed:function(){this.__videoIsPlaying&&!this.__isLinear?this.__transitionToPausedState():this.__transitionToPlayingState()},__transitionToPlayingStoppedEvent:function(e){this._sTrackingManager.trackCloseMedia(),this.handleBackEvent(e)},__transitionToPlayingState:function(){c.publish(f.PlaySelected),this.__transitionToPlayingStateNotFiringEvent()},__transitionToPlayingStateNotFiringEvent:function(){this.__videoIsPlaying=!0},__transitionToPausedState:function(){c.publish(f.PauseSelected),this.__transitionToPausedStateNotFiringEvent()},__transitionToPausedStateNotFiringEvent:function(){this.__videoIsPlaying=!1},__finished:function(e,t){this._handledFinish||this._executingDirectPlay||(this._handledFinish=!0,m.info("perform history back when receiving the stop status"),this._sTrackingManager.trackCloseMedia(),L.cleanUpSession(),v.heartbeat(this.__currentAsset.get("id"),!0),!t&&this.__currentAsset&&"trailer"!==this.__mediaType&&this.__currentAsset.get("type")===P.ASSET_TYPES.EPISODE&&this.__recommendedEpisodes.length>0?c.publish("navigate",{path:"Recommendation",state:{episodes:this.__recommendedEpisodes,currentEpisode:this.__currentAsset,resumeOptions:e||{},bingeWatchingSetting:this._bingeWatchingSetting},historySkip:!0}):this.handleBackEvent())},__setProgressBar:function(e){e>=0&&e<=1&&(this.__progressBar.getRoot().getHTMLElement().style.width=100*e+"%")},isInsideBingeTrigger:function(e,t){if(Y.timeelapsed&&Y.timeelapsed>0){if(Y.timeelapsed>this.__duration-Y.min_duration&&(Y.timeelapsed=this.__duration-Y.min_duration-1),e>Y.timeelapsed)return!0}else if(1===this.__videoManager.getState()&&t<Y.timeleft)return!0;return!1},handleBingeTriggerEnd:function(e){this._miniBinge.getAutoPlayStatus()===O.AUTO_PLAY_READY?this._onBingeWatchClick(this._miniBinge.getAsset()):this.__finished(e)},__setTime:function(e){if(this.__currentTime=e,this.__duration){this.__timeLabel.setText(this.__formatTime(e)+" / "+this.__formatTime(this.__duration));var t=this.__duration-e;if(!0===K)if(this.isInsideBingeTrigger(e,t)){var i=B.getStoredValue(B.KEYS.BINGE_AUTO_PLAY);1===this.__videoManager.getState()&&this._miniBinge.update(e,Y.max_duration,this.__duration)&&"true"===i&&this.handleBingeTriggerEnd({resumeTime:e,shouldResume:t>Y.timeleft})}else this._miniBinge.hide()}},__formatTime:function(e){e=~~e%356400;var t=~~(e/3600),i=~~(e%3600/60),n=e%60;return(t<10?"0":"")+t+":"+(i<10?"0":"")+i+":"+(n<10?"0":"")+n},__showAllEpisodeButton:function(){this._allEpisodesButton.show(),this.__status&&"hidden"===this.__status&&l.focus(this._miniBinge)},_onExtendedBingeClose:function(e){this.extendedBingeGrid&&(this.__showUI(e),this.extendedBingeGrid.reset(),this.extendedBingeGrid.setData(this.__extendedBingeData))},__showUI:function(e){!0===e&&this.play(),this.__status&&"hidden"===this.__status&&(this.__playerControllerContainer.show(),this._allEpisodesButton.show(),this.__footerContainer.show(),this._miniBinge.restore(),this.__status="show",l.focus(this.playPauseButton)),clearTimeout(this.__hideUITimer),this._miniBinge.isHidden()&&(this.__hideUITimer=setTimeout(d.bind(function(){this.__hideUI()},this),5e3))},__hideUI:function(e,t){this.__status&&"show"!==this.__status||x.isMouseOn()&&!t||!this._miniBinge.isHidden()||(this._allEpisodesButton.hide(),e||S.isAnyDialogOpen()||l.focus(this.__fullscreenPlayerView),this.__footerContainer.hide(),this.__playerControllerContainer.hide(),this.__status="hidden")},__mouseOn:function(){this._executingDirectPlay||this.extendedBingeGrid&&!this.extendedBingeGrid.isHidden()||this.__showUI()},__mouseOff:function(){clearTimeout(this.__hideUITimer),this._executingDirectPlay||this.extendedBingeGrid&&!this.extendedBingeGrid.isHidden()||(this.__hideUITimer=setTimeout(d.bind(function(){this.__hideUI()},this),5e3))},_updateBookmarkInEpisodeList:function(e,t,i){for(var n,s,r=e.length,a=0;a<r;a++)if(n=e[a],n.episodeListData&&n.episodeListData.episodes.length>0){var s=d.find(n.episodeListData.episodes,function(e){return e.get("id")===i});if(s)return s.set("bookmark",t),!0}return!1},updateTime:function(e){if(this.__setTime(e),this.__setProgressBar(this.__duration?e/this.__duration:0),this.__currentAsset&&this.__duration>0&&this.extendedBingeGrid){var t={bookmark:e,duration:this.__duration,percentage:e/this.__duration*100,watchedState:"P"},i=this.__currentAsset.get("id");this.__currentAsset.set("bookmark",t),this._updateBookmarkInEpisodeList(this.__extendedBingeData,t,i),this.extendedBingeGrid.updateProgressBar(t,i)}this.__duration&&e&&(v.setHeartbeatPlayedTime(e),v.setHeartbeatDuration(this.__duration)),this.hideExtendedBinge(!1)},setUIForState:function(e){this.playPauseButton.removeClass("paused"),this.playPauseButton.removeClass("ff"),this.playPauseButton.removeClass("rw"),e&&this.playPauseButton.addClass(e),this.__showUI()},setUIForStoppedState:function(e,t){"true"!==B.getStoredValue(B.KEYS.BINGE_AUTO_PLAY)||e||this._miniBinge.isHidden()||this._miniBinge.getAutoPlayStatus()!==O.AUTO_PLAY_READY?this.__finished(null,t):this._onBingeWatchClick(this._miniBinge.getAsset())},displayErrorDialog:function(e){return!this._errorDialogIsOpen&&(m.info("[FullscreenPlayer] - displayErrorDialog"),this._errorDialogIsOpen=!0,S.error({reason:e,closeAction:d.bind(function(){this._errorDialogIsOpen=!1,m.info("[FullscreenPlayer] - error dialog closed"),this.__transitionToPlayingStoppedEvent(!0)},this),buttonText:y.getString("Global.Global_buttonBack_button")}),!0)},startHeartbeat:function(e){v.heartbeat(e).then(d.bind(function(e){if(e.stopVideo)switch(this.killHeartbeat(),this.__transitionToPausedState(),e.reason){case C.SILK_CODE.PLAY_SESSION_TOKEN_LIFESPAN_REACHED:E.getSilkMessageForCode(C.SILK_CODE.PLAY_SESSION_TOKEN_LIFESPAN_REACHED).then(d.bind(function(e){this.displayErrorDialog(e.get("description"))},this));break;default:this.displayErrorDialog(y.getString("Player.Player_labelPlaybackFailed"))}},this))},killHeartbeat:function(){v.killHeartbeat()},isFooterFocused:function(){return!(!this.__footerContainer||!l.isCompChildFocused(this.__footerContainer)&&!l.isCompFocused(this.__footerContainer))},isComponentFocused:function(e){if(e&&(l.isCompChildFocused(e)||l.isCompFocused(e)))return!0},doHistoryBack:function(){D.back()},handleBackEvent:function(e){var t=this.__mediaType,i=this.__currentAsset&&this.__currentAsset.get("id");t&&"movie"===t&&i&&!e?v.heartbeat(i,!0).then(d.bind(function(){this.doHistoryBack()},this)):this.doHistoryBack()},onKey:function(e){if(this.handleKeyClickForBingeWatch(e))return!(e.id===u.BACK.id&&!this.isComponentFocused(this._allEpisodesButton));if(this.handleKeyClickForMiniBinge(e))return!0;var t=this.__videoManager.getState();switch(e.id!==u.BACK.id&&this.__showUI(),e.id){case u.YELLOW.id:case"playstation:vkey:triangle":this.__numberOfAudioTracks>1&&!this.__isLinear&&this.__videoManager.toggleAudio();break;case u.PLAY_PAUSE.id:this.__playPauseButtonPressed(),this._onExtendedBingeClose(this.__videoIsPlaying);break;case u.PLAY.id:this.__videoIsPlaying||this.__transitionToPlayingState(),this._onExtendedBingeClose(this.__videoIsPlaying);break;case u.PAUSE.id:!this.__isLinear&&this.__videoIsPlaying&&this.__transitionToPausedState(),this._onExtendedBingeClose(this.__videoIsPlaying);break;case u.STOP.id:case"device:kb-vkey:s":case u.BACK.id:return c.publish(f.DismissSelected),this.handleBackEvent(),!1;case u.RW.id:case u.LEFT.id:if(e.id===u.LEFT.id&&this.isFooterFocused())return!0;if(!this.__isLinear&&5!==t&&6!==t){var i="playstation"===w.platform?.5:1,n=this.__currentTime<10?this.__currentTime:10;this.setUIForState("rw"),this.skip({sec:-n,delaySec:i,progressive:!0})}return!0;case u.PREV.id:return this.setUIForState("rw"),this.skip({sec:-60,delaySec:1,progressive:!0}),!0;case u.FF.id:case u.RIGHT.id:if(e.id===u.RIGHT.id&&this.isFooterFocused())return!0;if(!this.__isLinear&&5!==t&&6!==t){var i="playstation"===w.platform?.5:1,s=this.__duration-this.__currentTime,n=s<10?s:10;this.setUIForState("ff"),this.skip({sec:n,delaySec:i,progressive:!0})}return!0;case u.NEXT.id:return this.setUIForState("ff"),this.skip({sec:60,delaySec:1,progressive:!0}),!0;default:return!0}return!1},handleKeyClickForBingeWatch:function(e){if(this.isComponentFocused(this._allEpisodesButton)||this.isComponentFocused(this.extendedBingeGrid))switch(e.id){case u.BACK.id:case u.LEFT.id:case u.RIGHT.id:case u.UP.id:case u.DOWN.id:case u.OK.id:return e.id===u.BACK.id&&(this.extendedBingeGrid&&this.extendedBingeGrid.hide(),this.__showUI()),!0;case"playstation:vkey:triangle":case u.YELLOW.id:case u.PLAY.id:case u.PAUSE.id:case u.STOP.id:case u.RW.id:case u.PREV.id:case u.FF.id:case u.NEXT.id:return this.extendedBingeGrid&&this.extendedBingeGrid.hide(),this.__showUI(),!1}},handleKeyClickForMiniBinge:function(e){if(this.isComponentFocused(this._miniBinge))switch(e.id){case u.LEFT.id:case u.RIGHT.id:case u.UP.id:case u.DOWN.id:case u.OK.id:return this.__showUI(),!0;case u.BACK.id:return this._miniBinge.hide(!0),!1;default:return!1}},_onNetworkStatusChange:function(e){e?this.play():this.pause()},reset:function(){w.system.removeEventListener(U.EVT_NETWORK_STATUS_CHANGED,this.__boundOnNetworkStatusChange),I.close(),this.setUIForState(),this.killHeartbeat(),c.publish(f.DismissSelected),c.unsubscribe(g.SetControlsInPlayState,this.__setControlsInPlayStateRef),c.unsubscribe(g.SetControlsInPauseState,this.__setControlsInPauseStateRef),c.unsubscribe(g.UpdatePlayheadState,this.__updatePlayheadStateRef),c.unsubscribe(g.DismissControls,this.__dismissControlsRef),c.unsubscribe(g.NotifyError,this.__setControlsInErrorState),c.unsubscribe(b.PlayState,this.__playStateRef),c.unsubscribe(b.StopState,this.__stopStateRef),c.unsubscribe(b.PauseState,this.__pauseStateRef),c.unsubscribe(b.BufferState,this.__bufferStateRef),c.unsubscribe(b.SkippingState,this.__skippingStateRef),c.unsubscribe("onAudioTracks",this.__audioTracksRef),c.unsubscribe("onAudioTrackChange",this.__audioTracksChangeRef),c.unsubscribe("mouseOn",this.__mouseOnRef),c.unsubscribe("mouseOff",this.__mouseOffRef),this.__videoManager&&this.__videoManager.deinit(),c.unsubscribe(T.UserDataUpdated,this.__handleUserDataUpdated),c.unsubscribe(T.UserHasBeenLoggedOut,this.__userHasBeenLoggedOutHandler),clearTimeout(this.__hideUITimer),H.getView().removeClass("fullscreen-video-mode"),this.getView().removeEventListener(o.KEY,this.__onKeyRef),this.removeCtaListeners(),this._sTrackingManager.trackCloseMedia(),L.cleanUpSession()}})}),define("tvedemo/wgt/HighlightsMenu",["xdk-base/class","xdk-base/core","xdk-ui-basic/Layout","xdk-ax/evt/type","xdk-ui-basic/Button","xdk-base/util"],function(e,t,i,n,s,r){return e.create(i,{},{_items:[],_selectedIndex:-1,init:function(e){e.alignment=i.HORIZONTAL,e.forwardFocus=!0,this._super(e),e.items&&this.setItems(e.items),this.addEventListener(n.CLICK,this._onClick,!1)},setItems:function(e){this._items=e,this._initUI()},_initUI:function(){this.detachAll();for(var e=0,t=this._items.length;e<t;e++)this.createButton(this._items[e])},createButton:function(e){var t;t=e.css?" "+e.css:"",new s({css:"wgt-highlightsMenu-item"+t,text:e.text?e.text:e,parent:this})},addButton:function(e){this._items.push(e),this.createButton(e)},removeContinueWatchButton:function(){for(var e=this.getChildren(),t=0,i=this._items.length;t<i;t++)this._items[t].isContinueWatch&&(this._items.splice(t,1),e[t].deinit())},getSelection:function(){return this._items[this._selectedIndex]},getSelectedIndex:function(){return this._selectedIndex},select:function(e){if(e<0||e>=this._items.length)throw t.createException("Invalid param","Array index out of bound");this._select(e)},_select:function(e){var t=this.getChildren();this._selectedIndex>=0&&t[this._selectedIndex]&&t[this._selectedIndex].removeClass("selected"),this._selectedIndex=e,t[this._selectedIndex].addClass("selected"),this._lastFocusChild=t[this._selectedIndex]},_onClick:function(e){var t=r.indexOf(this.getChildren(),e.target);this._select(t)}})}),define("tvedemo/wgt/ContinueWatchBanner",["xdk-base/class","xdk-ax/Container","xdk-base/Element","xdk-base/util","xdk-ax/evt/type","xdk-ui-basic/Label","tvedemo/mgr/sAssetManager","storm/mgr/sLanguageManager"],function(e,t,i,n,s,r,a,o){"use strict";return e.create(t,{},{__seasonTitle:null,__partnerAge:null,init:function(e){e.focusable=!0,e.clickable=!0,e.css=e.css||"continue-watch-banner",e.root=e.root||new i("div"),this._super(e),this._titleLabel=new r({css:"continue-watch-banner-title",parent:this}),this._playButton=new t({css:"continue-watch-banner-play",parent:this})},setData:function(e){if(e){this._data=e;var t=e.get("assetType");if("Episode"===t){var i=e.get("serieCommTitle"),n=e.get("seasonNumber"),s=e.get("episodeNumber"),r=e.get("fsk"),a=e.get("category");this._titleLabel.setText(o.getString("Binge.Binge_ContinueWatchingAlert_top_label",{series_title:i,season_number:n,episode_number:s,fsk:r,partner_channel:a}))}if("Film"===t){var l=e.get("title"),r=e.get("fsk"),a=e.get("category");this._titleLabel.setText(o.getString("Binge.Binge_ContinueWatchingAlert_top_label_movie",{title:l,fsk:r,partner_channel:a}))}}},getData:function(){return this._data}})}),define("tvedemo/tmpl/home",["xdk-ui-basic/Layout","xdk-ui-basic/Label","tvedemo/wgt/BasicGrid","tvedemo/ext/ui/grid/LoopedGrid","tvedemo/wgt/AssetGrid","tvedemo/wgt/HighlightsMenu","tvedemo/wgt/ContinueWatchBanner","xdk-ax/Container","storm/mgr/sLanguageManager"],function(e,t,i,n,s,r,a,o,l){"use strict";return function(){return{klass:e,id:"#homeView",width:1,alignment:e.HORIZONTAL,css:"subcontrollerPage",children:[{klass:a,id:"continueWatch"},{klass:t,id:"homePanelLabel",css:"home-panel-label",text:l.getString("Startscreen.Startscreen_NowOnSky").toUpperCase()},{klass:n,alignment:n.VERTICAL,scrollFrontBoundary:1,scrollEndBoundary:3,id:"homePanelGrid",css:"home-panel-grid",rows:5,cols:1},{klass:o,id:"#homeOverlay",css:"overlay"},{klass:e,alignment:e.HORIZONTAL,css:"highlightsBar",id:"highlightsBar",children:[{klass:t,id:"homePanelHighlightsLabel",css:"home-panel-label",text:l.getString("Landingpages.Landingpages_Highlights_Title").toUpperCase()},{klass:o,css:"highlightsMenu",children:[{klass:r,id:"highlightsMenu"}]}]},{klass:o,id:"#highlightsContainer",css:"highlightsContainer"}]}}}),define("tvedemo/wgt/HomeGridButton",["xdk-base/class","xdk-base/core","xdk-ax/Container","storm/wgt/Image","xdk-ui-basic/Label","storm/mgr/sAppConfigManager","xdk-base/util","tve/mgr/sLinearManager"],function(e,t,i,n,s,r,a,o){"use strict";return e.create(i,{},{init:function(e){e=e||{},e.focusable=!0,e.clickable=!0,this._super(e),this.addClass("wgt-homegridbtn"),this._imageContainer=new i({css:"wgt-homegridbtn-imgDiv",parent:this}),this._image=new n({css:"wgt-homegridbtn-bg",parent:this._imageContainer,placeHolderPromise:r.getPlaceholderLandscape}),e.image?o.constructCMSUrlPromise(e.image).then(a.bind(function(e){this._image.setSrc(e)},this)):this._image.fallback(),this._imageTime=new i({css:"wgt-homegridbtn-tint",parent:this._imageContainer}),this._channelImage=new n({css:"wgt-homegridbtn-channel",parent:this._imageContainer}),e.channelImage?o.constructCMSUrlPromise(e.channelImage).then(a.bind(function(e){this._channelImage.setSrc(e)},this)):this._channelImage.fallback(),e.category&&e.category.length&&(this._categoryLabel=new s({css:"wgt-homegridbtn-category",text:e.category,parent:this._imageContainer})),this._textContainer=new i({css:"wgt-homegridbtn-text-block",parent:this}),this._label=new s({css:"wgt-homegridbtn-title",text:e.title||"",parent:this._textContainer}),this._periodLabel=new s({css:"wgt-homegridbtn-period",text:e.period,parent:this._textContainer}),this._fskLabel=new s({css:"wgt-homegridbtn-fsk",text:e.fsk,parent:this._textContainer}),e.metadata&&e.metadata.length&&(this._metaDataLabel=new s({css:"wgt-homegridbtn-meta",text:e.metadata,parent:this._textContainer}))}})}),define("tvedemo/wgt/HighlightsButton",["xdk-base/class","xdk-base/core","xdk-base/util","xdk-ax/Container","storm/wgt/Image","xdk-ui-basic/Label","tve/mgr/sLinearManager","tvedemo/mgr/sAssetManager","xdk-base/Element","storm/mgr/sAppConfigManager","storm/helper/util"],function(e,t,i,n,s,r,a,o,l,c,d){"use strict";return e.create(n,{},{trimSportTitle:function(e){var t=e.split(": ");return t.length>1&&(t[0]=null),t.join("")},init:function(e){e=e||{},e.focusable=!0,e.clickable=!0,e.root=new l("div"),this._super(e),this.addClass("wgt-assetbtn"),this._imageContainer=new n({parent:this});var t,o,u,h,_,g="";if("Film"===e.type)_=!1,o=e.title,u=e.category.main.content,h=e.parental_rating.display;else if("Episode"===e.type)_=!0,o=e.serie_title,u=e.category.main.content,h=e.parental_rating.display;else if("Series"===e.type)_=!0,o=e.title,u=e.category.main.content,h=e.parental_rating.display;else if("Season"===e.type)_=!0,o=e.title,u=e.category.main.content,h=e.parental_rating.display;else if("Sport"===e.type){var f=d.parseAirDate(e.on_air.start_date),p=d.parseAirDate(e.on_air.end_date);f==p?p="":p+=" ",_=!0,o=this.trimSportTitle(e.title),u=e.category.main.content,h=e.parental_rating.display,g=f+"&nbsp; "+e.on_air.start_time+" - "+p+e.on_air.end_time}else"sportsNews"===e.type?(t=e.image,o=e.title,u=e.category,h=""):"redirect"===e.type&&(t="img/tiles/tile_"+e.page_type.toLowerCase()+".png",o="");i.isUndefined(e._isLandscape)&&(e._isLandscape=_),!0===e._isLandscape&&"redirect"!==e.type&&(e&&e.main_picture&&e.main_picture.picture&&e.main_picture.picture.length?(t=e.main_picture.picture[0].path+"/"+e.main_picture.picture[0].file,i.each(e.main_picture.picture,function(e){if(e.path&&e.file)return"gallery"===e.type?(t=e.path+"/"+e.file,i.breaker):void 0})):(t=null,console.warn("Could not find a 16:9 image to display"))),!1===e._isLandscape&&e.dvd_cover&&e.dvd_cover.path&&e.dvd_cover.file&&(t=e.dvd_cover.path+"/"+e.dvd_cover.file),this._image=new s({css:"wgt-assetbtn-thumbnail",parent:this._imageContainer,placeHolderPromise:e._isLandscape?c.getPlaceholderLandscape:c.getPlaceholderPortrait}),t&&"redirect"!==e.type?a.constructCMSUrlPromise(t).then(i.bind(function(e){this._image.setSrc(e)},this)):t&&"redirect"===e.type?this._image.setSrc(t):this._image.fallback(),this._textContainer=new n({css:"wgt-assetbtn-container",parent:this}),this._label=new r({css:"wgt-assetbtn-title",text:o.toUpperCase()||"",parent:this._textContainer});var m=e.package_code;m||(m=e.package_color_code),this._categoryLabel=new r({text:u,css:"wgt-assetbtn-category",parent:this._textContainer}),this._extraInfoLabel=new r({text:g,css:"wgt-assetbtn-extrainfo",parent:this._textContainer}),this._ratingLabel=new r({text:h,css:"wgt-assetbtn-rating",parent:this._textContainer})}})}),define("tvedemo/model/Context",["xdk-base/class","tve/model/ImmutableModel"],function(e,t){"use strict";return e.create(t,{defaults:{data:null,diagnosticData:null}},{})}),define("tvedemo/model/ContextBuilder",["xdk-base/class","tvedemo/model/Context"],function(e,t){return e.create({},{_attrs:{},setData:function(e){return this._attrs.data=e,this},setDiagnosticData:function(e){return this._attrs.diagnosticData=e,this},build:function(){return new t(this._attrs)}})}),define("tvedemo/wgt/ContinueWatchButton",["xdk-base/class","xdk-base/util","xdk-ax/Container","storm/wgt/Image","xdk-ui-basic/Label","xdk-base/Element","lib/moment","tvedemo/wgt/Progressbar"],function(e,t,i,n,s,r,a,o){"use strict";return e.create(i,{},{init:function(e){var t=[];e=e||{},e.focusable=!0,e.clickable=!0,e.root=new r("div"),this._super(e),this.addClass("wgt-continue-watchbtn"),this._imageContainer=new i({css:"wgt-continue-watchbtn-container",parent:this}),this._image=new n({css:"wgt-continue-watchbtn-thumbnail",parent:this._imageContainer,src:e.imageUrl}),this._play=new i({css:"wgt-continue-watchbtn-playicon",parent:this._imageContainer}),this._progress=new o({css:"wgt-continue-watch-progressbar",progress:e.percentage,parent:this._imageContainer}),this._textContainer=new i({css:"wgt-continue-watchbtn-container",parent:this}),this._label=new s({css:"wgt-continue-watchbtn-title",text:e.title||"",parent:this._textContainer}),t.push(e.category),t.push(e.fsk),t.push((a.duration(e.duration).asMinutes()>>0)+" min."),this._categoryLabel=new s({text:t.join(" | "),css:"wgt-continue-watchbtn-category",parent:this._textContainer})}})}),
define("tvedemo/ctrl/Home",["xdk-base/ax","tvedemo/helper/sMoment","tvedemo/ctrl/RoutableController","xdk-ax/mvc/view","xdk-ax/data/LocalDatasource","tvedemo/tmpl/home","storm/mgr/sAppConfigManager","tve/mgr/sVODManager","xdk-base/util","xdk-ax/evt/type","xdk-ax/mediator","xdk-ax/mvc/AppRoot","xdk-ax/focusManager","xdk-base/device","xdk-base/device/vKey","xdk-base/promise","tvedemo/ext/ui/grid/LoopedGrid","tvedemo/helper/dialogHelper","tvedemo/wgt/ConfirmDialog","tvedemo/wgt/HomeGridButton","xdk-base/console","tve/sServiceHolder","tve/mgr/sLinearManager","tvedemo/wgt/HighlightsButton","tvedemo/model/ContextBuilder","tvedemo/mgr/sNavigationManager","storm/helper/util","storm/helper/silkResponseHelper","storm/event/LifecycleEvent","storm/mgr/sLanguageManager","tvedemo/mgr/deepLinkingManager","tvedemo/mgr/sAssetManager","tvedemo/helper/sPlaybackHelper","tvedemo/wgt/ContinueWatchButton","xdk-ui-grid/BoundedGrid","tvedemo/wgt/Loading","tvedemo/mgr/sEndUserManager"],function(e,t,i,n,s,r,a,o,l,c,d,u,h,_,g,f,p,m,v,b,S,y,E,k,C,T,x,I,w,L,A,D,P,R,O,N,M){"use strict";var B=(u.singleton(),{MOVIE:"Film",EPISODE:"Episode",SERIES:"Series",SEASON:"Season",SPORT_EVENT:"Sport",SPORT_NEWS:"sportsNews",REDIRECT:"redirect"}),F=["Serien","Filme","Dokus","Kids","Sport"],U=["SeriesSection","FilmSection","DocuSection","KidsSection","SportSection"],G=["Serien","Filme","Sport","Dokus","Kids","Sky Box Sets"],H=!1;return e.klass.create(i,{},{init:function(){this.setView(n.render(r))},orderHighlights:function(e){return e.sort(function(e,t){return G.indexOf(e.title)-G.indexOf(t.title)})},setup:function(e){var t=this.getView(),i=f.defer();if(this._continueWatchList=[],this.trackLevel(1,"Home"),this.homePanelGrid=t.find("homePanelGrid"),this.subContainer=t.find("highlightsContainer"),this.subBar=t.find("highlightsBar"),this.submenu=t.find("highlightsMenu"),this.overlay=t.find("homeOverlay"),this.continueWatchBanner=t.find("continueWatch"),this.continueWatchBanner.hide(),this.__boundContinueWatch=l.bind(this.continueWatchBannerClick,this),this.continueWatchBanner.addEventListener(c.CLICK,this.__boundContinueWatch),this.__boundHighlightsGridClickHandler=l.bind(this._highlightsGridClickHandler,this),this.subContainer.addEventListener(c.CLICK,this.__boundHighlightsGridClickHandler),this.__boundKeyHandler=l.bind(this.keyHandler,this),this.__boundSubMenuBlur=l.bind(this.subMenuBlur,this),this.__boundSubMenuFocus=l.bind(this.subMenuFocus,this),this.__boundSubMenuClick=l.bind(this.subMenuClick,this),t.addEventListener(c.KEY,this.__boundKeyHandler),this.submenu.addEventListener(c.BLUR,this.__boundSubMenuBlur),this.submenu.addEventListener(c.FOCUS,this.__boundSubMenuFocus),this.submenu.addEventListener(c.CLICK,this.__boundSubMenuClick),this.__boundHomePanelGridClickHandler=l.bind(this.homePanelGridClickHandler,this),this.homePanelGrid.addEventListener(c.CLICK,this.__boundHomePanelGridClickHandler),H?i.resolve():M.sessionCheck().then(l.bind(function(e){"OK"!==e.resultMessage?M.autoLogin(!1).then(function(){S.log("[sEndUserManager] Auto login Successful"),i.resolve()}).fail(l.bind(function(e){S.log("[sEndUserManager] Auto login Failed"),f.isPromise(e)?e.then(l.bind(function(e){e.get("code")===I.SILK_CODE.ALREADY_LOGGED_IN?m.confirm({title:e.get("title"),dialogCss:"session-dialog",message:L.getString("Login.Login_AlreadyLoggedInOnOtherDevice_message"),positiveText:L.getString("Errormessages.Errormessages_labelPressButtonToKillSessions"),negativeText:L.getString("Login.Login_labelClose"),positiveAction:l.bind(function(){M.autoLogin(!0).complete(function(){i.resolve()})},this),negativeAction:l.bind(function(){i.resolve()},this)}):i.resolve()},this)):i.resolve()},this)):i.resolve()},this)).fail(function(){i.resolve()}),T.triggerResetMenu(!0),e.historyBack)return this.subBar&&this.subBar.getRoot()&&this.subBar.getRoot().hasClass("focused")&&this.showOverlay(),void i.promise.complete(l.bind(function(){N.open(),this._fetchContinueWatchData().complete(l.bind(function(){N.close();var e,t=this.submenu.getSelection().isContinueWatch,i=this.submenu.getSelectedIndex(),n=h.isCompFocused(this.highlightsGrid)||h.isCompChildFocused(this.highlightsGrid),s=h.isCompFocused(this.continueWatchBanner)||!n&&!h.isCompChildFocused(this.homePanelGrid);0===this._continueWatchList.length&&(t&&(this.submenu.select(0),this.updateHighlightsGrid(0,n)),h.isCompFocused(this.continueWatchBanner)&&(e=this.subBar)),this.setupContinueWatchBanner(this._continueWatchList,s),t&&(this.submenu.select(i),this.updateHighlightsGrid(i,n)),e?h.focus(e):h.isCompChildFocused(this.getView())||h.focus(this.homePanelGrid)||h.focus(this.subBar)},this))},this));this._curIndexGrid=0,this._highlightsCatalog=void 0;var n=y.getLinearContentService().getHomePageHighlights().then(l.bind(function(e){var t=[];e=this.orderHighlights(e);for(var i=0;i<e.length;i++)e[i].title.match(/Sky Box Sets/gi)||t.push({text:e[i].title});this.submenu.setItems(t)},this),function(e){S.warn("Unable to get home page highlights due to "+e)});if(this.homePanelGrid.setDisplayStgy(function(e){var t=e&&e.channel&&"Sky Sport News HD"===e.channel.name;return new b({id:e.event.id,title:e.event.title,metadata:t?"":e.event.subtitle,period:e.event.startTime+"-"+e.event.endTime,image:e.event.image,channelImage:e.channel.logo,channelColour:e.channel.mobilepc,fsk:e.event.fskInfo})}),"playstation"===_.platform&&"PS4"===_.id.getModel()){var s=amd.require("xdk-ext-device-playstation/webmaf");s&&s.addNativeEventListener("externalParameter",function(e){e&&A.handleDeepLinking(e)})}this._handleDeeplinkRef=l.bind(function(){A.navigate(e.deepLinkData.contentType,e.deepLinkData.assetId),d.unsubscribe("navigated",this._handleDeeplinkRef)},this),e&&e.deepLinkData&&e.deepLinkData.contentType&&e.deepLinkData.assetId&&d.subscribe("navigated",this._handleDeeplinkRef),i.promise.complete(l.bind(function(){N.open();var t=this._fetchContinueWatchData().then(l.bind(function(e){return this.setupContinueWatchBanner(e),e},this));e.setupPending=x.allPromises([this.setupHomePanelGrid(e),n,t]).then(l.bind(function(){N.close();var e=!0,t="header";this._curIndexGrid=0,this.submenu.select(this._curIndexGrid),this.updateHighlightsGrid(this._curIndexGrid),this.homePanelGrid._data||(e=!1),h.isCompFocusable(this.continueWatchBanner)?(h.focus(this.continueWatchBanner),t=this.continueWatchBanner):h.focus(this.homePanelGrid)||h.focus(this.subBar),e||(this.homePanelGrid.setOption("focusable",!1),this.subBar.setOption("nextUp",t)),H||(H=!0,d.publish(w.HomePageInitialised))},this))},this))},setupHomePanelGrid:function(){return f.all([E.getCurrentlyRunningEvents(),y.getLinearContentService().getAllChannelIds()]).spread(l.bind(function(e,t){e=e.sort(function(e,i){return t.indexOf(e.channel.id)>t.indexOf(i.channel.id)});var i=new s,n=function(){var t=f.defer();return t.resolve({total:e.length,data:e}),t.promise};return i.setDataLoader(n),this.homePanelGrid.setDatasource(i).then(l.bind(function(){this.homePanelGrid.select(0,1)},this))},this))},homePanelGridClickHandler:function(){var e=this.homePanelGrid.getSelectedData(),t=new C,i=t.setData({channelId:e.channel.id,eventId:e.event.id,epgExcerptEvent:e.event}).build();D.getAssetById(e.event.assetid,this._highlightsCatalog).then(l.bind(function(e){this.__navigate(e.get("id"),e.get("type"))},this)).fail(function(){d.publish("navigate",{path:"Main/EpgEvent",state:{context:i}})})},makeHighlightsGrid:function(e,t){var i,n,s;return t=t||k,"16:9"===e?(i="movie-grid wide",n=5,s=2):(i="movie-grid",n=7,s=3),this.highlightsGrid&&this.highlightsGrid.detach(),t===R?(this.highlightsGrid=new O({css:"continue-watch-grid",id:"moviesAssetGrid",rows:4,cols:1,alignment:O.VERTICAL,parent:this.subContainer}),this.subContainer.addClass("continue-watch"),s=0):(this.highlightsGrid=new p({css:i,id:"moviesAssetGrid",rows:n,cols:1,alignment:p.VERTICAL,scrollFrontBoundary:s,scrollEndBoundary:s,parent:this.subContainer}),this.subContainer.removeClass("continue-watch")),this.highlightsGrid.setDisplayStgy(function(i){return i._isLandscape="16:9"===e,new t(i)}),s},__navigate:function(e,t){t===B.MOVIE?d.publish("navigate",{path:"Main/Movie",state:{assetId:e,catalog:this._highlightsCatalog}}):t===B.EPISODE?d.publish("navigate",{path:"Main/Episode",state:{selectedEpisodeId:e,catalog:this._highlightsCatalog}}):t===B.SERIES?d.publish("navigate",{path:"Main/TVShow",state:{serieId:e,catalog:this._highlightsCatalog}}):t===B.SEASON?d.publish("navigate",{path:"Main/TVShow",state:{seasonId:e,catalog:this._highlightsCatalog}}):t===B.SPORT_EVENT?d.publish("navigate",{path:"Main/Sport",state:{assetId:e,catalog:this._highlightsCatalog}}):t===B.SPORT_NEWS?d.publish("navigate",{path:"Main/News",state:{selectedNewsId:e,selectedNewsCategory:category}}):t===B.REDIRECT?T.navigateToSeriesBasePage(!1,e):S.warn("Clicked on unexpected type "+asset.type)},_highlightsGridClickHandler:function(){this.hideOverlay();var e=this.highlightsGrid.getSelectedData(),t=e.type||e.assetType,i=e.id||e.assetId;e.category_id||e.category;return l.isUndefined(e.assetType)||l.isUndefined(e.bookmark)||l.isUndefined(e.catalog)?(this.__navigate(i,t),!1):P.directPlay(i,e.catalog,e.bookmark,t).fail(l.bind(function(e){N.close(),this.showOverlay(),e&&e.message&&m.error({reason:e.message})},this))},extendHighlighAssets:function(e,t){var i=F.indexOf(t);return i>-1?[{type:"redirect",page_type:t,id:U[i],title:""}].concat(e):e},_updateContinueWatchHighlightsGrid:function(e){var t;return f.resolve().then(l.bind(function(i){t=new s,t.setDataLoader(l.bind(function(){for(var e=[],t=0,n=i.length;t<n;t++)e.push(i[t]._attrs);return f.resolve({data:e,total:e.length})},this));var n=this.makeHighlightsGrid("16:9",R);return this.highlightsGrid.setDatasource(t).then(l.bind(function(){return this.highlightsGrid.select(0,n).then(l.bind(function(){e&&h.focus(this.highlightsGrid)},this))},this))},this,this._continueWatchList))},updateHighlightsGrid:function(e,t){if(this._curIndexGrid=e,this.submenu.getSelection().isContinueWatch)return this._updateContinueWatchHighlightsGrid(t);var i;return y.getLinearContentService().getHomePageHighlights().then(l.bind(function(n){if(i=new s,n=this.orderHighlights(n),i.setDataLoader(l.bind(function(){return E.getAssetListing(n[e].url).then(l.bind(function(t){var i,s=t.listing;return this._highlightsCatalog=t.catalog,s.length>20&&(s=s.slice(0,20)),i=this.extendHighlighAssets(s,n[e].title),{data:i,total:i.length}},this))},this)),!i)return S.warn("No available datasource"),!1;var r=this.makeHighlightsGrid(n[e].displayType),a="16:9"===n[e].displayType?1:3;return this.highlightsGrid.setDatasource(i).then(l.bind(function(){return this.highlightsGrid.select(a,r).then(l.bind(function(){t&&h.focus(this.highlightsGrid)},this))},this))},this))},hideHighlights:function(){this.subBar.removeClass("focused"),this.subContainer.removeClass("focused"),this.hideOverlay()},subMenuBlur:function(e){S.log(e.relatedTarget),e.relatedTarget.isDescendantOf(this.subContainer)||this.hideHighlights()},subMenuFocus:function(){this.subBar.addClass("focused"),this.subContainer.addClass("focused"),this.showOverlay()},subMenuClick:function(){this._curIndexGrid!==this.submenu.getSelectedIndex()&&this.updateHighlightsGrid(this.submenu.getSelectedIndex())},setupContinueWatchBanner:function(e,t){if(!l.isUndefined(e[0])){var i,n=e[0].get("time"),s=Date.now();n=n.split(" "),n=x.parseSkyDateTimeToDate(n[0],n[1]),i=(s-n)/36e5,i<=12&&(this.continueWatchBanner.setData(e[0]),this.continueWatchBanner.show(),t&&h.isCompFocusable(this.continueWatchBanner)&&h.focus(this.continueWatchBanner))}},setupContinueWatchHighLightsButton:function(e){this.submenu.removeContinueWatchButton(),e&&e.length>0&&this.submenu.addButton({text:"Fortsetzen (HC)",css:"continue-watch-highlight",isContinueWatch:!0})},_fetchContinueWatchData:function(){return D.getContinueWatch().then(l.bind(function(e){return this._continueWatchList=e,e},this))},continueWatchBannerClick:function(){var e=this.continueWatchBanner.getData(),t=e&&e.get("bookmark"),i=e&&e.get("assetId"),n=e&&e.get("catalog"),s=e&&(e.get("type")||e.get("assetType"));P.directPlay(i,n,t,s)},showOverlay:function(){this.overlay.addClass("visible")},hideOverlay:function(){this.overlay.removeClass("visible")},keyHandler:function(e){switch(e.id){case g.UP.id:if(h.getCurFocus().getParent()!==this.submenu)return!0;h.focus(this.submenu.getChildren()[this.submenu.getSelectedIndex()]);break;default:return!0}return!1},reset:function(){this.subBar&&this.subBar.getRoot()&&this.subBar.getRoot().hasClass("focused")&&this.hideOverlay(),this.getView().removeEventListener(c.KEY,this.__boundKeyHandler),this.submenu.removeEventListener(c.BLUR,this.__boundSubMenuBlur),this.submenu.removeEventListener(c.FOCUS,this.__boundSubMenuFocus),this.submenu.removeEventListener(c.CLICK,this.__boundSubMenuClick),this.continueWatchBanner.removeEventListener(c.CLICK,this.__boundContinueWatch),this.homePanelGrid.removeEventListener(c.CLICK,this.__boundHomePanelGridClickHandler),this.subContainer.removeEventListener(c.CLICK,this.__boundHighlightsGridClickHandler),d.unsubscribe("navigated",this._handleDeeplinkRef),this._super()}})}),define("tvedemo/tmpl/login",["xdk-ui-basic/Image","xdk-ui-basic/Layout","xdk-ui-basic/Button","tvedemo/wgt/input/Input","xdk-ui-basic/Label","xdk-ax/Container","tvedemo/wgt/Keyboard","storm/mgr/sLanguageManager"],function(e,t,i,n,s,r,a,o){"use strict";return function(){return{klass:r,css:"fullscreen-controller login",children:[{klass:r,css:"main-view",children:[{klass:r,id:"form",css:"login-form",forwardFocus:!0,children:[{klass:s,css:"title",text:o.getString("Login.Login_labelHeadline").toUpperCase()},{klass:s,css:"input-header",text:o.getString("Login.Login_labelCustomerIDLabel"),id:"userNameLabel"},{klass:n,id:"usernameButton",maxLength:100,focusable:!0,nextDown:"passwordButton"},{klass:s,css:"input-header",text:o.getString("Login.Login_labelPINLabel"),id:"passwordLabel"},{klass:n,id:"passwordButton",isPassword:!0,focusable:!0,maxLength:4,hideTimeout:0,nextUp:"usernameButton",nextDown:"buttonContainer"},{klass:t,id:"buttonContainer",css:"button-container",forwardFocus:!0,nextUp:"passwordButton",children:[{klass:i,id:"loginButton",text:o.getString("Login.Login_buttonSignIn")}]},{klass:s,css:"forgottenText",text:o.getString("Login.Login_labelForgottenPIN")}]},{klass:r,id:"registerText",css:"registerText",children:[{klass:s,css:"title",text:o.getString("Settings.Settings_labelRegister").toUpperCase()},{klass:s,css:"content",text:o.getString("Login.Login_registerMessage")}]},{klass:r,id:"keyboardPatch2012",css:"keyboardPatch2012"}]}]}}}),define("storm/model/SettingsText",["xdk-base/class","tve/model/ImmutableModel"],function(e,t){"use strict";return e.create(t,{defaults:{title:"",label:"",body:""}},{})}),define("storm/model/TermsText",["xdk-base/class","xdk-base/util","storm/model/SettingsText"],function(e,t,i){"use strict";return e.create(i,{defaults:t.extend(t.clone(i.defaults),{checkboxTextA:"",checkboxTextB:"",acceptButtonText:""},!0)},{})}),define("storm/model/SettingsTextBuilder",["xdk-base/class","storm/model/SettingsText"],function(e,t){"use strict";return e.create({},{_attrs:{},setTitle:function(e){return this._attrs.title=e,this},setLabel:function(e){return this._attrs.label=e,this},setBody:function(e){return this._attrs.body=e,this},build:function(){return new t(this._attrs)}})}),define("storm/model/TermsTextBuilder",["xdk-base/class","storm/model/TermsText","storm/model/SettingsTextBuilder"],function(e,t,i){"use strict";return e.create(i,{},{_attrs:{},setCheckboxTextA:function(e){return this._attrs.checkboxTextA=e,this},setCheckboxTextB:function(e){return this._attrs.checkboxTextB=e,this},setAcceptanceButtonText:function(e){return this._attrs.acceptButtonText=e,this},setMarketingTexts:function(e,t){return this._attrs.marketingTitle=e,this._attrs.marketingBody=t,this},setAGBTexts:function(e,t){return this._attrs.AGBTitle=e,this._attrs.AGBBody=t,this},build:function(){return new t(this._attrs)}})}),define("storm/mgr/sLegalTextManager",["xdk-base/ax","xdk-base/core","xdk-base/class","storm/mgr/sEditorialManager","storm/model/TermsTextBuilder","storm/model/SettingsTextBuilder"],function(e,t,i,n,s,r){"use strict";var a=function(e){return e&&"AT"===e.toUpperCase()},o=function(e){return"<STRONG>"+e+"</STRONG>"};return new(i.create({},{getImpressum:function(e){var t=a(e)?n.CONTENT.IMPRESSUM_AT:n.CONTENT.IMPRESSUM_DE;return n.getEditorialContent(t).then(function(e){var t=e.responseJSON.impressum;return(new r).setTitle(t.article_name).setLabel(t.article_name).setBody(t.article_body).build()})},getPrivacy:function(e){var t=a(e)?n.CONTENT.PRIVACY_AT:n.CONTENT.PRIVACY_DE;return n.getEditorialContent(t).then(function(e){var t=e.responseJSON.datenschutz;return(new r).setTitle(t.article_name).setLabel(t.article_name).setBody(t.article_body).build()})},getTermsForReview:function(e){var t=a(e)?n.CONTENT.TERMS_AT:n.CONTENT.TERMS_DE;return n.getEditorialContent(t).then(function(e){var t=e.responseJSON.termsAndConditions;return(new r).setTitle(t.page_agb.agb_title).setLabel(t.page_agb.agb_title).setBody(t.page_agb.agb_body).build()})},getTermsForAgreement:function(e){var t=a(e)?n.CONTENT.TERMS_AT:n.CONTENT.TERMS_DE;return n.getEditorialContent(t).then(function(e){var t=e.responseJSON.termsAndConditions;return(new s).setTitle(t.acceptance.tc_title).setLabel(t.acceptance.tc_text1).setMarketingTexts(o(t.page_marketing.marketing_title),t.page_marketing.marketing_body).setAGBTexts(o(t.page_agb.agb_title),t.page_agb.agb_body).setBody(o(t.acceptance.tc_title)+t.acceptance.tc_text1+t.acceptance.tc_text2+t.acceptance.tc_text3).setCheckboxTextA(t.acceptance.tc_checkbox2_text).setCheckboxTextB(t.acceptance.tc_checkbox1_text).setAcceptanceButtonText(t.acceptance.tc_acceptbutton_text).build()})}}))}),define("tvedemo/ctrl/Login",["xdk-base/ax","xdk-base/promise","tvedemo/ctrl/RoutableController","xdk-ax/mvc/view","tvedemo/tmpl/login","xdk-ax/focusManager","xdk-ax/mediator","xdk-ax/evt/type","xdk-base/device/vKey","tvedemo/mgr/sHistoryManager","tvedemo/helper/dialogHelper","xdk-base/util","tvedemo/mgr/sEndUserManager","tvedemo/wgt/AlertDialog","xdk-base/console","xdk-base/device","tvedemo/wgt/Keyboard","tve/sServiceHolder","storm/mgr/sAppConfigManager","storm/mgr/sLanguageManager","storm/mgr/sLocalStorageManager","storm/mgr/sLegalTextManager","storm/helper/silkResponseHelper","tvedemo/wgt/Loading","lib/moment"],function(e,t,i,n,s,r,a,o,l,c,d,u,h,_,g,f,p,m,v,b,S,y,E,k,C){"use strict";return e.klass.create(i,{getDefaultState:function(){return{}}},{init:function(){this._super(),this.setView(n.render(s))},getState:function(){return this._super()},setup:function(e){this.context=e||{};var t=this.getView(),i=t.find("logo"),n=S.getStoredValue(S.KEYS.USERNAME);if(g.log(n),!0===e.historyBack&&h.getLoginStatus())return void c.back();v.getLogo().then(function(e){i.setSrc(e)}),this._usernameButton=t.find("usernameButton"),this._passwordButton=t.find("passwordButton"),this._keyboardPatch=t.find("keyboardPatch2012"),this._loginButton=t.find("loginButton"),this._keyboard=t.find("keyboard"),n?(this._usernameButton.setText(n),r.setReserveFocus(this._passwordButton),r.focus(this._passwordButton)):r.focus(this._usernameButton),this._usernameButton.__impl.updateLeft&&this._usernameButton.__impl.updateLeft(),this._passwordButton.__impl.updateLeft&&this._passwordButton.__impl.updateLeft();var s=this._usernameButton.getRoot()._dom.getElementsByTagName("input")[0];s&&s.blur(),this.__boundUsernameClick=u.bind(function(){this._keyboard=new p({id:"keyboard",type:"text",forwardFocus:!0}),this._input=this._usernameButton,this._nextFocus=this._passwordButton,this._keyboard.getReadyPromise().then(u.bind(function(){this._keyboard.setInputName(b.getString("Login.Login_labelCustomerIDLabel")),this._keyboard.showKeyboard({text:this._input.getText()}),r.focus(this._keyboard),this._keyboardOnClose(),t.attach(this._keyboard),2012===f.id.getFirmwareYear()&&this._keyboardPatch.addClass("madeVisible")},this),function(e){g.warn("Keyboard cannot be ready due to "+e)})},this),this.__boundPasswordClick=u.bind(function(){this._keyboard=new p({id:"keyboard",type:"password",forwardFocus:!0,maxLength:4,isPassword:!0,inputCss:"keyboard-number"}),this._input=this._passwordButton,this._nextFocus=this._loginButton,this._keyboard.getReadyPromise().then(u.bind(function(){this._keyboard.setInputName(b.getString("Login.Login_labelPINLabel")),this._keyboard.showKeyboard({text:this._input.getText(),keyMap:"number"}),r.focus(this._keyboard),this._keyboardOnClose(),t.attach(this._keyboard),2012===f.id.getFirmwareYear()&&this._keyboardPatch.addClass("madeVisible")},this),function(e){g.warn("Keyboard cannot be ready due to "+e)})},this),this.__boundUsernameKey=u.bind(this._fieldKeyHandler,this,this.__boundUsernameClick),this.__boundPasswordKey=u.bind(this._fieldKeyHandler,this,this.__boundPasswordClick),this.__boundLoginButtonClick=u.bind(this._login,this),this._usernameButton.addEventListener(this._usernameButton.CLICK,this.__boundUsernameClick),this._passwordButton.addEventListener(this._passwordButton.CLICK,this.__boundPasswordClick),this._usernameButton.addEventListener(this._usernameButton.KEY,this.__boundUsernameKey),this._passwordButton.addEventListener(this._passwordButton.KEY,this.__boundPasswordKey),this._loginButton.addEventListener(o.CLICK,this.__boundLoginButtonClick)},_fieldKeyHandler:function(e,t){switch(t.id){case l.KEY_0.id:case l.KEY_1.id:case l.KEY_2.id:case l.KEY_3.id:case l.KEY_4.id:case l.KEY_5.id:case l.KEY_6.id:case l.KEY_7.id:case l.KEY_8.id:case l.KEY_9.id:e()}},_loginSuccess:function(e){var i=e.get("entitlements")||[],n=u.bind(function(){this.context.redirection&&this.context.redirection.cmd?(this.context.redirection.cmd.historySkip=!0,a.publish("navigate",this.context.redirection.cmd)):this.context.intermediateLogin?(t.isPromise(this.context.intermediateLogin.promise)&&u.isFunction(this.context.intermediateLogin.resolve)&&this.context.intermediateLogin.resolve(),c.back()):a.publish("navigate",{path:"Main/Home"})},this);k.open(),this._hasUpcomingTicket(e).then(function(e){k.close(),r.setReserveFocus(null);var t=b.getString("Login.Login_upcoming_entitlement_body");t=t.replace("&lt;Datum&gt;",C(e.get("startDate")).format(b.getString("ui.format.daypassValidityDate"))),d.success({title:b.getString("Login.Login_upcoming_entitlement_headline"),message:t,closeAction:n})},function(){k.close(),i.length?n():d.success({title:b.getString("Login.Login_upselling_message_headline"),message:b.getString("Login.Login_upselling_message_body"),closeAction:n})})},_hasUpcomingTicket:function(e){var i=e.get("tickets")||[];return i.length?m.getDateTimeService().getServerDateTime().then(function(e){for(var n,s=!1,r=0;r<i.length;r++){if(i[r].get("startDate")<=e&&i[r].get("endDate")>e)return t.reject();i[r].get("startDate")>e&&((!n||i[r].get("startDate")<n.get("startDate"))&&(n=i[r]),s=!0)}return s?t.resolve(n):t.reject()}):t.reject()},_login:function(e,i){k.open();var n=this._usernameButton.getText(),s=this._passwordButton.getText();g.info("Login with ["+n+":"+s+"] ..."),h.login(n,s,i).then(u.bind(function(e){return k.close(),g.info("Logged in: ",e),h.checkTermsAndConditions(e).then(u.bind(function(t){if(!t)return this.openTermsAndConditionsDialog(e);this._loginSuccess(e)},this))},this)).fail(u.bind(function(e){k.close(),t.isPromise(e)?e.then(u.bind(function(e){e.get("code")===E.SILK_CODE.ALREADY_LOGGED_IN?d.confirm({title:e.get("title"),message:b.getString("Login.Login_AlreadyLoggedInOnOtherDevice_message"),positiveText:b.getString("Global.Global_Continue"),negativeText:b.getString("Global.Global_Cancel_Button"),positiveAction:u.bind(function(){this._login(null,!0)},this)}):(this.context.intermediateLogin&&t.isPromise(this.context.intermediateLogin.promise)&&u.isFunction(this.context.intermediateLogin.reject)&&this.context.intermediateLogin.reject(),d.error({title:e.get("title"),reason:e.get("description")}))},this)):e&&!1!==e.noErrorPopup||(this.context.intermediateLogin&&t.isPromise(this.context.intermediateLogin.promise)&&u.isFunction(this.context.intermediateLogin.reject)&&this.context.intermediateLogin.reject(),d.error({title:b.getString("Errormessages.Errormessages_GenericErrorMessageHeadline"),reason:b.getString("Global.Global_genericBackendError")}))},this)).done()},openTermsAndConditionsDialog:function(e,i){var n=u.bind(function(e,t){d.confirm({title:b.getString("Login.Login_labelTCpermission_is_not_accepted_hl"),message:b.getString("Login.Login_labelTCpermission_is_not_accepted_message"),positiveText:b.getString("Global.Global_buttonConfirm"),negativeText:b.getString("Global.Global_buttonClose"),positiveAction:u.bind(function(){this.openTermsAndConditionsDialog(e,t)},this),negativeAction:function(){t.reject({noErrorPopup:!0}),h.logout(h.LOGOUT.RETAIN_USERNAME)}})},this);return i=i||t.defer(),y.getTermsForAgreement(e.get("country")).then(u.bind(function(t){d.termsAndConditions({title:t.get("title"),message:t.get("label"),firstCheckboxLabel:t.get("checkboxTextA"),secondCheckboxLabel:t.get("checkboxTextB"),showMarketingButton:b.getString("Settings.Settings_Datenschutz"),showAGBButton:b.getString("Settings.Settings_labelTermsAndConditions"),marketingTitle:t.get("marketingTitle"),marketingBody:t.get("marketingBody"),AGBTitle:t.get("AGBTitle"),AGBBody:t.get("AGBBody"),confirmButtonText:t.get("acceptButtonText"),confirmAction:u.bind(function(t,s){h.acceptTermsAndConditions(e,s,t).then(u.bind(function(t){t?(i.resolve(),this._loginSuccess(e)):n(e,i)},this)).fail(function(){i.reject()})},this),cancelButtonText:b.getString("Global.Global_buttonClose"),cancelAction:function(){i.reject({noErrorPopup:!0}),h.logout(h.LOGOUT.RETAIN_USERNAME)}})},this)).fail(function(){i.reject()}),i.promise},reset:function(){this.context.intermediateLogin&&t.isPromise(this.context.intermediateLogin.promise)&&u.isFunction(this.context.intermediateLogin.reject)&&this.context.intermediateLogin.reject(),this._input=this._nextFocus=void 0,this._usernameButton.removeEventListener(o.CLICK,this.__boundUsernameClick),this._passwordButton.removeEventListener(o.CLICK,this.__boundPasswordClick),this._usernameButton.removeEventListener(o.KEY,this.__boundUsernameKey),this._passwordButton.removeEventListener(o.KEY,this.__boundPasswordKey),this._usernameButton.removeInputListeners(),this._passwordButton.removeInputListeners(),this._loginButton.removeEventListener(o.CLICK,this.__boundLoginButtonClick),r.setReserveFocus(null)},_keyboardOnClose:function(){this._keyboard.setOnClose(u.bind(function(e){g.log("TEXT: "+e),this._keyboardClosed=!0,!1!==e&&this._input.setText(e),this._keyboard.removeAllListeners(),this._keyboard.detach(),this._keyboardPatch.removeClass("madeVisible"),this._input.__impl.__input&&this._input.__impl.__input.getHTMLElement().blur(),r.focus(this._nextFocus)},this))}})}),define("tvedemo/wgt/MainMenuButton",["xdk-base/class","xdk-base/util","xdk-ax/Container","xdk-base/Element","xdk-ui-basic/Image","xdk-ui-basic/Label","xdk-ax/focusManager","xdk-ax/evt/type","xdk-base/device","xdk-base/console"],function(e,t,i,n,s,r,a,o,l,c){return e.create(i,{},{_label:null,_icon:null,_selectedIcon:null,_isSelected:!1,init:function(e){e.focusable=!0,e.clickable=!0,e.root=e.root||new n("div"),this._super(e),this.getRoot().addClass("main-menu-button"),e.text&&(this._label=new r({text:e.text,isPureText:e.isPureText||!1,parent:this})),!1===e.selectable&&this.getRoot().addClass("non-selectable")},select:function(){c.info("select"),this.addClass("selected"),this._isSelected=!0},unselect:function(){c.info("unselect"),this.removeClass("selected"),this._isSelected=!1}})}),define("tvedemo/wgt/MainMenu",["xdk-base/class","tvedemo/ext/ui/grid/LoopedGrid","tvedemo/wgt/MainMenuButton","xdk-base/console","storm/helper/util","xdk-base/util","xdk-base/promise","xdk-ax/focusManager"],function(e,t,i,n,s,r,a,o){"use strict";return e.create(t,{},{HOME:0,DEFAULT_ROWS:6,DEFAULT_BG_X:358,DEFAULT_LEFT:189,CENTERED_LEFT:615,DEFAULT_FOCUS_POSITION:2,FOCUS_POSITION:2,_savedState:null,init:function(e){e=e||{},e.scrollFrontBoundary=void 0===e.scrollFrontBoundary?2:e.scrollFrontBoundary,e.scrollEndBoundary=void 0===e.scrollEndBoundary?3:e.scrollEndBoundary,e.alignment=t.VERTICAL,this._super(e),this.setDisplayStgy(function(e){if(!e||!e.text)throw new Error("missing parameter in creating menu elements");return new i({selectable:e.selectable,text:e.text})})},setStyle:function(e){return this._root?(this._root.__setStyle(e),this):this},saveFirstState:function(){n.debug("Menu  Save first state"),this._savedState||this.saveState()},saveState:function(){n.debug("Menu  Save state");var e={selectedDsIndex:this._selectedDsIndex,selectedGridRow:this._selectedGridRow,selectedGridCol:this._selectedGridCol,hidden:this._hidden};this._savedState=e,n.log("Saved state",this._savedState)},restoreState:function(e){n.debug("Menu  Restore state");var t={selectedDsIndex:this._selectedDsIndex};if(n.log("Menu state",t),this._savedState){if(n.log("Saved state",this._savedState),this._savedState.selectedDsIndex!==t.selectedDsIndex){n.warn("Selected should be "+this._savedState.selectedDsIndex+" but is "+t.selectedDsIndex);var i=this._gridComponents[this._savedState.selectedGridRow][this._savedState.selectedGridCol];return o.focus(i,{noActive:!1,skipForwardFocus:!1}),this.select(this._savedState.selectedDsIndex,this.FOCUS_POSITION).then(r.bind(function(){return this.saveState(),e&&(n.log("Focus to _subController"),o.focus(e,{noActive:!0,skipForwardFocus:!1})),a.resolve()},this),function(e){n.error(e)})}n.log("Selection is fine")}else n.log("No state saved.");return a.resolve()},delayForwardFocus:function(e){return n.debug("delayForwardFocus()"),function(){clearInterval(this.forwardFocusDelay),o.focus(e)}},clearState:function(){n.debug("Menu  Clear state"),this._savedState={selectedDsIndex:0,selectedGridRow:this.FOCUS_POSITION,selectedGridCol:0,hidden:this._hidden}}})}),define("tvedemo/tmpl/main",["xdk-ui-basic/Image","xdk-ui-basic/Layout","xdk-ui-basic/Label","xdk-ui-basic/Button","xdk-ax/Container","tvedemo/wgt/MainMenu","tvedemo/ctrl/Home"],function(e,t,i,n,s,r,a){"use strict";return function(){return{klass:t,alignment:t.VERTICAL,id:"#main-view",forwardFocus:!0,children:[{klass:t,id:"header",css:"headerMenu",forwardFocus:!0,alignment:t.VERTICAL,nextDown:"subCtlrContainer",children:[{klass:r,forwardFocus:!0,id:"#list-main-menu",rows:6,cols:1},{klass:n,id:"#breadcrumb",css:"breadcrumb",focusable:!1,text:""},{klass:r,forwardFocus:!0,id:"#list-sub-menu",rows:6,cols:1},{klass:e,css:"fadeout-upper",src:"img/skystorm/fadeout_upper.png"},{klass:e,id:"submenuFading",css:"fadeout-lower",src:"img/skystorm/fadeout_lower.png"},{klass:s,id:"#subCtlrOverlay"}]},{klass:s,id:"#subCtlrContainer",forwardFocus:!0,nextUp:"header",children:[{controller:a}]},{klass:e,id:"#logo"}]}}}),define("tvedemo/ctrl/Main",["xdk-base/class","tvedemo/ctrl/RoutableController","xdk-ax/mvc/view","tvedemo/tmpl/main","xdk-ax/focusManager","xdk-ax/data/LocalDatasource","tve/sServiceHolder","xdk-ax/evt/type","xdk-ax/mediator","xdk-base/device/vKey","xdk-base/util","storm/mgr/sAppConfigManager","tvedemo/mgr/sEndUserManager","tvedemo/mgr/sNavigationManager","xdk-base/promise","tve/mgr/sLinearManager","xdk-base/console","tvedemo/helper/dialogHelper","storm/mgr/sLanguageManager","storm/event/UserEvent","tve/TVEError","storm/helper/util","tvedemo/wgt/Loading"],function(e,t,i,n,s,r,a,o,l,c,d,u,h,_,g,f,p,m,v,b,S,y,E){"use strict";var k=S.FACILITY,C=S.ERROR;return e.create(t,{getDefaultState:function(){return{}}},{_menu:null,_submenu:null,_submenuLoaded:!1,_lastKeyNavigation:null,_subController:null,_header:null,_level:1,_shouldSelectSubMenu:!0,init:function(){this.setView(i.render(n)),this._super()},getState:function(){return this.__state.menuSelectedDsIndex=this._menu.getSelectedDsIndex(),this._super()},setup:function(e){
var t=this.getView(),i=t.find("logo"),n=t.find("list-main-menu"),s=t.find("list-sub-menu"),r=t.find("breadcrumb"),a=t.find("submenuFading"),c=t.find("subCtlrContainer"),h=t.find("subCtlrContainer");this._onMenuUpdate=y.debounce(this.__onMenuUpdate,_.MENU_RESPOND_TIME),this.__onMenuUpdateRef=d.bind(this._onMenuUpdate,this),this.__onMenuAvailableRef=d.bind(this._onMenuAvailable,this),this.__subControllerFocusHandlerRef=d.bind(this.__onSubControllerFocus,this),this.__headerFocusRef=d.bind(this.__onHeaderFocus,this),this.__menuClickHandlerRef=d.bind(this.__menuClickHandler,this),this.__menuKeyHandlerRef=d.bind(this.__menuKeyHandler,this),this.__submenuClickHandlerRef=d.bind(this.__submenuClickHandler,this),this.__submenuKeyHandlerRef=d.bind(this.__submenuKeyHandler,this),this.__submenuSelectableCheckerRef=d.bind(this.__submenuSelectableChecker,this),this.__menuSelectionFocusRef=d.bind(this.__menuSelectionFocus,this),this.__menuFocusRef=d.bind(this.__menuFocus,this),this.__menuBlurRef=d.bind(this.__menuBlur,this),this.__submenuFocusRef=d.bind(this.__submenuFocus,this),this.__submenuBlurRef=d.bind(this.__submenuBlur,this),this.__breadcrumbClickHandlerRef=d.bind(this.__breadcrumbClickHandler,this),this.__onKeyRef=d.bind(this.onKey,this),this.getView().addEventListener(o.KEY,this.__onKeyRef),n.addEventListener(o.CLICK,this.__menuClickHandlerRef),n.addEventListener(o.KEY,this.__menuKeyHandlerRef),n.addEventListener(o.SELECTION_CHANGED,this.__menuSelectionFocusRef),n.addEventListener(o.FOCUS,this.__menuFocusRef),n.addEventListener(o.BLUR,this.__menuBlurRef),s.addEventListener(o.CLICK,this.__submenuClickHandlerRef),s.addEventListener(o.KEY,this.__submenuKeyHandlerRef),s.addEventListener(o.SELECTION_CHANGED,this.__submenuSelectableCheckerRef),s.addEventListener(o.FOCUS,this.__submenuFocusRef),s.addEventListener(o.BLUR,this.__submenuBlurRef),r.addEventListener(o.CLICK,this.__breadcrumbClickHandlerRef),r.setOption("focusable",!1),n.addEventListener(o.FOCUS,this.__headerFocusRef),s.addEventListener(o.FOCUS,this.__headerFocusRef),c.addEventListener(o.FOCUS,this.__subControllerFocusHandlerRef),l.subscribe(_.MENU_UPDATE,this.__onMenuUpdateRef),l.subscribe(_.NAV_AVAILABLE,this.__onMenuAvailableRef),this.__onMenuNavigatedRef=d.bind(this.__onMenuNavigated,this),l.subscribe("navigated",this.__onMenuNavigatedRef),this.__onHistoryNavigatedRef=d.bind(this.__onHistoryNavigated,this),l.subscribe(_.MENU_RECONSTRUCT_COMPLETE,this.__onHistoryNavigatedRef),this.__userHasBeenLoggedOutHandler=d.bind(function(){m.error({reason:v.getString("Errormessages.Errormessages_labelSessionExpired"),buttonText:v.getString("Global.Global_buttonBack_button")})},this),l.subscribe(b.UserHasBeenLoggedOut,this.__userHasBeenLoggedOutHandler),e.historyBack||(u.getLogo().then(function(e){i.setSrc(e)}),s.hide(),r.hide(),a.hide()),this._menu=n,this._submenu=s,this._submenuFading=a,this._breadcrumb=r,this._subController=c,this._header=h,this._menu.saveFirstState()},__onMenuUpdate:function(e){if(!e.list||!e.list.length)return p.error("__onMenuUpdate failed");if(e.target===_.MAIN_MENU){var t=y.arrayToDs(e.list);this._menu.setDatasource(t).then(d.bind(function(){return this._level=1,this._submenuLoaded=!1,this._shouldSelectSubMenu=!0,this._submenuFading.hide(),this._breadcrumb.hide(),this._submenu.hide(),this._menu.show(),e.promise&&g.isPromise(e.promise.promise)&&d.isFunction(e.promise.resolve)&&e.promise.resolve(),this._menu.select(e.selection,this._menu.FOCUS_POSITION).then(d.bind(function(){e.obtainFocus&&s.focus(this._menu)},this))},this)).fail(function(t){p.error("Menu cannot be configured due to "+t),e.promise&&g.isPromise(e.promise.promise)&&d.isFunction(e.promise.reject)&&e.promise.reject()})}else e.target===_.SUB_MENU&&(this._submenu.clearState(),this.__updateSubmenu(e))},__updateSubmenu:function(e){var t=y.arrayToDs(e.list);this._lastKeyNavigation=0;var i={};e.list.length<4?(i.scrollEndBoundary=Math.ceil(e.list.length/2),i.scrollFrontBoundary=Math.ceil(e.list.length/2)-1):(i.scrollFrontBoundary=this._submenu.DEFAULT_FOCUS_POSITION,i.scrollEndBoundary=this._submenu.DEFAULT_FOCUS_POSITION+1);var n={left:this._submenu.DEFAULT_LEFT+"px",marginLeft:"0px"};if(e.list.length<4){this._submenu._rows=e.list.length,this._submenu.FOCUS_POSITION=Math.ceil(e.list.length/2)-1,p.log("Focus",this._submenu.FOCUS_POSITION),p.log("Rows",this._submenu._rows),p.log("Length",e.list.length);var r=0-Math.ceil(170*e.list.length/2);this._submenu.FOCUS_POSITION;n={left:this._submenu.CENTERED_LEFT+"px",marginLeft:r+"px"}}else this._submenu._rows=this._submenu.DEFAULT_ROWS,this._submenu.FOCUS_POSITION=this._submenu.DEFAULT_FOCUS_POSITION;(s.isCompFocused(this._submenu)||s.isCompChildFocused(this._submenu))&&(e.obtainFocus=!0),this._submenu.reset(i),this._submenu.setStyle(n),this._submenu.setDatasource(t).then(d.bind(function(){return this._level++,this._submenuLoaded=!0,this._breadcrumb.setText(_.getBreadcrumb()),this._submenuFading.show(),this._breadcrumb.show(),this._submenu.show(),this._menu.hide(),e.promise&&g.isPromise(e.promise.promise)&&d.isFunction(e.promise.resolve)&&e.promise.resolve(),this._submenu.select(e.selection,this._submenu.FOCUS_POSITION).then(d.bind(function(){e.obtainFocus&&s.focus(this._submenu),this._lastKeyNavigation=1,this.__submenuSelectableChecker(),this._shouldSelectSubMenu&&(this.__submenuClickHandler(),p.log("***************** SUBMENU SELECT")),this._shouldSelectSubMenu=!0},this))},this)).fail(function(t){p.error("Submenu cannot be configured due to "+t),e.promise&&g.isPromise(e.promise.promise)&&d.isFunction(e.promise.reject)&&e.promise.reject()})},_onMenuAvailable:function(){this._shouldSelectSubMenu&&p.log("hehehehe *******************************")},__lastFocusOnHeader:!1,__onHeaderFocus:function(e){this.__lastFocusOnHeader||(p.warn("Header focus"),this.__lastFocusOnHeader=!0)},__onSubControllerFocus:function(e){e.target;this.__lastFocusOnHeader&&(this._submenuLoaded&&!this._submenu._hidden?this._menu.restoreState(!1).then(d.bind(function(){this._submenu.restoreState(this._subController)},this)):this._submenuLoaded&&this._submenu._hidden?this._submenu._savedState&&!1===this._submenu._savedState.hidden?this._menu.restoreState(!1).then(d.bind(function(){this._submenu.restoreState(!1),this._submenuFading.show(),this._submenu.show();var e=this._submenu.getSelectedData();_._handleMenu(e,!0,!0)},this)):this._menu.restoreState(!1).then(d.bind(function(){this._submenu.restoreState(this._subController)},this)):this._menu.restoreState(this._subController),this.__lastFocusOnHeader=!1)},__menuClickHandler:function(){var e=this._menu.getSelectedData();return this.trackLevel(this._level,e.text),this._menu.saveState(),this._submenu&&this._submenu.clearState(),E.open(),_.handleMenu(e).fail(d.bind(function(e){throw p.error("Navigation failed due to: "+e),e instanceof S&&e.getFacility()===k.NAVIGATION_MANAGER&&e.getErrorCode()===C.NOT_FOUND&&this.__menuErrorNoResult(),e},this)).complete(function(){E.close()}),!1},__menuKeyHandler:function(e){if(e.id===c.OK.id)return 2===this._lastKeyNavigation&&_.returnUpperLevelMenu(!0),this._lastKeyMainNavigation=!1,this._lastKeySubmenNavigationSideways=!1,this.__menuClickHandler(e);if(e.id===c.DOWN.id)if(2===this._lastKeyNavigation)this._level+=1,this._breadcrumb.show(),this._menu.hide();else{if(this._submenuLoaded)return this._lastKeyMainNavigation=!1,this._lastKeySubmenNavigationSideways=!1,this.__menuClickHandler(e);-1!==this._lastKeyNavigation&&1!==this._lastKeyNavigation||this._menu.saveFirstState()}else e.id!==c.LEFT.id&&e.id!==c.RIGHT.id||this._submenuLoaded&&!this._submenu._hidden&&(this._submenu.hide(),this._lastKeyMainNavigationSideways=!0,this._lastKeyNavigation=-1,_.returnUpperLevelMenu(!0));return!0},__menuBlur:function(e){},__menuFocus:function(e){this._menu.saveFirstState()},__submenuBlur:function(e){},__submenuFocus:function(e){},__onMenuNavigated:function(e){1===(e.path.match(/\//g)||[]).length&&s.focus(this.getView().find("subCtlrContainer"))},__onHistoryNavigated:function(e){this._menu.clearState(),this._lastKeyNavigation=0,this._shouldSelectSubMenu=!1,e||d.defer().then(d.bind(function(){this.__focusHandler()},this))},__focusHandler:function(){if(!m.isAnyDialogOpen()){var e=s.getCurFocus();if(function(e){return e&&e.getRoot()&&e.getRoot().isInDOMTree()}(e)&&this._subController.isAncestorOf(e))return;s.focus(this._subController)||s.focus(this._submenu)||s.focus(this._menu)}},__breadcrumbClickHandler:function(){return this._lastKeyNavigation=0,_.returnUpperLevelMenu(),this._level-=2,!0},__submenuClickHandler:function(){var e=this._submenu.getSelectedData();return this.trackLevel(this._level,e.text),this._submenu.saveState(),E.open(),_.handleMenu(e).fail(d.bind(function(e){throw p.error("Navigation failed due to: "+e),e instanceof S&&(e.getFacility()===k.NAVIGATION_MANAGER&&e.getErrorCode()===C.NOT_FOUND||"network issue"===e.getMessage())&&this.__menuErrorNoResult(),e},this)).complete(function(){E.close()}),!1},__returnPage:function(){var e=document.getElementById("news");return e||(e=document.getElementById("homeView")),e||(e=document.getElementById("moviesAssetGrid")),e||(e=document.getElementById("tvShowAssetGrid")),e||(e=document.getElementById("program-guide-view")),e||(e=document.getElementById("sport")),e||(e=document.getElementById("movie")),e||(e=document.getElementById("tvshow")),e},__submenuKeyHandler:function(e){switch(e.id){case c.OK.id:this._lastKeyNavigation=0;var t=this._submenu.getSelectedData();return this.trackLevel(this._level,t.text),this._submenu.saveState(),E.open(),_.handleMenu(t).fail(d.bind(function(e){throw p.error("Navigation failed due to: "+e),e instanceof S&&(e.getFacility()===k.NAVIGATION_MANAGER&&e.getErrorCode()===C.NOT_FOUND||"network issue"===e.getMessage())&&this.__menuErrorNoResult(),e},this)).complete(function(){E.close()}),!1;case c.DOWN.id:this._lastKeySubmenuNavigationSideways=!1;break;case c.UP.id:return this._level>2?(this._shouldSelectSubMenu=!1,_.returnUpperLevelMenu()):(this._submenu.restoreState(!1).then(d.bind(function(){s.focus(this._menu)},this)),this._lastKeyNavigation=2,this._level-=1,this._breadcrumb.hide(),this._menu.show()),!1;case c.LEFT.id:this._lastKeySubmenuNavigationSideways=!0,this._lastKeyNavigation=-1;break;case c.RIGHT.id:this._lastKeySubmenNavigationSideways=!0,this._lastKeyNavigation=1}return!0},onKey:function(e){if(e.id===c.EXIT.id)return!1;e.id===c.BACK.id&&(this._shouldSelectSubMenu=!1)},__submenuSelectableChecker:function(){if(0!==this._lastKeyNavigation){var e=this._submenu.getSelectedData(),t=this._submenu.getSelectedDsIndex();!1===e.selectable&&(p.info("This item is not selectable, selecting:"+(t+this._lastKeyNavigation)),this._submenu.select(t+this._lastKeyNavigation,this._submenu.FOCUS_POSITION))}},__menuSelectionFocus:function(e){e.gridComponents.length>0&&this._menu.setOption("forwardFocus",e.gridComponents[e.selectedGridRow][e.selectedGridCol])},__menuErrorNoResult:function(){m.error({reason:v.getString("Global.Global_NoResults"),buttonText:v.getString("Global.Global_buttonClose")})},reset:function(){l.unsubscribe(_.MENU_UPDATE,this.__onMenuUpdateRef),l.unsubscribe(_.NAV_AVAILABLE,this.__onMenuUpdateRef),l.unsubscribe("navigated",this.__onMenuNavigatedRef),l.unsubscribe(_.MENU_RECONSTRUCT_COMPLETE,this.__onHistoryNavigatedRef),l.unsubscribe(b.UserHasBeenLoggedOut,this.__userHasBeenLoggedOutHandler),this.getView().removeEventListener(o.KEY,this.__onKeyRef),this._menu.removeEventListener(o.CLICK,this.__menuClickHandlerRef),this._menu.removeEventListener(o.KEY,this.__menuKeyHandlerRef),this._menu.removeEventListener(o.SELECTION_CHANGED,this.__menuSelectionFocus),this._menu.removeEventListener(o.FOCUS,this.__headerFocusRef),this._subController.removeEventListener(o.FOCUS,this.__subControllerFocusHandlerRef),this._submenu.removeEventListener(o.KEY,this.__submenuKeyHandlerRef),this._submenu.removeEventListener(o.SELECTION_CHANGED,this.__submenuSelectableCheckerRef),this._submenu.removeEventListener(o.FOCUS,this.__headerFocusRef),this._breadcrumb.removeEventListener(o.CLICK,this.__breadcrumbClickHandlerRef)}})}),define("tvedemo/tmpl/maintenance",["xdk-ui-basic/Layout","xdk-ui-basic/Label","xdk-ui-basic/Image"],function(e,t,i){"use strict";return function(){return{klass:e,id:"#maintenanceView",width:1,alignment:e.HORIZONTAL,focusable:!0,children:[{klass:i,css:"backdrop",src:"img/skystorm/splash.png"},{klass:t,css:"message",id:"message",text:""}]}}}),define("tvedemo/ctrl/Maintenance",["xdk-base/ax","tvedemo/ctrl/RoutableController","xdk-ax/mvc/view","tvedemo/tmpl/maintenance","storm/mgr/sAppConfigManager","xdk-base/util","xdk-ax/evt/type","xdk-ax/focusManager","xdk-ax/mediator","storm/mgr/sLanguageManager"],function(e,t,i,n,s,r,a,o,l,c){return e.klass.create(t,{},{init:function(){this.setView(i.render(n))},setup:function(e){var t=this.getView();this._messageLabel=t.find("message"),s.getMessage().then(r.bind(function(e){this._messageLabel.setText(e)},this),r.bind(function(e){this._messageLabel.setText(c.getString("ui.maintenance.default"))},this)),o.focus(t),this._super(e)},reset:function(){this._super()}})}),define("tvedemo/tmpl/mixedListing",["xdk-ui-basic/Layout","xdk-ui-basic/Label","tvedemo/ext/ui/grid/LoopedGrid","xdk-ax/Container","storm/mgr/sLanguageManager"],function(e,t,i,n,s){"use strict";return function(){return{klass:e,forwardFocus:!0,alignment:e.VERTICAL,css:"subcontrollerPage mixed-listing",children:[{klass:t,id:"moviesHeadline",css:"movies-headline"},{klass:i,forwardFocus:!0,alignment:i.VERTICAL,id:"moviesAssetGrid",css:"movie-asset-grid",nextDown:"tvShowAssetGrid",rows:9,cols:1,scrollFrontBoundary:4,scrollEndBoundary:4},{klass:n,css:"middle-content",children:[{klass:n,id:"descriptionContainer",css:"description-container",children:[{klass:t,id:"title",css:"title"},{klass:t,id:"meta",css:"meta"}]}]},{klass:t,id:"seriesHeadline",css:"series-headline"},{klass:i,forwardFocus:!0,alignment:i.VERTICAL,id:"tvShowAssetGrid",css:"serie-asset-grid",nextUp:"moviesAssetGrid",rows:5,cols:1,scrollFrontBoundary:2,scrollEndBoundary:2},{klass:t,id:"errorMsgNoResults",css:"error-msg-center hidden",text:s.getString("Global.Global_NoResults")}]}}}),define("tvedemo/ctrl/MixedListing",["tvedemo/ctrl/RoutableController","xdk-ax/data/LocalDatasource","tvedemo/mgr/sAssetManager","tvedemo/tmpl/mixedListing","tvedemo/wgt/ImageButton","tve/mgr/sLinearManager","xdk-ax/focusManager","storm/helper/util","xdk-ax/Container","xdk-ui-basic/Label","xdk-ax/evt/type","xdk-ax/mvc/view","xdk-base/device/vKey","xdk-ax/mediator","xdk-base/console","xdk-base/promise","xdk-base/class","xdk-base/util","storm/mgr/sAppConfigManager"],function(e,t,i,n,s,r,a,o,l,c,d,u,h,_,g,f,p,m,v){"use strict";return p.create(e,{getDefaultState:function(){return{navigator:null}}},{init:function(){this._super(),this.setView(u.render(n))},getState:function(){return{navigator:this.context.navigator}},setup:function(e){this.context=e||{},this.populateVariables(),this.addListeners(),!0!==e.historyBack&&(this._data={},this._data.dvd_cover=[],this._data["16:9"]=[],e.setupPending=this._setupGrid().then(m.bind(function(e){Error.prototype.isPrototypeOf(e[0])?Error.prototype.isPrototypeOf(e[1])?this.getView().find("errorMsgNoResults").removeClass("hidden"):a.focus(this._seriesGrid):a.focus(this._moviesGrid)},this)))},populateVariables:function(){this._moviesHeadline=this.getView().find("moviesHeadline"),this._moviesGrid=this.getView().find("moviesAssetGrid"),this._titleLabel=this.getView().find("title"),this._metaLabel=this.getView().find("meta"),this._seriesHeadline=this.getView().find("seriesHeadline"),this._seriesGrid=this.getView().find("tvShowAssetGrid")},addListeners:function(){this._movieGridClickHandlerRef=m.bind(this._movieGridClickHandler,this),this._movieGridFocusHandlerRef=m.bind(this._movieGridFocusHandler,this),this._moviesGrid.addEventListener(d.CLICK,this._movieGridClickHandlerRef),this._moviesGrid.addEventListener(d.FOCUS,this._movieGridFocusHandlerRef),this._serieGridClickHandlerRef=m.bind(this._serieGridClickHandler,this),this._serieGridFocusHandlerRef=m.bind(this._serieGridFocusHandler,this),this._seriesGrid.addEventListener(d.CLICK,this._serieGridClickHandlerRef),this._seriesGrid.addEventListener(d.FOCUS,this._serieGridFocusHandlerRef)},_setupGrid:function(){return this.__mergeDataByLexic().then(m.bind(function(){return o.allPromises([this._setupMovieGrid(),this._setupSerieGrid()])},this))},__mergeDataByLexic:function(){for(var e=this.context.navigator.listings,t=[],i=0,n=e.length;i<n;i++){var s=e[i];s.url=s.path,s.displayType&&s.displayType.length&&("dvd_cover"===s.displayType||"16:9"===s.displayType)?s.structureType&&-1!==s.structureType.indexOf("ByLexic")?(g.log("[MixedListing __mergeDataByLexic] Start fetching "+s.structureType+" data..."),t.push(r.getLetterHeaderListing(s.url).then(m.bind(function(e,t){var i=e.url.replace(/[^\/]*$/,""),n=[];return m.each(t,function(t){if(t.linkable){var s=i+t.content.toString()+".json";n.push(r.getAssetListing(s).then(function(i){return g.log("[MixedListing __mergeDataByLexic] "+e.structureType+" "+t.content+" data fetched"),m.each(i.listing,function(e){e.catalog=i.catalog}),i.listing}))}}),f.all(n)},this,s)).then(m.bind(function(e,t){this._data[e.displayType]=this._data[e.displayType].concat.apply(this._data[e.displayType],t),g.log("[MixedListing __mergeDataByLexic] Finish merging "+e.structureType+" data... TotalCount:"+this._data[e.displayType].length)},this,s)))):t.push(r.getAssetListing(s.url).then(m.bind(function(e,t){m.each(t.listing,function(e){e.catalog=t.catalog}),this._data[e.displayType]=t.listing},this,s))):g.error("[MixedListing __mergeDataByLexic] "+s.structureType+" displayType "+s.displayType+" is not recognizable!")}return f.all(t)},_setupMovieGrid:function(){var e=new t;return e.setDataLoader(m.bind(function(e,t){var i,n=this._data.dvd_cover,s=f.defer(),r=[];for(n.length||(g.error("dvd_cover data empty!"),s.reject("dvd_cover data empty!")),i=0;i<t;i++)r.push(n[(e+i)%n.length]);return s.resolve({data:r,total:n.length}),s.promise},this)),this._moviesGrid.setDisplayStgy(function(e){var t=new l({forwardFocus:!0}),i=new s({parent:t,placeHolderPromise:v.getPlaceholderPortrait});return e.dvd_cover&&e.dvd_cover.path&&e.dvd_cover.file?r.constructCMSUrlPromise(e.dvd_cover.path+"/"+e.dvd_cover.file).then(function(e){i.setSrc(e)}):(g.warn("Asset does not contain dvd_cover images"),i.fallback()),t}),this._moviesGrid.setDatasource(e).then(m.bind(function(){this._moviesGrid.select(0,4)},this))},_setupSerieGrid:function(){var e=new t,i=function(e){var t="";return e.season_nr&&(t+="S"+e.season_nr+" "),e.episode_nr&&(t+="E"+e.episode_nr),t.length&&(t+=": "),e.serie_title&&e.serie_title.length?t+=e.serie_title.toUpperCase():e.title&&e.title.length&&(t+=e.title.toUpperCase()),t};return e.setDataLoader(m.bind(function(e,t){var i,n=this._data["16:9"],s=f.defer(),r=[];for(n.length||(g.error("16:9 data empty!"),s.reject("16:9 data empty!")),i=0;i<t;i++)r.push(n[(e+i)%n.length]);return s.resolve({data:r,total:n.length}),s.promise},this)),this._seriesGrid.setDisplayStgy(function(e){var t,n=new l({forwardFocus:!0}),a=new s({parent:n,placeHolderPromise:v.getPlaceholderLandscape});e.main_picture&&e.main_picture.picture&&e.main_picture.picture.length?(m.each(e.main_picture.picture,function(e){if(e.path&&e.file)return t=e,"content_2"===e.type?m.breaker:void 0}),r.constructCMSUrlPromise(t.path+"/"+t.file).then(function(e){a.setSrc(e)})):(g.warn("Asset does not contain 16:9 images"),a.fallback());var o=new l({parent:a,css:"textContainer"});new c({parent:o,text:i(e),css:"text"});return n}),this._seriesGrid.setDatasource(e).then(m.bind(function(){this._seriesGrid.select(0,2)},this))},_movieDescriptionHandler:function(){var e=this._moviesGrid.getSelectedData();e.title&&e.title.length?this._titleLabel.setText(e.title.toUpperCase()):this._titleLabel.setText(""),this._metaLabel.setText(e.category.main.content+" | "+e.year_of_production)},setMovieGridDescriptionVisible:function(e){e?this.getView().find("descriptionContainer").removeClass("hidden"):this.getView().find("descriptionContainer").addClass("hidden")},_movieGridFocusHandler:function(){this.setMovieGridDescriptionVisible(!0),this._movieDescriptionHandler()},_serieGridFocusHandler:function(){this.setMovieGridDescriptionVisible(!1)},_movieGridClickHandler:function(){var e=this._moviesGrid.getSelectedData();return _.publish("navigate",{path:"Main/Movie",state:{assetId:e.id,catalog:e.catalog}}),!1},_serieGridClickHandler:function(){var e=this._seriesGrid.getSelectedData();return"Episode"===e.asset_type?_.publish("navigate",{path:"Main/Episode",state:{selectedEpisodeId:e.id,catalog:e.catalog}}):_.publish("navigate",{path:"Main/TVShow",state:{serieId:e.id,catalog:e.catalog}}),!1},reset:function(){this._moviesGrid.removeEventListener(d.CLICK,this._movieGridClickHandlerRef),this._moviesGrid.removeEventListener(d.FOCUS,this._movieGridFocusHandlerRef),this._seriesGrid.removeEventListener(d.CLICK,this._serieGridClickHandlerRef),this._seriesGrid.removeEventListener(d.FOCUS,this._serieGridFocusHandlerRef),this._super()}})}),define("tvedemo/tmpl/movie",["xdk-ui-basic/Layout","xdk-ui-basic/Label","storm/wgt/Image","xdk-ax/Container","xdk-ui-basic/Button","tvedemo/wgt/AssetGrid","tvedemo/wgt/ScrollLabel","tvedemo/wgt/ImageButton","storm/mgr/sAppConfigManager","tvedemo/wgt/Progressbar"],function(e,t,i,n,s,r,a,o,l,c){"use strict";return function(){return{klass:e,alignment:e.VERTICAL,id:"#movie",children:[{klass:e,alignment:e.VERTICAL,children:[{klass:e,id:"#upContainer",children:[{klass:n,children:[{klass:i,id:"#thumbnail",placeHolderPromise:l.getPlaceholderLandscape},{klass:c,id:"#thumbnailProgress"}]},{klass:e,id:"#blackoutMessageContainer",children:[{klass:t,id:"#blackoutMessage"}]},{klass:n,css:"informationContainer",children:[{klass:t,id:"#title"},{klass:e,id:"#metaDataContainer",alignment:e.HORIZONTAL},{klass:i,id:"#channelLogo"},{klass:n,id:"missingPackage",css:"missingPackage",children:[{klass:i,id:"missingPackageLogo",css:"missingPackageLogo"},{klass:t,id:"missingPackageText",css:"missingPackageText"}]}]}]},{klass:e,alignment:e.HORIZONTAL,id:"#videoButtonContainer",children:[{klass:o,id:"movieStartFromVod",text:"",nextRight:"detailDescription",nextLeft:"movieStartFromVod"},{klass:o,id:"movieWatchTrailer",text:"",nextLeft:"movieWatchTrailer",nextRight:"detailDescription"},{klass:o,id:"addToWatchlist",text:"",nextRight:"detailDescription",nextLeft:"addToWatchlist"}]},{klass:a,id:"detailDescription",scrollStep:72,nextLeft:"videoButtonContainer",nextUp:"header",nextDown:"detailDescription"}]}]}}}),define("tvedemo/ctrl/Movie",["xdk-base/ax","xdk-base/class","xdk-ax/mvc/view","tvedemo/tmpl/movie","xdk-ax/evt/type","xdk-ax/focusManager","xdk-base/device/vKey","xdk-base/util","xdk-ax/mediator","tvedemo/wgt/TextSelectionListDialog","xdk-base/promise","xdk-ui-basic/Label","tvedemo/helper/sMoment","tvedemo/mgr/sEndUserManager","tvedemo/mgr/sHistoryManager","tvedemo/helper/dialogHelper","tvedemo/wgt/AlertDialog","storm/mgr/sAppConfigManager","xdk-base/console","storm/mgr/sLanguageManager","tvedemo/mgr/sAssetManager","tvedemo/ctrl/DetailsBase","storm/event/UserEvent","tvedemo/wgt/Loading"],function(e,t,i,n,s,r,a,o,l,c,d,u,h,_,g,f,p,m,v,b,S,y,E,k){"use strict";return t.create(y,{getDefaultState:function(){return{}}},{__asset:null,init:function(){this._super(),this.setView(i.render(n))},setup:function(e){if(this._super(e),this.__handleUserDataUpdate=o.bind(function(){this.__asset&&this.updateDetailInformation(this.__asset)},this),l.subscribe(E.UserDataUpdated,this.__handleUserDataUpdate),this.setupButtons(),e.historyBack)return void this.updateDetailInformation(this.__asset);this._autoPlayRef=o.bind(function(){this.__watchVod(this.__asset)},this),!0===e.autoPlay&&l.subscribe("navigated",this._autoPlayRef,!0),e.setupPending=this.setupDetailsInformation(e.assetId,e.catalog)},setupButtons:function(){var e=this.getView(),t=e.find("movieStartFromVod"),i=e.find("movieWatchTrailer"),n=e.find("addToWatchlist");this.__watchTrailerRef=o.bind(function(){this.__watchTrailer(this.__asset)},this),this.__watchMovieRef=o.bind(function(){this.__watchVod(this.__asset)},this),this.__addToWatchlistRef=o.bind(function(){this.__updateWatchList({remove:!!this.__detailInformation.isInWatchlist,add:!this.__detailInformation.isInWatchlist,catalog:this.__asset.get("catalog"),assetId:this.__asset.get("id"),assetType:this.__asset.get("type")}).then(o.bind(function(e){e.added?this.__detailInformation.isInWatchlist=!0:e.removed&&(this.__detailInformation.isInWatchlist=!1),this.updateButtons({asset:this.__asset,userHasPrivileges:this.__detailInformation.userHasPrivileges,isBlackedOut:this.__detailInformation.isBlackedOut,isPlayable:this.__assetIsPlayable(this.__asset),isInWatchlist:this.__detailInformation.isInWatchlist,userIsLoggedIn:this.checkIfUserIsLoggedIn()})},this))},this),i.addEventListener(s.CLICK,this.__watchTrailerRef),t.addEventListener(s.CLICK,this.__watchMovieRef),n.addEventListener(s.CLICK,this.__addToWatchlistRef)},setupDetailsInformation:function(t,i){var n;return t&&i?(n=S.getAssetById(t,i),n.then(o.bind(function(e){return this.updateDetailInformation(e)},this)).fail(function(e){v.warn("Movie detail page setup failed: "+e),o.defer().then(function(){f.error({reason:b.getString("Global.Global_NoResults"),closeAction:o.bind(g.back,g),buttonText:b.getString("Global.Global_buttonBack_button")})})})):n=e.promise.reject().fail(function(){o.defer().then(function(){f.error({reason:b.getString("Global.Global_NoResults"),closeAction:o.bind(g.back,g),buttonText:b.getString("Global.Global_buttonBack_button")})})})},updateDetailInformation:function(e){return k.open(),d.all([this.__checkUserPrivileges(e),this.__checkIfAssetIsPresentInWatchlist(e),this.getBookmarkAsObject(e.get("id"))]).then(o.bind(function(t){var i=t[0],n=t[1],s=t[2]?t[2].bookmark:void 0;e.set("bookmark",t[2]),this.__asset=e,this.__detailInformation.title=e.get("title"),this.__detailInformation.synopsis=e.get("synopsis"),this.__detailInformation.cast=e.get("cast"),this.__detailInformation.parentalRating=e.get("parentalRating"),this.__detailInformation.length=e.get("length"),this.__detailInformation.year=e.get("year"),this.__detailInformation.genres=e.get("genreList"),this.__detailInformation.onAirDate=e.get("date"),this.__detailInformation.packageCode=e.get("packageCode"),this.__detailInformation.packageColorCode=e.get("packageColorCode"),this.__detailInformation.isBlackedOut=e.get("blackedOut"),this.__detailInformation.userHasPrivileges=i,this.__detailInformation.isInWatchlist=n,this.__detailInformation.isHD=e.get("isHD"),this.trackPage(e.get("title")),this.updateCommonDetailInformation(this.__asset,this.__detailInformation),this.updateButtons({asset:this.__asset,userHasPrivileges:this.__detailInformation.userHasPrivileges,isBlackedOut:this.__detailInformation.isBlackedOut,isPlayable:this.__assetIsPlayable(this.__asset),isInWatchlist:this.__detailInformation.isInWatchlist,userIsLoggedIn:this.checkIfUserIsLoggedIn(),bookmark:s})},this))},updateButtons:function(e){if(e){var t=this.getView(),i=t.find("movieStartFromVod"),n=t.find("movieWatchTrailer"),s=t.find("addToWatchlist"),r=t.find("videoButtonContainer"),a=t.find("detailDescription"),o=e.asset,l=e.userHasPrivileges,c=e.userIsLoggedIn,d=e.isBlackedOut,u=e.isPlayable,h=e.isInWatchlist,_=this.__hasTrailer(o);o.get("bookmark")&&"W"!==o.get("bookmark").watchedState?i.setText(b.getString("DetailPage.DetailPage_continue_now_btn")):i.setText(b.getString("DetailPage.DetailPage_watch_now_btn")),n.setText(b.getString("DetailPage.DetailPage_labelwatch_trailer_label")),s.setText(h?b.getString("DetailPage.DetailPage_removeWatchlist"):b.getString("DetailPage.DetailPage_labeladd_to_watchlist")),this.setButtonNavigation([{button:i,hidden:!(!d&&u),greyedOut:!l&&!!c},{button:n,hidden:!_,greyedOut:!1},{button:s,hidden:!!d,greyedOut:!1}],r),d&&!_||a.setFocusable(!1),this.isInitialized||(this.focusFirstVisibleComponent([i,n,s]),this.isInitialized=!0)}},reset:function(){var e=this.getView(),t=e.find("movieStartFromVod"),i=e.find("movieWatchTrailer"),n=e.find("addToWatchlist");this._super(),t.removeEventListener(s.CLICK,this.__watchMovieRef),i.removeEventListener(s.CLICK,this.__watchTrailerRef),n.removeEventListener(s.CLICK,this.__addToWatchlistRef),l.unsubscribe(E.UserDataUpdated,this.__handleUserDataUpdate),l.unsubscribe("navigated",this._autoPlayRef)}})}),define("tvedemo/tmpl/moviesListing",["storm/mgr/sLanguageManager","xdk-ui-basic/Layout","xdk-ui-basic/Label","tvedemo/ext/ui/grid/LoopedGrid","xdk-ax/Container"],function(e,t,i,n,s){"use strict";return function(){return{klass:t,forwardFocus:!0,alignment:t.VERTICAL,css:"subcontrollerPage movie-listing",children:[{klass:n,forwardFocus:!0,alignment:n.VERTICAL,id:"#moviesAssetGrid",rows:9,cols:2,scrollFrontBoundary:4,scrollEndBoundary:4},{klass:s,css:"middle-content",children:[{klass:s,id:"descriptionContainer",css:"description-container",children:[{klass:i,id:"title",css:"title"},{klass:i,id:"meta",css:"meta"}]}]},{klass:i,id:"errorMsg",css:"error-msg",text:e.getString("Global.Global_NoResults")}]}}}),define("tvedemo/ctrl/MoviesListing",["tvedemo/ctrl/RoutableController","tvedemo/tmpl/moviesListing","xdk-ax/data/LocalDatasource","tvedemo/mgr/sAssetManager","tvedemo/wgt/ImageButton","tve/mgr/sLinearManager","xdk-ax/focusManager","storm/helper/util","xdk-ax/Container","xdk-ax/mvc/view","xdk-ax/evt/type","xdk-base/device/vKey","xdk-ax/mediator","xdk-base/console","xdk-base/promise","xdk-base/class","xdk-base/util","storm/mgr/sAppConfigManager","tvedemo/wgt/BasicGrid"],function(e,t,i,n,s,r,a,o,l,c,d,u,h,_,g,f,p,m,v){"use strict";return f.create(e,{getDefaultState:function(){return{navigator:null}}},{init:function(){this._super(),this.setView(c.render(t))},setup:function(e){this.context=e||{},this._assetGrid=this.getView().find("moviesAssetGrid"),this._assetGridParent=this._assetGrid._parent,this._titleLabel=this.getView().find("title"),this._metaLabel=this.getView().find("meta"),this._assetGridHandlerRef=p.bind(this._assetGridHandler,this),this._assetDescriptionHandlerRef=p.bind(this._assetDescriptionHandler,this),this._assetGrid.addEventListener(d.CLICK,this._assetGridHandlerRef),this._assetGrid.addEventListener(d.FOCUS,this._assetDescriptionHandlerRef),!0!==e.historyBack&&(this._data=[],this.getView().find("errorMsg").hide(),e.setupPending=this._setupData().then(p.bind(this._setupGrid,this)).then(p.bind(function(){a.focus(this._assetGrid)},this),p.bind(function(){this.getView().find("errorMsg").show()},this)),this.trackLevel(2,void 0,!0))},swapAssetGrid:function(e){var t=this._assetGrid;this._assetGrid=new v({forwardFocus:!0,alignment:v.VERTICAL,id:"#moviesAssetGrid",rows:2,cols:Math.ceil(e/2)}),this._assetGridParent.replace(t,this._assetGrid),this._assetGrid.addEventListener(d.CLICK,this._assetGridHandlerRef),this._assetGrid.addEventListener(d.FOCUS,this._assetDescriptionHandlerRef)},_fetchPage:function(e,t){var i=e.replace("p1","p"+t);return r.getAssetListing(i).then(p.bind(function(e){return p.each(e.listing,function(t){t.catalog=e.catalog}),e.listing},this))},_sortByTitle:function(e){return e.sort(function(e,t){return e.title<t.title?-1:e.title>t.title?1:0})},_setupData:function(){return p.bind(function(e){return e&&e.length?this.context.navigator.id&&this.context.navigator.id.indexOf("ByYear")>-1?r.getAssetListing(e).then(p.bind(function(t){var i,n=[];if(p.each(t.listing,function(e){e.catalog=t.catalog}),!(t.pages&&t.pages>1))return void(this._data=this._sortByTitle(t.listing));for(i=2;i<=t.pages;i++)n.push(this._fetchPage(e,i));return g.all(n).then(p.bind(function(e){var i=[].concat(t.listing);p.each(e,function(e){i=i.concat(e)}),this._data=this._sortByTitle(i)},this))},this)):this.context.navigator.id&&-1!==this.context.navigator.id.indexOf("ByLexic")?r.getLetterHeaderListing(e).then(function(t){var i=e.replace(/[^\/]*$/,""),n=[];return p.each(t,function(e){if(e.linkable){
var t=i+e.content.toString()+".json";n.push(r.getAssetListing(t).then(function(t){return _.log("[MoviesListing _retrieveData] "+e.content+" data fetched"),p.each(t.listing,function(e){e.catalog=t.catalog}),t.listing}))}}),g.all(n)}).then(p.bind(function(e){this._data=this._data.concat.apply(this._data,e),_.log("[MoviesListing _retrieveData] Finish merging data... TotalCount:"+this._data.length)},this)):r.getAssetListing(e).then(p.bind(function(e){p.each(e.listing,function(t){t.catalog=e.catalog}),this._data=e.listing},this)):(_.error("path is empty"),g.reject("path is empty"))},this)(this.context.navigator.url)},_setupGrid:function(){var e=o.arrayToDs(this._data),t=this._data.length;return t<15&&this.swapAssetGrid(t),this._assetGrid.setDisplayStgy(function(e){var t=new l({forwardFocus:!0}),i=new s({parent:t,placeHolderPromise:m.getPlaceholderPortrait});return e.dvd_cover&&e.dvd_cover.path&&e.dvd_cover.file?r.constructCMSUrlPromise(e.dvd_cover.path+"/"+e.dvd_cover.file).then(function(e){i.setSrc(e)}):(_.warn("Asset does not contain dvd_cover images"),i.fallback()),t}),this._assetGrid.setDatasource(e).then(p.bind(function(){t<15&&(this._assetGridParent.addClass("movie-listing-limited"),this._assetGrid.addClass("limited-movies"))},this))},_assetDescriptionHandler:function(){var e=this._assetGrid.getSelectedData(),t="";e.title&&e.title.length?this._titleLabel.setText(e.title.toUpperCase()):this._titleLabel.setText(""),e.category.main.content?t=e.category.main.content:e.category.other.length>0&&(t=e.category.other[0].content),this._metaLabel.setText(t+(e.year_of_production?" | "+e.year_of_production:""))},_assetGridHandler:function(){var e=this._assetGrid.getSelectedData();switch(e.type){case"Series":h.publish("navigate",{path:"Main/TVShow",state:{serieId:e.id,catalog:e.catalog}});break;default:h.publish("navigate",{path:"Main/Movie",state:{assetId:e.id,catalog:e.catalog}})}return!1},reset:function(){this._assetGrid.removeEventListener(d.CLICK,this._assetGridHandlerRef),this._assetGrid.removeEventListener(d.SELECTION_CHANGED,this._assetDescriptionHandlerRef),this._super()}})}),define("tvedemo/tmpl/myAccount",["xdk-ui-basic/Layout","xdk-ui-basic/Label","tvedemo/wgt/AssetGrid","xdk-ui-basic/Image","xdk-ax/Container","tvedemo/wgt/ImageButton","xdk-base/config","storm/mgr/sLanguageManager"],function(e,t,i,n,s,r,a,o){"use strict";return function(){return{klass:e,alignment:e.VERTICAL,forwardFocus:!0,css:"subcontrollerPage settings-myaccount",children:[{klass:s,id:"#myaccount-maincontainer",children:[{klass:s,css:"myaccount-details",alignment:e.HORIZONTAL,children:[{klass:t,id:"#myaccount-title",css:"myaccount-title",text:o.getString("Settings.Settings_labelAccount_SmartTV").toUpperCase()},{klass:e,alignment:e.VERTICAL,id:"#user-details",children:[{klass:t,id:"#title",css:"itemHeader",text:o.getString("Settings.Settings_labelTitle")},{klass:t,id:"#userTitleValue",css:"itemValue",text:""},{klass:t,id:"#name",css:"itemHeader",text:o.getString("Settings.Settings_labelFullName")},{klass:t,id:"#userNameValue",css:"itemValue",text:""},{klass:t,id:"#email",css:"itemHeader",text:o.getString("Settings.Settings_labelEmail")},{klass:t,id:"#userEmailValue",css:"itemValue",text:""},{klass:t,id:"#customerId",css:"itemHeader",text:o.getString("Settings.Settings_AccountlabelId")},{klass:t,id:"#userCustomerId",css:"itemValue",text:""}]},{klass:r,id:"#logoutButton",text:o.getString("Global.Global_buttonLogout_btn").toUpperCase()}]},{klass:s,alignment:e.HORIZONTAL,children:[{klass:t,id:"#addonsubscription-title",css:"addonsubscription-title",text:o.getString("Settings.Settings_entitlementSubscription_sky").toUpperCase()},{klass:e,id:"#subscriptiondetail-layout",alignment:e.VERTICAL,children:[]},{klass:t,id:"#activedaypass-title",css:"activedaypass-title",text:o.getString("Settings.Settings_entitlementDayPass_active").toUpperCase()},{klass:e,id:"#activedaypass-layout",children:[]}]}]}]}}}),define("storm/model/Daypass",["xdk-base/class","tve/model/ImmutableModel"],function(e,t){"use strict";return e.create(t,{defaults:{key:null,title:"",startDate:null,endDate:null,entitlements:"",category:""}},{})}),define("storm/model/DaypassBuilder",["xdk-base/class","storm/model/Daypass"],function(e,t){"use strict";return e.create({},{_attrs:{},setKey:function(e){return this._attrs.key=e,this},setTitle:function(e){return this._attrs.title=e,this},setStartDate:function(e){return this._attrs.startDate=e,this},setEndDate:function(e){return this._attrs.endDate=e,this},setEntitlements:function(e){return this._attrs.entitlements=e,this},setCategory:function(e){return this._attrs.category=e,this},build:function(){return new t(this._attrs)}})}),define("storm/mgr/sProductDetailsManager",["xdk-base/class","xdk-base/util","xdk-base/promise","tvedemo/helper/sMoment","tve/TVEError","storm/helper/util","storm/mgr/sEditorialManager","storm/mgr/sLanguageManager","storm/model/DaypassBuilder"],function(e,t,i,n,s,r,a,o,l){"use strict";return new(e.create({},{getSubscriptionsDetails:function(){return a.getEditorialContent(a.CONTENT.PRODUCT_DETAILS).then(function(e){var t=e.responseJSON.subscriptions;return t||i.reject("getSubscriptionsDetails: Malformed product-describing editorial content")})},getDaypassGroupDetails:function(){return a.getEditorialContent(a.CONTENT.PRODUCT_DETAILS).then(function(e){var t=e.responseJSON.daypasses;return t||i.reject("getDaypassGroupDetails: Malformed product-describing editorial content")})},getDaypassGroupNameFromLetter:function(e){return this.getDaypassGroupDetails().then(function(t){var n=t[e];return o.getInitPromise().then(function(){return i.resolve(o.getString("Settings."+n.labelKey))})})},getDaypassDetails:function(){return a.getEditorialContent(a.CONTENT.DAYPASS_DETAILS).then(function(e){var t=e.responseJSON.daypass;return t||i.reject("getDaypassDetails: Malformed product-describing editorial content")})},getDaypassFromKey:function(e){return this.getDaypassDetails().then(function(s){var r,a=o.getString("ui.parsing.daypassValidityDate")+o.getString("ui.parsing.daypassValidityTime");return t.each(s,function(i){if(i.key===e){var s=(new l).setKey(e).setTitle(i.title).setStartDate(n(i.validity.start_date+i.validity.start_time,a).toDate()).setEndDate(n(i.validity.end_date+i.validity.end_time,a).toDate()).setEntitlements(i.entitlements).setCategory(i.category);return r=s.build(),t.each.breaker}}),r||i.reject("getDaypassFromKey: No daypass found with key "+e)})}}))}),define("tvedemo/ctrl/MyAccount",["xdk-base/ax","tvedemo/ctrl/RoutableController","tvedemo/tmpl/myAccount","xdk-ax/mvc/view","xdk-base/util","xdk-ax/evt/type","xdk-ax/focusManager","xdk-ax/mediator","xdk-base/promise","tvedemo/mgr/sEndUserManager","xdk-base/console","xdk-base/config","xdk-base/device","storm/mgr/sAppConfigManager","tvedemo/helper/dialogHelper","xdk-ui-basic/Label","tvedemo/helper/sMoment","storm/mgr/sLanguageManager","xdk-ui-basic/Layout","storm/mgr/sProductDetailsManager","tvedemo/mgr/sNavigationManager","tve/sServiceHolder","storm/event/UserEvent","tvedemo/mgr/sHistoryManager","lib/moment","tvedemo/wgt/Loading"],function(e,t,i,n,s,r,a,o,l,c,d,u,h,_,g,f,p,m,v,b,S,y,E,k,C,T){"use strict";return e.klass.create(t,{getDefaultState:function(){return{}}},{init:function(){this._super(),this.setView(n.render(i))},setup:function(e){this._super(e),this._logoutButton=this.getView().find("logoutButton"),c.getLoginStatus()?(this._boundLogoutClick=s.bind(this._logoutClick,this),this._logoutButton.addEventListener(r.CLICK,this._boundLogoutClick),this.__handleUserDataUpdate=s.bind(function(){this.populateUserData()},this),o.subscribe(E.UserDataUpdated,this.__handleUserDataUpdate),e.setupPending=this.populateUserData()):!0===e.historyBack&&k.back()},populateUserData:function(){return c.getLoggedInUser().then(s.bind(function(e){if(e){var t=this.getView(),i=t.find("userTitleValue"),n=t.find("userNameValue"),r=t.find("userEmailValue"),a=t.find("userCustomerId"),o=t.find("subscriptiondetail-layout"),l=t.find("activedaypass-layout"),c=e.get("subscriptions"),u=e.get("tickets");o.detachAll(),l.detachAll(),i.setText(e.get("presentation")),n.setText(e.get("firstName")+" "+e.get("lastName")),r.setText(e.get("email")),a.setText(e.get("customerCode")),s.isArray(c)&&c.length>0?b.getSubscriptionsDetails().then(function(e){s.each(c,function(t){var i=e[t.get("id")];if(i)return s.each(i,function(e){new f({parent:o,text:e.label,css:"itemHeader row-begin row-end"})}),s.breaker()})},function(e){d.log("Error while showing subscription catalog ",e)}):new f({parent:o,text:m.getString("Settings.Settings_noSubscriptionsMessage"),css:"itemHeaderFlowing"}),s.isArray(u)&&u.length>0?s.each(u,s.bind(function(e){var t,i=new v({parent:l}),n=e.get("title"),s=e.get("startDate"),r=e.get("endDate");r=p(r-864e5).toDate(),n=n.replace(/[0-9]*\.[0-9]*\.[0-9]*/i,""),t=this.isDayTicket(s,r),n=m.getString("ui.ticket.prefix")+" "+n+": "+p(s).format(m.getString("ui.format.daypassValidityDate")),t||(n=n+" - "+p(r).format(m.getString("ui.format.daypassValidityDate"))),new f({parent:i,text:n,css:"itemHeaderDayPass"})},this)):(new f({parent:l,text:m.getString("Settings.Settings_noDaypassesMessage"),id:"#nodayPassMessage",css:"itemHeaderFlowing"}),new f({parent:l,text:m.getString("Settings.Settings_daypassesUpsellingMessage"),id:"#bookdayPassWebsite",css:"itemHeaderFlowing"}))}},this))},isDayTicket:function(e,t){return t-e<=864e5},_toggleBookmarkFlagClick:function(){var e=this.getView(),t=e.find("userCustomerBookmarkFlag");"Y"===t.getText()?g.confirm({title:m.getString("Bookmarking.Bookmarking_Deactivation_Popup_hl"),message:m.getString("Bookmarking.Bookmarking_Deactivation_Popup_text"),positiveText:m.getString("Bookmarking.Bookmarking_Deactivation_Popup_Confirm_text"),negativeText:m.getString("Bookmarking.Bookmarking_Deactivation_Popup_Cancel_text"),positiveAction:s.bind(function(){this._updateBookmarkFlag(t)},this),negativeAction:s.bind(function(){},this)}):this._updateBookmarkFlag(t)},_updateBookmarkFlag:function(e){T.open(),c.updateCustomerBookmarkFlag().then(s.bind(function(t){"OK"===t.resultMessage?c.getLoggedInUser().then(s.bind(function(t){T.close();var i=t.get("isBookmarkOn"),n=i?"Bookmarking_Activation_Successful_Popup_text":"Bookmarking_Deactivation_Successful_Popup_text",s=i?"Bookmarking_Activation_Successful_Popup_hl":"Bookmarking_Deactivation_Successful_Popup_hl";t&&(g.success({title:m.getString("Bookmarking."+s),message:m.getString("Bookmarking."+n)}),e.setText(!0===i?"Y":"N"))})):(T.close(),g.error({reason:m.getString("Errormessages.Errormessages_GenericErrorMessageHeadline"),buttonText:m.getString("Global.Global_buttonBack_button"),closeAction:s.bind(function(){T.open(),c.getLoggedInUser().then(function(e){T.close(),c.getLoginStatus()||k.back()})},this)}))},this))},_logoutClick:function(){c.logout(c.LOGOUT.DISCARD_USERNAME).then(function(){o.publish("navigate",{path:"Main/Home"})}).fail(function(e){l.isPromise(e)?e.then(function(e){var t=e&&e.get("description");d.info("Logout failed: ",t),g.error({reason:t})}):(d.info("Logout on MyAccount failed: ",e),g.error({reason:m.getString("Errormessages.Errormessages_labelSessionExpired")}))})},reset:function(e){this._logoutButton.removeEventListener(r.CLICK,this._boundLogoutClick),this.getView().removeAllListeners(),o.unsubscribe(E.UserDataUpdated,this.__handleUserDataUpdate),this._super(e)}})}),define("tvedemo/wgt/Submenu",["xdk-base/class","xdk-base/core","xdk-ui-basic/Layout","xdk-ax/evt/type","xdk-ui-basic/Button","xdk-base/util"],function(e,t,i,n,s,r){return e.create(i,{},{_items:[],_selectedIndex:-1,init:function(e){e.alignment=i.HORIZONTAL,e.forwardFocus=!0,this._super(e),this.addClass("wgt-submenu"),e.items&&this.setItems(e.items),this.addEventListener(n.CLICK,this._onClick,!0)},setItems:function(e){this._items=e,this._initUI()},_initUI:function(){this.detachAll();for(var e=0,t=this._items.length;e<t;e++)new s({css:"wgt-submenu-item",text:this._items[e].text,parent:this}).removeClass("wgt-button").addClass("menu-button")},getSelection:function(){return this._items[this._selectedIndex]},getSelectedIndex:function(){return this._selectedIndex},select:function(e){if(e<0||e>=this._items.length)throw t.createException("Invalid param","Array index out of bound");this._select(e)},_select:function(e){var t=this.getChildren();this._selectedIndex>=0&&t[this._selectedIndex]&&t[this._selectedIndex].removeClass("selected"),this._selectedIndex=e,t[this._selectedIndex].addClass("selected")},_onClick:function(e){var t=r.indexOf(this.getChildren(),e.target);this._select(t)}})}),define("tvedemo/tmpl/news",["xdk-ui-basic/Layout","xdk-ui-basic/Label","tvedemo/wgt/Submenu","tvedemo/wgt/AssetGrid","storm/wgt/Image","xdk-ax/Container","tvedemo/wgt/ScrollLabel","storm/mgr/sAppConfigManager"],function(e,t,i,n,s,r,a,o){return function(){return{klass:e,alignment:e.VERTICAL,id:"#news",children:[{klass:r,id:"#upContainer",children:[{klass:s,id:"#thumbnail",placeHolderPromise:o.getPlaceholderLandscape},{klass:t,id:"#title"},{klass:e,id:"#metaDataContainer",alignment:e.HORIZONTAL},{klass:s,id:"#channelLogo"}]},{klass:a,id:"detailDescription",css:"serie-description",scrollStep:108,nextDown:"relatedNewsGrid",nextUp:"header"},{klass:n,id:"#relatedNewsGrid",focusable:!0,rows:1,cols:4,button:{showEpisodeNumber:!0,icon:!0},nextUp:"detailDescription",nextDown:"relatedNewsGrid"}]}}}),define("tvedemo/wgt/EpisodeButton",["xdk-base/ax","xdk-base/promise","xdk-base/class","tvedemo/wgt/AssetButton","xdk-ui-basic/Label","xdk-ax/Component","storm/mgr/sAppConfigManager"],function(e,t,i,n,s,r,a){"use strict";var o,l,c;return i.create(n,{},{init:function(e){o=e.thumbnailPromise,l=e.packageColorPromise,this._super(e)},_getPlaceholder:function(){return"img/placeholders/show_placeholder.png"},_getThumbnail:function(){return o?o.then(e.util.bind(function(e){this._thumbnail=e.get("url"),this._thumbnailImage.setSrc(this._thumbnail)},this)):t.reject("No thumbnail available")},_setupContainer:function(){var e=new r({css:"wgt-assetbtn-episode-shade"}),t=this._asset.get("episodeNumber"),i=this._asset.get("seasonNumber"),n=this._asset.get("title");this._labelContainer.attach(e),c=new s({css:"wgt-assetbtn-episode",text:t&&i?"S"+i+" E"+t+": "+n:n,parent:this._labelContainer})}})}),define("tvedemo/ctrl/News",["xdk-base/ax","xdk-base/class","xdk-ax/mvc/view","tvedemo/tmpl/news","xdk-ax/evt/type","xdk-ax/focusManager","xdk-base/device/vKey","xdk-base/util","xdk-ax/mediator","tvedemo/wgt/TextSelectionListDialog","xdk-base/promise","xdk-ui-basic/Label","tvedemo/helper/sMoment","tvedemo/mgr/sEndUserManager","tvedemo/mgr/sHistoryManager","tvedemo/helper/dialogHelper","tvedemo/wgt/AlertDialog","storm/mgr/sAppConfigManager","xdk-base/console","storm/mgr/sLanguageManager","tve/mgr/sLinearManager","tvedemo/ctrl/DetailsBase","storm/helper/util","tvedemo/mgr/sAssetManager","tvedemo/wgt/EpisodeButton","xdk-ax/evt/eventManager"],function(e,t,i,n,s,r,a,o,l,c,d,u,h,_,g,f,p,m,v,b,S,y,E,k,C,T){"use strict";return t.create(y,{getDefaultState:function(){return{}}},{__news:null,__detailInformation:{},init:function(){this._super(),this.setView(i.render(n))},setup:function(e){this._super(e),this.setupGrid(),e.historyBack||(e.setupPending=this.setupDetailsInformation(e.selectedNewsId,e.selectedNewsCategory))},setupGrid:function(){var e=this.getView(),t=e.find("relatedNewsGrid");this.__gridClickHandler=o.bind(this._gridClickHandler,this),t.addEventListener(s.CLICK,this.__gridClickHandler)},setupDetailsInformation:function(e,t){S.getSportNewsAssetsByCategory(t).then(o.bind(function(t){var i;o.each(t,function(t){if(t.get("id")===e)return i=t,o.breaker}),d.all([this.displayDetailInformation(i),this.displayRelatedNews(t)]).then(o.bind(function(){var e=this.getView(),t=e.find("relatedNewsGrid"),i=e.find("detailDescription");this.focusFirstVisibleComponent([t,i])},this))},this)).fail(function(){})},displayDetailInformation:function(e){return e?(this.__news=e,this.__detailInformation.title=this.__news.get("title"),this.__detailInformation.synopsis=this.__news.get("synopsis"),this.__detailInformation.newsDate=h(this.__news.get("date"),b.getString("ui.parsing.newsDate")),this.__detailInformation.userHasPrivileges=!0,this.updateCommonDetailInformation(this.__news,this.__detailInformation),d.resolve(!0)):d.resolve(!1)},displayRelatedNews:function(e){var t=this.getView(),i=t.find("relatedNewsGrid"),n=E.arrayToDs(e);return i.setDisplayStgy(o.bind(function(e){var t=e.get("packageCode");t||(t=e.get("packageColourCode"));var i={css:"wgt-assetbutton",asset:e,thumbnailPromise:k.getStormAssetImageBySize(e,this.IMAGE_MIN_WIDTH,this.IMAGE_MIN_HEIGHT),packageColorPromise:m.getPackageColourForCode(t)};return new C(i)},this)),i.setDatasource(n)},_gridClickHandler:function(e){var t="wgt-grid-arrow"!=e.target._opts.css,i=this.getView().find("relatedNewsGrid"),n=i.getSelectedData();if(t)return this.displayDetailInformation(n),!1;var o=e.target;return r.focus(i),o._root._dom.className.indexOf("right")>-1?T.trigger(s.KEY,i,{id:a.RIGHT.id}):T.trigger(s.KEY,i,{id:a.LEFT.id}),!1},reset:function(){this._super(),this.getView().find("relatedNewsGrid").removeEventListener(s.CLICK,this.__gridClickHandler)}})}),define("tvedemo/tmpl/onNow",["xdk-ax/Container","xdk-ui-basic/Button","xdk-ui-basic/Image","xdk-ui-basic/Label","xdk-ui-basic/Layout","tvedemo/ext/ui/grid/LoopedGrid","xdk-ui-basic/Checkbox","tvedemo/wgt/Footer","tvedemo/wgt/FooterIconMap"],function(e,t,i,n,s,r,a,o,l){"use strict";return{klass:e,id:"#onNowView",width:2,alignment:s.HORIZONTAL,forwardFocus:!0,focusable:!0,children:[{klass:s,id:"onNowChannelListContainer",css:"on-now-channel-list-container",width:1,alignment:s.HORIZONTAL,forwardFocus:!0,children:[{klass:i,id:"arrowUp",css:"on-now-arrow-up",src:"img/arrow_up.png"},{klass:i,id:"arrowDown",css:"on-now-arrow-down",src:"img/arrow_down.png"}]},{klass:e,id:"detailsPanel",css:"details-panel",forwardFocus:!0,children:[{klass:n,css:"on-now-label",text:"ON NOW"},{klass:a,css:"favorite-button",id:"favoriteButton",nextLeft:"onNowChannelList"},{klass:n,css:"on-now-title",id:"onNowTitle"},{klass:n,css:"on-now-time",id:"onNowTime"},{klass:n,css:"on-now-details",id:"onNowDetails"}]},{klass:e,css:"footer-container on-now",id:"footerContainer",children:[{klass:o,id:"footer",css:"footer",iconSet:l.DEFAULT}]}]}}),define("tvedemo/ctrl/OnNow",["xdk-base/ax","xdk-ax/mvc/AppRoot","tvedemo/ctrl/RoutableController","xdk-ax/mvc/view","tvedemo/tmpl/onNow","xdk-ax/evt/type","xdk-ax/focusManager","tvedemo/wgt/AlertDialog","xdk-ax/mediator","xdk-base/promise","xdk-base/util","tvedemo/wgt/ImageButton","tve/mgr/sLinearManager","tvedemo/mgr/sEndUserManager","tvedemo/helper/sMoment","xdk-base/device/vKey","tvedemo/wgt/TextSelectionListDialog","xdk-ui-grid/LoopedGrid","tvedemo/wgt/ConfirmDialog","storm/helper/util","xdk-base/console","tve/videoPlaybackService/model/Playlist","tve/videoPlaybackService/model/PlaylistItem","storm/mgr/sVideoManager","tve/videoPlaybackService/evt/VideoPlaybackControlsEvent","tve/videoPlaybackService/evt/VideoControlsStatusEvent","storm/mgr/sLanguageManager","tvedemo/wgt/vLoading"],function(e,t,i,n,s,r,a,o,l,c,d,u,h,_,g,f,p,m,v,b,S,y,E,k,C,T,x,I){"use strict";var w=t.singleton(),L=[{id:"all",text:"All"}],A=[{id:"all",text:"All"},{id:"favorites",text:"Favorite"}],D=x.getString("ui.format.onAirTime");return e.klass.create(i,{getDefaultState:function(){return{}}},{init:function(){this.setView(n.render(s))},setup:function(e){w.getView().addClass("fullscreen-video-mode"),this.context=e;var t=this.getView();this.onNowView=t.find("onNowView"),this.onNowChannelListContainer=t.find("onNowChannelListContainer"),this.arrowUp=t.find("arrowUp"),this.arrowDown=t.find("arrowDown"),this.detailsPanel=t.find("detailsPanel"),this.favoriteButton=t.find("favoriteButton"),this.onNowTitle=t.find("onNowTitle"),this.onNowTime=t.find("onNowTime"),this.onNowDetails=t.find("onNowDetails"),this.footer=t.find("footer"),this.footerContainer=t.find("footerContainer"),_.getLoginStatus()?this.footer.update({colorYellow:"Category",arrowAll:"Move",enter:"Select",back:"Back"}):(this.footer.update({arrowAll:"Move",enter:"Select",back:"Back"}),this.favoriteButton.hide()),this.showUI(),h.getChannels().then(d.bind(function(e){this.totalChannelsNumber=e.length,this.setupGrid(this.totalChannelsNumber,h.getChannelsDs())},this)),this.setupPlayback(),e.historyBack||(this.favoriteButton.addEventListener(r.CLICK,d.bind(function(){this.favoriteButtonValue?_.addFavoriteChannelById(this.currentChannel.get("id")).done():_.removeFavoriteChannelById(this.currentChannel.get("id")).done()},this)),this.favoriteButton.addEventListener(r.VALUE_CHANGED,d.bind(function(e){this.favoriteButtonValue=e},this)),this.__onKeyRef=d.bind(this.onKey,this),t.addEventListener(r.KEY,this.__onKeyRef),this.__exitPopupUpdateRef=d.bind(this.__exitPopupUpdate,this),l.subscribe("exitPopup",this.__exitPopupUpdateRef))},setupGrid:function(e,t){var i=e>4?5:e;this.onNowChannelList&&(this.onNowChannelList.detach(),this.onNowChannelList.removeAllListeners()),this.onNowChannelList=new m({css:"on-now-channel-list",id:"onNowChannelList",rows:i,cols:1,alignment:m.HORIZONTAL,scrollFrontBoundary:0,scrollEndBoundary:i-1,nextRight:"favoriteButton",parent:this.onNowChannelListContainer}),this.setupArrowKeys(e);var n=this.onNowChannelList;n.setDisplayStgy(d.bind(function(e){var t=new u({src:"",placeHolder:"img/placeholders/channel_placeholder.png"});return h.getChannelLogoUrl(e).then(function(e){t.setSrc(e)}).fail(function(t){S.warn("[OnNow] failed to get channel logo for channel "+e.get("title")+": "+t)}).done(),t.addEventListener(r.FOCUS,d.bind(function(){this.currentChannel=e,_.getLoginStatus()&&_.checkFavoriteForChannelById(e.get("id")).then(d.bind(function(t){if(e.get("id")===this.currentChannel.get("id")){if(t)return void this.favoriteButton.check();this.favoriteButton.uncheck()}},this)).done(),h.getCurrentProgramByChannelId(e.get("id")).then(d.bind(function(t){var i="NA",n="NA";if(e===this.currentChannel){try{i=g(Math.floor(t.get("startTime"))).format(D),n=g(Math.floor(t.get("endTime"))).format(D)}catch(e){S.warn("[OnNow] "+e)}this.onNowTitle.setText(t.get("title")),this.onNowTime.setText(i+" - "+n),this.onNowDetails.setText(t.get("description"))}},this)).done()},this)),this.currentPlayingChannel&&this.currentPlayingChannel.get("id")===e.get("id")&&(t.addClass("playing"),this.currentPlayingButton=t),t.addEventListener(r.CLICK,d.bind(function(i){this.playChannel(e),this.currentPlayingButton&&this.currentPlayingButton.removeClass("playing"),t.addClass("playing"),this.currentPlayingButton=t},this)),t},this)),n.setDatasource(t).then(d.bind(function(){var e=d.bind(function(e){var t=n.getDatasource();t.getRange(0,t.getFetchedCount()).then(d.bind(function(t){for(var i=0,s=t.length;i<s;i++)if(e===t[i].get("id")){n.select(i,0),this.playChannel(t[i]);break}},this))},this);if(this.context&&this.context.channelId&&!this.loadedDataSource)e(this.context.channelId);else if(_.getLoginStatus()&&!this.loadedDataSource)_.getLastWatchedChannel().then(d.bind(function(t){t&&t.assetId?e(t.assetId):this.onNowChannelList.getDatasource().getRange(0,1).then(d.bind(function(e){this.playChannel(e[0])},this))},this));else{var t=n.getDatasource();t.getRange(0,t.getFetchedCount()).then(d.bind(function(e){if(this.currentPlayingChannel)for(var t=this.currentPlayingChannel.get("id"),i=0,s=e.length;i<s;i++)if(t===e[i].get("id"))return n.select(i,0),void this.playChannel(e[i]);this.playChannel(e[0])},this))}this.loadedDataSource=!0,a.focus(n),this.__showUIRef=d.bind(this.showUI,this),n.addEventListener(r.SELECTION_CHANGED,this.__showUIRef)},this)).done()},setupArrowKeys:function(e){if(e){if(1===e)return this.arrowUp.hide(),void this.arrowDown.hide();this.arrowUp.show(),this.arrowDown.show();var t=e<5?e:5;this.arrowDown.getRoot().getHTMLElement().style.top=640-115*(5-t)+"px"}},setupPlayback:function(){this.__dismissControlsRef=d.bind(this._dismissControls,this),l.subscribe(C.DismissControls,this.__dismissControlsRef),I.open()},closeLoadingCallback:function(){I.close()},_dismissControls:function(e){},__playByUrl:function(e){var t=[new E({url:e})],i=new y({items:t});this.__videoManager=new k,this.__videoManager.setVideoLoadedCallback(d.bind(this.closeLoadingCallback,this)),this.__videoManager.setPlaylist(i),this.__videoManager.playPlaylistItem(t[0])},playChannel:function(e){I.close(),_.getLoginStatus()&&_.addLastWatchedChannelById(e.get("id")),h.getChannelStream(e).then(d.bind(function(t){l.publish(T.DismissSelected),this.__currentVideoUrl=t.get("url"),this.__playByUrl(this.__currentVideoUrl),this.currentPlayingChannel=e,setTimeout(d.bind(function(){this.onNowChannelList.getChildren()[0].getChildren()[0].getChildren()[0].addClass("playing")},this),100)},this)).fail(function(t){S.warn("[OnNow] failed to get the stream for "+e.get("title")+": "+t)}).done()},__exitPopupUpdate:function(e){this.hasExitPopup=e,e||"show"!==this.status||this.showUI()},__hasPopup:function(){return!(!this.hasExitPopup&&!this.hasCategoryPopup)},showUI:function(){if(clearTimeout(this.hideUITimer),this.hideUITimer=setTimeout(d.bind(function(){this.hideUI()},this),5e3),this.status&&"hidden"===this.status)return this.onNowChannelListContainer.show(),this.detailsPanel.show(),this.footerContainer.show(),this.status="show",a.focus(this.onNowChannelList),!0},hideUI:function(){this.status&&"show"!==this.status||this.__hasPopup()||(this.onNowChannelListContainer.hide(),this.detailsPanel.hide(),this.footerContainer.hide(),this.status="hidden",a.focus(this.onNowView))},selectCategoryById:function(e){if(!this.currentCategoryId||this.currentCategoryId!==e){var t;"all"===e?(this.currentCategoryId=e,this.setupGrid(this.totalChannelsNumber,h.getChannelsDs())):"favorites"===e&&(this.currentCategoryId=e,_.getFavoriteChannels().then(d.bind(function(e){if(e){for(var i=[],n=0,s=e.length;n<s;n++)e[n].assetId&&i.push(e[n].assetId);t=h.getChannelsDsByIds(i)}else t=h.getChannelsDs();this.setupGrid(e.length,t)},this)))}},onKey:function(e){if(!this.showUI()){switch(e.id){case f.YELLOW.id:if(this.__hasPopup())return;_.getFavoriteChannels().then(d.bind(function(e){var t,i;t=e.length?A:L,i=new p({items:t,parent:this.getView()}),this.hasCategoryPopup=!0,i.addEventListener(p.EVT_SELECTED,d.bind(function(e){i.close(),this.showUI(),this.selectCategoryById(t[e].id)},this)),i.addEventListener(r.CLOSE,d.bind(function(e){this.hasCategoryPopup=!1},this))},this));break;default:return!0}return!1}},reset:function(){I.close(),clearTimeout(this.hideUITimer),w.getView().removeClass("fullscreen-video-mode"),this.getView().removeEventListener(r.KEY,this.__onKeyRef),this.onNowChannelList.removeEventListener(r.SELECTION_CHANGED,this.__showUIRef),this.status="hidden",l.publish(T.DismissSelected),l.unsubscribe(C.DismissControls,this.__dismissControlsRef),l.unsubscribe("exitPopup",this.__exitPopupUpdateRef),this.__videoManager.deinit()}})}),define("tvedemo/tmpl/programDetailPopup",["xdk-ax/Container","xdk-ui-basic/Button","xdk-ui-basic/Label","xdk-ui-basic/Layout"],function(e,t,i,n){"use strict";return function(){return{klass:e,css:"popup-controller",nextLeft:null,nextRight:null,nextUp:null,nextDown:null,children:[{klass:e,id:"popupRootView",css:"program-detail-popup",children:[{klass:e,id:"popupBody",css:"popup-body",children:[{klass:i,id:"description",css:"description"},{klass:n,id:"buttonLayout",css:"button-container",forwardFocus:!0,children:[{klass:t,id:"tuneInButton",css:"button",text:"Tune in"},{klass:t,id:"restartFromVodButton",css:"button",text:"Restart from VOD"},{klass:t,id:"addToWatchlistButton",css:"button",text:"Add to watchlist"},{klass:t,id:"goToDetailsButton",css:"button",text:"Go to details"}]}]}]}]}}}),define("tvedemo/ctrl/ProgramDetailPopup",["xdk-base/ax","tvedemo/ctrl/RoutableController","xdk-ax/mvc/view","tvedemo/tmpl/programDetailPopup","xdk-base/device/vKey","xdk-ax/evt/type","xdk-ax/focusManager","xdk-base/promise","xdk-base/util","tvedemo/mgr/sHistoryManager","tve/model/Asset","tvedemo/wgt/AlertDialog","tvedemo/wgt/Loading","tve/mgr/sLinearManager","tvedemo/helper/dialogHelper","xdk-ax/mediator","storm/mgr/sLanguageManager"],function(e,t,i,n,s,r,a,o,l,c,d,u,h,_,g,f,p){"use strict";p.getString("ui.format.onAirTime");return e.klass.create(t,{getDefaultState:function(){return{channelId:null,programId:null}}},{_asset:null,_channel:null,_thumbnail:null,_title:null,_onAirTime:null,_logo:null,_pgIndicator:null,_onNowIndicator:null,_description:null,_tuneInButton:null,_restartFromVodButton:null,_addToWatchlistButton:null,_goToDetailsButton:null,init:function(){this._super(),this.setView(i.render(n))},setup:function(t){var i,n,s=this,d=this.getView(),u=d.find("buttonLayout"),h=t.channelId,f=t.programId;if(this._thumbnail=d.find("thumbnail"),this._title=d.find("title"),this._onNowIndicator=d.find("onNowIndicator"),this._onAirTime=d.find("onAirTime"),this._pgIndicator=d.find("pgIndicator"),this._logo=d.find("logo"),this._description=d.find("description"),this._tuneInButton=d.find("tuneInButton"),this._restartFromVodButton=d.find("restartFromVodButton"),this._addToWatchlistButton=d.find("addToWatchlistButton"),this._goToDetailsButton=d.find("goToDetailsButton"),this.__onClick=l.bind(this._onClick,this),u.addEventListener(r.CLICK,this.__onClick),this.__onKeyRef=l.bind(this._onKey,this),d.addEventListener(r.KEY,this.__onKeyRef),t.historyBack)a.focus(u);else{if(!h||!f){d.find("popupRootView").hide();return void g.error({title:"Sorry",reason:"Cannot get the program information.<br />\nPlease try again later.",buttonText:"Back",parent:this.getView()}).addEventListener(r.CLOSE,function(e){c.back()})}this.updateState({channelId:h,programId:f}),i=_.getChannelById(h),n=_.getProgramById(f),u.hide(),t.setupPending=o.all([i,n]).then(function(e){s._channel=e[0],s._asset=e[1],u.show(),a.focus(u)}).fail(function(t){s.getView().hide(),g.error({title:"Sorry",reason:"Cannot get the program information.<br />\nPlease try again later.",buttonText:"Back",parent:s.getView()}).addEventListener(r.CLOSE,function(t){e.util.delay(.2).then(function(){c.back()})})})}},goToOnNow:function(){f.publish("navigate",{path:"OnNow",state:{channelId:this._channel.get("id")}})},_onClick:function(e){var t=e.target;t===this._tuneInButton||t===this._restartFromVodButton||t===this._addToWatchlistButton||this._goToDetailsButton},_onKey:function(e){switch(e.id){case s.BACK.id:case s.OK.id:case s.EXIT.id:return!0;default:return!1}},reset:function(){this.getView().find("buttonLayout").removeEventListener(r.CLICK,this.__onClick,this)}})}),define("css!tve/ext/ui/programguide/css/row",[],function(){}),define("tve/ext/ui/programguide/Row",["xdk-base/class","xdk-ax/Container","xdk-ax/focusManager","xdk-ax/evt/type","xdk-base/device/vKey","xdk-ui-basic/Button","xdk-ui-basic/Image","xdk-ui-basic/Layout","xdk-base/util","css!./css/row"],function(e,t,i,n,s,r,a,o,l){var c=function(e,t,i){return(t-e)/6e4*i};return e.create(t,{},{_logo:null,_listing:null,_slider:null,_sliderWidth:0,_visibleWidth:0,_minLeft:0,_currentLeft:0,_ppm:0,_programs:[],_startTime:0,_endTime:0,_selectionTime:0,_programClickedCallback:null,_programFocusedCallback:null,_programOffset:0,init:function(e){this._super(e),e.borderWidth=0,e.horizontalMargin=2,this._visibleWidth=e.scrollPaneWidth||600,this._startTime=e.startTime,this._endTime=e.endTime,this._windowStart=e.windowStart,this._selectionTime=e.selectionTime;var i=e.borderWidth,n=e.horizontalMargin,s=2*i+n;this.windowSize=e.windowSize||120,this._ppm=this._visibleWidth/this.windowSize,this._channel=e.channel,this._programs=e.programs,this.addClass("wgt-programguide-row");var r,a=new t({css:"wgt-programguide-row-header-container",parent:this}),o=new t({css:"wgt-programguide-row-listing-container",parent:this});e.displayProgramGuideRowHeaderStgy&&(r=e.displayProgramGuideRowHeaderStgy(this._channel)),e.displayProgramItemStgy&&(this._displayProgramItemStgy=e.displayProgramItemStgy),o.getRoot().css("width",this._visibleWidth+"px"),a.attach(r),this.setupSlider(o,s)},
setupSlider:function(e,i){this._slider=new o({css:"wgt-programguide-row-listing-slider",parent:e,width:99,autoNavigation:!0,forwardFocus:!0}),this.setOption("forwardFocus",this._slider);for(var n,s=0,r=this,a=[],d=[],u=[],h=this._windowStart+6e4*this.windowSize,_=function(e,i,n,s){r._displayProgramItemStgy&&(a[e]=r._displayProgramItemStgy(r._programs[e].data));var o=a[e].getRoot();o.css("left",i+"px"),o.css("width",n+"px"),s?b.attach(a[e],t.PLACE_PREPEND):b.attach(a[e])},g=0,f=this._programs.length,p=this._startTime;g<f&&p<this._endTime;g++){var m=this._programs[g].startTime,v=this._programs[g].endTime,b=this._slider;if(m<this._startTime){if(v<=this._startTime){this._programOffset++;continue}m=this._startTime}v>this._endTime&&(v=this._endTime),p=v,n=c(m,v,this._ppm),v<=this._windowStart?d.push(l.bind(_,null,g,s,n-i,!0)):m>=h?u.push(l.bind(_,null,g,s,n-i)):_(g,s,n-i),s+=n}this.onReady=l.delay(.5).then(l.bind(function(){var e,t;for(e=d.length-1;e>-1;e--)d[e](!0);for(e=0,t=u.length;e<t;e++)u[e]();if(this._selectionTime)return void this.setSelectionTime(this._selectionTime);this.setSelectionTime(this._windowStart)},this)),this._sliderWidth=s,this._minLeft=-(this._sliderWidth-this._visibleWidth),this._slider.getRoot().css("width",s+"px")},updateTime:function(e){var t=-this.__timeToLeft(e),i=this._slider.getRoot();i&&(this._currentLeft=t>0?0:Math.max(t,this._minLeft),i.css("left",this._currentLeft+"px"))},getSelection:function(){return this.__getSelectedProgram()},getSelectionTime:function(){var e,t;return t=this.__leftToTime(-this._currentLeft),e=this.__getSelectedProgram().startTime,Math.max(e,t)},setSelectionTime:function(e){this._selectionTime=e,this._slider.setOption("forwardFocus",this._searchChildByTime(e))},getChannel:function(){return this._channel},_searchChildByTime:function(e){for(var t=this._programOffset,i=this._programs.length;t<i;t++){var n=this._programs[t];if(n.startTime<=e&&e<n.endTime)return this._slider.getChildren()[t-this._programOffset]}},selectByTime:function(e){this._selectionTime=e;for(var t=this._programOffset,n=this._programs.length;t<n;t++){var s=this._programs[t];if(s.startTime<=e&&e<s.endTime)return void i.focus(this._slider.getChildren()[t-this._programOffset])}},__getSelectedProgram:function(){for(var e=this._slider.getChildren(),t=0,n=this._programs.length;t<n;t++)if(i.isCompFocused(e[t]))return this._programs[t+this._programOffset];return null},__timeToLeft:function(e){return(e-this._startTime)/6e4*this._ppm},__leftToTime:function(e){return Math.round(e/this._ppm*6e4)+this._startTime}})}),define("css!tve/ext/ui/programguide/css/timeline",[],function(){}),define("tve/ext/ui/programguide/Timeline",["xdk-base/class","xdk-ax/Container","xdk-ui-basic/Button","xdk-ui-basic/Label","xdk-ui-basic/Layout","xdk-base/util","tvedemo/helper/sMoment","css!./css/timeline"],function(e,t,i,n,s,r,a){return e.create(t,{},{_slider:null,_sliderWidth:0,_visibleWidth:0,_minLeft:0,_currentLeft:0,_ppm:0,_dateFormat:"",_timeFormat:"",_dateLabel:null,_labels:[],_marker:null,_markerTimer:null,_startTime:0,_endTime:0,init:function(e){e.focusable=!1,e.forwardFocus=!1,this._super(e),this._visibleWidth=e.scrollPaneWidth||600,this._startTime=e.startTime,this._endTime=e.endTime,this._dateFormat=e.dateFormat||"D-MMM",this._timeFormat=e.timeFormat||"hh:mm a";var i,s=e.windowSize||120;this._ppm=this._visibleWidth/s,this._timescale=e.timescale||30,this.addClass("wgt-programguide-timeline"),this._dateLabel=new n({css:"wgt-programguide-timeline-date",parent:this}),i=new t({css:"wgt-programguide-timeline-slider-container",parent:this}),i.getRoot().css("width",this._visibleWidth+"px"),this._setupSlider(i,e.programs),this._marker=new n({css:"wgt-programguide-timeline-marker",parent:this._slider,focusable:!1}),this._marker.hide()},updateTime:function(e){var t=-this.__timeToLeft(e),i=this._slider.getRoot();i&&(this._currentLeft=t>0?0:Math.max(t,this._minLeft),i.css("left",this._currentLeft+"px")),this._dateLabel.setText(a(e).format(this._dateFormat))},startMarker:function(e){this._marker.show(),e||(e=6e4);var t=r.bind(function(){this._marker.getRoot().css("left",this.__timeToLeft((new Date).getTime())+"px")},this);t(),this._markerTimer||(this._markerTimer=setInterval(t,e))},stopMarker:function(){this._marker.hide(),clearInterval(this._markerTimer),this._markerTimer=null},_setupSlider:function(e,t){this._slider=new s({css:"wgt-programguide-timeline-slider",parent:e,autoNavigation:!0,forwardFocus:!0}),this.setOption("forwardFocus",this._slider);var i,n=0,r=this._timescale*this._ppm,o=this._startTime,l=a(o),c="",d={},u=6e4*this._timescale;d.width="width: "+r+"px;";for(var h=0;o<this._endTime;h++)d.position=0===h?"":"position: absolute;",d.left="left: "+n+"px;",i=l.format(this._timeFormat),c+='<div class="wgt-label wgt-programguide-timeline-time" style="clear: left; float: left;'+d.width+d.left+d.position+'">'+i+"</div>",n+=r,o+=u,l.add("m",this._timescale);this._slider.getRoot().setInnerHTML(c),this._sliderWidth=(this._endTime-this._startTime)/6e4*this._ppm,this._minLeft=-(this._sliderWidth-this._visibleWidth),this._slider.getRoot().css("width",n+"px")},__timeToLeft:function(e){return(e-this._startTime)/6e4*this._ppm},__leftToTime:function(e){return Math.round(e/this._ppm*6e4)+this._startTime}})}),define("css!storm/programguide/css/structure",[],function(){}),define("storm/ProgramGuide",["xdk-base/class","xdk-base/core","xdk-ui-grid/Grid","xdk-ax/Component","xdk-ax/Container","xdk-ax/data/LocalDatasource","xdk-ax/focusManager","xdk-ax/evt/type","xdk-base/device/vKey","xdk-ui-grid/gridStgy","xdk-ui-grid/boundedGridStgy","xdk-ui-basic/Layout","xdk-ui-basic/Button","xdk-ui-basic/Label","xdk-base/promise","xdk-base/util","tve/ext/ui/programguide/Row","tve/ext/ui/programguide/Timeline","tvedemo/helper/sMoment","xdk-ax/focusManager","css!./programguide/css/structure"],function(e,t,i,n,s,r,a,o,l,c,d,u,h,_,g,f,p,m,v,a){return e.create(i,{},{_epgRows:[],_programGuideTimeline:null,_tvListings:[],_windowStart:0,_windowEnd:0,_windowSize:0,_scrollPaneWidth:0,_upperBound:0,_lowerBound:0,_selectionInRow:null,_selectionTime:0,_lastFocusedProgramStart:0,_dateFormat:null,_timeFormat:null,_container:null,_arrows:[],init:function(e){e=e||{},e.rows=e.rows||5,e.cols=1,e.forwardFocus=!0,this._super(e),this._windowSize=e.windowSize||120,this._scrollPaneWidth=e.scrollPaneWidth||600,this._timescale=e.timescale||30,this._container=this.getChildren()[0],this._initArrows();this.setPrereadyStgy(c.BASIC_PREREADY_STGY),this.setCheckScrollableStgy(c.BASIC_CHECK_SCROLLABLE_STGY),this.setCheckSelectableStgy(f.bind(d.SCROLL_BOUNDARY_CHECK_SELECTABLE_STGY,this,0,0)),this.setDataMappingStgy(c.BASIC_DATA_MAPPING_STGY),this.setScrollEntranceStgy(f.bind(this._scrollEntranceStgy,this,!1)),this.setScrollShiftStgy(c.BASIC_SCROLL_SHIFT_STGY),this.setScrollExitStgy(c.BASIC_SCROLL_EXIT_STGY),this.setOnUpdateStgy(c.BASIC_ONUPDATE_STGY),this.setKeyNavigationStgy(f.bind(d.SCROLL_BOUNDARY_KEY_NAVIGATION_STGY,this,!1,0,0)),this.addEventListener(o.KEY,f.bind(this._onKey,this),!0),this.addEventListener(o.FOCUS,f.bind(this._onRowProgramFocused,this)),this.addClass("wgt-programguide"),this.getRoot().addEventListener("mousewheel",this.scrollFunc)},scrollFunc:function(e){var t=Math.max(-1,Math.min(1,e.wheelDelta||-e.detail)),i=document.createEvent("Event");i.initEvent("keydown",!0,!0),i.target=document,i.currentTarget=document,i.isSimulated=!0,1==t?(i.keyCode=38,i.keyCodeVal=38):(i.keyCode=40,i.keyCodeVal=40),document.dispatchEvent(i)},setProgramGuideDatasource:function(e){this.__programGuideDatasource=e},_updateEpgRowsLeft:function(e){var t=this,i=this.__programGuideDatasource,n=e.date,s=v(n.getTime()),a=1e3*s.hour(0).minute(0).second(0).millisecond(0).unix(),o=1e3*s.add("d",1).unix();return this._epgRows=[],this._upperBound=o-6e4*this._windowSize,this._lowerBound=a,this._selectionTime=this._lowerBound,this._lastFocusedProgramStart=0,this._setupTimeLabels(),this.setWindowPosition(e.windowPosition?e.windowPosition:this._lowerBound),i.getTotalRowNumber().then(function(e){for(var s,l,c,d=[],u=[],h=new r,_=0;_<e;_++)l=function(e){return i.getRowHeaderData(e).then(function(t){d[e]=d[e]||{},d[e].channel=t})}(_),s=function(e){return i.getProgramGuideCellData(e,n).then(function(t){d[e]=d[e]||{},d[e].tvListing=t})}(_),u.push(l),u.push(s);return g.all(u).then(function(){return c=function(e,t){var i=g.defer();return i.resolve({data:d,total:d.length}),i.promise},t._tvListings=d,t.setDisplayStgy(function(e){var i=e.tvListing;return new p({forwardFocus:!0,channel:e.channel,programs:i,scrollPaneWidth:t._scrollPaneWidth,windowSize:t._windowSize,startTime:a,endTime:o,windowStart:t._windowStart,selectionTime:t._selectionTime,displayProgramGuideRowHeaderStgy:t._rowHeaderDisplayStgy||null,displayProgramItemStgy:t._cellDisplayStgy||null})}),h.setDataLoader(c),t.setDatasource(h)})})},setWindowPosition:function(e){var t=this._windowStart<e;e<this._lowerBound?this._windowStart=this._lowerBound:e>this._upperBound?this._windowStart=this._upperBound:this._windowStart=e,this._windowEnd=this._windowStart+6e4*this._windowSize,t&&this._windowStart>this._selectionTime?this._selectionTime=this._windowStart:t||(this._selectionTime=Math.max(this._lastFocusedProgramStart,this._windowStart)),this._programGuideTimeline.updateTime(this._windowStart),this._updateEpgRowTimeAndLeft()},startMarker:function(e){this._programGuideTimeline.startMarker(e)},stopMarker:function(){this._programGuideTimeline.stopMarker()},getSelectedProgram:function(){return this._getSelectedRow().getSelection()},getSelectionStates:function(){var e=this._getSelectedRow(),t=e.getSelection(),i=this._tvListings[this._selectedDsIndex].channel,n=this._tvListings[this._selectedDsIndex].tvListing;return{channel:i,program:t,isFirstChannel:i===this._tvListings[0].channel,isLastChannel:i===this._tvListings[this._tvListings.length-1].channel,isFirstProgram:t===n[0],isLastProgram:t===n[n.length-1]}},setRowHeaderDisplayStgy:function(e){this._rowHeaderDisplayStgy=e},setCellDisplayStgy:function(e){this._cellDisplayStgy=e},_setupTimeLabels:function(){this._programGuideTimeline&&this.detach(this._programGuideTimeline),this._programGuideTimeline=new m({scrollPaneWidth:this._scrollPaneWidth,windowSize:this._windowSize,timescale:this._timescale,startTime:this._lowerBound,endTime:this._upperBound+6e4*this._windowSize,dateFormat:this._dateFormat,timeFormat:this._timeFormat}),this.attach(this._programGuideTimeline,s.PLACE_BEFORE,this._container)},_getSelectedRow:function(){return this._epgRows[this._selectedDsIndex]},_moveWindow:function(e){e?this.setWindowPosition(this._windowStart+6e4*this._windowSize):this.setWindowPosition(this._windowStart-6e4*this._windowSize)},_updateEpgRowsLeft:function(){for(var e in this._epgRows)this._epgRows[e].updateTime(this._windowStart)},_updateEpgRowSelectionTime:function(){for(var e in this._epgRows)this._epgRows[e].setSelectionTime(this._selectionTime)},_updateEpgRowTimeAndLeft:function(){for(var e in this._epgRows)this._epgRows[e].updateTime(this._windowStart),this._epgRows[e].setSelectionTime(this._selectionTime)},_scrollEntranceStgy:function(e,t,i,r,a){var o,l,c,d,u,h,_,f=a.gridComponents.slice(a.newRowsStart,a.newRowsStart+a.newRowsCount),p=a.newRowsCount,m=t.getChildren();if(m.length>0)if(i>0)for(o=0;o<i;o++)m[o].deinit();else for(_=m.length,o=_+i;o<_&&m[o];o++)m[o].deinit();var v,b=[];for(o=0;o<p;o++){for(d=[],l=0;l<r.cols&&(f[o]&&f[o][l]);l++)d.push(f[o][l]);if(f[o]){v=f[o][0];for(var S=!1,y=JSON.stringify(v.getChannel()),E=0,k=this._epgRows.length;E<k;E++)if(y===JSON.stringify(this._epgRows[E].getChannel())){this._epgRows[E]=v,S=!0;break}S||(i>=0?this._epgRows.push(v):this._epgRows.unshift(v)),v.updateTime(this._windowStart)}c=new s({css:e?"wgt-grid-row-v":"wgt-grid-row-h",children:d}),i<0&&r.gridComponents&&r.gridComponents[0]?(u=n.PLACE_BEFORE,h=r.gridComponents[0][0].getParent()):(u=n.PLACE_APPEND,h=null),t.attach(c,u,h),b.push(v.onReady)}return g.all(b)},_initArrows:function(){for(var e=0;e<4;e++)this._arrows[e]=new h({css:"wgt-programguide-arrow"});this._arrows[0].addClass("top"),this._arrows[1].addClass("right"),this._arrows[2].addClass("bottom"),this._arrows[3].addClass("left"),this.attach(this._arrows[0],s.PLACE_BEFORE,this._container),this.attach(this._arrows[3],s.PLACE_BEFORE,this._container),this.attach(this._arrows[1],s.PLACE_APPEND),this.attach(this._arrows[2],s.PLACE_APPEND),this._arrows[1].addEventListener(o.CLICK,f.bind(function(){this._moveWindow(!0)},this),!0),this._arrows[3].addEventListener(o.CLICK,f.bind(function(){this._moveWindow(!1)},this),!0),this._arrows[0].addEventListener(o.CLICK,f.bind(function(){a.focus(this._epgRows[this._firstSlotDsIndex]);var e=document.createEvent("Event");e.initEvent("keydown",!0,!0),e.target=document,e.currentTarget=document,e.isSimulated=!0,e.keyCode=38,e.keyCodeVal=38,document.dispatchEvent(e)},this),!0),this._arrows[2].addEventListener(o.CLICK,f.bind(function(){a.focus(this._epgRows[this._firstSlotDsIndex+4]);var e=document.createEvent("Event");e.initEvent("keydown",!0,!0),e.target=document,e.currentTarget=document,e.isSimulated=!0,e.keyCode=40,e.keyCodeVal=40,document.dispatchEvent(e)},this),!0),this.addEventListener(o.FOCUS,this._updateArrows)},_updateArrows:function(){var e=this.getSelectionStates();e.isFirstChannel?this._arrows[0].hide():this._arrows[0].show(),e.isLastChannel?this._arrows[2].hide():this._arrows[2].show(),e.isFirstProgram?this._arrows[3].hide():this._arrows[3].show(),e.isLastProgram?this._arrows[1].hide():this._arrows[1].show()},_onKey:function(e){var t;switch(e.id){case l.LEFT.id:if(t=this._epgRows[this._selectedDsIndex],this._selectionInRow=t.getSelection(),this._selectionTime=t.getSelectionTime(),this._windowStart>this._lowerBound){var i=this._selectionInRow.startTime;if(i<this._windowStart)return this._moveWindow(!1),!1;if(i===this._windowStart)return this._moveWindow(!1),!0}break;case l.RIGHT.id:if(t=this._epgRows[this._selectedDsIndex],this._selectionInRow=t.getSelection(),this._selectionTime=t.getSelectionTime(),this._windowStart<this._upperBound){var n=this._selectionInRow.endTime;if(n>this._windowEnd)return this._moveWindow(!0),!1;if(n===this._windowEnd)return this._moveWindow(!0),!0}}},_onRowProgramFocused:function(e){if("wgt-programguide-arrow"!==e.target._opts.css){var t=this._getSelectedRow(),i=t.getSelection();this._updateArrows(),this._selectionTime=Math.max(t.getSelectionTime(),this._windowStart),this._lastFocusedProgramStart=i.startTime,this._updateEpgRowSelectionTime()}}})}),define("tvedemo/wgt/ProgramGuideTimeline",["xdk-base/class","xdk-base/util","xdk-base/console","tve/ext/ui/programguide/Timeline","tve/sServiceHolder"],function(e,t,i,n,s){"use strict";return e.create(n,{},{init:function(e){i.log("EPG timeline sub-classed to use server date/time"),this._super(e)},startMarker:function(e){this._marker.show(),e||(e=6e4);var i=t.bind(function(){s.getDateTimeService().getServerDateTime().then(t.bind(function(e){this._marker.getRoot().css("left",this.__timeToLeft(e.getTime())+"px")},this))},this);i(),this._markerTimer||(this._markerTimer=setInterval(i,e))}})}),define("css!tve/ext/ui/programguide/css/style",[],function(){}),define("tvedemo/wgt/ProgramGuide",["xdk-base/class","storm/ProgramGuide","xdk-ax/evt/type","xdk-base/util","xdk-base/console","xdk-ui-basic/Label","xdk-ax/Container","xdk-ui-grid/boundedGridStgy","tvedemo/wgt/ProgramGuideTimeline","tvedemo/wgt/Loading","lib/moment","xdk-ax/data/LocalDatasource","xdk-base/promise","tve/ext/ui/programguide/Row","css!tve/ext/ui/programguide/css/style"],function(e,t,i,n,s,r,a,o,l,c,d,u,h,_){"use strict";return e.create(t,{},{init:function(e){e=e||{},e.frontBoundary=e.frontBoundary||0,e.endBoundary=e.endBoundary||0,this._dateFormat=e.dateFormat||"",this._timeFormat=e.timeFormat||"",this._super(e),this.setCheckSelectableStgy(n.bind(o.SCROLL_BOUNDARY_CHECK_SELECTABLE_STGY,this,e.frontBoundary,e.endBoundary)),this.setKeyNavigationStgy(n.bind(o.SCROLL_BOUNDARY_KEY_NAVIGATION_STGY,this,!1,e.frontBoundary,e.endBoundary)),this.addClass("transparent pg-custom"),this.__attachedToDom=n.defer().then(n.bind(function(){this.removeClass("transparent"),this.removeEventListener(i.ATTACHED_TO_DOM,this.__attachedToDom)},this)),this.addEventListener(i.ATTACHED_TO_DOM,this.__attachedToDom),this._epgBotGradient=new a({css:"epg-bottom-gradient",parent:this});var t=this._scrollEntranceStgy;this.setScrollEntranceStgy(n.bind(function(e,i,s,r){return t.apply(this,arguments).then(n.bind(function(){r.lastSlotDsIndex<this._tvListings.length-1?this._epgBotGradient.show():this._epgBotGradient.hide()},this))},this))},updateEpg:function(e){var t=this,i=this.__programGuideDatasource,n=e.date,s=d(n.getTime()),r=1e3*s.hour(0).minute(0).second(0).millisecond(0).unix(),a=1e3*s.add("d",1).unix();return this._epgRows=[],this._upperBound=a-6e4*this._windowSize,this._lowerBound=r,this._selectionTime=e.selectionTime||this._lowerBound,this._lastFocusedProgramStart=0,this._setupTimeLabels(),this.setWindowPosition(e.windowPosition?e.windowPosition:this._lowerBound),i.getTotalRowNumber().then(function(e){for(var s,o,l,c=[],d=[],g=new u,f=0;f<e;f++)o=function(e){return i.getRowHeaderData(e).then(function(t){c[e]=c[e]||{},c[e].channel=t})}(f),s=function(e){return i.getProgramGuideCellData(e,n).then(function(t){c[e]=c[e]||{},c[e].tvListing=t})}(f),d.push(o),d.push(s);return h.all(d).then(function(){return l=function(e,t){var i=h.defer();return i.resolve({data:c,total:c.length}),i.promise},t._tvListings=c,t.setDisplayStgy(function(e){var i=e.tvListing;return new _({forwardFocus:!0,channel:e.channel,programs:i,scrollPaneWidth:t._scrollPaneWidth,windowSize:t._windowSize,startTime:r,endTime:a,windowStart:t._windowStart,selectionTime:t._selectionTime,displayProgramGuideRowHeaderStgy:t._rowHeaderDisplayStgy||null,displayProgramItemStgy:t._cellDisplayStgy||null})}),g.setDataLoader(l),t.setDatasource(g)})})},setWindowPosition:function(e){var t=this._windowStart<e;e<this._lowerBound?this._windowStart=this._lowerBound:e>this._upperBound?this._windowStart=this._upperBound:this._windowStart=e,this._windowEnd=this._windowStart+6e4*this._windowSize,(this._selectionTime<this._windowStart||this._selectionTime>this._windowEnd)&&(t&&this._windowStart>this._selectionTime?this._selectionTime=this._windowStart:t||(this._selectionTime=Math.max(this._lastFocusedProgramStart,this._windowStart))),this._programGuideTimeline.updateTime(this._windowStart),this._updateEpgRowTimeAndLeft()},_setupTimeLabels:function(){c.open(),this._programGuideTimeline&&this.detach(this._programGuideTimeline),this._programGuideTimeline=new l({scrollPaneWidth:this._scrollPaneWidth,windowSize:this._windowSize,timescale:this._timescale,startTime:this._lowerBound,endTime:this._upperBound+6e4*this._windowSize,dateFormat:this._dateFormat,timeFormat:this._timeFormat}),this.attach(this._programGuideTimeline,a.PLACE_BEFORE,this._container)},getSelectionStates:function(){var e=this._getSelectedRow(),t=e&&e.getSelection(),i=this._tvListings[this._selectedDsIndex]&&this._tvListings[this._selectedDsIndex].channel,n=this._tvListings[this._selectedDsIndex]&&this._tvListings[this._selectedDsIndex].tvListing;return{channel:i,program:t,isFirstChannel:this._tvListings[0]&&i===this._tvListings[0].channel,isLastChannel:this._tvListings[this._tvListings.length-1]&&i===this._tvListings[this._tvListings.length-1].channel,isFirstProgram:n&&t===n[0],isLastProgram:n&&t===n[n.length-1]}},_updateArrows:function(){this._super(),this.getSelectionStates().isLastChannel&&this._epgBotGradient.hide()}})}),define("tvedemo/tmpl/programGuide",["xdk-ax/Container","xdk-ui-basic/Layout","xdk-ui-basic/Label","tvedemo/wgt/ProgramGuide","tvedemo/wgt/Submenu","storm/wgt/Image","storm/mgr/sLanguageManager","storm/mgr/sAppConfigManager","xdk-base/device"],function(e,t,i,n,s,r,a,o,l){"use strict";return function(){return{klass:t,css:"program-guide-view",alignment:t.VERTICAL,autoNavigation:!1,children:[{klass:e,css:"program-detail-container",children:[{klass:e,css:"thumbnail-wrapper",children:[{klass:r,id:"thumbnail",css:"thumbnail",placeHolderPromise:o.getPlaceholderLandscape},{klass:e,css:"thumbnail-overlay hidden",id:"thumbnail-overlay",children:[{klass:i,text:a.getString("Epg.blackoutShort"),css:"thumbnail-unavailable"}]}]},{klass:i,id:"title",css:"title"},{klass:e,css:"packageNeeded hidden",id:"packageNeeded",children:[{klass:r,id:"packageNeededLogo",css:"packageNeededLogo"},{klass:i,id:"packageNeededLabel",text:"",css:"packageNeededLabel"}]},{klass:i,id:"metadata",css:"metadata"},{klass:i,id:"description",css:"description"}]},{klass:i,text:a.getString("Global.Global_buttonBack_button"),css:"program-guide-back"},{klass:n,id:"epgGrid",scrollPaneWidth:936,windowSize:120,timescale:30,rows:6,nextUp:"submenu",endBoundary:1,timeFormat:a.getString("ui.format.epgEventTime"),dateFormat:a.getString("ui.format.epgShortDate")}]}}}),define("tvedemo/helper/CentralEuropeanTime",[],function(){return{getTimestampMillis:function(){var e=new Date,t=e.getTime(),i=e.getUTCFullYear();if(i<=1998&&i>2099)return!1;var n=31-(5*i/4+4)%7,s=new Date(Date.UTC(i,2,n,1,0,0)),r=31-(5*i/4+1)%7,a=new Date(Date.UTC(i,9,r,1,0,0)),o=0;return e>s&&e<a&&(o=36e5),t+o},getDate:function(){return(new Date).setTime(this.getTimestampMillis())}}}),define("tvedemo/ctrl/ProgramGuide",["xdk-base/ax","tvedemo/ctrl/RoutableController","xdk-ax/mvc/view","tvedemo/tmpl/programGuide","xdk-ax/evt/type","xdk-ax/focusManager","xdk-base/device/vKey","xdk-ui-basic/Image","xdk-base/promise","xdk-ax/mediator","tve/mgr/sLinearManager","tvedemo/mgr/sEndUserManager","tvedemo/wgt/TextSelectionListDialog","tvedemo/helper/dialogHelper","tvedemo/helper/sMoment","tvedemo/helper/CentralEuropeanTime","storm/mgr/sAppConfigManager","tvedemo/wgt/Loading","xdk-ui-basic/Button","tvedemo/wgt/ChannelLogo","xdk-base/console","xdk-ax/Container","tvedemo/mgr/sNavigationManager","storm/mgr/sLanguageManager","tve/sServiceHolder","tvedemo/model/ContextBuilder","xdk-ax/mvc/AppRoot"],function(e,t,i,n,s,r,a,o,l,c,d,u,h,_,g,f,p,m,v,b,S,y,E,k,C,T,x){"use strict";var I,w=x.singleton(),L=function(e){for(var t=1e3*g(e).startOf("day").unix();t+72e5<e;)t+=72e5;return t};return e.klass.create(t,{getDefaultState:function(){return{__forceReload:!0}}},{_title:null,_metadata:null,_thumbnail:null,_description:null,_submenuItems:[],_epgGrid:null,_currentDate:void 0,_currentCategoryId:null,_availableDays:1,init:function(){this._super(),this.setView(i.render(n))},setup:function(t){var i=this.getView();if(this._title=i.find("title"),this._metadata=i.find("metadata"),this._thumbnail=i.find("thumbnail"),this._thumbnailOverlay=i.find("thumbnail-overlay"),this._description=i.find("description"),this._epgGrid=i.find("epgGrid"),this._packageNeeded=i.find("packageNeeded"),this._packageNeededLabel=i.find("packageNeededLabel"),this._packageNeededLogo=i.find("packageNeededLogo"),this.__boundKeyHandler=e.util.bind(this._keyHandler,this),this.__epgFocus=e.util.bind(this._epgFocus,this),this.__epgClick=e.util.bind(this._epgClick,this),this.__epgBlur=e.util.bind(this._epgBlur,this),i.addEventListener(s.KEY,this.__boundKeyHandler),this._epgGrid.addEventListener(s.FOCUS,this.__epgFocus),this._epgGrid.addEventListener(s.CLICK,this.__epgClick),this._epgGrid.addEventListener(s.BLUR,this.__epgBlur),this._epgGrid.setRowHeaderDisplayStgy(function(e){var t=new y({css:"channel-logo-wrapper",children:[new b({css:"channel-logo",src:e.logo})]});t.getRoot().getHTMLElement();return t}),this._epgGrid.setCellDisplayStgy(function(e){return new v({css:"wgt-programguide-row-program "+(e.get("epgBlackout")?"program-blackout":""),text:e.get("title"),focusable:!0,clickable:!0})}),!t.historyBack){this._submenuItems=[],i.hide();var n,r=e.util.bind(function(t){return e.util.bind(function(){return this.getView()._parent?(this.saveMenuState(),this.selectCategoryById(t)):void c.publish("navigate",{path:"Main/ProgramGuide",state:{outerNavigation:{id:t,submenu:this._submenuItems}}})},this)},this);if(t.outerNavigation){this._submenuItems=t.outerNavigation.submenu;for(var a=this._submenuItems.length-1;a>=0;a--)this._submenuItems[a].action=r(this._submenuItems[a].id);n=this.selectCategoryById(t.outerNavigation.id)}n=n||C.getDateTimeService().getServerDateTime().then(e.util.bind(function(t){var i=g(t);return this._submenuItems.push({id:"today",text:k.getString("Epg.LabelToday_SmartTV"),time:1e3*i.unix(),action:r("today")}),i.add("d",1),this._submenuItems.push({id:"tomorrow",text:k.getString("Epg.LabelTomorrow_SmartTV"),time:1e3*i.unix(),action:r("tomorrow")}),p.getEpgDaysForwards().then(e.util.bind(function(e){this._availableDays=e;for(var t=1;t<this._availableDays;t++)i.add("d",1),this._submenuItems.push({id:this._availableDays+2+t,text:i.format(k.getString("ui.format.epgMenuDate")),time:1e3*i.unix(),action:r(this._availableDays+2+t)});return E.insertSubmenu(this._submenuItems)},this))},this));var o=C.getDateTimeService().getServerDateTime().then(e.util.bind(function(e){this._currentDate=e.getTime(),I=g(e).startOf("day")},this));t.setupPending=l.all([n,o]),this.trackLevel(2,void 0,!0)}},selectDate:function(e,t){var i=1e3*g(e).startOf("day").unix();if(i!==this._currentDate){this._currentDate=i;var n={};return t&&(n.windowPosition=t),this.updateEpg(n)}},nextDay:function(){if(this._canNext())return this.selectDate(this._currentDate+864e5)},prevDay:function(){if(this._canPrev())return this.selectDate(this._currentDate-864e5)},selectCategoryById:function(t){this.getView().show();for(var i=this._submenuItems.length-1;i>=0;i--)if(this._submenuItems[i].id===t)return this.selectSubmenuByIndex(i);throw e.core.createException("Invalid Param","Cannot find item *"+t+"* in the submenu.")},selectSubmenuByIndex:function(e){return this._currentCategoryId=this._submenuItems[e].id,this._currentDate=this._submenuItems[e].time,this.selectDate(this._currentDate,L(this._currentDate))},updateEpg:function(t){return m.open(),l.all([this.__setPromisesBasedOnCategory(),C.getDateTimeService().getServerDateTime()]).then(e.util.bind(function(i){var n={date:new Date(this._currentDate),selectionTime:i[1].getTime()},s=e.util.bind(function(t){return this._epgGrid.setProgramGuideDatasource(t),this._epgGrid.updateEpg(n).then(e.util.bind(function(){this._epgGrid.startMarker(6e4),r.focus(this._epgGrid)},this))},this);return e.util.isObject(t)&&e.util.extend(n,t),d.getProgramGuideDatasource().then(s)},this)).complete(function(){m.close()})},_highlightSubmenuByCategoryId:function(e){for(var t=this._submenuItems.length-1;t>=0;t--)if(this._submenuItems[t].id===e)return this.getView().find("submenu").select(t)},_canPrev:function(){return g(this._currentDate).startOf("day").isAfter(I)},_canNext:function(){return g(this._currentDate).startOf("day").subtract("d",this._availableDays-1).isBefore(I)},_focusToTopMenu:function(){var e=w.getView().find("list-sub-menu");r.focus(e)},__setPromisesBasedOnCategory:function(){var e=l.defer();return e.resolve(),e.promise},_keyHandler:function(e){switch(e.id){case a.BACK.id:return this._focusToTopMenu(),!1}return!0},_epgClick:function(){var e=this._epgGrid.getSelectionStates();if(0!==e.program.id){var t,i=new T;t=i.setData({channelId:e.channel.id,eventId:e.program.id}).build(),c.publish("navigate",{path:"Main/EpgEvent",state:{context:t}})}},_epgFocus:function(){var t=this._epgGrid.getSelectionStates(),i=t.program&&t.program.data,n=i&&i.get("id"),s=t.channel&&t.channel.mobilepc;i&&!e.util.isUndefined(n)&&s&&n!==this._program_id_last_shown&&(this._program_id_last_shown=n,this._title.setText(i.get("title")),this._metadata.setText(i.get("inlineMetadata")),this._description.setText(i.get("description")),this._thumbnailOverlay[i.get("epgBlackout")?"removeClass":"addClass"]("hidden"),i.set("packageCode",s),this._packageNeeded.addClass("hidden"),e.util.clearDelay("epgFocusDelay"),e.util.delay(.5,"epgFocusDelay").then(e.util.bind(function(){var r=[p.getPlaceholderLandscape(),d.getProgramById(n,t.channel.id),u.checkUserPrivileges(i)];l.all(r).then(e.util.bind(function(t,i){var n=i[1],r=i[0],a=i[2];if(this._program_id_last_shown===t){var o=n.get("title"),l=n.get("inlineMetadata"),c=n.get("description"),u=n.get("images"),h=e.util.isArray(u)&&u.length&&u[0].file;if(o&&this._title.setText(o),l&&this._metadata.setText(l),c&&this._description.setText(c),h?d.constructCMSUrlPromise(h).then(e.util.bind(function(e){this._thumbnail.setSrc(e)},this)):this._thumbnail.setSrc(r),a)this._packageNeeded.addClass("hidden");else{p.getPackageImageForCode(s).then(e.util.bind(function(e){this._packageNeededLogo.setSrc(e),this._packageNeededLogo.removeClass("hidden")},this),e.util.bind(function(){this._packageNeededLogo.addClass("hidden")},this));var _="DetailPage.DetailPage_MissingEntitlement_"+s,g=k.getString(_);g===_&&(g=k.getString("DetailPage.DetailPage_MissingEntitlement_OTHER")),this._packageNeededLabel.setText(g),this._packageNeeded.removeClass("hidden")}}},this,n))},this)))},_epgBlur:function(){},reset:function(){this.getView().removeEventListener(s.KEY,this.__boundKeyHandler),this._epgGrid.removeEventListener(s.FOCUS,this.__epgFocus),this._epgGrid.removeEventListener(s.CLICK,this.__epgClick),this._epgGrid.removeEventListener(s.BLUR,this.__epgBlur)}})}),define("tvedemo/tmpl/recentlyWatched",["xdk-ui-basic/Layout","xdk-ui-basic/Label","tvedemo/wgt/Submenu","tvedemo/ext/ui/grid/LoopedGrid","storm/mgr/sLanguageManager"],function(e,t,i,n,s){"use strict";return function(){return{klass:e,forwardFocus:!0,alignment:e.VERTICAL,css:"subcontrollerPage recentlyWatched",children:[{klass:n,forwardFocus:!0,alignment:n.VERTICAL,id:"#recentlyWatchedGrid",rows:3,cols:2,scrollFrontBoundary:1,scrollEndBoundary:1},{klass:t,id:"empty-list-label",text:s.getString("Global.Global_NoResults"),css:"empty-list-label hidden"}]}}}),define("tvedemo/ctrl/RecentlyWatched",["xdk-base/ax","xdk-base/promise","tvedemo/ctrl/RoutableController","xdk-ax/mvc/view","tvedemo/tmpl/recentlyWatched","xdk-ax/focusManager","xdk-ax/evt/type","tvedemo/helper/dialogHelper","xdk-base/util","tvedemo/mgr/sEndUserManager","xdk-base/console","tvedemo/wgt/ImageButton","tvedemo/wgt/Progressbar","xdk-ax/Container","xdk-ui-basic/Label","storm/helper/util","storm/mgr/sAppConfigManager","tvedemo/mgr/sHistoryManager","storm/mgr/sLanguageManager","xdk-ax/mediator","tvedemo/helper/sPlaybackHelper"],function(e,t,i,n,s,r,a,o,l,c,d,u,h,_,g,f,p,m,v,b,S){"use strict";var y={MOVIE:"Film",EPISODE:"Episode",SERIES:"Series",SPORT_EVENT:"Sport",SPORT_NEWS:"sportsNews"};return e.klass.create(i,{getDefaultState:function(){return{}}},{init:function(){this._super(),this.setView(n.render(s))},getState:function(){return this._super()},setup:function(e){if(this._super(e),!0===e.historyBack&&!c.getLoginStatus())return void m.back();this.currentView=this.getView(),this.recentlyWatchedGrid=this.currentView.find("recentlyWatchedGrid"),e.setupPending=this.getRecentlyWatchList(),this.trackLevel(2,void 0,!0)},getRecentlyWatchList:function(){return c.getRecentlyWatched().then(l.bind(function(e){e&&l.isArray(e)&&e.length?this.setupGrid(this.recentlyWatchedGrid,e).then(l.bind(function(){this.recentlyWatchedGrid.select(0,1),r.focus(this.recentlyWatchedGrid)},this)):this.currentView.find("empty-list-label").removeClass("hidden")},this)).fail(function(e){d.info("Error while fetching recently watched ",e),o.error({reason:v.getString("Errormessages.Errormessages_labelErrorMessage"),buttonText:v.getString("Global.Global_buttonBack_button")})})},setupGrid:function(e,t){var i=f.arrayToDs(t),n=new Date,s=this;return e.setDisplayStgy(function(e){var t=new _({forwardFocus:!0}),i=new u({parent:t,src:e.get("imageUrl"),placeHolderPromise:p.getPlaceholderLandscape}),r=new _({parent:i,css:"textContainer"}),o=new h({parent:i}),c=(new g({parent:r,text:e.get("title"),css:"text"}),new Date(e.get("startDate"))),d=new Date(e.get("endDate"));if(c<n&&n<d&&("sg"===e._attrs.catalog&&"st"===e._attrs.catalog||!1!==e._attrs.contentTargeting)||(i.addClass("notAvailable"),new g({parent:i,
text:"this content is currently expired",css:"contentNoAvailable"})),i.addEventListener(a.CLICK,l.bind(s._gridClickHandler,s,e)),e){var f=e.get("percentage"),m=e.get("watchedFlag");f&&m?(o.removepProgressAndIcon(),o.update(f,m),o.show()):o.hide()}return t}),e.setDatasource(i)},_gridClickHandler:function(e){var t=e.get("assetId"),i=e.get("catalog"),n=e.get("assetType");return n===y.MOVIE?b.publish("navigate",{path:"Main/Movie",state:{assetId:t,catalog:i}}):n===y.EPISODE?b.publish("navigate",{path:"Main/Episode",state:{selectedEpisodeId:t,catalog:i}}):n===y.SERIES?b.publish("navigate",{path:"Main/TVShow",state:{serieId:t,catalog:i}}):n===y.SPORT_EVENT?b.publish("navigate",{path:"Main/Sport",state:{assetId:t,catalog:i}}):d.warn("Clicked on unexpected type "+n),!1},reset:function(){this._super()}})}),define("tvedemo/tmpl/searchListing",["storm/mgr/sLanguageManager","tvedemo/ext/ui/grid/LoopedGrid","xdk-ui-basic/Layout","xdk-ax/Container","xdk-ui-basic/Label"],function(e,t,i,n,s){"use strict";return function(){return{klass:i,forwardFocus:!0,alignment:i.VERTICAL,css:"subcontrollerPage search-listing",children:[{klass:s,id:"skyGoLabel",css:"sky-go-label"},{klass:n,id:"searchGridContainer",css:"search-grid-container",children:[]},{klass:s,id:"errorMsgGo",css:"error-msg",text:e.getString("Global.Global_NoResults")}]}}}),define("tvedemo/ctrl/SearchListing",["tvedemo/ctrl/RoutableController","storm/mgr/sAppConfigManager","xdk-ax/data/LocalDatasource","tvedemo/tmpl/searchListing","storm/mgr/sLanguageManager","tvedemo/wgt/ImageButton","tve/mgr/sLinearManager","xdk-ax/focusManager","storm/helper/util","xdk-ax/Container","xdk-ui-basic/Label","xdk-ax/mediator","xdk-ax/evt/type","xdk-ax/mvc/view","xdk-base/console","xdk-base/promise","xdk-base/class","xdk-base/util","tvedemo/wgt/BasicGrid","tvedemo/ext/ui/grid/LoopedGrid"],function(e,t,i,n,s,r,a,o,l,c,d,u,h,_,g,f,p,m,v,b){"use strict";return p.create(e,{getDefaultState:function(){return{keyword:null}}},{init:function(){this._super(),this.setView(_.render(n))},getState:function(){return m.isObject(this.__state)?(this.__state.keyword=this.context.keyword,this.__state):{keyword:this.context.keyword}},setup:function(e){if(this.context=e||{},this._skyGoLabel=this.getView().find("skyGoLabel"),this._gridContainer=this.getView().find("searchGridContainer"),this._assetGridHandlerRef=m.bind(this._assetGridHandler,this),!0===e.historyBack)return this._skyGoGrid.addEventListener(h.CLICK,this._assetGridHandlerRef),void o.focus(this.getView());this.getView().find("errorMsgGo").hide(),e.setupPending=this._setupGrid().then(m.bind(function(e){Error.prototype.isPrototypeOf(e[0])?this.getView().find("errorMsgGo").show():o.focus(this._skyGoGrid)},this)),this.trackLevel(1,"SUCHE")},_setupGrid:function(){var e=this.context.keyword;return e&&e.length?l.allPromises([this._setupAssetGrid(e)]):(g.error("Keyword is empty"),f.reject())},_createAssetGrid:function(e){return this._skyGoGrid=e<7?new v({forwardFocus:!0,alignment:v.VERTICAL,id:"skyGoGrid",css:"asset-grid",rows:2,cols:Math.ceil(e/2)}):new b({forwardFocus:!0,alignment:b.VERTICAL,id:"skyGoGrid",css:"asset-grid",rows:3,cols:2,scrollFrontBoundary:1,scrollEndBoundary:1}),this._gridContainer.attach(this._skyGoGrid),this._skyGoGrid.addEventListener(h.CLICK,this._assetGridHandlerRef),this._skyGoGrid},_setupAssetGrid:function(e){return a.getSearchResults(e,"sg").then(m.bind(function(i){this._skyGoLabel.setText(s.getString("Search.Search_GoHL",{"search term":e,"amounts results":i.length}));var n=this._createAssetGrid(i.length);n.setDisplayStgy(function(e){var i=new c({forwardFocus:!0}),n=new r({parent:i,placeHolderPromise:t.getPlaceholderLandscape}),s=new c({parent:n,css:"textContainer"});new d({parent:s,text:e.title,css:"text"});return a.constructCMSUrlPromise(e.picture).then(function(e){n.setSrc(e)}),i});var o=this._setupSkyGoDatasource(i);return n.setDatasource(o).then(m.bind(function(){n.select(0)},this))},this))},_setupSkyGoDatasource:function(e){var t=new i;return t.setDataLoader(m.bind(function(){return e.length?f.resolve({data:e,total:e.length}):f.reject("skyGoGrid has empty data")},this)),t},_assetGridHandler:function(e){var t;switch(e.target.isDescendantOf(this._skyGoGrid)&&(t=this._skyGoGrid.getSelectedData()),t.contentType){case"Sport":u.publish("navigate",{path:"Main/Sport",state:{assetId:t.id,catalog:t.catalog}});break;case"Film":u.publish("navigate",{path:"Main/Movie",state:{assetId:t.id,catalog:t.catalog}});break;case"Episode":u.publish("navigate",{path:"Main/Episode",state:{selectedEpisodeId:t.id,catalog:t.catalog}})}return!1},reset:function(){this._skyGoGrid.removeEventListener(h.CLICK,this._assetGridHandlerRef),this._super()}})}),define("tvedemo/tmpl/sport",["xdk-ui-basic/Layout","xdk-ui-basic/Label","tvedemo/wgt/AssetGrid","storm/wgt/Image","xdk-ax/Container","tvedemo/wgt/ScrollLabel","xdk-ui-basic/Button","tvedemo/wgt/ImageButton","storm/mgr/sAppConfigManager"],function(e,t,i,n,s,r,a,o,l){return function(){return{klass:e,alignment:e.VERTICAL,id:"#sport",children:[{klass:e,alignment:e.VERTICAL,children:[{klass:e,id:"#upContainer",children:[{klass:n,id:"#thumbnail",placeHolderPromise:l.getPlaceholderLandscape},{klass:e,id:"#blackoutMessageContainer",children:[{klass:t,id:"#blackoutMessage"}]},{klass:s,css:"informationContainer",children:[{klass:t,id:"#title"},{klass:e,id:"#metaDataContainer",alignment:e.HORIZONTAL},{klass:n,id:"#channelLogo"},{klass:s,id:"missingPackage",css:"missingPackage",children:[{klass:n,id:"missingPackageLogo",css:"missingPackageLogo"},{klass:t,id:"missingPackageText",css:"missingPackageText"}]}]}]},{klass:e,alignment:e.HORIZONTAL,id:"#videoButtonContainer",children:[{klass:o,id:"sportTuneIn",text:"",nextRight:"detailDescription"},{klass:o,id:"sportStartFromVod",text:"",nextRight:"detailDescription",nextLeft:"sportStartFromVod"},{klass:o,id:"addToWatchlist",text:"",nextRight:"detailDescription",nextLeft:"addToWatchlist"}]},{klass:r,id:"detailDescription",scrollStep:72,nextLeft:"videoButtonContainer",nextUp:"header",nextDown:"detailDescription"}]}]}}}),define("tvedemo/ctrl/Sport",["xdk-base/ax","xdk-base/class","xdk-ax/mvc/view","tvedemo/tmpl/sport","xdk-ax/evt/type","xdk-ax/focusManager","xdk-base/device/vKey","xdk-base/util","xdk-ax/mediator","tvedemo/wgt/TextSelectionListDialog","xdk-base/promise","xdk-ui-basic/Label","tvedemo/helper/sMoment","tvedemo/mgr/sEndUserManager","tvedemo/mgr/sHistoryManager","tvedemo/helper/dialogHelper","tvedemo/wgt/AlertDialog","storm/mgr/sAppConfigManager","xdk-base/console","storm/mgr/sLanguageManager","tvedemo/mgr/sAssetManager","tvedemo/ctrl/DetailsBase","storm/helper/util","tvedemo/wgt/Loading"],function(e,t,i,n,s,r,a,o,l,c,d,u,h,_,g,f,p,m,v,b,S,y,E,k){"use strict";return t.create(y,{getDefaultState:function(){return{}}},{__asset:null,init:function(){this._super(),this.setView(i.render(n))},setup:function(e){if(this._super(e),this.setupButtons(),e.historyBack)return void this.updateDetailInformation(this.__asset);e.setupPending=this.setupDetailsInformation(e.assetId,e.catalog)},setupButtons:function(){var e=this.getView(),t=e.find("sportTuneIn"),i=e.find("sportStartFromVod"),n=e.find("addToWatchlist");this.__tuneInRef=o.bind(function(){t.isDisabled()||this.__tuneIn(this.__asset)},this),this.__watchSportRef=o.bind(function(){if(!i.isDisabled()){this.__asset.get("live")?E.isOnAir(this.__asset.get("onAir")).then(o.bind(function(e){e?this.__watchVod(this.__asset):f.error({title:b.getString("Sport.Sport_Error_TecEvent_not_ongoingTitle"),reason:b.getString("Sport.Sport_Error_TecEvent_not_ongoingMessage"),buttonText:b.getString("Global.Global_Continue")})},this)):this.__watchVod(this.__asset)}},this),this.__addToWatchlistRef=o.bind(function(){this.__updateWatchList({remove:!!this.__detailInformation.isInWatchlist,add:!this.__detailInformation.isInWatchlist,catalog:this.__asset.get("catalog"),assetId:this.__asset.get("id"),assetType:this.__asset.get("type")}).then(o.bind(function(e){e.added?this.__detailInformation.isInWatchlist=!0:e.removed&&(this.__detailInformation.isInWatchlist=!1),this.updateButtons({isBlackedOut:this.__detailInformation.isBlackedOut,channelIsPermitted:this.__detailInformation.channelIsPermitted,channelIsPlayable:this.__detailInformation.channelIsPlayable,userHasPrivilegeToWatchChannel:this.__detailInformation.userHasPrivilegeToWatchChannel,userHasPrivilegeToWatchVod:this.__detailInformation.userHasPrivilegeToWatchVod,isInWatchlist:this.__detailInformation.isInWatchlist,userIsLoggedIn:this.checkIfUserIsLoggedIn(),vodIsPlayable:this.__assetIsPlayable(this.__asset)})},this))},this),t.addEventListener(s.CLICK,this.__tuneInRef),i.addEventListener(s.CLICK,this.__watchSportRef),n.addEventListener(s.CLICK,this.__addToWatchlistRef)},setupDetailsInformation:function(t,i){var n;return t&&i?(n=S.getSportAssetById(t,i),n.then(o.bind(function(e){this.updateDetailInformation(e)},this)).fail(function(){o.defer().then(function(){f.error({reason:b.getString("Global.Global_NoResults"),closeAction:o.bind(g.back,g),buttonText:b.getString("Global.Global_buttonBack_button")})})})):n=e.promise.reject().fail(function(){o.defer().then(function(){f.error({reason:b.getString("Global.Global_NoResults"),closeAction:o.bind(g.back,g),buttonText:b.getString("Global.Global_buttonBack_button")})})})},updateDetailInformation:function(e){var t=e.get("channel");t&&(v.warn("Sport detail page doesn't expect an associated channel ("+t+")"),t=null),k.open(),d.all([t?this.__checkIfChannelIsPermitted(t):d.resolve(!1),t?this.__checkIfChannelIsPlayable(t):d.resolve(!1),t?this.__checkUserPrivileges(t):d.resolve(!1),this.__checkUserPrivileges(e),this.__checkIfAssetIsPresentInWatchlist(e)]).then(o.bind(function(t){var i=t[0],n=t[1],s=t[2],r=t[3],a=t[4];t[5];this.__asset=e,this.__detailInformation.title=e.get("title"),this.__detailInformation.synopsis=e.get("subtitle"),this.__detailInformation.cast=e.get("cast"),this.__detailInformation.parentalRating=e.get("parentalRating"),this.__detailInformation.length=e.get("length"),this.__detailInformation.year=e.get("year"),this.__detailInformation.genres=e.get("genreList"),this.__detailInformation.startTime=e.get("startTime"),this.__detailInformation.endTime=e.get("endTime"),this.__detailInformation.packageCode=e.get("packageCode"),this.__detailInformation.packageColorCode=e.get("packageColorCode"),this.__detailInformation.isBlackedOut=e.get("blackedOut"),this.__detailInformation.channelIsPermitted=i,this.__detailInformation.channelIsPlayable=n,this.__detailInformation.userHasPrivilegeToWatchChannel=s,this.__detailInformation.userHasPrivilegeToWatchVod=r,this.__detailInformation.isInWatchlist=a,this.trackPage(e.get("title")),this.updateCommonDetailInformation(this.__asset,this.__detailInformation),this.updateButtons({isBlackedOut:this.__detailInformation.isBlackedOut,channelIsPermitted:this.__detailInformation.channelIsPermitted,channelIsPlayable:this.__detailInformation.channelIsPlayable,userHasPrivilegeToWatchChannel:this.__detailInformation.userHasPrivilegeToWatchChannel,userHasPrivilegeToWatchVod:this.__detailInformation.userHasPrivilegeToWatchVod,isInWatchlist:this.__detailInformation.isInWatchlist,userIsLoggedIn:this.checkIfUserIsLoggedIn(),vodIsPlayable:this.__assetIsPlayable(this.__asset),liveSupported:!0})},this))},updateButtons:function(e){if(e){var t=this.getView(),i=t.find("sportTuneIn"),n=t.find("sportStartFromVod"),s=t.find("addToWatchlist"),r=t.find("videoButtonContainer"),a=t.find("detailDescription"),o=e.isBlackedOut,l=e.channelIsPermitted,c=e.channelIsPlayable,d=e.userHasPrivilegeToWatchChannel,u=e.userHasPrivilegeToWatchVod,h=e.isInWatchlist,_=e.userIsLoggedIn,g=e.vodIsPlayable,f=e.liveSupported||!0,p=this.__asset.get("currentType")===S.SPORT_ASSET_CURRENT_TYPES.LIVE;i.setText(b.getString("DetailPage.DetailPage_labelTuneIn")),n.setText(b.getString("DetailPage.DetailPage_labelwatch_now_label")),s.setText(h?b.getString("DetailPage.DetailPage_removeWatchlist"):b.getString("DetailPage.DetailPage_labeladd_to_watchlist")),this.setButtonNavigation([{button:i,hidden:!(!o&&l&&c),greyedOut:(!d||!f)&&!(!_&&f)},{button:n,hidden:!g,greyedOut:!(f||!p)||!u&&!!_},{button:s,hidden:!!o,greyedOut:!1}],r),o&&!g||a.setFocusable(!1),this.focusFirstVisibleComponent([i,n,s])}},__keyHandler:function(e){return e.id,!0},reset:function(){var e=this.getView(),t=e.find("sportTuneIn"),i=e.find("sportStartFromVod"),n=e.find("addToWatchlist");this._super(),t.removeEventListener(s.CLICK,this.__tuneInRef),i.removeEventListener(s.CLICK,this.__watchSportRef),n.removeEventListener(s.CLICK,this.__addToWatchlistRef)}})}),define("tvedemo/tmpl/sportHome",["xdk-ui-basic/Layout","xdk-ui-basic/Label","tvedemo/wgt/BasicGrid","tvedemo/ext/ui/grid/LoopedGrid","tvedemo/wgt/AssetGrid","tvedemo/wgt/HighlightsMenu","xdk-ax/Container","storm/mgr/sLanguageManager"],function(e,t,i,n,s,r,a,o){"use strict";return function(){return{klass:e,id:"#homeView",width:1,alignment:e.HORIZONTAL,css:"subcontrollerPage sportHome",children:[{klass:t,id:"homePanelLabel",css:"home-panel-label",text:o.getString("Sport.Sport_LabelLive").toUpperCase()},{klass:n,alignment:n.VERTICAL,scrollFrontBoundary:1,scrollEndBoundary:3,id:"livePlanner",css:"home-panel-grid",rows:5,cols:1},{klass:a,id:"#sportOverlay",css:"overlay"},{klass:a,id:"#highlightsContainer",css:"highlightsContainer",children:[{klass:n,id:"highlightGrid",css:"movie-grid",scrollFrontBoundary:2,scrollEndBoundary:3,rows:5,cols:1,alignment:n.VERTICAL}]}]}}}),define("tvedemo/tmpl/tvShowsListing",["xdk-ui-basic/Label","xdk-ui-basic/Layout","tvedemo/ext/ui/grid/LoopedGrid","storm/mgr/sLanguageManager"],function(e,t,i,n){"use strict";return function(){return{klass:t,forwardFocus:!0,alignment:t.VERTICAL,css:"subcontrollerPage serie-listing",children:[{klass:i,forwardFocus:!0,alignment:i.VERTICAL,id:"#tvShowAssetGrid",rows:3,cols:2,scrollFrontBoundary:1,scrollEndBoundary:1},{klass:e,id:"errorMsg",css:"error-msg",text:n.getString("Global.Global_NoResults")}]}}}),define("tvedemo/ctrl/TVShowsListing",["xdk-base/class","xdk-ax/mvc/view","tvedemo/ctrl/RoutableController","tvedemo/tmpl/tvShowsListing","xdk-ax/evt/type","xdk-ax/focusManager","xdk-base/device/vKey","xdk-base/util","xdk-ax/data/LocalDatasource","tve/mgr/sLinearManager","tvedemo/wgt/ImageButton","tvedemo/mgr/sAssetManager","xdk-ax/Container","xdk-ax/mediator","xdk-ui-basic/Label","xdk-base/promise","xdk-base/console","storm/helper/util","tvedemo/mgr/sNavigationManager","storm/mgr/sAppConfigManager","storm/mgr/sLanguageManager","tvedemo/wgt/BasicGrid"],function(e,t,i,n,s,r,a,o,l,c,d,u,h,_,g,f,p,m,v,b,S,y){"use strict";return e.create(i,{getDefaultState:function(){return{navigator:null}}},{init:function(){this._super(),this.setView(t.render(n))},setup:function(e){var t=this.context&&this.context.navigator;if(this.context=e||{},this._assetGrid=this.getView().find("tvShowAssetGrid"),this._assetGridParent=this._assetGrid._parent,this._assetGridHandlerRef=o.bind(this._assetGridHandler,this),this._assetGrid.addEventListener(s.CLICK,this._assetGridHandlerRef),!0===e.historyBack)return void(this.context.navigator||(this.context.navigator=t));this._data=[],this.getView().find("errorMsg").hide();var i;i=e.navigator.highlights?this._buildMenu(e):this._setupData().then(o.bind(this._setupGrid,this)),e.setupPending=i.then(o.bind(function(){r.focus(this._assetGrid)},this),o.bind(function(){this.getView().find("errorMsg").show()},this)),this.trackLevel(2,void 0,!0)},_buildMenu:function(e){var t,i=o.bind(function(t){return o.bind(function(){return this.getView()._parent?(this.saveMenuState(),e.navigator.index=t,this._setupData().then(o.bind(this._setupGrid,this))):void _.publish("navigate",{path:"Main/TVShowsListing",state:{navigator:{title:e.navigator.title,highlights:e.navigator.highlights,index:t,submenu:this._submenuItems}}})},this)},this);if(this._submenuItems=m.getSanitizedValue(e,"navigator.submenu"),this._submenuItems){for(t=this._submenuItems.length-1;t>=0;t--)this._submenuItems[t].action=i(t);return e.navigator.index=e.navigator.index,this._setupData().then(o.bind(this._setupGrid,this))}for(this._submenuItems=[],t=0;t<e.navigator.highlights.data.length;t++)this._submenuItems.push({id:e.navigator.highlights.data[t].category.id,text:t?e.navigator.highlights.data[t].category.label:S.getString("Sport.Sport_LabelAll").toUpperCase(),action:i(t)});return v.insertSubmenu(this._submenuItems,e.navigator.title.toUpperCase(),null,e.navigator.index,!0)},_setupData:function(){return o.bind(function(e){return this.context.navigator.highlights?(this._data=this.context.navigator.highlights.data[this.context.navigator.index].items,f.resolve()):e&&e.length?this.context.navigator.id&&-1!==this.context.navigator.id.indexOf("ByLexic")?c.getLetterHeaderListing(e).then(function(t){var i=e.replace(/[^\/]*$/,""),n=[];return o.each(t,function(e){if(e.linkable){var t=i+e.content.toString()+".json";n.push(c.getAssetListing(t).then(function(t){return p.log("[TVShowsListing _retrieveData] "+e.content+" data fetched"),o.each(t.listing,function(e){e.catalog=t.catalog}),t.listing}))}}),f.all(n)}).then(o.bind(function(e){this._data=this._data.concat.apply(this._data,e),p.log("[TVShowsListing _retrieveData] Finish merging data... TotalCount:"+this._data.length)},this)):c.getAssetListing(e).then(o.bind(function(e){o.each(e.listing,function(t){t.catalog=e.catalog}),this._data=e.listing},this)):(p.error("path is empty"),f.reject("path is empty"))},this)(this.context.navigator.url)},swapAssetGrid:function(e){var t=this._assetGrid;this._assetGrid=new y({forwardFocus:!0,alignment:y.VERTICAL,id:"#tvShowAssetGrid",rows:2,cols:Math.ceil(e/2)}),this._assetGridParent.replace(t,this._assetGrid),this._assetGrid.addEventListener(s.CLICK,this._assetGridHandlerRef)},_setupGrid:function(){var e=m.arrayToDs(this._data),t=this._data.length,i=function(e){var t="";return e.season_nr&&(t+="S"+e.season_nr),e.episode_nr&&(t.length&&(t+=" "),t+="E"+e.episode_nr),t.length&&(t+=": "),e.serie_title&&e.serie_title.length?t+=e.serie_title.toUpperCase():e.title&&e.title.length&&(t+=e.title.toUpperCase()),e.item_title&&e.item_title.length&&(t+=e.item_title.toUpperCase()),t};return t<7&&this.swapAssetGrid(t),this.context.navigator.highlights&&this._assetGrid[this.context.navigator.index?"addClass":"removeClass"]("no-category-tag"),this._assetGrid.setDisplayStgy(function(e){var t,n=new h({forwardFocus:!0}),s=new d({parent:n,placeHolderPromise:b.getPlaceholderLandscape});e.item_preview_image||e.main_picture&&e.main_picture.picture&&e.main_picture.picture.length?(e.item_preview_image?t=e.item_preview_image:o.each(e.main_picture.picture,function(e){if(e.path&&e.file)return t=e.path+"/"+e.file,"content_2"===e.type?o.breaker:void 0}),c.constructCMSUrlPromise(t).then(function(e){s.setSrc(e)})):(p.warn("Asset does not contain 16:9 images"),s.fallback());var r=new h({parent:s,css:"textContainer"});if(e.item_category_name&&new g({parent:r,text:e.item_category_name,css:"category"}),"Sport"===e.type&&e.on_air){var a=m.parseAirDate(e.on_air.start_date),l=m.parseAirDate(e.on_air.end_date);a==l?l="":l+=" ";new g({parent:s,text:a+"&nbsp; "+e.on_air.start_time+" - "+l+e.on_air.end_time,css:"on_air_time"})}new g({parent:r,text:i(e),css:"text"});return n}),this._assetGrid.setDatasource(e).then(o.bind(function(){t<7&&(this._assetGridParent.addClass("serie-listing-limited"),this._assetGrid.addClass("limited-serie"))},this))},_assetGridHandler:function(){var e=this._assetGrid.getSelectedData();switch(e.type){case"News":_.publish("navigate",{path:"Main/News",state:{selectedNewsId:e.id,selectedNewsCategory:e.item_category_id}});break;case"Clip":break;case"Sport":_.publish("navigate",{path:"Main/Sport",state:{assetId:e.id,catalog:e.catalog}});break;case"Film":_.publish("navigate",{path:"Main/Movie",state:{assetId:e.id,catalog:e.catalog}});break;case"Series":_.publish("navigate",{path:"Main/TVShow",state:{serieId:e.id,catalog:e.catalog}});break;case"Season":_.publish("navigate",{path:"Main/TVShow",state:{seasonId:e.id,catalog:e.catalog}});break;default:_.publish("navigate",{path:"Main/Episode",state:{selectedEpisodeId:e.id,catalog:e.catalog}})}return!1},reset:function(){this._assetGrid.removeEventListener(s.CLICK,this._assetGridHandlerRef),this._super()}})}),define("tvedemo/ctrl/SportHome",["xdk-base/ax","tvedemo/ctrl/RoutableController","xdk-ax/mvc/view","xdk-ax/data/LocalDatasource","tvedemo/tmpl/sportHome","storm/mgr/sAppConfigManager","tve/mgr/sVODManager","xdk-base/util","xdk-ax/evt/type","xdk-ax/mediator","xdk-ax/mvc/AppRoot","xdk-ax/focusManager","xdk-base/device/vKey","xdk-base/promise","tvedemo/ctrl/TVShowsListing","tvedemo/helper/dialogHelper","storm/helper/util","tvedemo/wgt/ConfirmDialog","tvedemo/wgt/HomeGridButton","xdk-base/console","tvedemo/wgt/BasicGrid","tve/sServiceHolder","require","tve/mgr/sLinearManager","tvedemo/mgr/sNavigationManager","tvedemo/helper/sMoment","tvedemo/model/ContextBuilder","storm/mgr/sLinearChannelManager","storm/mgr/sLanguageManager","tvedemo/wgt/Loading"],function(e,t,i,n,s,r,a,o,l,c,d,u,h,_,g,f,p,m,v,b,S,y,E,k,C,T,x,I,w,L){"use strict";d.singleton();return e.klass.create(t,{},{LIVE_EVENT_DAYS:7,DATE_FORMAT:w.getString("ui.parsing.onAirStartDate"),init:function(){this.setView(i.render(s))},setup:function(e){var t=this.getView();if(this.imageContainer=t.find("imageContainer"),this.livePlanner=t.find("livePlanner"),this.subContainer=t.find("highlightsContainer"),this.subBar=t.find("highlightsBar"),this.highlightGrid=t.find("highlightGrid"),this.overlay=t.find("sportOverlay"),this._keyHandlerRef=o.bind(this.keyHandler,this),t.addEventListener(l.KEY,this._keyHandlerRef),this._subContainerHandlerRef=o.bind(this.subContainerHandler,this),this._livePlannerClickHandlerRef=o.bind(this._livePlannerClickHandler,this),this.livePlanner.addEventListener(l.CLICK,this._livePlannerClickHandlerRef),this._highlightGridClickHandlerRef=o.bind(this._highlightGridClickHandler,this),this.highlightGrid.addEventListener(l.CLICK,this._highlightGridClickHandlerRef),e.historyBack)return void(this.subBar&&this.subBar.__expanded&&this.showOverlay());this._curIndexGrid=0,this._sportNode=e.navigator.node,this._categories=y.getLinearContentService().getSportHighlightSections(this._sportNode);var i=["LiveplannerSection","ClipSection","ReplaysSection"];this._categories=o.filter(this._categories,o.bind(function(e){return-1===o.indexOf(i,e.structureType)},this)),this.livePlanner.setDisplayStgy(function(e){var t=null;return e&&e.main_picture&&e.main_picture.picture&&e.main_picture.picture.length?(t=e.main_picture.picture[0].path+"/"+e.main_picture.picture[0].file,o.each(e.main_picture.picture,function(e){if(e.path&&e.file)return"content_2"===e.type?(t=e.path+"/"+e.file,o.breaker):void 0})):b.warn("Asset does not contain 16:9 images"),new v({id:e.id,title:e.title,category:e.category&&e.category.main?e.category.main.content:null,period:e.on_air.start_time+"-"+e.on_air.end_time,image:t,channelImage:e.logo,channelColour:e.package_code})}),this.highlightGrid.setDisplayStgy(o.bind(function(e){var t=e.items[0];return new v({id:t.id,title:t.item_title,category:t.item_category_name,period:this._formatSportDate(t.item_Create_Date),image:t.item_preview_image,channelColour:t.package_code})},this)),L.open(),e.setupPending=p.allPromises([this.setupLivePlanner(e),this.updateHighlightGrid(0)]).then(function(){L.close()})},_formatSportDate:function(e){return o.isString(e)&&e.length?T(e,w.getString("ui.parsing.newsDate")).format(w.getString("ui.format.highlightNewsTime")):""},setupLivePlanner:function(e){return p.allPromises([y.getDateTimeService().getServerDateTime(),y.getLinearContentService().getSportLivePlannerPromise(e.navigator.node)]).then(o.bind(function(e){var t=e[0],i=e[1],n=p.getSanitizedValue(i,"listing.listing.asset")||[];if(n.length){for(var s=T(t).add(this.LIVE_EVENT_DAYS,"day"),r=0;r<n.length&&T(n[r].on_air.start_date,this.DATE_FORMAT).diff(s,"days")<0;)n[r].catalog||(n[r].catalog=i.product),r++;n=n.slice(0,r)}return n.length||(this.livePlanner.setOption("focusable",!1),this.subBar.setOption("nextUp","header")),this.livePlanner.setDatasource(p.arrayToDs(n)).then(o.bind(function(){this.livePlanner.select(0,1)},this))},this))},updateHighlightGrid:function(e){return!this._categories||this._categories.length<=e?_.resolve():(this._curIndexGrid=e,y.getLinearContentService().getSportHighlightPromise(this._sportNode,this._categories[e].structureType).then(o.bind(function(e){var t,i;this._highlights=e,this.highlightGrid._data=null,this.highlightGrid._ds=null,i=e.displayFirstChild?e.data:e.data.slice(1);for(var n=0,s=i.length;n<s;n++)i[n].items=[i[n].items[0]];return t=p.arrayToDs(i),this.highlightGrid.setDatasource(t).then(o.bind(function(){this.highlightGrid.select(0,2)},this))},this)))},_livePlannerClickHandler:function(){var e=this.livePlanner.getSelectedData();e&&e.event_id&&c.publish("navigate",{path:"Main/Sport",state:{assetId:e.id,catalog:e.catalog}})},_highlightGridClickHandler:function(){c.publish("navigate",{path:"Main/TVShowsListing",state:{navigator:{title:this._categories[this._curIndexGrid].text,highlights:this._highlights,index:this.highlightGrid.getSelectedDsIndex()+(this._highlights.displayFirstChild?0:1)}}})},subContainerHandler:function(e){"highlightsMenu"===e.target._parent.getId()&&this.setHighlightsMenuExpanded(!0)},submenuClick:function(e){},subMenuBlur:function(e){b.log(e.relatedTarget),e.relatedTarget.isDescendantOf(this.subContainer)||this.setHighlightsMenuExpanded(!1)},setHighlightsMenuExpanded:function(e){e?this.subBar.__expanded||(this.subBar.addClass("focused"),this.subContainer.addClass("focused"),this.showOverlay(),this.subBar.__expanded=!0):this.subBar.__expanded&&(this.subBar.removeClass("focused"),this.subContainer.removeClass("focused"),this.hideOverlay(),this.subBar.__expanded=!1)},showOverlay:function(){this.overlay.addClass("visible")},hideOverlay:function(){this.overlay.removeClass("visible")},keyHandler:function(e){switch(e.id){case h.UP.id:default:return!0}return!1},reset:function(){this.subBar&&this.subBar.__expanded&&this.hideOverlay(),this.getView().removeEventListener(l.KEY,this._keyHandlerRef),this.livePlanner.removeEventListener(l.CLICK,this._livePlannerClickHandlerRef),this.highlightGrid.removeEventListener(l.CLICK,this._highlightGridClickHandlerRef),this._super()}})}),define("tvedemo/tmpl/textpage",["xdk-ui-basic/Layout","xdk-ui-basic/Label","tvedemo/wgt/ScrollLabel"],function(e,t,i){"use strict";return function(){return{klass:e,id:"#textpageView",css:"subcontrollerPage",width:1,alignment:e.VERTICAL,children:[{klass:e,children:[{klass:t,css:"title",id:"title",text:"&nbsp;"},{klass:i,id:"scrollableField",css:"scrollable-field",scrollStep:108}]}]}}}),define("tvedemo/ctrl/TextPage",["xdk-base/ax","tvedemo/ctrl/RoutableController","xdk-ax/mvc/view","tvedemo/tmpl/textpage","storm/mgr/sAppConfigManager","xdk-base/util","xdk-ax/evt/type","xdk-ax/focusManager","xdk-ax/mediator","storm/mgr/sLanguageManager","storm/mgr/sEulaManager","storm/mgr/sLegalTextManager","tvedemo/mgr/sEndUserManager","storm/event/UserEvent"],function(e,t,i,n,s,r,a,o,l,c,d,u,h,_){"use strict";var g={eula:d.getEula,imprint:u.getImpressum,dataPrivacy:u.getPrivacy,tnc:u.getTermsForReview};return e.klass.create(t,{getDefaultState:function(){return{__forceReload:!0}}},{init:function(){this.setView(i.render(n))},setup:function(e){this.__handleUserDataUpdate=r.bind(function(){this.setupInformation(e)},this),l.subscribe(_.UserDataUpdated,this.__handleUserDataUpdate),this.setupInformation(e)},setupInformation:function(t){var i,n=this.getView(),s=n.find("title"),r=n.find("scrollableField"),a=t&&t.navigator||{};h.getLoggedInUser().then(function(t){i=t&&t.get("country"),g[a.id]&&g[a.id](i).then(function(t){if(t&&t.get){var i=t.get("body");if("imprint"===a.id){var n,o,l=/font-size: (\w+);/,c=i.match(l),d="font-size: medium;",u=/color: rgb\((\d+), (\d+), (\d+)\);/,h=i.match(u),_="color: rgb(153, 153, 153);";c&&c.length>0&&(n=d.replace(d,c[0]))&&"undefined"!==n&&(d=n),h&&h.length>0&&(o=_.replace(_,h[0]))&&"undefined"!==o&&(_=o),i='<p><span style="'+d+_+'">UI version: '+e.config.get("version")+"</span></p>"+i}s.setText(t.get("title")),r.setText(i),this.trackPage(t.get("title"))}}),o.focus(n)})},reset:function(){l.unsubscribe(_.UserDataUpdated,this.__handleUserDataUpdate),this._super()}})}),define("tvedemo/tmpl/tvShow",["xdk-ui-basic/Layout","xdk-ui-basic/Label","tvedemo/wgt/Submenu","tvedemo/wgt/AssetGrid","storm/wgt/Image","xdk-ax/Container","tvedemo/wgt/ImageButton","tvedemo/wgt/ScrollLabel","storm/mgr/sLanguageManager","storm/mgr/sAppConfigManager"],function(e,t,i,n,s,r,a,o,l,c){return function(){return{klass:e,alignment:e.VERTICAL,id:"#tvshow",children:[{klass:e,alignment:e.VERTICAL,id:"#tvshowContainer",css:"tvshow-container",children:[{klass:r,id:"#tvshowUpperContainer",children:[{klass:s,id:"#thumbnail",placeHolderPromise:c.getPlaceholderLandscape},{klass:e,id:"#blackoutMessageContainer",children:[{klass:t,id:"#blackoutMessage"}]},{klass:r,css:"informationContainer",children:[{klass:r,css:"title-positioner",children:[{klass:t,id:"#title"},{klass:t,id:"#seasonLabel"}]},{klass:e,id:"#metaDataContainer",alignment:e.HORIZONTAL},{klass:s,id:"#channelLogo"},{klass:r,id:"missingPackage",css:"missingPackage",children:[{klass:s,id:"missingPackageLogo",css:"missingPackageLogo"},{klass:t,id:"missingPackageText",css:"missingPackageText"}]}]}]},{klass:e,alignment:e.HORIZONTAL,forwardFocus:"buttonLayout",children:[{klass:e,id:"buttonLayout",focusable:!1,forwardFocus:!0,alignment:e.VERTICAL,children:[{klass:e,alignment:e.HORIZONTAL,id:"#serieButtonContainer",focusable:!1,forwardFocus:!0,children:[{klass:a,id:"addToWatchlist",text:""}]},{klass:e,alignment:e.HORIZONTAL,id:"#seasonSelectionButtonContainer",children:[{klass:t,id:"navigate-seasons",css:"navigate-seasons",text:l.getString("DetailPage.DetailPage_labelNavigateSeasons")},{klass:a,id:"previousSeasonButton",css:"previousSeason",text:""},{klass:a,id:"nextSeasonButton",css:"nextSeason",text:""}]}]},{klass:o,id:"detailDescription",css:"serie-description",scrollStep:108}]},{klass:t,id:"#episodesGridLabel"},{klass:n,id:"#seasonEpisodesGrid",focusable:!0,rows:1,cols:4,button:{showEpisodeNumber:!0,icon:!0}}]}]}}}),define("tvedemo/wgt/TVSeasonSelectionDialog",["xdk-base/class","xdk-base/util","xdk-ax/Container","tvedemo/wgt/TextSelectionListDialog","storm/helper/util","xdk-ui-basic/Label","tvedemo/wgt/ImageButton","tvedemo/wgt/TextSelectionList","tve/mgr/sVODManager","xdk-base/console"],function(e,t,i,n,s,r,a,o,l,c){return e.create(n,{},{init:function(e){e=e||{},e.size=e.size||3,e.headerText=e.headerText||"Select Season",this._super(e),this.addClass("wgt-seasons-dialog")},_createList:function(e){var t=new o({id:"list",rows:e.size});return t.setDisplayStgy(function(e){var t=new a({css:"season-option",text:"Season "+e.get("seasonNumber")});return l.getTVSeasonThumbnail(e).then(function(e){t.setSrc(e.get("url"))}).fail(function(t){c.warn("[TVSeasonSelectionDialog] fail to get thumbnail for season "+e.get("seasonNumber")+": "+t)}).done(),t}),t}})}),define("tvedemo/wgt/ScrollingLabel",["xdk-base/class","xdk-ui-basic/AbstractScrollable","xdk-base/util","xdk-ui-basic/Label","xdk-ui-basic/Scrollbar","xdk-base/Element","xdk-ax/evt/type","xdk-base/cssUtil","xdk-ui-basic/ScrollingMediator","xdk-base/console"],function(e,t,i,n,s,r,a,o,l,c){return o.addCss(".wgt-scrollingLabel .container{                        position: absolute;                        overflow:hidden;                    }                    .wgt-scrollingLabel .text{                        position:absolute;                        top:0px;                    }"),e.create(t,{},{__label:null,__labelContainer:null,__scrollbar:null,__inited:!1,__auto:!0,__processing:!1,__stopped:!0,__containerHeight:0,__labelHeight:0,__scrollable:!1,__maxStep:0,__stepSize:0,__interval:5,__delayId:"",__bindedTransitionEndAction:function(){},init:function(e){var t,o,c=new l;e=e||{},e.focusable=!0,e.root=new r("div"),
o=e.text||"",t=e.scrollSecond||1,this.__stepSize=e.scrollStep||50,this.__interval=e.interval||5,this.__auto=!!i.isUndefined(e.autoScroll)||e.autoScroll,this.__delayId="scrollDelay"+e.id+Math.floor(1e3*Math.random()),this._super(e),this.getRoot().addClass("wgt-scrollingLabel"),this.__labelContainer=new r("div").addClass("container"),this.getRoot().append(this.__labelContainer),this.__label=new n({parent:this}),this.__label.getRoot().setClass("text"),this.__scrollbar=new s({css:"scrollbar",parent:this}),this.setText(o),this.addEventListener(a.ATTACHED_TO_DOM,i.bind(this.__attachToDom,this)),this.addEventListener(a.DETACHED_FROM_DOM,i.bind(this.__detachFromDom,this)),this.__label.getRoot().getHTMLElement().style.transition="top "+t+"s ease-in-out",this.__scrollbar._nodeTable.getHTMLElement().style.transition="top "+t+"s ease-in-out",this.__label.getRoot().getHTMLElement().style.webkitTransition="top "+t+"s ease-in-out",this.__scrollbar._nodeTable.getHTMLElement().style.webkitTransition="top "+t+"s ease-in-out",this.__bindedTransitionEndAction=i.bind(function(){this.__stopped||this.start()},this),this.__bindedTransitionEndFlagControl=i.bind(function(){this.__processing=!1},this),c.registerIndicator(this.__scrollbar),c.setScrollable(this),this.__inited=!0},setText:function(e){this.__label.setText(e),this.__inited&&(this.__updateSize(),this._scrollTo(0))},getText:function(){return this.__label.getText()},start:function(){this.__stopped=!1,i.clearDelay(this.__delayId),this.__label.getRoot().getHTMLElement().addEventListener("webkitTransitionEnd",this.__bindedTransitionEndAction),i.delay(this.__interval,this.__delayId).then(i.bind(function(){this.scroll()},this))},scroll:function(e){if(!this.__scrollable)return void c.info("Abort the scroll: The content is fit into the label, no scroll is needed.");if(this.__processing)return void c.info("Abort the scroll: Another scroll is in progress.");var t,n=parseInt(this.__label.getRoot().getHTMLElement().offsetTop,10),s=this.__stepSize;e=!!i.isUndefined(e)||e,t=n+(e?-s:s),t>=0?this._scrollTo(0):t>this.__maxStep?this._scrollTo(t):n!==this.__maxStep?this._scrollTo(this.__maxStep):this.__stopped||this._scrollTo(0)},stop:function(){this.__stopped=!0,i.clearDelay(this.__delayId),this.__label.getRoot().getHTMLElement().removeEventListener("webkitTransitionEnd",this.__bindedTransitionEndAction)},reset:function(){this._scrollTo(0),this.__stopped||this.start()},__getPosition:function(){return parseInt(this.__label.getRoot().getHTMLElement().offsetTop,10)},_scrollTo:function(e){if(this.__getPosition()===e)return void c.info("Abort the scroll: Label is at target position.");this.__label.getRoot().css("top",e+"px"),this.dispatchScrolledInfo(-e,this.__containerHeight,this.__labelHeight),this.__processing=!0},__attachToDom:function(){this.__updateSize(),this.__auto&&(this.__focus=i.bind(function(){this.start()},this),this.__blur=i.bind(function(){this.stop(),this.reset()},this),this.addEventListener(a.FOCUS,this.__focus),this.addEventListener(a.BLUR,this.__blur)),this.__label.getRoot().getHTMLElement().addEventListener("webkitTransitionEnd",this.__bindedTransitionEndFlagControl)},__detachFromDom:function(){var e=this.__label.getRoot().getHTMLElement();this.__stopped=!0,this.__processing=!1,this.removeEventListener(a.FOCUS,this.__focus),this.removeEventListener(a.BLUR,this.__blur),e.removeEventListener("webkitTransitionEnd",this.__bindedTransitionEndAction),e.removeEventListener("webkitTransitionEnd",this.__bindedTransitionEndFlagControl)},_doAttach:function(e,i,s){if(this.__inited)return void c.info("Unavailable to append more children after inited.");var r=this._root;switch(e instanceof n&&(r=this.__labelContainer),i){case t.PLACE_APPEND:r.append(e.getRoot());break;case t.PLACE_PREPEND:r.prepend(e.getRoot());break;case t.PLACE_BEFORE:r.insertBefore(s.getRoot(),e.getRoot());break;case t.PLACE_AFTER:r.insertAfter(s.getRoot(),e.getRoot())}},__updateSize:function(){this.__labelHeight=this.__label.getRoot().getHTMLElement().offsetHeight,this.__containerHeight=this.__labelContainer.getHTMLElement().offsetHeight,this.__labelHeight>this.__containerHeight?(this.__scrollable=!0,this.__scrollbar.show(),this.dispatchScrolledInfo(0,this.__containerHeight,this.__labelHeight)):(this.__scrollable=!1,this.__scrollbar.hide()),this.__maxStep=-(this.__labelHeight-this.__containerHeight)}})}),define("tvedemo/wgt/InfoDialog",["xdk-base/class","fix/Dialog","xdk-base/util","xdk-ax/Container","xdk-ax/evt/type","xdk-ui-basic/Button","tvedemo/wgt/ScrollingLabel","tvedemo/wgt/Footer","tvedemo/wgt/FooterIconMap","xdk-ax/focusManager","xdk-base/device/vKey","xdk-ui-basic/Image"],function(e,t,i,n,s,r,a,o,l,c,d,u){return e.create(t,{},{_footer:null,_scrollingLabel:null,_arrowUp:null,_arrowDown:null,init:function(e){e=e||{},e.title=e.title||"Info.";var t=new r({css:"wgt-infodialog-button",text:e.buttonText||"OK"});this._footer=new o({css:"footer",iconSet:l.DIALOG}),this._scrollingLabel=new a({css:"wgt-dialog-message",text:e.message,scrollStep:450,scrollSecond:.5,autoScroll:!1}),this._arrowUp=new u({css:"arrow up"}),this._arrowDown=new u({css:"arrow down"}),e.content=new n({forwardFocus:t,children:[this._arrowUp,this._scrollingLabel,this._arrowDown,t]}),e.footer=new n({css:"footer-container",children:[this._footer]}),e.forwardFocus=t,this._footer.update({arrowUpDown:"Move",enter:"Select",back:"Back"}),this._super(e),this.addClass("wgt-infodialog"),t.addEventListener(s.CLICK,i.bind(this.close,this)),this.addEventListener(s.KEY,i.bind(this._onKey,this))},open:function(){this._isOpen||(this._super(),this._lastFocus=c.getCurFocus(),this.setOption("forwardFocus",this.getOption("content")),c.focus(this))},close:function(){this._super(),this.deinit()},_onKey:function(e){switch(e.id){case d.UP.id:this._scrollingLabel.scroll(!1);break;case d.DOWN.id:this._scrollingLabel.scroll();break;default:return!0}return!1}})}),define("tvedemo/ctrl/TVShow",["xdk-base/ax","xdk-ax/mvc/view","tvedemo/tmpl/tvShow","tve/mgr/sVODManager","xdk-base/util","xdk-ax/evt/type","xdk-ax/focusManager","xdk-ax/mediator","xdk-base/device/vKey","tvedemo/helper/sMoment","xdk-ui-basic/Label","xdk-base/promise","tvedemo/helper/dialogHelper","tvedemo/mgr/sEndUserManager","storm/helper/util","xdk-base/console","tve/TVEError","tvedemo/mgr/sHistoryManager","tvedemo/wgt/EpisodeButton","tvedemo/wgt/TVSeasonSelectionDialog","tvedemo/wgt/InfoDialog","tvedemo/mgr/sAssetManager","storm/mgr/sLanguageManager","tvedemo/ctrl/DetailsBase","storm/mgr/sAppConfigManager","storm/event/UserEvent","xdk-ax/evt/eventManager","tvedemo/wgt/Loading","tvedemo/helper/sPlaybackHelper"],function(e,t,i,n,s,r,a,o,l,c,d,u,h,_,g,f,p,m,v,b,S,y,E,k,C,T,x,I,w){"use strict";return e.klass.create(k,{getDefaultState:function(){return{}}},{__tvShow:null,_currentlySelectedSeason:0,_grid:null,init:function(){this._super(),this.setView(t.render(i))},setup:function(e){this._super(e);var t=this.getView();if(this._grid=t.find("seasonEpisodesGrid"),this._tvShowContainer=t.find("tvshowContainer"),o.publish("footerUpdate",{colorGreen:"Search",arrowAll:"Move",enter:"Select",back:"Back"}),this.__gridClickHandler=s.bind(this._gridClickHandler,this),this._grid.addEventListener(r.CLICK,this.__gridClickHandler),this._setupButtons(),this.__handleUserDataUpdate=s.bind(function(){this.__tvShow&&this._displayAsset(this.__tvShow)},this),o.subscribe(T.UserDataUpdated,this.__handleUserDataUpdate),e.historyBack)return void this._displayAsset(this.__tvShow);var i;i=e.seasonId?y.getSeasonAssetById(e.seasonId,e.catalog).then(s.bind(function(t){return this._displayContent(t.get("serieId"),e.catalog,e.seasonId)},this)):this._displayContent(e.serieId?e.serieId:e.assetId,e.catalog),e.setupPending=i},_setupButtons:function(){var e=this.getView(),t=e.find("addToWatchlist"),i=e.find("previousSeasonButton"),n=e.find("nextSeasonButton");this.__addToWatchlistReference=s.bind(function(){var e=this.__tvShow.get("seasons")&&this.__tvShow.get("seasons")[this._currentlySelectedSeason],t=e&&e.get("episodes"),i="";s.each(t,function(e,n){i+=e.get("id"),n<t.length-1&&(i+=",")}),this.__updateWatchList({remove:!!this.__detailInformation.isInWatchlist,add:!this.__detailInformation.isInWatchlist,catalog:this.__tvShow.get("catalog"),assetId:i,assetType:y.ASSET_TYPES.EPISODE}).then(s.bind(function(e){e.added?this.__detailInformation.isInWatchlist=!0:e.removed&&(this.__detailInformation.isInWatchlist=!1),this.updateButtons({tvShow:this.__tvShow,isBlackedOut:this.__detailInformation.isBlackedOut,isInWatchlist:this.__detailInformation.isInWatchlist})},this))},this),this.__selectPreviousSeasonReference=s.bind(this._selectPreviousSeason,this),this.__selectNextSeasonReference=s.bind(this._selectNextSeason,this),t.addEventListener(r.CLICK,this.__addToWatchlistReference),i.addEventListener(r.CLICK,this.__selectPreviousSeasonReference),n.addEventListener(r.CLICK,this.__selectNextSeasonReference)},_displayContent:function(t,i,n){return t&&i?y.getSerieAssetById(t,i).then(s.bind(function(e){if(e){if(this._currentlySelectedSeason=this._currentlySelectedSeason||0,n){var t=s.findIndex(e.get("seasons"),function(e){return e.get("id")===n});t&&(this._currentlySelectedSeason=t)}this._displayAsset(e)}},this)).fail(function(e){f.log("sAssetManager.getSerieAssetById("+t+", "+i+") failed: "+e),s.defer().then(function(){h.error({reason:E.getString("Global.Global_NoResults"),closeAction:s.bind(m.back,m),buttonText:E.getString("Global.Global_buttonBack_button")})})}):e.promise.reject().fail(function(){s.defer().then(function(){h.error({reason:E.getString("Global.Global_NoResults"),closeAction:s.bind(m.back,m),buttonText:E.getString("Global.Global_buttonBack_button")})})})},_displayAsset:function(e){this.__checkUserPrivileges(e).then(s.bind(function(t){if(this.__tvShow=e,this.__detailInformation.title=this.__tvShow.get("title"),this.__detailInformation.synopsis=this.__tvShow.get("synopsis"),this.__detailInformation.cast=this.__tvShow.get("cast"),this.__detailInformation.parentalRating=this.__tvShow.get("parentalRating"),this.__detailInformation.length=this.__tvShow.get("length"),this.__detailInformation.year=this.__tvShow.get("year"),this.__detailInformation.genres=this.__tvShow.get("genreList"),this.__detailInformation.onAirDate=this.__tvShow.get("date"),this.__detailInformation.packageCode=this.__tvShow.get("packageCode"),this.__detailInformation.packageColorCode=this.__tvShow.get("packageColorCode"),this.__detailInformation.isBlackedOut=this.__tvShow.get("blackedOut"),this.__detailInformation.userHasPrivileges=t,this.__detailInformation.country=this.__tvShow.get("country"),this.__detailInformation.isHD=this.__tvShow.get("isHD"),this.trackPage(this.__tvShow.get("title")),!this.__detailInformation.packageCode&&!this.__detailInformation.packageColorCode)try{this.__tvShow.set("packageCode",this.__tvShow.get("seasons")[0].get("episodes")[0].get("packageCode")),this.__tvShow.set("packageColorCode",this.__tvShow.get("seasons")[0].get("episodes")[0].get("packageColorCode"))}catch(e){f.info("No episode information available for this series.")}if(this.updateCommonDetailInformation(this.__tvShow,this.__detailInformation),this.isSeasonIndexAvailable(this._currentlySelectedSeason)){var i=this.__tvShow.get("seasons")&&this.__tvShow.get("seasons")[this._currentlySelectedSeason];this._displaySeason(i)}else this.hideButtons()},this))},updateButtons:function(e){var t=e&&e.tvShow,i=e&&e.isBlackedOut,n=e&&e.isInWatchlist,s=this.getView(),r=s.find("addToWatchlist"),a=s.find("seasonEpisodesGrid"),o=s.find("detailDescription"),l=s.find("seasonSelectionButtonContainer");t&&(i?(r.hide(),a.getDatasource()&&a.getDatasource().getTotalCount()>0&&o.setFocusable(!1)):(r.setText(n?E.getString("DetailPage.DetailPage_removeWatchlist"):E.getString("DetailPage.DetailPage_labeladd_to_watchlist")),o.setFocusable(!1)),this.focusFirstVisibleComponent(e.evtTarget?[e.evtTarget,l,o]:[r,a,o]))},hideButtons:function(){var e=this.getView();e.find("detailDescription");e.find("addToWatchlist").hide()},_displaySeason:function(e,t){this.__checkIfSeasonIsPresentInWatchlist(e).then(s.bind(function(i){this.__detailInformation.isInWatchlist=i;var n=e.get("seasonNumber"),r=this.getView().find("seasonLabel");if(n){var a=E.getString("DetailPage.DetailPage_labelseason_label")+" "+n;r.show().setText(a.toUpperCase())}else r.hide();this._displayEpisodes(e.get("episodes")).then(s.bind(function(){this.updateButtons({tvShow:this.__tvShow,isBlackedOut:this.__detailInformation.isBlackedOut,isInWatchlist:this.__detailInformation.isInWatchlist,evtTarget:t&&t.target}),I.close()},this)).fail(function(e){I.close(),f.warn("_displayEpisodes request failed. Error: "+e)})},this)).fail(function(e){I.close(),f.warn("__checkIfSeasonIsPresentInWatchlist request failed. Error: "+e)})},_displayEpisodes:function(e){var t=(this.getView(),g.arrayToDs(e)),i=this.getView().find("episodesGridLabel");return e.length>0&&i.setText(E.getString("DetailPage.DetailPage_labelseries_overview").toUpperCase()),this._grid.setDisplayStgy(s.bind(function(e){var t=e.get("packageCode");t||(t=e.get("packageColourCode"));var i={css:"wgt-assetbutton",asset:e,thumbnailPromise:y.getStormAssetImageBySize(e,this.IMAGE_MIN_WIDTH,this.IMAGE_MIN_HEIGHT),packageColorPromise:C.getPackageColourForCode(t)};return new v(i)},this)),this._grid.setDatasource(t).fail(s.bind(function(){this._grid.hide()},this))},_gridClickHandler:function(e){if("wgt-grid-arrow"!=e.target._opts.css){var t=this._grid.getSelectedData();return o.publish("navigate",{path:"Main/Episode",message:{selectedEpisodeId:t.get("id"),seasonEpisodes:this.__tvShow.get("seasons")[this._currentlySelectedSeason].get("episodes"),catalog:t.get("catalog")}}),!1}var i=e.target;return a.focus(this._grid),i._root._dom.className.indexOf("right")>-1?x.trigger(r.KEY,this._grid,{id:l.RIGHT.id}):x.trigger(r.KEY,this._grid,{id:l.LEFT.id}),!1},isSeasonIndexAvailable:function(e){var t=this.getView(),i=(t.find("addToWatchlist"),t.find("previousSeasonButton")),n=t.find("nextSeasonButton"),s=(t.find("seasonEpisodesGrid"),t.find("navigate-seasons")),r=(t.find("detailDescription"),!0);return(e<0||e>=(this.__tvShow.get("seasons")&&this.__tvShow.get("seasons").length))&&(r=!1),e<=0?i.hide():i.show(),e>=(this.__tvShow.get("seasons")&&this.__tvShow.get("seasons").length-1)?n.hide():n.show(),(!this.__tvShow.get("seasons")||this.__tvShow.get("seasons").length<=1)&&(i.hide(),n.hide(),s.hide()),n.isHidden()&&!i.isHidden()&&a.isCompFocused(n)&&a.focus(i),i.isHidden()&&!n.isHidden()&&a.isCompFocused(i)&&a.focus(n),r},_selectNextSeason:function(e){if(this.isSeasonIndexAvailable(this._currentlySelectedSeason+1)){I.open(),this._currentlySelectedSeason++;var t=this.__tvShow.get("seasons")&&this.__tvShow.get("seasons")[this._currentlySelectedSeason];this._displaySeason(t,e)}},_selectPreviousSeason:function(e){if(this.isSeasonIndexAvailable(this._currentlySelectedSeason-1)){I.open(),this._currentlySelectedSeason--;var t=this.__tvShow.get("seasons")&&this.__tvShow.get("seasons")[this._currentlySelectedSeason];this._displaySeason(t,e)}},reset:function(){this._super();var e=this.getView(),t=e.find("addToWatchlist"),i=e.find("previousSeasonButton"),n=e.find("nextSeasonButton");this._grid.removeEventListener(r.CLICK,this.__gridClickHandler),t.removeEventListener(r.CLICK,this.__addToWatchlistReference),i.removeEventListener(r.CLICK,this.__selectPreviousSeasonReference),n.removeEventListener(r.CLICK,this.__selectNextSeasonReference),o.unsubscribe(T.UserDataUpdated,this.__handleUserDataUpdate)}})}),define("tvedemo/wgt/EPG/EpgItemBuilder",["xdk-ax/Container","xdk-ui-basic/Button","xdk-ui-basic/Label","xdk-ui-basic/Image","tvedemo/helper/sMoment","xdk-base/console","storm/mgr/sAppConfigManager","xdk-base/ax"],function(e,t,i,n,s,r,a,o){"use strict";return{_dateFormat:"D.MM",_timeFormat:"HH:mm",patron:null,setDateFormat:function(e){this._dateFormat=e},setTimeFormat:function(e){this._timeFormat=e},returnContainer:function(t,i,n,s){return new e({id:t,css:i,placement:s,parent:n})},returnLabel:function(e,t,n,s){return new i({id:e,css:t,text:s,parent:n})},returnImage:function(e,t,i,s){return new n({id:e,css:t,src:s,parent:i})},returnHeaderItem:function(e,t,i,n){return this.returnLabel(e,t,i,s(n).format(this._dateFormat))},returnTimeLineItem:function(e,t,i,n){return this.returnLabel(e,t,i,s(n).format(this._timeFormat))},returnChannelItem:function(t,i,n,s,r,a,o,l,c,d){var u,h,_,g="channelLabel";return d=d||e.PLACE_APPEND,u=this.returnContainer("channel"+s,i,n,d),u.blackout=o,u.subsribed=l,h=this.returnImage("channelImage"+s,"channelLogo",u,r),r&&(g+=" hidden"),_=this.returnLabel("channelLabel"+s,g,u,a),h.setErrorCallback(this._brokenImageHandler(h,_)),u},returnProgrammeItem:function(e,i,n,s,r,a,o){(o-=1)<30&&(n="");var l=new t({id:e,css:i,text:n,programmeData:s,parent:r});return l.getRoot().getHTMLElement().style.left=a+"px",l.getRoot().getHTMLElement().style.width=o+"px",l.getChildren()[0].getRoot().getHTMLElement().style.width=o-this.patron.programmeTextPadding+"px",l},setTimeLineItems:function(e,t,i,n){for(var s=0;s<4;s++){var r,a=e+n*s;r=this.returnTimeLineItem("timeLineItem"+a,"timeLineItem",i,a),t.push(r)}},_brokenImageHandler:function(e,t){return function(){e.addClass("hidden"),t.removeClass("hidden")}}}}),define("tvedemo/wgt/EPG/EpgTimeAndPosition",["tvedemo/helper/sMoment","xdk-base/console","tvedemo/helper/CentralEuropeanTime"],function(e,t,i){"use strict";var n=0;return{patron:null,MS_IN_1_MIN:6e4,slotPosition:0,dayPosition:0,rowPosition:0,numberOfChannels:null,dataStartSlot:0,stopVerticalPaging:!1,setCurrentTimeSlot:function(e){var t=this._getTimestamp(),i=this._getStartOfDayTimestamp(),n=t-i;this.slotPosition=Math.floor(n/(this.MS_IN_1_MIN*e.timeSlotSize)),this.dataStartSlot=this.slotPosition,this.patron=e},getTimeSlot:function(e){var t=this._getStartOfDayTimestamp(),i=this._getStartOfDayTimestamp(),n=this._getStartOfDayTimestamp(),s=t-n,r={};return r.slotPosition=Math.floor(s/(this.MS_IN_1_MIN*this.patron.timeSlotSize)),r.dayPosition=Math.floor((n-i)/864e5),r},getCurrentTimeSlotStart:function(){var e=this._getStartOfDayTimestamp();return e+=864e5*this.dayPosition,e+=this.slotPosition*(this.MS_IN_1_MIN*this.patron.timeSlotSize)},getCurrentSlotTimesForMarker:function(){if(0!=this.dayPosition)return!1;var e=this._getTimestamp()+60*this.MS_IN_1_MIN,t=this._getStartOfDayTimestamp()+60*this.MS_IN_1_MIN,i=e-t,n={},s=Math.floor(i/(this.MS_IN_1_MIN*this.patron.timeSlotSize));return n.dataStartSlot=s,this.slotPosition!=s?n:(n.startTime=t+s*(this.MS_IN_1_MIN*this.patron.timeSlotSize),n.endTime=n.startTime+this.MS_IN_1_MIN*this.patron.timeSlotSize,n)},getTopChannelIndex:function(){return n},setTopChannelIndex:function(e){n=e,null!==this.numberOfChannels&&(n<0?n=this.numberOfChannels-1:n>this.numberOfChannels-1&&(n=0))},returnTimeSlot:function(){return this._getStartOfDayTimestamp()+864e5*this.dayPosition+this.slotPosition*(this.MS_IN_1_MIN*this.patron.timeSlotSize)},updateDayAndSlotPositions:function(e,t){if(e<0&&this.dayPosition==this.patron.minDay&&this.slotPosition<1)return!1;var i=e>0?Math.floor(e/12):Math.ceil(e/12);if(this.slotPosition+=e,e>0&&this.slotPosition>11){if(this.invalidDay(i))return this.slotPosition-=e,!1;12!=e?(1==e?this.slotPosition=0:this.slotPosition-=e,0==i&&(i=1)):this.slotPosition-=e,t(i)}else if(e<0&&this.slotPosition<0){if(this.invalidDay(i))return this.slotPosition-=e,!1;-11!=e?(-1==e?this.slotPosition=11:this.slotPosition-=e,0==i&&(i=-1)):this.slotPosition-=e,t(i)}return!0},invalidDay:function(e){if(this.dayPosition+e>this.patron.maxDay||this.dayPosition+e<this.patron.minDay)return!0},_getTimestamp:function(){return 1e3*e().unix()},_getStartOfDayTimestamp:function(){return 1e3*e().startOf("d").unix()}}}),define("tvedemo/wgt/EPG/EpgTopBar",["tvedemo/helper/sMoment","xdk-base/console"],function(e,t){"use strict";var i,n=null,s=null;return{epgAndTimeLineMask:null,epgTimeLine:null,epgTimeLineNext:null,epgTimeLineObjects:null,channelHeaderMask:null,channelHeader:null,channelHeaderNext:null,channelHeaderItem:null,patron:null,timeAndPosition:null,itemBuilder:null,setVariables:function(e,t,n){this.patron=e,this.timeAndPosition=t,this.itemBuilder=n,i=e.timeSegment*t.MS_IN_1_MIN,this.setupContainers()},setupContainers:function(){this.channelHeaderMask=this.itemBuilder.returnContainer("channelHeaderMask","channelHeaderMask",this.patron),this.channelHeader=this.itemBuilder.returnContainer("channelHeader"+this.timeAndPosition.dayPosition,"channelHeader",this.channelHeaderMask),this.timeLineMask=this.itemBuilder.returnContainer("timeLineMask","timeLineMask",this.patron),this.timeLine=this.itemBuilder.returnContainer("timeLine"+this.timeAndPosition.dayPosition+"-"+this.timeAndPosition.slotPosition,"timeLine",this.timeLineMask)},setUpHeaderAndTimeLine:function(e){this.channelHeaderItem=this.itemBuilder.returnHeaderItem("chHeader"+this.timeAndPosition.dayPosition,"channelHeaderLabel",this.channelHeader,e),this.epgTimeLineObjects=[],t.log(this.timeLine),this.itemBuilder.setTimeLineItems(e,this.epgTimeLineObjects,this.timeLine,i)},moveTimeLineHorizontal:function(e){var t,s;return e>0?(t="epgRight",s="epgLeft"):(t="epgLeft",s="epgRight"),!!this.timeAndPosition.updateDayAndSlotPositions(e,this.moveChannelHeader(this))&&(this.timeLineNext=this.itemBuilder.returnContainer("timeLine"+this.timeAndPosition.dayPosition+"-"+this.timeAndPosition.slotPosition,"timeLine "+t,this.timeLineMask),this.itemBuilder.setTimeLineItems(this.timeAndPosition.returnTimeSlot(),this.epgTimeLineObjects,this.timeLineNext,i),n=setInterval(this.animateTimeLine(this,s,t),30),!0)},moveChannelHeader:function(e){return function(t){var i=e.timeAndPosition;i.dayPosition+=t;var n,r;t>0?(n="epgChannelRight",r="epgChannelLeft"):(n="epgChannelLeft",r="epgChannelRight"),e.channelHeaderNext=e.itemBuilder.returnHeaderItem("chHeader"+i.dayPosition,"channelHeaderLabel "+n,e.channelHeader,i.returnTimeSlot()),s=setInterval(e.animateChannelHeader(e,r,n),30)}},animateTimeLine:function(e,t,i){return function(){clearInterval(n),e.timeLine.addClass(t),e.timeLineNext._root._dom.addEventListener("transitionend",e.timeLineAniComplete(e)),e.timeLineNext._root._dom.addEventListener("webkitTransitionEnd",e.timeLineAniComplete(e)),e.timeLineNext.removeClass(i)}},animateChannelHeader:function(e,t,i){return function(){clearInterval(s),e.channelHeaderItem.addClass(t),e.channelHeaderNext._root._dom.addEventListener("transitionend",e.channelHeaderAniComplete(e)),e.channelHeaderNext._root._dom.addEventListener("webkitTransitionEnd",e.channelHeaderAniComplete(e)),e.channelHeaderNext.removeClass(i)}},timeLineAniComplete:function(e){return function(){if(e.timeLineNext){e.timeLineNext._root._dom.removeEventListener("transitionend",e.timeLineAniComplete(e)),e.timeLineNext._root._dom.removeEventListener("webkitTransitionEnd",e.timeLineAniComplete(e));for(var t=0;t<4;t++){var i=e.epgTimeLineObjects.shift();e.timeLine.detach(i)}e.timeLineMask.detach(e.timeLine),e.timeLine=e.timeLineNext,e.timeLineNext=null}}},channelHeaderAniComplete:function(e){return function(){e.channelHeaderNext&&(e.channelHeaderNext._root._dom.removeEventListener("transitionend",e.channelHeaderAniComplete(e)),e.channelHeaderNext._root._dom.removeEventListener("webkitTransitionEnd",e.channelHeaderAniComplete(e)),e.channelHeader.detach(e.channelHeaderItem),e.channelHeaderItem=e.channelHeaderNext,e.channelHeaderNext=null)}}}}),define("tvedemo/wgt/EPG/data/Retrieval",["xdk-base/console"],function(e){"use strict";return{retrieveChannelDataElement:function(e,t,i){var n,s=i.channels;if(s=s[e],t.length>0)for(n=0;n<t.length;n++)try{s=s[t[n]]}catch(e){return null}return s},retrieveChannelProgrammes:function(e,t,i){var n=t.programmes[i].data;return n=n[e],n=this.retrieveProgrammeElement(n,t.programmeDataBase)},retrieveProgrammeDataElement:function(e,t,i){var n=e[t];return this.retrieveProgrammeElement(n,i)},retrieveProgrammeElement:function(e,t){var i;if(t.length>0)for(i=0;i<t.length;i++)e=e[t[i]];return e}}}),define("tvedemo/wgt/EPG/EpgChannelBar",["tvedemo/wgt/EPG/data/Retrieval","xdk-ax/Container","tvedemo/helper/sMoment","xdk-base/console"],function(e,t,i,n){"use strict";var s=null;return{channelMask:null,channelContainer:null,channelContainerNext:null,channelObjects:null,newChannelItem:null,channelBarAnimationDelay:null,patron:null,timeAndPosition:null,itemBuilder:null,upAni:!1,animationListener:null,animationUpListener:null,setVariables:function(e,t,i){this.patron=e,this.timeAndPosition=t,this.itemBuilder=i,this.setupContainers()},setupContainers:function(){this.channelMask=this.itemBuilder.returnContainer("channelMask","channelMask",this.patron),this.channelContainer=this.itemBuilder.returnContainer("channelContainer","channelContainer channelContainerStepAni",this.channelMask)},setupChannels:function(){var i,s=this.timeAndPosition.getTopChannelIndex(),r=s+this.patron.numberOfRows;this.channelObjects=[];for(var a=s;a<r;a++){i=a>=this.patron.channels.length?this.patron.channels.length:0;var o=e.retrieveChannelDataElement(a-i,this.patron.channelDataId,this.patron),l=e.retrieveChannelDataElement(a-i,this.patron.channelDataLogo,this.patron),c=e.retrieveChannelDataElement(a-i,this.patron.channelDataTitle,this.patron),d=e.retrieveChannelDataElement(a-i,this.patron.channelDataBlackout,this.patron),u=e.retrieveChannelDataElement(a-i,this.patron.channelDataStatus,this.patron),h=e.retrieveChannelDataElement(a-i,this.patron.channelDataSubscribed,this.patron),_=e.retrieveChannelDataElement(a-i,this.patron.channelPackColourCode,this.patron),g="offline"==u?"channelObject channel-offline":"channelObject";this.patron.loggedIn&&(g=h?g:g+" channel-unsubscribed",h||n.log("Channel "+o+" "+c+"  ----------unsubscribed")),this.channelObjects.push(this.itemBuilder.returnChannelItem("channelItem"+a,g,this.channelContainer,o,l,c,d,h,_,t.PLACE_APPEND))}},moveChannel:function(i){var n,r,a,o,l;this.timeAndPosition.setTopChannelIndex(this.timeAndPosition.getTopChannelIndex()+i),n=i>0?this.timeAndPosition.getTopChannelIndex()+(this.patron.numberOfRows-1):this.timeAndPosition.getTopChannelIndex(),n>=this.patron.channels.length&&(n-=this.patron.channels.length),r=e.retrieveChannelDataElement(n,this.patron.channelDataId,this.patron),a=e.retrieveChannelDataElement(n,this.patron.channelDataLogo,this.patron),o=e.retrieveChannelDataElement(n,this.patron.channelDataTitle,this.patron);var c=e.retrieveChannelDataElement(n,this.patron.channelDataBlackout,this.patron),d=e.retrieveChannelDataElement(n,this.patron.channelDataStatus,this.patron),u=e.retrieveChannelDataElement(n,this.patron.channelDataSubscribed,this.patron),h=e.retrieveChannelDataElement(n,this.patron.channelPackColourCode,this.patron),_="offline"==d?"channelObject channel-offline":"channelObject";this.patron.loggedIn&&(_=u?_:_+" channel-unsubscribed"),i>0?(this.upAni=!1,this.newChannelItem=this.itemBuilder.returnChannelItem("channelItem"+n,_,this.channelContainer,r,a,o,c,u,h,t.PLACE_APPEND),this.channelObjects.push(this.newChannelItem),l="beforeTop",this.animationListener=this.channelAniComplete(this,l),this.channelContainer._root._dom.addEventListener("transitionend",this.animationListener),this.channelContainer._root._dom.addEventListener("webkitTransitionEnd",this.animationListener),this.channelContainer.addClass(l)):(this.upAni=!0,this.newChannelItem=this.itemBuilder.returnChannelItem("channelItem"+n,_,this.channelContainer,r,a,o,c,u,h,t.PLACE_PREPEND),this.channelObjects.unshift(this.newChannelItem),l="beforeTop",this.channelContainer.removeClass("channelContainerStepAni"),this.channelContainer.addClass(l),s=setInterval(this.channelBarUpStep2Animation(this,l),30))},channelBarUpStep2Animation:function(e,t){return function(){clearInterval(s),e.animationUpListener=e.channelUpAniComplete(e,t),e.channelContainer._root._dom.addEventListener("transitionend",e.animationUpListener),e.channelContainer._root._dom.addEventListener("webkitTransitionEnd",e.animationUpListener),e.channelContainer.addClass("channelContainerStepAni"),e.channelContainer.removeClass(t)}},channelUpAniComplete:function(e,t){return function(){e.channelContainer._root._dom.removeEventListener("transitionend",e.animationUpListener),e.channelContainer._root._dom.removeEventListener("webkitTransitionEnd",e.animationUpListener),e.newChannelItem&&e.upAni&&(e.channelContainer.detach(e.channelObjects.pop()),e.newChannelItem.removeClass(t),e.newChannelItem=null)}},channelAniComplete:function(e,t){return function(){e.channelContainer._root._dom.removeEventListener("transitionend",e.animationListener),e.channelContainer._root._dom.removeEventListener("webkitTransitionEnd",e.animationListener),e.newChannelItem&&!e.upAni&&(e.channelContainer.removeClass("channelContainerStepAni"),e.channelContainer.detach(e.channelObjects.shift()),e.newChannelItem.removeClass(t),e.newChannelItem=null,e.channelContainer.removeClass(t),s=setInterval(e.channelBarStepAnimationFinish(e),1))}},channelBarStepAnimationFinish:function(e){return function(){clearInterval(s),e.channelContainer.addClass("channelContainerStepAni")}},detachChannelObjects:function(){for(var e=0;e<this.channelObjects.length;e++)this.channelObjects[e].detach()}}}),define("tvedemo/wgt/EPG/ProgrammeGrid/HorizontalAnimation",["xdk-base/console","tvedemo/wgt/Loading"],function(e,t){"use strict";var i;return{patron:null,animateProgrammes:function(e,n,s,r,a){return function(){t.open(),clearInterval(e.programmeAnimationDelay),e.epgContainer.addClass(s),i&&(e.epgContainerNext._root._dom.removeEventListener("transitionend",i),e.epgContainerNext._root._dom.removeEventListener("webkitTransitionEnd",i)),i=n.programmeAniComplete(e,n,a),e.epgContainerNext._root._dom.addEventListener("transitionend",i),e.epgContainerNext._root._dom.addEventListener("webkitTransitionEnd",i),e.epgContainerNext.removeClass(r)}},programmeAniComplete:function(e,n,s){return function(){e.epgContainerNext&&(e.epgContainerNext._root._dom.removeEventListener("transitionend",i),e.epgContainerNext._root._dom.removeEventListener("webkitTransitionEnd",i),e.epgMask.detach(e.epgContainer),t.close(),e.epgContainer=e.epgContainerNext,e.epgContainerNext=null,s&&s())}}}}),define("tvedemo/wgt/EPG/ProgrammeGrid/VerticalStepAnimation",["tvedemo/helper/sMoment","xdk-base/console"],function(e,t){"use strict";return{upAni:!1,verticalUpStep2Animation:function(e,t,i,n){return function(){clearInterval(e.programmeAnimationDelay),e.animationUpListener=t.verticalUpAniComplete(e,t,i,n),e.epgContainer._root._dom.addEventListener("transitionend",e.animationUpListener),e.epgContainer._root._dom.addEventListener("webkitTransitionEnd",e.animationUpListener),e.epgContainer.addClass("channelContainerStepAni"),e.epgContainer.removeClass(i)}},verticalUpAniComplete:function(e,t,i,n){return function(){e.epgContainer._root._dom.removeEventListener("transitionend",e.animationUpListener),e.epgContainer._root._dom.removeEventListener("webkitTransitionEnd",e.animationUpListener),e.newRow&&t.upAni&&(e.epgContainer.detach(e.epgProgrammeRows.pop()),e.newRow.removeClass(i),e.newRow=null,n&&n())}},verticalAniComplete:function(e,t,i,n){return function(){e.epgContainer._root._dom.removeEventListener("transitionend",e.animationListener),e.epgContainer._root._dom.removeEventListener("webkitTransitionEnd",e.animationListener),e.newRow&&!t.upAni&&(e.epgContainer.removeClass("channelContainerStepAni"),e.epgContainer.detach(e.epgProgrammeRows.shift()),e.newRow.removeClass(i),e.newRow=null,e.epgContainer.removeClass(i),e.programmeAnimationDelay=setInterval(t.verticalStepAnimationFinish(e,n),30))}},verticalStepAnimationFinish:function(e,t){return function(){clearInterval(e.programmeAnimationDelay),e.epgContainer.addClass("channelContainerStepAni"),t&&t()}}}}),
define("tvedemo/wgt/EPG/EpgProgrammeGrid",["tvedemo/wgt/EPG/ProgrammeGrid/HorizontalAnimation","tvedemo/wgt/EPG/data/Retrieval","tvedemo/wgt/EPG/ProgrammeGrid/VerticalStepAnimation","xdk-ax/evt/type","xdk-ax/Container","tvedemo/helper/sMoment","xdk-base/console","xdk-base/device"],function(e,t,i,n,s,r,a,o){"use strict";var l=0,c=function(e){return"number"==typeof e?e:new r(e).valueOf()};return{epgMask:null,epgContainer:null,epgContainerNext:null,epgProgrammeRows:null,newRow:null,patron:null,timeAndPosition:null,itemBuilder:null,channelBar:null,programmeAnimationDelay:null,animationListener:null,animationUpListener:null,setVariables:function(e,t,i,n){this.patron=e,this.timeAndPosition=t,this.itemBuilder=i,this.channelBar=n,l=e.scrollPanelWidth/e.timeSlotSize,this.epgProgrammeRows=[],this.setupContainers()},setupContainers:function(){this.epgMask=this.itemBuilder.returnContainer("epgMask","epgMask",this.patron),this.epgContainer=this.itemBuilder.returnContainer("epgContainer-"+this.timeAndPosition.dayPosition+"-"+this.timeAndPosition.slotPosition,"epgContainer channelContainerStepAni",this.epgMask)},setupProgrammes:function(){this.defineEndDayAndSlot(),this.setupProgrammesIn(this.epgContainer)},defineEndDayAndSlot:function(){try{var e=t.retrieveChannelProgrammes(0,this.patron,this.patron.programmes.length-1),i=c(t.retrieveProgrammeDataElement(e,e.length-1,this.patron.programmeDataStartTime)),n=c(t.retrieveProgrammeDataElement(e,e.length-1,this.patron.programmeDataEndTime)),s=this.timeAndPosition.getTimeSlot(i);this.patron.endDay=s.dayPosition,this.patron.endSlot=r(i).startOf("d").unix()!=r(n).startOf("d").unix()?11:s.slotPosition}catch(e){a.log("[EpgProgrammeGrid].defineEndDayAndSlot not posible")}},moveOneProgrammesVertical:function(e,t){var n,s;this.timeAndPosition.getTopChannelIndex(),n=e>0?this.timeAndPosition.getTopChannelIndex()+(this.patron.numberOfRows-1):this.timeAndPosition.getTopChannelIndex(),n>=this.patron.channels.length&&(n-=this.patron.channels.length),this.newRow=this.generateRow(n,n,this.epgContainer,e<0),s="beforeTop",e>0?(i.upAni=!1,this.animationListener=i.verticalAniComplete(this,i,s,t),this.epgContainer._root._dom.addEventListener("transitionend",this.animationListener),this.epgContainer._root._dom.addEventListener("webkitTransitionEnd",this.animationListener),this.epgContainer.addClass(s)):(i.upAni=!0,this.epgContainer.removeClass("channelContainerStepAni"),this.epgContainer.addClass(s),this.programmeAnimationDelay=setInterval(i.verticalUpStep2Animation(this,i,s,t),30));var r=0===n,a=n===this.patron.channels.length-1;this.patron.verticalScrollFunc(r,a)},moveProgrammesHorizontal:function(t,i){var n,s,r,a;t>0?(n="epgRight",s="epgLeft"):(n="epgLeft",s="epgRight"),0===this.timeAndPosition.slotPosition&&(r=!0),11===this.timeAndPosition.slotPosition&&(a=!0),this.patron.horizontalScrollFunc(r,a),this.epgContainerNext=this.itemBuilder.returnContainer("epgContainer-"+this.timeAndPosition.dayPosition+"-"+this.timeAndPosition.slotPosition,"epgContainer channelContainerStepAni "+n,this.epgMask),this.setupProgrammesIn(this.epgContainerNext),this.programmeAnimationDelay=setInterval(e.animateProgrammes(this,e,s,n,i),30)},setupProgrammesIn:function(e){var t,i=this.timeAndPosition.getTopChannelIndex(),n=i+this.patron.numberOfRows;this.epgProgrammeRows=[];for(var s=i;s<n;s++)t=s>=this.patron.channels.length?this.patron.channels.length:0,this.generateRow(s-t,s,e)},generateRow:function(e,i,n,r){var a=t.retrieveChannelProgrammes(e,this.patron,this.timeAndPosition.dayPosition),o=t.retrieveChannelDataElement(e,this.patron.channelDataStatus,this.patron),l=t.retrieveChannelDataElement(e,this.patron.channelDataBlackout,this.patron),c=t.retrieveChannelDataElement(e,this.patron.channelDataSubscribed,this.patron),d=t.retrieveChannelDataElement(e,this.patron.channelDataType,this.patron),u=this.patron.channels[e],h=this.itemBuilder.returnContainer("row-"+i,"programmeRow",n,r?s.PLACE_PREPEND:s.PLACE_APPEND);return h.channelData=u,r?this.epgProgrammeRows.unshift(h):this.epgProgrammeRows.push(h),this.setupProgrammesInRow(a,h,o,l,c,d),h},setupProgrammesInRow:function(e,i,n,s,r,o){var l=this.timeAndPosition.returnTimeSlot(),d=l+this.patron.timeSlotSize*this.timeAndPosition.MS_IN_1_MIN,u=this.getFirstProgrammeIndex(l,d,e);if(!1===u||0===e.length){var h=[];return h.push(this.createDummyProgramme(l,d)),void this.populateRow([0],h,l,d,i,!0,n,s,r,o)}try{var _=[u];if(u<e.length-1){u+=1;for(var g=c(t.retrieveProgrammeDataElement(e,u,this.patron.programmeDataStartTime));g<d&&(_.push(u),(u+=1)!=e.length);)g=c(t.retrieveProgrammeDataElement(e,u,this.patron.programmeDataStartTime))}this.populateRow(_,e,l,d,i,!1,n,s,r,o)}catch(e){a.warn("[Epg ProgrammeGrid]setupProgrammesInRow "+e)}},populateRow:function(e,i,s,r,l,d,u,h,_,g){for(var f,p,m,v,b,S,y,E,k,C=e.length,T=0;T<C;T++){if(f=c(t.retrieveProgrammeDataElement(i,e[T],this.patron.programmeDataStartTime)),p=c(t.retrieveProgrammeDataElement(i,e[T],this.patron.programmeDataEndTime)),m=this.returnProgrammeLeftAndWidth(f,p,s,r),0!==T||0===m.left||d||this.populateRow([0],[this.createDummyProgramme(s,f)],s,r,l,!0,u,h,_,g),v=t.retrieveProgrammeDataElement(i,e[T],this.patron.programmeDataId),b=t.retrieveProgrammeDataElement(i,e[T],this.patron.programmeDataTitle),E=h||t.retrieveProgrammeDataElement(i,e[T],this.patron.programmeDataBlackout),S=i[e[T]],y=v?"programmeItem":"programmeItem dummy",this.patron.locked){var x=t.retrieveProgrammeDataElement(i,e[T],this.patron.programPrName);this.patron.getParentalRatingIndex(x)}var I=(new Date).getTime();f<=I&&p>I?y+=" programme-onnow":p<I&&(y+=" programme-past"),E&&("playstation"===o.platform?y+=" programme-blackout-playstation":y+=" programme-blackout"),g&&(y+=" "+g),k=this.itemBuilder.returnProgrammeItem(v,y,b,S,l,m.left,m.width),k.addEventListener(n.FOCUS,this.itemFocus(this)),this.patron.programmeClickFunc?k.addEventListener(n.CLICK,this.patron.programmeClickFunc):d||a.warn("[Epg ProgrammeGrid ] programmeClickFunc not set"),T===C-1&&p<r&&!d&&this.populateRow([0],[this.createDummyProgramme(p,r)],s,r,l,!0,u,h,_,g)}},createDummyProgramme:function(e,t){return{blackout:!1,category:"",end:t,id:null,start:e,synopsis:"",thumbnail:"",title:"No programme available"}},itemFocus:function(e){return function(t){var i=t.target,n=i._parent,s=n._parent._children.indexOf(n);e.rowPosition(s)}},returnProgrammeLeftAndWidth:function(e,t,i,n){var s={},r=0;return s.left=0,e>i?s.left=Math.floor((e-i)/this.timeAndPosition.MS_IN_1_MIN*l):r=i-e,s.width=t<n?Math.floor((t-(e+r))/this.timeAndPosition.MS_IN_1_MIN*l):Math.floor((n-(e+r))/this.timeAndPosition.MS_IN_1_MIN*l),s},getFirstProgrammeIndex:function(e,i,n){for(var s,r,a=n.length,o=0;o<a;o++)if(s=c(t.retrieveProgrammeDataElement(n,o,this.patron.programmeDataStartTime)),r=c(t.retrieveProgrammeDataElement(n,o,this.patron.programmeDataEndTime)),s<i&&r>e)return o;return!1},rowPosition:function(e){return e>-1&&(this.timeAndPosition.rowPosition<this.patron.numberOfRows&&this.removeRowFocus(this.timeAndPosition.rowPosition),this.timeAndPosition.rowPosition=e,this.addRowFocus(e)),this.timeAndPosition.rowPosition},removeRowFocus:function(e){for(var t=this.epgProgrammeRows[e]._children,i=0;i<t.length;i++)t[i].removeClass("rowFocus");this.channelBar.channelObjects[e].removeClass("rowFocus")},addRowFocus:function(e){},returnNowProgrammeIndex:function(){for(var e,i,n=this.epgProgrammeRows[this.rowPosition()]._children,s=1e3*r().unix(),o=0;o<n.length;o++)if(a.log(n[o]),e=t.retrieveProgrammeElement(n[o]._opts.programmeData,this.patron.programmeDataStartTime),i=t.retrieveProgrammeElement(n[o]._opts.programmeData,this.patron.programmeDataEndTime),c(e)<s&&c(i)>s)return o;return 0},detachProgrammeRows:function(){for(var e=0;e<this.epgProgrammeRows.length;e++)this.epgProgrammeRows[e].detach()}}}),define("tvedemo/wgt/EPG/EPGKeyHandler",["tvedemo/wgt/EPG/data/Retrieval","xdk-base/device/vKey","xdk-ax/focusManager","xdk-base/console","tvedemo/helper/sMoment","xdk-base/util"],function(e,t,i,n,s,r){"use strict";var a,o,l,c=!1;return{setVariables:function(e,t,i){a=e,o=t,l=i},handleKey:function(e,i,s){return function(r){var o;if(n.log("[EPGKeyHandler]handleKey - evt "+r.id),n.log(r),c)switch(r.id){case"localUp":case"localDown":case t.UP.id:case t.DOWN.id:case t.RIGHT.id:case t.LEFT.id:case e.goToStartKey:case"device:kb-vkey:y":case t.NEXT.id:case"device:kb-vkey:m":case t.FF.id:case t.PREV.id:case"device:kb-vkey:n":case t.RW.id:return!1;default:return!0}else switch(r.id){case"device:kb-vkey:r":case e.forwardFocusKey:return e.forwardFocusFunc?e.forwardFocusFunc():n.warn("[EPG KeyHandler] opts.forwardFocusFunc not set"),!1;case"device:kb-vkey:y":case e.dateDialogKey:return e.dateDialogFunc?e.dateDialogFunc(e.endDay+1):n.warn("[EPG KeyHandler] opts.dateDialogFunc not set"),!1;case"device:kb-vkey:g":case e.submenuKey:return e.submenuFunc?e.submenuFunc():n.warn("[EPG KeyHandler] opts.submenuFunc not set"),!1;case"localUp":return a.rowPosition(0),o=a.timeAndPosition.getCurrentTimeSlotStart(),i.moveUp(e,{startTime:o,entTime:o},s),!1;case"localDown":a.rowPosition(e.numberOfRows-2),o=a.timeAndPosition.getCurrentTimeSlotStart();var l=function(){i.goDownOne(e,{startTime:o,entTime:o},s)},d=i.downTargetTop(e);return i.checkForListingsInChannelPage(e,a.timeAndPosition.dayPosition,d,l),!1;case t.UP.id:return i.moveUp(e,r),!1;case t.OK.id:return e.programmeClickFunc?e.programmeClickFunc(r):n.warn("[Epg KeyHandler ] programmeClickFunc not set"),!1;case t.DOWN.id:return i.moveDown(e,r),!1;case t.RIGHT.id:return i.moveRight(e,r,i),!1;case t.LEFT.id:return i.moveLeft(e,r,i),!1;case e.goToStartKey:case"device:kb-vkey:b":return i.nowPosition(this),!1;case t.NEXT.id:case"device:kb-vkey:m":case t.FF.id:return i.dayRight(e),!1;case t.PREV.id:case"device:kb-vkey:n":case t.RW.id:return a.timeAndPosition.dayPosition>0&&(a.timeAndPosition.slotPosition<a.timeAndPosition.dataStartSlot&&1==a.timeAndPosition.dayPosition&&(a.timeAndPosition.slotPosition=a.timeAndPosition.dataStartSlot),i.dayLeft(e)),!1;default:return n.log("[EPGKeyHandler]handleKey - evt "+r.id+" : TRUE"),!0}return!0}},goToDay:function(e,t){if(t>=e.minDay&&t<=e.maxDay&&t!=a.timeAndPosition.dayPosition){var i,n=(a.timeAndPosition.slotPosition,-1);a.timeAndPosition.slotPosition<a.timeAndPosition.dataStartSlot&&0==t&&a.timeAndPosition.dataStartSlot;var s=r.bind(function(){c=!0,t>a.timeAndPosition.dayPosition?(n=1,i=1440*(t-a.timeAndPosition.dayPosition)/e.timeSlotSize,o.moveDays(i,n,this.pageFocus(0,this))):(i=1440*(a.timeAndPosition.dayPosition-t)/e.timeSlotSize,o.moveDays(i,n,this.pageFocus("last",this)))},this);this.checkForListings(e,t,s)}},moveUp:function(e,t,i){var n;n=i?t:this.returnStartAndEndTime(e,t.target._opts.programmeData);var s=a.timeAndPosition.getTopChannelIndex()-a.patron.numberOfRows;s<0&&(s+=a.timeAndPosition.numberOfChannels),s%a.patron.numberOfRows>0&&(s+=a.patron.numberOfRows-s%a.patron.numberOfRows),s>=a.timeAndPosition.numberOfChannels-1&&(s-=a.timeAndPosition.numberOfChannels-1);var o=r.bind(function(){this.goUpOne(e,n,i)},this);this.checkForListingsInChannelPage(e,a.timeAndPosition.dayPosition,s,o)},goUpOne:function(e,t,i){0==a.rowPosition()?this.scrollDelayUp||(this.scrollDelayUp=setTimeout(r.bind(function(){this.scrollDelayUp=!1},this),500),c=!0,i?o.nextUp(r.bind(function(){this.itemFocus(t,e,this)(),i()},this),!0):o.nextUp(this.itemFocus(t,e,this))):(a.rowPosition(a.rowPosition()-1),this.itemFocus(t,e,this)())},moveDown:function(e,t){var i=this.returnStartAndEndTime(e,t.target._opts.programmeData),n=this.downTargetTop(e);if(!(n>a.timeAndPosition.numberOfChannels)){if(n===a.timeAndPosition.numberOfChannels)return void this.goDownOne(e,i,null,!0);var s=r.bind(function(){this.goDownOne(e,i)},this);this.checkForListingsInChannelPage(e,a.timeAndPosition.dayPosition,n,s)}},downTargetTop:function(e){return a.timeAndPosition.getTopChannelIndex()+e.numberOfRows===a.timeAndPosition.numberOfChannels-2?a.timeAndPosition.getTopChannelIndex()+a.timeAndPosition.rowPosition+1:a.timeAndPosition.rowPosition===e.numberOfRows-2?a.timeAndPosition.getTopChannelIndex()+e.numberOfRows:a.timeAndPosition.getTopChannelIndex()+a.timeAndPosition.rowPosition+1},goDownOne:function(e,t,i,n){var s=a.timeAndPosition.getTopChannelIndex()+e.numberOfRows===a.timeAndPosition.numberOfChannels-1?1:2;a.timeAndPosition.rowPosition===e.numberOfRows-s&&!0!==n||i?this.scrollDelayDown||(this.scrollDelayDown=setTimeout(r.bind(function(){this.scrollDelayDown=!1},this),500),c=!0,i?o.nextDown(r.bind(function(){this.itemFocus(t,e,this)(),i&&i()},this)):o.nextDown(this.itemFocus(t,e,this))):a.timeAndPosition.rowPosition<=e.numberOfRows-s&&(a.rowPosition(a.timeAndPosition.rowPosition+1),this.itemFocus(t,e,this)())},checkForListings:function(e,t,i){if(!(t>=e.minDay&&t<=e.maxDay))return!1;var n=this.checkForListingsInDayPage(e,t);if(n[0].required||n[1].required){var s,r=2;n[0].required===n[1].required?(s=n[1].targetTop,n[0].targetTop!==n[1].targetTop&&(r=3)):n[0].required?s=n[0].targetTop:n[1].required&&(s=n[1].targetTop),e.requestListings(t,i,s,!1,r)}else i()},checkForListingsInDayPage:function(e,t){var i=a.timeAndPosition.getTopChannelIndex(),n=a.patron.numberOfRows;i<0&&(i+=a.timeAndPosition.numberOfChannels),i%a.patron.numberOfRows>0?i+=a.patron.numberOfRows-i%a.patron.numberOfRows:n=0,i>=a.timeAndPosition.numberOfChannels&&(i-=a.timeAndPosition.numberOfChannels);var s=i-n;s<0&&(s+=a.timeAndPosition.numberOfChannels);var r=!1,o=!1;return!e.programmes[t]||e.programmes[t].timestamp+e.listingsCache<(new Date).getTime()?(r=!0,o=!0):(e.programmes[t].data[i]||(r=!0),e.programmes[t].data[s]||(o=!0)),[{required:r,targetTop:i},{required:o,targetTop:s}]},checkForListingsInChannelPage:function(e,t,i,n,s){if(!(t>=e.minDay&&t<=e.maxDay))return!1;!e.programmes[t]||!e.programmes[t].data[i]||e.programmes[t].timestamp+e.listingsCache<(new Date).getTime()?e.requestListings(t,n,i,s):n()},getNewDayPosition:function(e){var t=a.timeAndPosition.dayPosition,i=a.timeAndPosition.slotPosition;return i+=e,i>11?(i-=12,t+=1):i<0&&(i+=12,t-=1),t},checkForEnd:function(e,t,i){var n=i.getNewDayPosition(t);return n<=e.maxDay&&n>=e.minDay},returnValidEnd:function(e,t,i,n){if(e>i.endDay)this.checkForListings(i,e).then(function(){n()});else{if(e==i.endDay&&t>i.endSlot)return!1;n()}},dayLeft:function(e){this.checkForListings(e,a.timeAndPosition.dayPosition-1,r.bind(function(){l.hide(),c=!0,o.prevDay(this.pageFocus("last",this))},this))},dayRight:function(e){this.checkForListings(e,a.timeAndPosition.dayPosition+1,r.bind(function(){l.hide(),c=!0,o.nextDay(this.pageFocus(0,this))},this))},nowPosition:function(e){var t=this.nowNavigationFunction();if(t){c=!0,a.timeAndPosition.slotPosition=a.timeAndPosition.dataStartSlot,a.timeAndPosition.dayPosition=1;var i=this.nowNavigationCallback(this,t);this.checkForListings(e,0,r.bind(i,o))}},nowNavigationCallback:function(e,t){return function(){t(e.pageFocus("current",e))}},nowNavigationFunction:function(){return 0===a.timeAndPosition.dayPosition?a.timeAndPosition.slotPosition>a.timeAndPosition.dataStartSlot?r.bind(o.prevDay,o):a.timeAndPosition.slotPosition<a.timeAndPosition.dataStartSlot?r.bind(o.prevDay,o):void 0:(a.timeAndPosition.dayPosition,r.bind(o.prevDay,o))},moveLeft:function(e,t,i){var n=t.target;c||i.goLeft(n,e,i)},goToPrevPage:function(e,t,i){!c&&t.checkForEnd(e,1,t)&&(0==a.timeAndPosition.dayPosition&&a.timeAndPosition.slotPosition==a.timeAndPosition.dataStartSlot||(l.hide(),c=!0,i?o.nextLeft(function(){t.pageFocus("last",t)(),i()}):o.nextLeft(t.pageFocus("last",t))))},goLeft:function(e,t,n){var s=e._parent,d=s._children,u=d.indexOf(e)-1;-1==u&&this.checkForEnd(t,-1,this)?t.bookendHorizontal&&0===a.timeAndPosition.slotPosition||this.checkForListings(t,n.getNewDayPosition(-1),r.bind(function(){l.hide(),c=!0,o.nextLeft(this.pageFocus("last",this))},this)):i.focus(d[u])},moveRight:function(e,t,i){var n=t.target;i.goRight(n,e,i)},goToNextPage:function(e,t,i){!c&&t.checkForEnd(e,1,t)&&(e.endOfData||(l.hide(),c=!0,i?o.nextRight(function(){t.pageFocus(0,t)(),i()}):o.nextRight(t.pageFocus(0,t))))},goRight:function(e,t,n){var s=e._parent,r=s._children,d=r.indexOf(e)+1;if(d==r.length){if(!t.bookendHorizontal||11!==a.timeAndPosition.slotPosition){var u=function(){l.hide(),c=!0,o.nextRight(n.pageFocus(0,n))};n.checkForEnd(t,1,n)&&n.checkForListings(t,n.getNewDayPosition(1),u)}}else i.focus(r[d])},pageFocus:function(e,t){return function(n){l.updateMarkerPosition(l)(),"last"==e?e=a.epgProgrammeRows[a.rowPosition()]._children.length-1:"current"==e&&(e=a.returnNowProgrammeIndex()),n||(e=t.validateFocus(e),i.focus(a.epgProgrammeRows[a.rowPosition()]._children[e])),c=!1}},validateFocus:function(e){return e<0&&(e=this.findFocus()),0==a.epgProgrammeRows[a.rowPosition()]._children.length&&(e=this.findFocus()),a.epgProgrammeRows[a.rowPosition()]._children.length-1<e&&(e=a.epgProgrammeRows[a.rowPosition()]._children.length-1),e},findFocus:function(){for(var e=0;e<a.epgProgrammeRows.length;e++)if(a.epgProgrammeRows[e]._children.length>0)return a.rowPosition(e),0;return 0},returnStartAndEndTime:function(t,i){var n={};return n.startTime=s(e.retrieveProgrammeElement(i,t.programmeDataStartTime)).unix(),n.endTime=s(e.retrieveProgrammeElement(i,t.programmeDataEndTime)).unix(),n},itemFocus:function(e,t,n){return function(){var s,r=a.epgProgrammeRows[a.rowPosition()]._children,o=r.length,l=[],d=n.returnOnNowFocusItem(t,n,r,e);if(null===d){for(var u=0;u<o;u++)s=n.returnStartAndEndTime(t,r[u]._opts.programmeData),l.push(n.weightItem(s,e));d=n.returnItemToFocusFromWeight(r,l)}i.focus(d),c=!1}},returnOnNowFocusItem:function(e,t,i,n){var r,a,o=s().unix();if(n.startTime<o&&n.endTime>o){a=i.length;for(var l=0;l<a;l++)if(r=t.returnStartAndEndTime(e,i[l]._opts.programmeData),r.startTime<o&&r.endTime>o)return i[l]}return null},returnItemToFocusFromWeight:function(e,t){for(var i=e[0],n=t[0],s=e.length,r=1;r<s;r++)n<t[r]&&(i=e[r],n=t[r]);return i},weightItem:function(e,t){var i=0;return e.startTime>t.endTime?0:e.endTime<t.startTime?0:e.startTime==t.startTime?100:e.startTime<t.startTime&&e.endTime>=t.endTime?100:(e.startTime<t.startTime&&e.endTime<t.endTime?i=e.endTime-t.startTime:e.startTime>t.startTime&&e.endTime<t.endTime?i=e.endTime-e.startTime:e.startTime>t.startTime&&e.endTime>t.endTime&&(i=t.endTime-e.startTime),100/(t.endTime-t.startTime)*i)}}}),define("tvedemo/wgt/EPG/EpgNavigation",["tvedemo/helper/sMoment","xdk-base/console"],function(e,t){"use strict";return{patron:null,channelBar:null,programmeGrid:null,topBar:null,setVariables:function(e,t,i,n){this.patron=e,this.channelBar=t,this.programmeGrid=i,this.topBar=n},nextUp:function(e,t){var i=this.programmeGrid.timeAndPosition.getTopChannelIndex()-1;if((i<0||i>=this.patron.channels.length)&&this.patron.verticalPagingDisabled())return e(),void(t||this.patron.submenuFunc());this.programmeGrid.removeRowFocus(this.programmeGrid.timeAndPosition.rowPosition),this.channelBar.moveChannel(-1),this.programmeGrid.moveOneProgrammesVertical(-1,e)},nextDown:function(e){var t=this.programmeGrid.timeAndPosition.getTopChannelIndex()+this.patron.maxRows;if((t<0||t>=this.patron.channels.length)&&this.patron.verticalPagingDisabled())return e();this.programmeGrid.removeRowFocus(this.programmeGrid.timeAndPosition.rowPosition),this.channelBar.moveChannel(1),this.programmeGrid.moveOneProgrammesVertical(1,e)},nextRight:function(e){this.topBar.moveTimeLineHorizontal(1)?this.programmeGrid.moveProgrammesHorizontal(1,e):e(!0)},nextLeft:function(e){this.topBar.moveTimeLineHorizontal(-1)?this.programmeGrid.moveProgrammesHorizontal(-1,e):e(!0)},nextDay:function(e){var t=1440/this.patron.timeSlotSize;this.topBar.moveTimeLineHorizontal(t)?this.programmeGrid.moveProgrammesHorizontal(t,e):e(!0)},prevDay:function(e){var t=1440/this.patron.timeSlotSize;this.topBar.moveTimeLineHorizontal(-t)?this.programmeGrid.moveProgrammesHorizontal(-t,e):e(!0)},moveDays:function(e,t,i){this.topBar.moveTimeLineHorizontal(t*e)?this.programmeGrid.moveProgrammesHorizontal(t*e,i):i(!0)}}}),define("tvedemo/wgt/EPG/EpgTimeMarker",["tvedemo/helper/sMoment","xdk-base/console","tvedemo/helper/CentralEuropeanTime"],function(e,t,i){"use strict";var n;return{patron:null,timeAndPosition:null,programmeGrid:null,itemBuilder:null,timeMarker:null,timeMarkerHTML:null,startingLeft:0,markerWidthInTime:0,interval:null,setVariables:function(e,t,i,s){this.patron=e,this.timeAndPosition=t,this.programmeGrid=i,this.itemBuilder=s,this.setupContainers(),n=e.scrollPanelWidth/e.timeSlotSize;var r=this.timeAndPosition.getCurrentSlotTimesForMarker().startTime-this.timeAndPosition._getStartOfDayTimestamp(),a=r*(n/this.timeAndPosition.MS_IN_1_MIN)%e.scrollPanelWidth;this.startingLeft=e.channelBarWidth+a-e.timeMarkerImageWidth/2,this.show()},setupContainers:function(){this.timeMarker=this.itemBuilder.returnContainer("timeMarker","timeMarker hidden",this.patron),this.timeMarkerHTML=this.timeMarker.getRoot().getHTMLElement()},updateMarkerPosition:function(e){return function(){var t=e.timeAndPosition.getCurrentSlotTimesForMarker();if(t.dataStartSlot&&(e.timeAndPosition.dataStartSlot=t.dataStartSlot),t.startTime){var s=i.getTimestampMillis()-t.startTime;s>t.endTime-t.startTime?e.hide():(e.timeMarker.removeClass("hidden"),e.timeMarkerHTML.style.left=e.startingLeft+s*(n/e.timeAndPosition.MS_IN_1_MIN)+"px")}else e.hide()}},hide:function(){this.timeMarker.addClass("hidden")},show:function(){null==this.interval&&(this.interval=setInterval(this.updateMarkerPosition(this),500)),this.updateMarkerPosition(this)()}}}),define("tvedemo/wgt/EPG/EpgOptions",["xdk-base/device/vKey"],function(e){"use strict";var t=null,i=null;return{setOptions:function(e,n,s){i=s,i.dayPosition=e.offset?e.offset:0,t=n,this.resetOptions(e)},resetOptions:function(e){this.populateVariables(e),this.populateDataLocations(e),this.populateEpgDimensions(e),this.populateTimeMarker(e),this.populateKeyHandling(e),this.populateColours(e)},populateVariables:function(e){t.locateTop=e.locateTop?e.locateTop:170,t.locateLeft=e.locateLeft?e.locateLeft:80,t.numberOfRows=e.numberOfRows?e.numberOfRows:6,t.maxRows=t.numberOfRows,t.maxDay=e.maxDay?e.maxDay:7,t.minDay=e.minDay?e.minDay:0,t.setFocusOnLaunch=!e.setFocusOnLaunch||e.setFocusOnLaunch,t.setFocusOnLaunchDelay=e.setFocusOnLaunchDelay?e.setFocusOnLaunchDelay:200,(e.topChannelIndex||0===e.topChannelIndex)&&i.setTopChannelIndex(e.topChannelIndex),t.requestListings=e.requestListingsFunc?e.requestListingsFunc:null,t.requestListingsErrorHandler=e.requestListingsErrorHandler?e.requestListingsErrorHandler:null,t.horizontalScrollFunc=e.horizontalScrollFunc?e.horizontalScrollFunc:null,t.verticalScrollFunc=e.verticalScrollFunc?e.verticalScrollFunc:null,i.stopVerticalPaging=!!e.stopVerticalPaging&&e.stopVerticalPaging,t.forcedStopVerticalPaging=!!e.stopVerticalPaging&&e.stopVerticalPaging,t.listingsCache=e.listingsCache?e.listingsCache:36e5,t.prIndex=e.parentalRatingIndex?e.parentalRatingIndex:null,e.parentalRatingIndex>-1?t.locked=!0:t.locked=!1,t.getParentalRatingIndex=e.getParentalRatingIndex,t.programmeDataFlags=e.programmeDataFlags?e.programmeDataFlags:"flags",t.loggedIn=!!e.loggedIn&&e.loggedIn,t.bookendHorizontal=!!e.bookendHorizontal&&e.bookendHorizontal},populateColours:function(e){t.channelHeaderLabelBackgroundColour=e.channelHeaderLabelBackgroundColour?e.channelHeaderLabelBackgroundColour:[23,34,82,1],t.channelHeaderLabelTextColour=e.channelHeaderLabelTextColour?e.channelHeaderLabelTextColour:[115,120,153,1],t.timeLineItemBackgroundColour=e.timeLineItemBackgroundColour?e.timeLineItemBackgroundColour:[23,34,82,1],t.timeLineItemTextColour=e.timeLineItemTextColour?e.timeLineItemTextColour:[115,120,153,1],t.channelObjectBackgroundColour=e.channelObjectBackgroundColour?e.channelObjectBackgroundColour:[23,34,82,1],t.channelObjectOfflineColour=e.channelObjectOfflineColour?e.channelObjectOfflineColour:[36,39,44,1],t.channelObjectBlackoutColour=e.channelObjectBlackoutColour?e.channelObjectBlackoutColour:[36,39,44,1],t.channelObjectUnsubscribedColour=e.channelObjectUnsubscribedColour?e.channelObjectUnsubscribedColour:[36,39,44,1],t.channelObjectTextColour=e.channelObjectTextColour?e.channelObjectTextColour:[115,120,153,1],t.channelMaskBackgroundColour=e.channelMaskBackgroundColour?e.channelMaskBackgroundColour:[0,0,0,0],t.epgBackgroundColour=e.epgBackgroundColour?e.epgBackgroundColour:[0,0,0,1],t.programmeItemBackgroundColour=e.programmeItemBackgroundColour?e.programmeItemBackgroundColour:[83,90,98,.4],t.programmeItemTextColour=e.programmeItemTextColour?e.programmeItemTextColour:[255,255,255,1],t.programmeItemPastBackgroundColour=e.programmeItemPastBackgroundColour?e.programmeItemPastBackgroundColour:[129,130,134,1],t.programmeItemPastTextColour=e.programmeItemPastTextColour?e.programmeItemPastTextColour:[255,255,255,1],t.programmeItemOnNowBackgroundColour=e.programmeItemOnNowBackgroundColour?e.programmeItemOnNowBackgroundColour:[83,90,93,1],t.programmeItemOnNowTextColour=e.programmeItemOnNowtextColour?e.programmeItemOnNowTextColour:[255,255,255,1],t.programmeItemOnDemandBackgroundColour=e.programmeItemOnDemandBackgroundColour?e.programmeItemOnDemandBackgroundColour:[83,90,93,1],t.programmeItemOnDemandTextColour=e.programmeItemOnDemandtextColour?e.programmeItemOnDemandTextColour:[255,255,255,1],t.programmeItemBlackoutColour=e.programmeItemBlackoutColour?e.programmeItemBlackoutColour:[83,90,98,.4],t.programmeItemBlackoutTextColour=e.programmeItemBlackoutTextColour?e.programmeItemBlackoutTextColour:[255,255,255,.4],t.programmeItemOfflineColour=e.programmeItemOfflineColour?e.programmeItemOfflineColour:[36,39,44,1],t.programmeItemOfflineTextColour=e.programmeItemOfflineTextColour?e.programmeItemOfflineTextColour:[130,131,135,1],t.programmeItemUnsubscribedColour=e.programmeItemUnsubscribedColour?e.programmeItemUnsubscribedColour:[36,39,44,1],t.programmeItemUnsubscribedTextColour=e.programmeItemUnsubscribedTextColour?e.programmeItemUnsubscribedTextColour:[130,131,135,1],t.rowFocusBackgroundColour=e.rowFocusBackgroundColour?e.rowFocusBackgroundColour:[110,111,112,1],t.rowFocusTextColour=e.rowFocusTextColour?e.rowFocusTextColour:[255,255,255,1],t.programmeItemFocusedBackgroundColour=e.programmeItemFocusedBackgroundColour?e.programmeItemFocusedBackgroundColour:[0,127,212,1],t.programmeItemPaidFocusedBackgroundColour=e.programmeItemPaidFocusedBackgroundColour?e.programmeItemPaidFocusedBackgroundColour:[219,58,148,1],t.programmeItemFocusedTextColour=e.programmeItemFocusedTextColour?e.programmeItemFocusedTextColour:[255,255,255,1]},populateEpgDimensions:function(e){t.timeSegment=e.timeSegmentMinutes?e.timeSegmentMinutes:30,t.timeSlotSize=e.timeSlotSizeMinutes?e.timeSlotSizeMinutes:120,t.scrollPanelWidth=e.scrollPanelWidthPx?e.scrollPanelWidthPx:936,t.scrollPanelHeight=e.scrollPanelHeightPx?e.scrollPanelHeightPx:282,t.channelRowHeight=e.channelRowHeightPx?e.channelRowHeightPx:46,t.channelBarWidth=e.channelBarWidthPx?e.channelBarWidthPx:185,t.topBarHeight=e.topBarHeightPx?e.topBarHeightPx:38,t.programmeTextPadding=e.programmeTextPadding?e.programmeTextPadding:10},populateTimeMarker:function(e){t.timeMarkerImage=e.timeMarkerImage?e.timeMarkerImage:"img/program_guide/on_now_pointer.png",t.timeMarkerImageTop=e.timeMarkerImageTop?e.timeMarkerImageTop:6,t.timeMarkerImageWidth=e.timeMarkerImageWidth?e.timeMarkerImageWidth:26,t.timeMarkerImageHeight=e.timeMarkerImageHeight?e.timeMarkerImageHeight:33},populateKeyHandling:function(i){t.goToStartKey=i.goToStartKey?i.goToStartKey:e.YELLOW.id,t.dateDialogFunc=i.dateDialogFunc?i.dateDialogFunc:null,t.dateDialogKey=i.dateDialogKey?i.dateDialogKey:"Not-In-Use",t.forwardFocusFunc=i.forwardFocusFunc?i.forwardFocusFunc:null,t.forwardFocusKey=i.forwardFocusKey?i.forwardFocusKey:"Not-In-Use",t.submenuFunc=i.submenuFunc?i.submenuFunc:null,t.submenuKey=i.submenuKey?i.submenuKey:"Not-In-Use",t.programmeClickFunc=i.programmeClickFunc?i.programmeClickFunc:null},populateDataLocations:function(e){t.channelDataId=e.channelDataId,t.channelDataTitle=e.channelDataTitle,t.channelDataLogo=e.channelDataLogo,t.channelDataStatus=e.channelDataStatus?e.channelDataStatus:[],t.channelDataBlackout=e.channelDataBlackout?e.channelDataBlackout:[],t.channelDataSubscribed=e.channelDataSubscribed?e.channelDataSubscribed:["subscribed"],t.channelDataType=e.channelDataType?e.channelDataType:[],t.channelPackColourCode=e.channelPackColourCode?e.channelPackColourCode:[],t.programmeSetDataBase=e.programmeSetDataBase,t.programmeDataBase=e.programmeDataBase,t.programmeDataId=e.programmeDataId,t.programmeDataTitle=e.programmeDataTitle,t.programmeDataStartTime=e.programmeDataStartTime,t.programmeDataEndTime=e.programmeDataEndTime,t.programmeDataBlackout=e.programmeDataBlackout?e.programmeDataBlackout:[],t.programPrName=e.programPrName?e.programPrName:""}}}),define("tvedemo/wgt/EPG",["xdk-base/class","xdk-ax/Container","xdk-ax/focusManager","tvedemo/wgt/EPG/EpgItemBuilder","tvedemo/wgt/EPG/EpgTimeAndPosition","tvedemo/wgt/EPG/EpgTopBar","tvedemo/wgt/EPG/EpgChannelBar","tvedemo/wgt/EPG/EpgProgrammeGrid","tvedemo/wgt/EPG/EPGKeyHandler","tvedemo/wgt/EPG/EpgNavigation","tvedemo/wgt/EPG/EpgTimeMarker","tvedemo/wgt/EPG/EpgOptions","xdk-base/device/vKey","tve/mgr/sLinearManager","xdk-base/util","tvedemo/wgt/Loading"],function(e,t,i,n,s,r,a,o,l,c,d,u,h,_,g,f){var p=null;return e.create(t,{},{topBarHeight:null,channelRowHeight:null,channelBarWidth:null,scrollPanelWidth:null,timeSlotSize:null,timeSegment:null,numberOfRows:null,maxDay:null,minDay:null,setFocusOnLaunch:null,programmeTextPadding:null,goToStartKey:null,timeMarkerImage:null,timeMarkerImageTop:null,timeMarkerImageWidth:null,timeMarkerImageHeight:null,channelDataId:null,channelDataTitle:null,channelDataLogo:null,programmeSetDataBase:null,programmeDataBase:null,programmeDataId:null,programmeDataTitle:null,programmeDataStartTime:null,programmeDataEndTime:null,dateDialogFunc:null,dateDialogKey:null,forwardFocusFunc:null,forwardFocusKey:null,programmeClickFunc:null,submenuKey:null,submenuFunc:null,requestListings:null,requestListingsErrorHandler:null,horizontalScrollFunc:null,verticalScrollFunc:null,channels:null,programmes:[],endOfData:!1,endDay:null,endSlot:null,maxRows:6,loggedIn:!1,sideload:!0,init:function(e){u.setOptions(e,this,s),this._super(e),s.setCurrentTimeSlot(this),this.setChildVariables(),r.setUpHeaderAndTimeLine(s.returnTimeSlot(s.dayPosition,this.slotPosition))},resetOpts:function(e){u.resetOptions(e)},setRowsAndPaging:function(e,t){this.numberOfRows=e,s.stopVerticalPaging=t},verticalPagingDisabled:function(){return s.stopVerticalPaging},setChildVariables:function(){n.patron=this,r.setVariables(this,s,n),a.setVariables(this,s,n),o.setVariables(this,s,n,a),d.setVariables(this,s,o,n),c.setVariables(this,a,o,r),l.setVariables(o,c,d)},setChannels:function(e){return function(t){t&&(s.numberOfChannels=t.length,s.numberOfChannels<=e.numberOfRows?e.setRowsAndPaging(s.numberOfChannels,!0):e.setRowsAndPaging(e.maxRows,e.forcedStopVerticalPaging),e.channels=t)}},setProgrammeData:function(e){return function(t,i,n){if(t){var s=e.programmes[i];if(s=s?s.data:e.createProgrammeDataDay(),s=e.populateProgrammeDataPage(t,n,s),e.programmes[i]={timestamp:(new Date).getTime(),data:s},e.programmes[i])return!0}return!1}},populateProgrammeDataPage:function(e,t,i){for(var n=0;n<e.length;n++){var r=n+t;r>=s.numberOfChannels&&(r-=s.numberOfChannels),i[r]=e[n]}return i},createProgrammeDataDay:function(){for(var e=[],t=0;t<s.numberOfChannels;t++)e.push(null);return e},refreshProgrammeData:function(){o.defineEndDayAndSlot()},setupEpg:function(e){return function(){a.setupChannels(),o.setupProgrammes(),e.setFocusOnLaunch&&(e.setFocusOnLaunchDelay>0?p=setInterval(e.focusFirstItem(e),e.setFocusOnLaunchDelay):e.focusFirstItem(e)())}},focusFirstItem:function(e){return function(){var e;clearInterval(p),document.getElementsByClassName("wgt-dialog").length>0&&(e=i.getCurFocus()),document.getElementsByClassName("program-detail-popup").length>0&&(e=i.getCurFocus()),
i.focus(o.epgProgrammeRows[0]._children[o.returnNowProgrammeIndex()]),e&&i.focus(e)}},handleKey:function(e){return l.handleKey(e,l)},goToNowPosition:function(){console.log("[EPG]goToStartPosition"),l.nowPosition(this)},goToNextPage:function(){console.log("[EPG]goToNextDay"),l.goToNextPage(this,l)},goToNextPageScoped:function(e,t){return function(){console.log("[EPG]goToNextDay"),l.goToNextPage(e,l,t)}},goToPrevPage:function(){console.log("[EPG]goToPrevDay"),l.goToPrevPage(this,l)},goToPrevPageScoped:function(e,t){return function(){console.log("[EPG]goToPrevDay"),l.goToPrevPage(e,l,t)}},goToNextDay:function(){console.log("[EPG]goToNextDay"),l.handleKey(this,l)({id:h.RW.id})},goToNextDayScoped:function(e){return function(){console.log("[EPG]goToNextDay"),l.handleKey(e,l)({id:h.RW.id})}},goToPrevDay:function(){console.log("[EPG]goToPrevDay"),l.handleKey(this,l)({id:h.FF.id})},goToPrevDayScoped:function(e){return function(){console.log("[EPG]goToPrevDay"),l.handleKey(e,l)({id:h.FF.id})}},goUpOneScoped:function(e,t){return function(){console.log("[EPG]goUpOneScoped"),l.handleKey(e,l,t)({id:"localUp"})}},goUpOne:function(){console.log("[EPG]goUpOne"),l.handleKey(this,l)({id:"localUp"})},goDownOneScoped:function(e,t){return function(){console.log("[EPG]goDownOneScoped"),l.handleKey(e,l,t)({id:"localDown"})}},goDownOne:function(){console.log("[EPG]goDownOne"),l.handleKey(this,l)({id:"localDown"})},goToDay:function(e){console.log("[EPG]goToDay "+e),l.goToDay(this,e)},resetEpgData:function(){this.channels=null,this.programmes=[],this.endOfData=!1,this.endDay=null,this.endSlot=null,s.timeslotPosition=0,s.dayPosition=0,s.rowPosition=0,s.numberOfChannels=null,s.dataStartSlot=0,s.setTopChannelIndex(0),a.detachChannelObjects(),o.detachProgrammeRows()}})}),define("tvedemo/tmpl/programListing",["xdk-ax/Container","xdk-ui-basic/Layout","xdk-ui-basic/Label","tvedemo/wgt/EPG","xdk-ui-basic/Image","storm/mgr/sLanguageManager","storm/mgr/sAppConfigManager","xdk-base/device"],function(e,t,i,n,s,r,a,o){return function(){return{klass:t,css:"program-guide-view",alignment:t.VERTICAL,autoNavigation:!1,children:[{klass:e,css:"program-detail-container",children:[{klass:e,css:"thumbnail-wrapper",children:[{klass:s,id:"thumbnail",css:"thumbnail",placeHolderPromise:a.getPlaceholderLandscape},{klass:e,css:"thumbnail-overlay hidden",id:"thumbnail-overlay",children:[{id:"thumbnail-overlay-message",klass:i,text:r.getString("Epg.blackoutShort"),css:"thumbnail-unavailable"}]}]},{klass:i,id:"title",css:"title"},{klass:e,css:"packageNeeded hidden",id:"packageNeeded",children:[{klass:s,id:"packageNeededLogo",css:"packageNeededLogo"},{klass:i,id:"packageNeededLabel",text:"",css:"packageNeededLabel"}]},{klass:i,id:"metadata",css:"metadata"},{klass:i,id:"description",css:"description"}]},{klass:i,text:r.getString("Global.Global_buttonBack_button"),css:"program-guide-back"},{klass:e,id:"epgGrid",css:"epgGrid"},{klass:e,css:"epg-bottom-gradient"}]}}}),define("storm/mgr/sLiveFeatureManager",["xdk-base/ax","xdk-base/core","xdk-base/util","xdk-base/class","xdk-base/promise","xdk-base/device","storm/mgr/sAppConfigManager"],function(e,t,i,n,s,r,a){"use strict";return new(n.create({},{isLiveSupported:function(){return a.getLiveFeatureStatus().then(function(e){var t=e&&e.platform?e.platform:{},i=t[r.platform],n=r.id.getFirmwareYear()+"";return!i||!0!==i.disabled||!(i.yearModel.indexOf(n)>=0||i.yearModel.indexOf("all")>=0)},function(){return!1})}}))}),define("tvedemo/ctrl/ProgramListing",["xdk-base/ax","xdk-ax/evt/type","xdk-ax/focusManager","xdk-base/device/vKey","xdk-base/promise","xdk-base/config","xdk-base/util","xdk-ax/mediator","xdk-ax/mvc/view","xdk-base/device","xdk-base/console","xdk-ax/Container","xdk-ui-basic/Image","xdk-ui-basic/Button","tvedemo/helper/sMoment","tvedemo/tmpl/programListing","tvedemo/ctrl/RoutableController","tvedemo/helper/dialogHelper","storm/mgr/sAppConfigManager","tve/mgr/sLinearManager","tve/videoPlaybackService/evt/VideoPlaybackControlsEvent","tve/videoPlaybackService/VideoManager","tve/videoPlaybackService/model/Playlist","tve/videoPlaybackService/model/PlaylistItem","tvedemo/wgt/TextSelectionListDialog","tvedemo/wgt/Loading","tvedemo/wgt/AlertDialog","tvedemo/wgt/EPG","tvedemo/wgt/EPG/data/Retrieval","tvedemo/mgr/sEndUserManager","xdk-base/Env","tvedemo/mgr/sNavigationManager","storm/mgr/sLanguageManager","tvedemo/model/ContextBuilder","tve/sServiceHolder","storm/mgr/sLiveFeatureManager"],function(e,t,i,n,s,r,a,o,l,c,d,u,h,_,g,f,p,m,v,b,S,y,E,k,C,T,x,I,w,L,A,D,P,R,O,N){var M=!1;return _KeyCallback=null,e.klass.create(p,{getDefaultState:function(){return{date:(new Date).getTime(),categoryId:"all"}}},{_title:null,_description:null,_initialising:!0,_arrows:null,_filtered:null,_epgGrid:null,_currentDate:(new Date).getTime(),_currentCategoryId:null,_numberOfChannelsToDisplay:6,_channelSet:null,programmeDataDescription:["_attrs","description"],programmeDataThumbnail:["_attrs","images"],setupComplete:!1,programmeWaitInterval:null,parentalRatingIndex:null,programPrName:["_attrs","parentalRating"],mainController:null,context:null,__epgFocus:null,init:function(){this._super(),this.setView(l.render(f)),c&&c.id},setup:function(e){if(this.context=e,this._closed=!1,!e.historyBack){null===this.__epgFocus&&(this.__epgFocus=a.bind(this._epgFocus,this));var t=this.populateVariables();this.__setFooter(!1,!1),this.parentalRatingIndex=-1,this.finishSetup(t,e.submenuClick?e.submenuClick-8:0),t.hide(),this._submenuItems=[],this.initSubmenu()}this.addListeners()},initSubmenu:function(){var t,i=e.util.bind(function(t){return e.util.bind(function(){return this.getView()._parent?(this.saveMenuState(),this.selectCategoryById(t)):void o.publish("navigate",{path:"Main/ProgramListing",state:{submenuClick:t,outerNavigation:{id:t,submenu:this._submenuItems}}})},this)},this);if(this.context.outerNavigation){this._submenuItems=this.context.outerNavigation.submenu;for(var n=this._submenuItems.length-1;n>=0;n--)this._submenuItems[n].action=i(n);t=this.selectCategoryById(this.context.outerNavigation.id)}t=t||O.getDateTimeService().getServerDateTime().then(e.util.bind(function(t){var n=g(t);return this._submenuItems.push({id:"today",text:P.getString("Epg.LabelToday_SmartTV"),time:1e3*n.unix(),action:i(8)}),n.add("d",1),this._submenuItems.push({id:"tomorrow",text:P.getString("Epg.LabelTomorrow_SmartTV"),time:1e3*n.unix(),action:i(9)}),v.getEpgDaysForwards().then(e.util.bind(function(e){this._availableDays=e;for(var t=1;t<this._availableDays;t++)n.add("d",1),this._submenuItems.push({id:this._availableDays+2+t,text:n.format(P.getString("ui.format.epgMenuDate")),time:1e3*n.unix(),action:i(this._availableDays+2+t)});return D.insertSubmenu(this._submenuItems)},this))},this));var r=O.getDateTimeService().getServerDateTime().then(e.util.bind(function(e){this._currentDate=e.getTime(),TODAY=g(e).startOf("day")},this));this.context.setupPending=s.all([t,r]),this.trackLevel(2,void 0,!0)},selectCategoryById:function(e){d.log("selectCategoryById : "+e);try{i.focus(this._epgGrid);var t=e>7?e-8:e;this.getView().show(),this._epgGrid.goToDay(t),i.focus(this._epgGrid)}catch(e){d.info("EPG not ready")}return!0},finishSetup:function(e,t){this.makeEPG(e,null,null,t),this.setupComplete=!0},makeEPG:function(e,t,i,n){A.singleton().blockKeys();var s,r=this;this.setUpEPG(i,n),this.setupComplete||this.initArrows(e),e.find("epgGrid").attach(this._epgGrid,u.PLACE_PREPEND),b.getChannels({}).then(a.bind(function(e){this._channelSet=e,this._epgGrid.setChannels(this._epgGrid)(e)},this)).then(a.bind(function(){var e=r.getPageOfChannelIds(0);s=b.getChannelListingsByDate(new Date((new Date).getTime()+864e5*n),e),r.waitForProgrammes(r,s,n,!0,null,0)()}),r)},getPageOfChannelIds:function(e,t){var i=[];t=t||2;for(var n=0;n<this._numberOfChannelsToDisplay*t;n++){var s=e+n;if(s>=this._channelSet.length&&(s-=this._channelSet.length),s>=this._channelSet.length)return i;i.push(this._channelSet[s]._attrs.id)}return i},waitForProgrammes:function(e,t,i,n,s,r){return function(){if(e.programmeWaitInterval&&clearInterval(e.programmeWaitInterval),"pending"==t.inspect().state)return void(e.programmeWaitInterval=setInterval(e.waitForProgrammes(e,t,i,n,s,r),100));if("rejected"!=t.inspect().state){var a=t.inspect().value,o=e._epgGrid.setProgrammeData(e._epgGrid)(a,i,r);n?e._epgGrid.setupEpg(e._epgGrid)():o&&e._epgGrid.refreshProgrammeData(),T.close(),e.requestingListings=!1,A.singleton().unblockKeys(),s&&s()}}},returnToEPGnow:function(){this._epgGrid.goToNowPosition()},setUpEPG:function(t,i){this._epgGrid=new I({id:"EPG",offset:i,channelDataId:["_attrs","id"],channelDataTitle:["_attrs","title"],channelDataLogo:["_attrs","images",0,"_attrs","url"],channelDataBlackout:["blackout"],channelDataStatus:["status"],channelDataSubscribed:["subscribed"],channelDataType:["type"],channelPackColourCode:["_attrs","mobilepc"],programmeDataBase:["_attrs","programs"],programmeDataId:["_attrs","id"],programmeDataTitle:["_attrs","title"],programmeDataStartTime:["_attrs","startTime"],programmeDataEndTime:["_attrs","endTime"],programmeDataBlackout:["_attrs","epgBlackout"],programmeDataFlags:["_attrs","flags"],programPrName:this.programPrName,goToStartKey:n.BLUE.id,submenuFunc:e.util.bind(this._jumpToSubmenu,this),programmeClickFunc:e.util.bind(this._epgClick,this),topChannelIndex:0,requestListingsFunc:e.util.bind(this._epgRequestListings,this),requestListingsErrorHandler:e.util.bind(this._epgRequestListingsErrorHandler,this),horizontalScrollFunc:e.util.bind(this._epgHorizonalScrollHandler,this),verticalScrollFunc:e.util.bind(this._epgVerticalScrollHandler,this),stopVerticalPaging:!0,locateTop:180,listingsCache:36e5,parentalRatingIndex:this.parentalRatingIndex,getParentalRatingIndex:e.util.bind(this.returnNoParentalGuidance,this),loggedIn:!1,bookendHorizontal:!0})},returnNoParentalGuidance:function(){return 100},retrieveType:function(e,t,i){i||(i="type");for(var n=0;n<e.length;n++)if(e[n][i]===t)return e[n]},populateVariables:function(){this.mainController=this.getParentController();var e=this.getView();return this._title=e.find("title"),this._metadata=e.find("metadata"),this._description=e.find("description"),this._thumbnail=e.find("thumbnail"),this._thumbnailOverlay=e.find("thumbnail-overlay"),this._thumbnailOverlayMessage=e.find("thumbnail-overlay-message"),this._packageNeeded=e.find("packageNeeded"),this._packageNeededLabel=e.find("packageNeededLabel"),this._packageNeededLogo=e.find("packageNeededLogo"),e},addListeners:function(){!1===M&&(_KeyCallback||(_KeyCallback=this._epgGrid.handleKey(this._epgGrid)),this._epgGrid.addEventListener(t.FOCUS,this.__epgFocus),this._epgGrid.addEventListener(t.KEY,_KeyCallback),M=!0)},removeListeners:function(){this._epgGrid.removeEventListener(t.FOCUS),this._epgGrid.removeEventListener(t.KEY,_KeyCallback),_KeyCallback=null,M=!1},initArrows:function(e){this._arrows=[];for(var t=0;t<4;t++)this._arrows[t]=new _({id:"arrowBtn-"+t,css:"wgt-programguide-arrow",nextUp:"EPG",nextLeft:"EPG",nextRight:"EPG",nextDown:"EPG"});this._arrows[0].addClass("top"),this._arrows[1].addClass("right"),this._arrows[2].addClass("bottom"),this._arrows[3].addClass("left"),e.attach(this._arrows[0]),e.attach(this._arrows[3]),e.attach(this._arrows[1]),e.attach(this._arrows[2]),this.subscribeToArrowClick(),this._epgGrid.getRoot().addEventListener("mousewheel",this.scrollFunc)},scrollFunc:function(e){var t=Math.max(-1,Math.min(1,e.wheelDelta||-e.detail)),i=document.createEvent("Event");i.initEvent("keydown",!0,!0),i.target=document,i.currentTarget=document,i.isSimulated=!0,1==t?(i.keyCode=38,i.keyCodeVal=38):(i.keyCode=40,i.keyCodeVal=40),document.dispatchEvent(i)},subscribeToArrowClick:function(){var e=function(e){i.focus(e)};this._arrows[0].addEventListener(t.CLICK,this._epgGrid.goUpOneScoped(this._epgGrid,a.bind(e,this,this._arrows[0]))),this._arrows[2].addEventListener(t.CLICK,this._epgGrid.goDownOneScoped(this._epgGrid,a.bind(e,this,this._arrows[2]))),this._arrows[1].addEventListener(t.CLICK,this._epgGrid.goToNextPageScoped(this._epgGrid,a.bind(e,this,this._arrows[1]))),this._arrows[3].addEventListener(t.CLICK,this._epgGrid.goToPrevPageScoped(this._epgGrid,a.bind(e,this,this._arrows[3])))},unsubscribeToArrowClick:function(){this._arrows[0].removeEventListener(t.CLICK,this._epgGrid.goUpOneScoped(this._epgGrid)),this._arrows[2].removeEventListener(t.CLICK,this._epgGrid.goDownOneScoped(this._epgGrid)),this._arrows[1].removeEventListener(t.CLICK,this._epgGrid.goToNextPageScoped(this._epgGrid)),this._arrows[3].removeEventListener(t.CLICK,this._epgGrid.goToPrevPageScoped(this._epgGrid))},_jumpToSubmenu:function(){this.focusedProgramme=i.getCurFocus(),this.focus(this.mainController.getView().find("list-sub-menu")),this.__setFooter(!1,!1)},_epgClick:function(e){if(e.target._opts.programmeData._attrs.id){var t,i=e.target._parent.channelData._attrs.id,n=e.target._opts.programmeData._attrs.id,s=new R;t=s.setData({channelId:i,eventId:n}).build(),D.returnUpperLevelMenu().then(function(){o.publish("navigate",{path:"Main/EpgEvent",state:{context:t}})})}},_epgFocus:function(t){this._initialising&&(this._initialising=!1),this.__setFooter(!0,!0);var i=t.target._opts.programmeData,n=t.target._opts.parent.channelData,r=i,a=r&&r.get("id"),o=n&&n._attrs.mobilepc;if(r&&!e.util.isUndefined(a)&&o&&a!==this._program_id_last_shown){this._program_id_last_shown=a,this._title.setText(r.get("title")),this._metadata.setText(r.get("inlineMetadata")),this._description.setText(r.get("description")),this._thumbnailOverlayMessage.setText(P.getString("Epg.blackoutShort")),this._thumbnailOverlay[r.get("epgBlackout")?"removeClass":"addClass"]("hidden"),r.set("packageCode",o),this._packageNeeded.addClass("hidden");var l="playstation"===c.platform?1:.5;e.util.clearDelay("epgFocusDelay"),e.util.delay(l,"epgFocusDelay").then(e.util.bind(function(){var t=[v.getPlaceholderLandscape(),b.getProgramById(a,n._attrs.id),L.checkUserPrivileges(r)];s.all(t).then(e.util.bind(function(t,i){var n=i[1],s=i[0],r=i[2];if(n.set("id",t),this._program_id_last_shown===t){var a=n.get("title"),l=n.get("inlineMetadata"),c=n.get("description"),d=n.get("images"),u=e.util.isArray(d)&&d.length&&d[0].file;if(a&&this._title.setText(a),l&&this._metadata.setText(l),c&&this._description.setText(c),u?b.constructCMSUrlPromise(u).then(e.util.bind(function(e){this._thumbnail.setSrc(e)},this)):this._thumbnail.setSrc(s),r)this._packageNeeded.addClass("hidden");else{v.getPackageImageForCode(o).then(e.util.bind(function(e){this._packageNeededLogo.setSrc(e),this._packageNeededLogo.removeClass("hidden")},this),e.util.bind(function(){this._packageNeededLogo.addClass("hidden")},this));var h="DetailPage.DetailPage_MissingEntitlement_"+o,_=P.getString(h);_===h&&(_=P.getString("DetailPage.DetailPage_MissingEntitlement_OTHER")),this._packageNeededLabel.setText(_),this._packageNeeded.removeClass("hidden")}}},this,a))},this))}},_epgRequestListings:function(e,t,i,n){if(!this.requestingListings||!n&&this.lastHidden){this.lastHidden=n,this.requestingListings=!0,n||T.open("Loading listings...");var s=new Date((new Date).getTime()+864e5*e),r=this.getPageOfChannelIds(i),a=b.getChannelListingsByDate(s,r);this.waitForProgrammes(this,a,e,!1,t,i)()}},_epgRequestListingsErrorHandler:function(){new x({buttonText:"OK",message:"Failed to load programme listings. Please try again later."})},_epgHorizonalScrollHandler:function(e,t){this._arrows[3].removeClass("hidden"),this._arrows[1].removeClass("hidden"),e&&this._arrows[3].addClass("hidden"),t&&this._arrows[1].addClass("hidden")},_epgVerticalScrollHandler:function(e,t){this._epgGrid.verticalPagingDisabled()&&(this._arrows[2].removeClass("hidden"),t&&(this._arrows[2].addClass("hidden"),d.log("*** Reached the bottom of the EPG grid.")))},__setFooter:function(e,t){var i={arrowAll:"Move",enter:"Select",back:"Back"};t&&a.extend(i,{colorRed:"Top Menu",colorGreen:"Categories",colorYellow:"Select Date",colorBlue:"On Now",prevNext:"Prev/Next Day"}),e||(i.colorYellow=null),o.publish("footerUpdate",i)},focus:function(e){this._closed||i.focus(e)},reset:function(){this._closed=!0,this.removeListeners()}})}),define("tvedemo/tmpl/watchList",["xdk-ui-basic/Layout","xdk-ui-basic/Label","tvedemo/ext/ui/grid/LoopedGrid","xdk-ax/Container","storm/mgr/sLanguageManager"],function(e,t,i,n,s){"use strict";return function(){return{klass:e,forwardFocus:!0,alignment:e.VERTICAL,css:"subcontrollerPage watchList",children:[{klass:n,id:"watchlistGridClipper",css:"watchlist-grid-clipper",children:[{klass:i,forwardFocus:!0,alignment:i.VERTICAL,id:"#moviesAssetGrid",nextDown:"episodeSportGrid",rows:9,cols:1,scrollFrontBoundary:4,scrollEndBoundary:4}]},{klass:n,css:"middle-content",children:[{klass:n,id:"descriptionContainer",css:"description-container",children:[{klass:t,id:"title",css:"title"},{klass:t,id:"meta",css:"meta"}]}]},{klass:i,forwardFocus:!0,alignment:i.VERTICAL,id:"#episodeSportGrid",nextUp:"moviesAssetGrid",rows:5,cols:1,scrollFrontBoundary:2,scrollEndBoundary:2},{klass:t,text:s.getString("Mystuff.Mystuff_labelno_watchlist_desc"),id:"empty-watchlist-label",css:"empty-watchlist-label"}]}}}),define("tvedemo/ctrl/Watchlist",["xdk-base/ax","xdk-base/promise","tvedemo/ctrl/RoutableController","xdk-ax/mvc/view","tvedemo/tmpl/watchList","xdk-ax/focusManager","xdk-ax/evt/type","xdk-base/device/vKey","tvedemo/mgr/sHistoryManager","tvedemo/helper/dialogHelper","xdk-base/util","tvedemo/mgr/sEndUserManager","xdk-ax/mediator","xdk-base/console","tvedemo/mgr/sAssetManager","storm/mgr/sAppConfigManager","xdk-ax/data/LocalDatasource","tvedemo/wgt/ImageButton","xdk-ax/Container","xdk-ui-basic/Label"],function(e,t,i,n,s,r,a,o,l,c,d,u,h,_,g,f,p,m,v,b){"use strict";var S={FILM:"Film",EPISODE:"Episode",SPORT:"Sport"};return e.klass.create(i,{getDefaultState:function(){return{}}},{init:function(){this._super(),this.setView(n.render(s))},getState:function(){return this._super()},setup:function(e){if(this._super(e),!0===e.historyBack&&!u.getLoginStatus())return void l.back();this.currentView=this.getView(),this.moviesGrid=this.currentView.find("moviesAssetGrid"),this.episodeSportGrid=this.currentView.find("episodeSportGrid"),this.moviesGridClipper=this.currentView.find("watchlistGridClipper"),this._titleLabel=this.currentView.find("title"),this._metaLabel=this.currentView.find("meta"),this._emptyWatchlistLabel=this.currentView.find("empty-watchlist-label"),this._emptyWatchlistLabel.hide(),this.movieGridFocusHandlerRef=d.bind(this.movieGridFocusHandler,this),this.movieGridClickHandlerRef=d.bind(this.movieGridClickHandler,this),this.movieDescriptionHandlerRef=d.bind(this.movieDescriptionHandler,this),this.moviesGrid.addEventListener(a.FOCUS,this.movieGridFocusHandlerRef),this.moviesGrid.addEventListener(a.CLICK,this.movieGridClickHandlerRef),this.moviesGrid.addEventListener(a.SELECTION_CHANGED,this.movieDescriptionHandlerRef),this.episodeSportGridFocusHandlerRef=d.bind(this.episodeSportGridFocusHandler,this),this.episodeSportGridClickHandlerRef=d.bind(this.episodeSportGridClickHandler,this),this.episodeSportGrid.addEventListener(a.FOCUS,this.episodeSportGridFocusHandlerRef),this.episodeSportGrid.addEventListener(a.CLICK,this.episodeSportGridClickHandlerRef),e.setupPending=this.setUpAssetGrids().then(d.bind(function(){if(this.moviesGrid.isHidden()||this.moviesGrid.select(0,4),this.episodeSportGrid.isHidden()||this.episodeSportGrid.select(0,2),this.moviesGrid.isHidden()&&this.episodeSportGrid.isHidden()){this._emptyWatchlistLabel.show();var e=this.getView().getParent().getParent().find("list-sub-menu");r.focus(e)}else this._emptyWatchlistLabel.hide(),r.focus(this.getView())},this)),this.trackLevel(2,void 0,!0)},setUpAssetGrids:function(){var e=[],i=[];return u.getUserWatchList().then(d.bind(function(n){_.info("Watchlist received",n),d.each(n,function(t){var n=t.get("assetType");n===S.FILM?e.push(t):n===S.EPISODE||n===S.SPORT?i.push(t):_.warn("Ignoring unexpected assetType: "+n)});for(var s=1;s<=8;s++)e.length===s?this.moviesGridClipper.addClass("item-count-"+s):this.moviesGridClipper.removeClass("item-count-"+s);return t.all([this.setMovieGridDatasource(this.moviesGrid,e),this.setEpisodeGridDatasource(this.episodeSportGrid,i)])},this)).fail(function(e){_.info("Error while fetching watchlist ",e),c.error({reason:e})})},setMovieGridDescriptionVisible:function(e){e?this.getView().find("descriptionContainer").removeClass("hidden"):this.getView().find("descriptionContainer").addClass("hidden")},setMovieGridDatasource:function(e,t){if(!t.length)return e.hide(),this.getView().find("descriptionContainer").hide(),!1;e.show(),this.getView().find("descriptionContainer").show();var i,n=new p,s={ids:t};return i=g.getAssets(s,S.FILM).then(function(t){return i=g.getDataLoaderFromArray(t),n.setDataLoader(i),e.setDatasource(n).then(null,function(){e.hide()})}),e.setDisplayStgy(function(e){var t=new v({forwardFocus:!0});return g.getStormAssetDvdCover(e).then(d.bind(function(e){new m({parent:t,src:e.get("url"),placeHolderPromise:f.getPlaceholderPortrait})},this),function(e){_.log("getStormAssetDvdCover failed: "+e)}).done(),t}),i},setEpisodeGridDatasource:function(e,t){if(!t.length)return e.hide(),!1;e.show();var i,n=new p,s={ids:t},r=function(e){var t="",i=e.get("seasonNumber"),n=e.get("episodeNumber"),s=e.get("serieTitle")||e.get("title");return i&&(t+="S"+i+" "),n&&(t+="E"+n),t.length&&(t+=": "),s&&s.length&&(t+=s.toUpperCase()),t};return i=g.getAssets(s,S.EPISODE).then(function(t){return i=g.getDataLoaderFromArray(t),n.setDataLoader(i),e.setDatasource(n).then(null,function(){e.hide()})}),e.setDisplayStgy(function(e){var t=new v({forwardFocus:!0});return g.getStormAssetImageBySize(e,300,200).then(d.bind(function(i){var n=new m({parent:t,src:i.get("url"),placeHolderPromise:f.getPlaceholderLandscape}),s=new v({parent:n,css:"textContainer"});new b({parent:s,text:r(e),css:"text"})},this),function(e){_.log("getStormAssetImageBySize failed: "+e)}).done(),t}),i},movieDescriptionHandler:function(){var e=this.moviesGrid.getSelectedData();this._titleLabel.setText(e.get("title"));var t=e.get("genreList");this._metaLabel.setText(t.main.content+" | "+e.get("year"))},movieGridClickHandler:function(){var e=this.moviesGrid.getSelectedData();return h.publish("navigate",{path:"Main/Movie",state:{assetId:e.get("id"),catalog:e.get("catalog")}}),!1},episodeSportGridFocusHandler:function(){this.setMovieGridDescriptionVisible(!1)},movieGridFocusHandler:function(){this.setMovieGridDescriptionVisible(!0)},episodeSportGridClickHandler:function(){var e=this.episodeSportGrid.getSelectedData();return e.get("type")===S.SPORT?h.publish("navigate",{path:"Main/Sport",state:{assetId:e.get("id"),catalog:e.get("catalog")}}):e.get("type")===S.EPISODE&&h.publish("navigate",{path:"Main/Episode",state:{selectedEpisodeId:e.get("id"),catalog:e.get("catalog")}}),!1},reset:function(){this.moviesGrid.removeEventListener(a.FOCUS,this.movieGridFocusHandlerRef),this.moviesGrid.removeEventListener(a.CLICK,this.movieGridClickHandlerRef),this.moviesGrid.removeEventListener(a.SELECTION_CHANGED,this.movieDescriptionHandlerRef),this.episodeSportGrid.removeEventListener(a.FOCUS,this.episodeSportGridFocusHandlerRef),this.episodeSportGrid.removeEventListener(a.CLICK,this.episodeSportGridClickHandlerRef),this._super()}})}),define("tvedemo/tmpl/bookmarkSettings",["xdk-ui-basic/Layout","xdk-ui-basic/Label","tvedemo/wgt/AssetGrid","xdk-ui-basic/Image","xdk-ax/Container","tvedemo/wgt/ImageButton","xdk-base/config","storm/mgr/sLanguageManager","xdk-ui-basic/Button"],function(e,t,i,n,s,r,a,o,l){"use strict";var c=o.getString("Settings.Settings_Bookmarking_info_text"),d=o.getString("Settings.Settings_auto_play_text");return function(){return{klass:e,alignment:e.VERTICAL,forwardFocus:!0,id:"bookmarkSettings",css:"subcontrollerPage bookmark-settings",children:[{klass:s,id:"bookmarkingContainer",css:"bookmarking-container",children:[{klass:t,id:"bookmarkingTitle",css:"bookmarking-title",text:o.getString("Settings.Settings_Bookmarking_headline")},{klass:t,id:"bookmarkingText",css:"bookmark-text",text:c},{klass:e,id:"bookmarking",css:"buttons",alignment:e.HORIZONTAL,children:[{klass:l,id:"allDevices",css:"wgt-imageButton",text:o.getString("Settings.Settings_Bookmarking_all_devices"),children:[{klass:s,id:"bookmarking-tick",css:"bookmarking-tick"}]},{klass:l,id:"onlyThisDevice",css:"wgt-imageButton",text:o.getString("Settings.Settings_Bookmarking_this_devices"),children:[{klass:s,id:"bookmarking-tick",css:"bookmarking-tick"}]}]}]},{klass:s,id:"autoplayContainer",css:"bookmarking-container",children:[{klass:t,id:"autoplayTitle",css:"bookmarking-title",text:o.getString("Settings.Settings_auto_play_headline")},{klass:t,id:"autoplayText",css:"bookmark-text",text:d},{klass:e,id:"autoplay",css:"buttons",alignment:e.HORIZONTAL,children:[{klass:l,id:"autoplayAutomatic",css:"wgt-imageButton",text:o.getString("Settings.Settings_auto_play_continue_automatically"),children:[{klass:s,id:"bookmarking-tick",css:"bookmarking-tick"}]},{klass:l,id:"autoplayNonAutomatic",css:"wgt-imageButton",text:o.getString("Settings.Settings_auto_play_continue_manuell"),children:[{klass:s,id:"bookmarking-tick",css:"bookmarking-tick"}]}]}]}]}}}),define("tvedemo/ctrl/BookmarkSettings",["xdk-base/ax","tvedemo/ctrl/RoutableController","tvedemo/tmpl/bookmarkSettings","xdk-ax/mvc/view","xdk-base/util","xdk-ax/evt/type","tvedemo/mgr/sEndUserManager","tvedemo/wgt/Loading","tvedemo/helper/dialogHelper","storm/mgr/sLanguageManager","xdk-base/promise","storm/mgr/sLocalStorageManager"],function(e,t,i,n,s,r,a,o,l,c,d,u){"use strict";return e.klass.create(t,{getDefaultState:function(){return{}}},{init:function(){this._super(),this.setView(n.render(i))},setup:function(e){this._super(e),this._allDevices=this.getView().find("allDevices"),this._onlyThisDevice=this.getView().find("onlyThisDevice"),this._autoplayAutomatic=this.getView().find("autoplayAutomatic"),this._autoplayNonAutomatic=this.getView().find("autoplayNonAutomatic"),this._allDevicesClick=s.bind(this._onAllDeviceClick,this),this._allDevices.addEventListener(r.CLICK,this._allDevicesClick),this._onlyThisDeviceClick=s.bind(this._onOnlyThisDeviceClick,this),this._onlyThisDevice.addEventListener(r.CLICK,this._onlyThisDeviceClick),this._autoplayClick=s.bind(this._onAutoplayClick,this),this._autoplayAutomatic.addEventListener(r.CLICK,this._autoplayClick),this._nonAutoplayClick=s.bind(this._onNonAutoplayClick,this),this._autoplayNonAutomatic.addEventListener(r.CLICK,this._nonAutoplayClick),e.setupPending=this._loadUserData()},_loadUserData:function(){return o.open(),a.getLoggedInUser().then(s.bind(function(e){var t=e.get("isBookmarkOn");this._bookmark=t,!0===t?this._allDevices.addClass("selected"):this._onlyThisDevice.addClass("selected")},this)).complete(s.bind(function(){o.close(),"false"===u.getStoredValue(u.KEYS.BINGE_AUTO_PLAY)?this._onNonAutoplayClick():this._onAutoplayClick()},this))},_onAllDeviceClick:function(){!1===this._bookmark&&l.confirm({title:c.getString("Bookmarking.Bookmarking_Activation_Popup_hl"),message:c.getString("Bookmarking.Bookmarking_Activation_Popup_text"),positiveText:c.getString("Bookmarking.Bookmarking_Deactivation_Popup_Confirm_text"),negativeText:c.getString("Bookmarking.Bookmarking_Deactivation_Popup_Cancel_text"),positiveAction:s.bind(function(){this._updateBookmark().then(s.bind(function(){this._bookmark=!0,this._switchTick(this._onlyThisDevice,this._allDevices)},this))},this),negativeAction:s.bind(function(){},this)})},_onOnlyThisDeviceClick:function(){!0===this._bookmark&&l.confirm({title:c.getString("Bookmarking.Bookmarking_Deactivation_Popup_hl"),message:c.getString("Bookmarking.Bookmarking_Deactivation_Popup_text"),positiveText:c.getString("Bookmarking.Bookmarking_Deactivation_Popup_Confirm_text"),negativeText:c.getString("Bookmarking.Bookmarking_Deactivation_Popup_Cancel_text"),positiveAction:s.bind(function(){this._updateBookmark().then(s.bind(function(){this._bookmark=!1,this._switchTick(this._allDevices,this._onlyThisDevice)},this))},this),negativeAction:s.bind(function(){},this)})},_updateBookmark:function(){return o.open(),a.updateCustomerBookmarkFlag().then(s.bind(function(e){return"OK"===e.resultMessage?a.getLoggedInUser().then(s.bind(function(e){var t=this._bookmark?"Bookmarking_Deactivation_Successful_Popup_text":"Bookmarking_Activation_Successful_Popup_text",i=this._bookmark?"Bookmarking_Deactivation_Successful_Popup_hl":"Bookmarking_Activation_Successful_Popup_hl";return l.success({title:c.getString("Bookmarking."+i),message:c.getString("Bookmarking."+t)}),d.resolve("OK")},this)):(l.error({reason:c.getString("Errormessages.Errormessages_GenericErrorMessageHeadline"),buttonText:c.getString("Global.Global_buttonBack_button")}),d.reject("failed"))},this)).complete(function(){o.close()})},_onAutoplayClick:function(){this._switchTick(this._autoplayNonAutomatic,this._autoplayAutomatic),u.setStoredValue(u.KEYS.BINGE_AUTO_PLAY,"true")},_onNonAutoplayClick:function(){this._switchTick(this._autoplayAutomatic,this._autoplayNonAutomatic),u.setStoredValue(u.KEYS.BINGE_AUTO_PLAY,"false")},_switchTick:function(e,t){e.removeClass("selected"),t.addClass("selected")},reset:function(e){this._allDevices.removeEventListener(r.CLICK,this._allDevicesClick),this._onlyThisDevice.removeEventListener(r.CLICK,this._onlyThisDeviceClick),this._autoplayAutomatic.removeEventListener(r.CLICK,this._autoplayClick),this._autoplayNonAutomatic.removeEventListener(r.CLICK,this._nonAutoplayClick),this.getView().removeAllListeners(),this._super(e)}})}),define("tvedemo/wgt/RecommendationImage",["xdk-base/class","xdk-base/util","xdk-ax/Container","storm/wgt/Image","xdk-ui-basic/Label","xdk-base/Element","xdk-ui-basic/Button","xdk-ui-basic/Layout","tve/mgr/sLinearManager","xdk-ax/evt/type","lib/moment","storm/mgr/sLanguageManager"],function(e,t,i,n,s,r,a,o,l,c,d,u){"use strict";return e.create(i,{ONCLOSE:"recimage-onclose",ONPLAY:"recimage-onplay"},{init:function(e){e=e||{},e.forwardFocus="buttonPlay",e.root=new r("div"),e.css=e.css||"recommendation-container",this._super(e);var l=e.data;this._backgroundImage=new n({css:"recommendation-background",parent:this}),this._gradient=new i({id:"gradient-container",css:"gradient-overlay",parent:this}),this._buttons=new o({alignment:o.HORIZONTAL,parent:this}),this._playButton=new a({css:"play-button",id:"buttonPlay",parent:this._buttons,nextUp:"buttonClose"}),this._closeButton=new a({css:"close-button",id:"buttonClose",parent:this._buttons,nextDown:"buttonPlay"}),this._playButton.addEventListener(c.CLICK,t.bind(function(){this.dispatchEvent(this.constructor.ONPLAY,l)},this)),this._closeButton.addEventListener(c.CLICK,t.bind(function(){this.dispatchEvent(this.constructor.ONCLOSE)},this)),this._detailText=new i({css:"recommendation-detailText",id:"detailText",parent:this}),this._nextEpisode=new s({id:"nextEpisode",css:"next-episode-text",text:u.getString("Binge.Binge_next_episode"),parent:this._detailText}),e.firstRecommendation||this._nextEpisode.hide(),this._titleText=new s({id:"titleText",css:"recommendation-title-text",parent:this._detailText}),this._metaText=new s({id:"metaText",css:"recommendation-meta-text",parent:this._detailText}),this._episodeGapContainer=new i({id:"episodeGapContainer",css:"recommendation-episodegap-container",parent:this}),this._missingEpisodeLabel=new s({id:"episodeGapInformation",css:"recommendation-episodegap-information",text:"",parent:this._episodeGapContainer}),this._episodeGapContainer.hide(),this._setBackgroundImage(l),this._setMetaText(l),this._handleEpisodeGap(l,e.episodeGap)},_setMetaText:function(e){console.info(e._attrs);var t=e.get("seasonNumber"),i=e.get("episodeNumber"),n=e.get("serieTitle"),s=e.get("category"),r=e.get("parentalRating").display,a=e.get("length"),o=e.get("isHD")?"HD":"",l=[];this._titleText.setText("S"+t+" E"+i+": "+n),s&&l.push(s),r&&l.push(r),a&&l.push(d.duration(a).asMinutes()+" "+u.getString("ui.format.minutesDurationSuffix")),o&&l.push(o),
this._metaText.setText(l.join(" | "))},_setBackgroundImage:function(e){var i,n=e.get("images");t.each(n,function(e){if(e.path&&e.file)return i=e,"hero_img"===e.type?t.breaker:void 0}),l.constructCMSUrlPromise(i.path+"/"+i.file).then(t.bind(function(e){this._backgroundImage.setSrc(e)},this))},_handleEpisodeGap:function(e,t){if(t&&t>1){for(var i=e.get("episodeNumber")>>0,n=[],s=i-1,r=i-t;s>r;s--)n.unshift("E"+("0"+s).substr(-2));this._missingEpisodeLabel.setText(u.getString("Binge_recommendation.next_episodes_missing_text",{list_of_episodes:n.join(", ")})),this._episodeGapContainer.show()}}})}),define("tvedemo/tmpl/recommendation",["xdk-ui-basic/Layout","xdk-ui-basic/Label","tvedemo/wgt/ImageButton","xdk-ax/Container","xdk-ui-basic/Button","storm/wgt/Image","tvedemo/wgt/RecommendationImage","xdk-ui-grid/BoundedGrid","storm/mgr/sLanguageManager"],function(e,t,i,n,s,r,a,o,l){"use strict";return function(){return{klass:n,id:"recommendationView",css:"recommendation-container",children:[{klass:o,id:"recommendationGrid",css:"recommendation-grid",rows:3,cols:1,scrollEndBoundary:2,alignment:o.HORIZONTAL},{klass:n,id:"topBanner",css:"top-banner",children:[{klass:t,css:"top-banner-text",text:l.getString("Binge_recommendation.last_episode_available_headline")}]}]}}}),define("tvedemo/wgt/EndOfSeriesImage",["xdk-base/class","xdk-base/util","xdk-ax/Container","storm/wgt/Image","xdk-ui-basic/Label","xdk-base/Element","xdk-ui-basic/Button","xdk-ui-basic/Layout","tve/mgr/sLinearManager","xdk-ax/evt/type","lib/moment","storm/mgr/sLanguageManager"],function(e,t,i,n,s,r,a,o,l,c,d,u){"use strict";return e.create(i,{ONCLOSE:"eosimage-onclose",ONPROCEED:"eosimage-onplay"},{init:function(e){e=e||{},e.forwardFocus="buttonProceed",e.css=e.css||"recommendation-container",this._super(e);var r=e.seriesTitle;this._backgroundImage=new n({css:"recommendation-background",parent:this}),this._ingress=new i({id:"ingress",css:"ingress",parent:this}),this._ingressText=new s({id:"ingressText",css:"ingress-text",text:u.getString("Binge_recommendation.last_episode_available_text",{series_title:r}),parent:this._ingress}),this._buttons=new o({alignment:o.HORIZONTAL,parent:this}),this._proceedButton=new a({css:"proceed-button button",id:"buttonProceed",parent:this._buttons,nextUp:"buttonClose"}),this._closeButton=new a({css:"close-button",id:"buttonClose",parent:this._buttons,nextDown:"buttonProceed"}),this._proceedButton.addEventListener(c.CLICK,t.bind(function(){this.dispatchEvent(this.constructor.ONPROCEED)},this)),this._closeButton.addEventListener(c.CLICK,t.bind(function(){this.dispatchEvent(this.constructor.ONCLOSE)},this)),this._setBackgroundImage(),this._setMetaText()},_setMetaText:function(){this._proceedButton.setText(u.getString("Binge_recommendation.last_episode_available_series_overview_btn_text")+" >")},_setBackgroundImage:function(){l.constructCMSUrlPromise(u.getString("Binge_recommendation.last_episode_available_background_image")).then(t.bind(function(e){this._backgroundImage.setSrc(e)},this))}})}),define("tvedemo/ctrl/Recommendation",["xdk-base/class","tvedemo/ctrl/RoutableController","xdk-ax/focusManager","xdk-base/util","xdk-base/promise","xdk-ax/mvc/view","tvedemo/tmpl/recommendation","tvedemo/mgr/sAssetManager","tvedemo/wgt/RecommendationImage","tvedemo/wgt/EndOfSeriesImage","xdk-ax/data/LocalDatasource","xdk-ax/Container","xdk-ax/evt/type","xdk-base/device/vKey","tvedemo/helper/sPlaybackHelper","tvedemo/mgr/sHistoryManager","tvedemo/mgr/sNavigationManager"],function(e,t,i,n,s,r,a,o,l,c,d,u,h,_,g,f,p){"use strict";return e.create(t,{getDefaultState:function(){return{__forceReload:!0}}},{isVideoPlayback:!0,MAX_SIZE:3,init:function(){this._super(),this.setView(r.render(a))},setup:function(e){this._super(e);var t=this.getView();this._recommendationContainer=this.getView().find("recommendation-container"),this._setUpGrid(e.episodes,e.currentEpisode),this.resumeOptions={resumeTime:(e.resumeOptions.shouldResume?e.resumeOptions.resumeTime:0)||0,currentEpisode:e.currentEpisode},this.bingeWatchingSetting=e.bingeWatchingSetting,t.addEventListener(h.KEY,n.bind(this._onKey,this))},_onKey:function(e){return e.id!==_.BACK.id||(this.handleClose(),!1)},_setUpGrid:function(e,t){e.push({type:"emptyItem"}),e.push({type:"emptyItem"});var r=new d,a=function(){var t=s.defer();return t.resolve({total:e.length,data:e}),t.promise};return r.setDataLoader(a),this.recommendationGrid=this.getView().find("recommendationGrid"),this._onPlayHandle=n.bind(this.handlePlay,this),this._onCloseHandle=n.bind(this.handleClose,this),this._onProceedHandle=n.bind(this.handleProceed,this),this.recommendationGrid.setDisplayStgy(n.bind(function(i){if(!0===i.endOfSeries){var n=new c(i);return n.addEventListener(c.ONCLOSE,this._onCloseHandle),n.addEventListener(c.ONPROCEED,this._onProceedHandle),n}if("emptyItem"===i.type)return new u({css:"empty-rec",focusable:!1,clickable:!1});var s,r=0,a=e.indexOf(i),o=0===a;"active"!==this.bingeWatchingSetting&&(o?r=i.get("seasonNumber")===t.get("seasonNumber")?i.get("episodeNumber")-t.get("episodeNumber"):i.get("episodeNumber"):(s=e[a-1],i.get("seasonNumber")===s.get("seasonNumber")&&(r=i.get("episodeNumber")-s.get("episodeNumber"))));var d=new l({data:i,episodeGap:r,firstRecommendation:o});return d.addEventListener(l.ONCLOSE,this._onCloseHandle),d.addEventListener(l.ONPLAY,this._onPlayHandle),d},this)),this.recommendationGrid.setCheckSelectableStgy(n.bind(this.recommendationSelectableStgy,this,0,2)),this.recommendationGrid.setDatasource(r).then(n.bind(function(){i.focus(this.recommendationGrid)},this))},recommendationSelectableStgy:function(e,t,i,n){var s,r,a=n.selectedDsIndex,o=n.selectedGridRow,l=i.ds.getTotalCount();return!(a<0)&&(s=Math.floor(a/i.cols),r=Math.floor((l-1)/i.cols),!((o<e||o>=i.rows-t)&&s>e&&s<r-t)&&((!i.ds._data[a]||"emptyItem"!==i.ds._data[a].type)&&(a<l||s<=r&&(n.selectedDsIndex=l-1,n.selectedGridCol=mod(l-1,this._cols),!0))))},handlePlay:function(e,t){if(e){var i=e.get("id"),s=e.get("catalog"),r=e.get("type");t=t||0,g.directPlay(i,s,t,r).fail(n.bind(function(){f.back()},this))}},handleClose:function(){this.resumeOptions.resumeTime?this.handlePlay(this.resumeOptions.currentEpisode,this.resumeOptions.resumeTime):f.back()},handleProceed:function(){p.navigateToSeriesBasePage(!0)},reset:function(e){this._super(e)}})}),define("storm/ctrl/Blank",["tvedemo/ctrl/RoutableController","xdk-ax/Container","xdk-base/class"],function(e,t,i){return i.create(e,{},{init:function(){this._super(),this.setView(new t({focusable:!1}))}})}),define("tvedemo/ext/device/playstation/Conviva",["xdk-base/util"],function(e){return{customerId:"c3.Sky-DE-Test",customerKey:"8b32f9655e8cb16b9a0a3a02871869983a1944c2",serviceUrl:"http://sky-de-test.testonly.conviva.com",sessionId:null,streamer:null,playerName:"",touchstoneEnabled:!1,init:function(){this.config=require("xdk-base/config"),this.sEndUserManager=require("tvedemo/mgr/sEndUserManager"),this.console=require("xdk-base/console"),console.info("[Conviva.js] PS init"),console.info("[Conviva.js] init - customerKey = "+this.customerKey),this.touchstoneEnabled?Conviva.LivePass.initWithSettings(this.customerKey,{gatewayUrl:this.serviceUrl}):Conviva.LivePass.init(this.customerKey),console.info("[Conviva.js] init done")},__setPlayerName:function(e){this.playerName=e},__enableTouchstone:function(){this.touchstoneEnabled=!0},createSession:function(e,t,i){if(e&&e.meta){this.cleanUpSession(),console.info("*** CONVIVA createSession *** = "+e.url),console.info("---------------------------------------"),console.info(JSON.stringify(e)),console.info("---------------------------------------");t&&0!==t&&!0;var n=this._getMediaProperties(i,e),s="no",r=this._getProperty("asset._attrs.id",i),a=r+" "+this._getProperty("asset._attrs.title",i),o=this._populateMediaTags(i,s,"SmoothStream",n.contentClass,e,n.liveContent,"play",n.contentCategory,r,this.config);if("Episode"===n.contentClass){var l=this._getProperty("asset._attrs.serieTitle",i),c=this._getProperty("asset._attrs.seasonNumber",i),d=this._getProperty("asset._attrs.episodeNumber",i),u=this._getProperty("asset._attrs.title",i);void 0!==l&&(a=r+" "+l+" S"+c+" E"+d+": "+u),s="yes",o=this._populateMediaTags(i,s,"SmoothStream",n.contentClass,e,n.liveContent,"play",n.contentCategory,r,this.config)}"Live"===n.contentClass&&(o=this._populateMediaTags(i,s,"SmoothStream",n.contentClass,e,n.liveContent,"play",n.contentCategory,r,this.config)),"Trailer"===n.contentClass&&(o=this._populateMediaTags(i,s,"MP4",n.contentClass,e,n.liveContent,"play",n.contentCategory,r,this.config));var h=new Conviva.ConvivaContentInfo(a,o);h.isLive=n.liveContent,h.defaultReportingCdnName=this._extractCDNName(e.url),h.streamUrl=o.asset_media_url=e.url,h.playerName=this.playerName,h.viewerId="I2-C9EZXV1",null===this.streamer&&(this.streamer=new Conviva.PlayStationWebmafStreamerProxy),console.info("[Conviva.js] createSession - streamer = "+this.streamer),console.info("[Conviva.js] createSession - convivaMetadata = "+h),this.sessionId=Conviva.LivePass.createSession(this.streamer,h),console.info("[Conviva.js] createSession - sessionId = "+this.sessionId+" assetName = "+a),console.info("[Conviva.js] createSession - END")}},cleanUpSession:function(){console.info("[Conviva.js] cleanUpSession"),null!=this.sessionId&&(Conviva.LivePass.cleanupSession(this.sessionId),this.sessionId=null,this.streamer=null)},reportError:function(e){Conviva.LivePass.reportError(this.sessionId,"A video playback error occoured: "+e)},_getProperty:function(e,t){for(var i=t,n=e.split("."),s=0;s<n.length;s++){if(!i||!i.hasOwnProperty(n[s]))return void console.warn("[Conviva.js] Could not find property: "+e);i=i[n[s]]}return i},_convertToYesNo:function(e){return!0===e?"yes":"no"},_extractCDNName:function(e){var t={akamai:Conviva.ConvivaContentInfo.CDN_NAME_AKAMAI,amazon:Conviva.ConvivaContentInfo.CDN_NAME_AMAZON,att:Conviva.ConvivaContentInfo.CDN_NAME_ATT,bitgravity:Conviva.ConvivaContentInfo.CDN_NAME_BITGRAVITY,cdnnetworks:Conviva.ConvivaContentInfo.CDN_NAME_CDNETWORKS,cdnvideo:Conviva.ConvivaContentInfo.CDN_NAME_CDNVIDEO,chinacache:Conviva.ConvivaContentInfo.CDN_NAME_CHINACACHE,chinanetcenter:Conviva.ConvivaContentInfo.CDN_NAME_CHINANETCENTER,comcast:Conviva.ConvivaContentInfo.CDN_NAME_COMCAST,edgecast:Conviva.ConvivaContentInfo.CDN_NAME_EDGECAST,fastly:Conviva.ConvivaContentInfo.CDN_NAME_FASTLY,highwinds:Conviva.ConvivaContentInfo.CDN_NAME_HIGHWINDS,internap:Conviva.ConvivaContentInfo.CDN_NAME_INTERNAP,iponly:Conviva.ConvivaContentInfo.CDN_NAME_IPONLY,level3:Conviva.ConvivaContentInfo.CDN_NAME_LEVEL3,limelight:Conviva.ConvivaContentInfo.CDN_NAME_LIMELIGHT,microsoft:Conviva.ConvivaContentInfo.CDN_NAME_MICROSOFT,mirrorimage:Conviva.ConvivaContentInfo.CDN_NAME_MIRRORIMAGE,ngenix:Conviva.ConvivaContentInfo.CDN_NAME_NGENIX,nice:Conviva.ConvivaContentInfo.CDN_NAME_NICE,octoshape:Conviva.ConvivaContentInfo.CDN_NAME_OCTOSHAPE,qbrick:Conviva.ConvivaContentInfo.CDN_NAME_QBRICK,swarmcast:Conviva.ConvivaContentInfo.CDN_NAME_SWARMCAST,talktalk:Conviva.ConvivaContentInfo.CDN_NAME_TALKTALK,telefonica:Conviva.ConvivaContentInfo.CDN_NAME_TELEFONICA,telenor:Conviva.ConvivaContentInfo.CDN_NAME_TELENOR,telia:Conviva.ConvivaContentInfo.CDN_NAME_TELIA,velocix:Conviva.ConvivaContentInfo.CDN_NAME_VELOCIX,bt:Conviva.ConvivaContentInfo.CDN_NAME_BT};for(var i in t)if(-1!==e.indexOf(i))return t[i];return Conviva.ConvivaContentInfo.CDN_NAME_OTHER},_populateMediaTags:function(e,t,i,n,s,r,a,o,l,c){return{asset_asset_type:n,asset_category_main_id:this._getProperty("asset._attrs.genreList.main.content",e),asset_genre_main_id:this._getProperty("asset._attrs.genreList.main.content",e),asset_category_other_id:this._getProperty("asset._attrs.genreList.second.content",e),asset_genre_second_id:this._getProperty("asset._attrs.genreList.second.content",e),asset_genre_sub1_id:this._getProperty("asset._attrs.genreList.sub1.content",e),asset_genre_sub2_id:this._getProperty("asset._attrs.genreList.sub2.content",e),asset_channel_code:this._getProperty("asset._attrs.packageCode",e),asset_channel_name:void 0,asset_current_type:n,asset_episode_number:void 0,asset_flag_series:t,asset_on_air_end_date:void 0,asset_on_air_end_time:void 0,asset_on_air_start_date:void 0,asset_on_air_start_time:void 0,asset_season:void 0,asset_season_number:void 0,asset_serie:void 0,asset_series_title:void 0,asset_subtitle:void 0,asset_title:this._getProperty("asset._attrs.title",e),asset_type:n,streamProtocol:i,show:void 0,episodeName:this._getProperty("meta.episodeTitle",s),asset_flag_live:this._convertToYesNo(r),duration:s.meta.duration.toString(),resume:a.toString(),site:"Sky-DE",contentCategory:o,contentId:l.toString(),playerVersion:c.get("version"),viewerAgreement:"N/A",connectionType:"N/A",asset_flag_simulcast:"no",asset_hd:this._getProperty("asset._attrs.isHD",e)?"yes":"no",asset_id:this._getProperty("asset._attrs.id",e).toString(),asset_length:s.meta.duration.toString(),asset_license_internet:"0",asset_license_mobile:"0"}},_getMediaProperties:function(e,t){var i=this._getProperty("asset._attrs.type",e),n=!1;void 0!==this._getProperty("isLinear",e)&&!0===this._getProperty("isLinear",e)?(n=this._getProperty("isLinear",e),i="Live"):void 0!==this._getProperty("asset._attrs.live",e)&&!0===this._getProperty("asset._attrs.live",e)?(n=this._getProperty("asset._attrs.live",e),i="Live"):void 0!==this._getProperty("mediaType",e)&&"trailer"===e.mediaType&&(i="Trailer");var s,r=this._getProperty("meta.isCatchUp",t),a=this._getProperty("meta.isArchive",t);return void 0!==r&&(s=r?"Catchup":a?"Archive":"On-Demand"),{contentClass:i,liveContent:n,contentCategory:s,isCatchup:r,isArchive:a}}}}),"object"!=typeof navigator?define("tvedemo/ext/device/shared/ConvivaLoader",["tvedemo/ext/device/shared/ConvivaDefault","tvedemo/ext/device/playstation/Conviva"],function(e,t){return{load:function(t,i,n){n(e)}}}):define("tvedemo/ext/device/shared/ConvivaLoader",["tvedemo/ext/device/shared/ConvivaDefault","tvedemo/ext/device/playstation/Conviva","xdk-base/config","xdk-base/console","xdk-base/Env","xdk-base/util","xdk-base/device","require"],function(e,t,i,n,s,r,a){"use strict";return{load:function(e,t,i){var n=s.singleton();this._onload=i,this._timeoutId=window.setTimeout(r.bind(this.__XDKDeviceLoadTimeout,this),2e3),n.addEventListener(n.EVT_ONDETECT,r.bind(this.__XDKDeviceHasLoadedCallback,this))},__XDKDeviceLoadTimeout:function(e){n.warn("[ConvivaLoader] Waited for ONDETECT event but it didn't arrive... Trying a different way to get the platform"),this.__XDKDeviceHasLoadedCallback(a.platform)},__XDKDeviceHasLoadedCallback:function(t){window.clearTimeout(this._timeoutId);var i=this.__getSettings(t);if(null===i||void 0===i)return void this._onload(e);this.__loadJavascript(i.convivaLibraryURL,r.bind(this.__convivaLibraryLoadedIntoWindow(i),this))},__loadJavascript:function(t,i){var s=document.getElementsByTagName("head")[0],r=document.createElement("script"),a="PLAYSTATION 3"===navigator.platform?/^complete$/:/^(complete|loaded)$/;r.type="text/javascript",r.charset="utf-8",r.async=!0,r.onreadystatechange=r.onload=function(){r.readyState&&!a.test(r.readyState)||(r.onload=r.onreadystatechange=null,r.onerror=null,i())},r.onerror=function(i,s,a){r.onload=r.onreadystatechange=null,r.onerror=null,n.error("[ConvivaLoader] Unable to load "+t+" check the XDK config under device.tracking. Message: "+i),this._onload(e)},r.src=t,s.appendChild(r)},__convivaLibraryLoadedIntoWindow:function(e){return function(){t.__setPlayerName(e.convivaPlayerName),!0===e.convivaEnableTouchstoneDebugging&&t.__enableTouchstone(),this._onload(t)}},__getSettings:function(e){var t;return t=i.get("device.tracking"),e=e.replace(/.*\/device\//i,""),e=e.replace(/\/detection.*/i,""),!1===t.hasOwnProperty(e)?(n.log("[ConvivaLoader] platform "+e+" not found in device.tracking config, use the default stub."),null):(n.log('[ConvivaLoader] using device "'+e+'" with config '+JSON.stringify(t[e])),t[e])}}}),define("tve/ext/ui/programguide/interface/Datasource",["xdk-base/Interface"],function(e){return e.create("Datasource",{getTotalRowNumber:[],getProgramGuideCellData:["rowIndex","date"],getRowHeaderData:["rowIndex"]})}),define("tvedemo/ext/ui/programguide/ChannelListingDatasource",["xdk-base/class","xdk-base/promise","xdk-base/console","tve/TVEError","tve/ext/ui/programguide/interface/Datasource","tve/mgr/sLinearManager","tvedemo/mgr/sEndUserManager"],function(e,t,i,n,s,r,a){"use strict";return e.create([s],{},{filteredChannelIds:null,init:function(e){this.__channelIds=e||null},getTotalRowNumber:function(){return this.__channelIds?t.resolve(this.__channelIds.length):r.getChannels().then(function(e){return e.length})},getProgramGuideCellData:function(e,t){var i=function(t){for(var i,n=t[e].get("programs"),s=[],r=0,a=n.length;r<a;r++)i=n[r],s[r]={id:i.get("id"),startTime:i.get("startTime"),endTime:i.get("endTime"),data:i};return s};return this.__channelIds?r.getChannelListingsByChannelIds(this.__channelIds,t).then(i):r.getChannelListingsByDate(t).then(i)},getRowHeaderData:function(e){var t=function(t){var i=t[e],n=i.get("id"),s=i.get("mobilepc");return r.getChannelLogoUrl(i).then(function(e){return{id:n,logo:e,mobilepc:s}})};return this.__channelIds?r.getChannelsByIds(this.__channelIds).then(t):r.getChannels().then(t)}})}),define("tvedemo/ext/ui/input/InputDivImpl",["xdk-ui-input/InputDivImpl","xdk-base/class","xdk-base/console"],function(e,t,i){"use strict";return t.create(e,{},{init:function(e){e=e||{},this._super(e)}})}),define("tvedemo/ext/ui/input/InputNativeImpl",["xdk-ui-input/InputNativeImpl","xdk-base/class","xdk-base/console"],function(e,t,i){"use strict";return t.create(e,{},{init:function(e){i.log("Overridden InputNativeImpl init"),e=e||{},this._super(e),handleMouseOut=function(e){return i.info(self.__inputState),i.info(e),i.info("STORM inputNativeImpl: mouse out"),!0}}})}),define("xdk-ext-device-playstation/detection",[],function(){"use strict";return function(){var e;return!(!navigator||!navigator.userAgent||(e=navigator.userAgent.toLowerCase(),-1===e.indexOf("playstation")))}()}),define("xdk-base/device/helper/storageUniqueId",["require","xdk-base/core","xdk-base/exception"],function(e,t,i){"use strict";var n=null;return{getUniqueID:function(){var s,r,a;if(!(s=e("xdk-base/device"))||!s.storage)throw t.createException(i.ILLEGAL_STATE,"device storage is not ready and fail to generate unique id");if(null===n&&!(n=s.storage.get("__UUID__"))){for(n="",r=0;r<32;r++)a=16*Math.random()|0,8!==r&&12!==r&&16!==r&&20!==r||(n+="-"),n+=(12===r?4:16===r?3&a|8:a).toString(16);s.storage.set("__UUID__",n)}return n}}}),define("xdk-base/device/AbstractId",["xdk-base/class","xdk-base/device/interface/Id","require","xdk-base/device/helper/storageUniqueId"],function(e,t,i,n){"use strict";return e.createAbstract([t],{},{getDeviceType:function(){return this.getHardwareType()},getMac:function(){return null},getFirmware:function(){return"dummyFirmware"},getFirmwareYear:function(){return 0},getUniqueID:function(){return n.getUniqueID()},getModel:function(){return"dummyModel"},getIP:function(){return"0.0.0.0"}})}),define("xdk-ext-device-playstation/webmaf",["xdk-base/util","xdk-base/console","xdk-base/core"],function(e,t,i){"use strict";var n,s={},r={};return n={command:function(i,n,s,r){var a,o;if(this.addNativeEventListener(i,s,r),a={command:i},n)for(o in n)a[o]=n[o];window.external&&window.external.user&&(t.info("[PlayStation]send the PlayStation command"+e.stringify(a)),window.external.user(e.stringify(a)),t.info("[PlayStation] after the send Command)"))},addNativeEventListener:function(i,n,a){if(!n||!e.isFunction(n))return void t.info("[PlayStation]no callback for the command"+i);var o,l;o=a?r:s,l=o[i],l||(l=[],o[i]=l),l.push(n)},removeNativeEventListener:function(e,t){var i,n,a=!1;for(i=s[e];;){if(i&&i.length>0)for(n=0;n<i.length;n++)if(i[n]===t)return void i.splice(n,1);if(a)break;i=r[e],a=!0}},__nativeCallback:function(i){t.info("[PlayStation]Receive command callback "+i);var n,a,o=!1;if(e.isString(i)&&(i=e.parse(i)),i&&i.command)for(n=s[i.command];;){if(n&&n.length>0)for(a=0;a<n.length;a++)t.info("[PlayStation] Run the callback of "+i.command),n[a](i);if(o)return void delete r[i.command];n=r[i.command],o=!0}else t.info("[PlayStation]unknow native callback from the PlayStation")}},t.info("[PlayStation] Setting the accessfuntion to the nativecallback"),i.root.accessfunction=n.__nativeCallback,n}),define("xdk-ext-device-playstation/Id",["xdk-base/class","xdk-base/device/AbstractId","xdk-base/console","xdk-base/util","xdk-ext-device-playstation/webmaf","xdk-base/device/interface/Id"],function(e,t,i,n,s,r){"use strict";return e.create(t,[r],{},{__appVersion:null,__uniqueID:null,init:function(){s.command("appversion",null,n.bind(function(e){e&&e.version&&(this.__appVersion=e.version)},this),!0),s.command("hwid",null,n.bind(function(e){e&&e.hwid&&(this.__uniqueID=e.hwid)},this),!0)},getDeviceType:function(){return"playstation"},getHardwareType:function(){return r.HARDWARE_TYPE.CONSOLE},getModel:function(){var e=window.navigator.userAgent.indexOf("PlayStation 4")>-1?"PS4":"PS3";return i.info("Get Model: "+e),e},getFirmware:function(){return i.info("playstation firmware: "+this.__appVersion),this.__appVersion||"dummyFirmware"},getUniqueID:function(){return this.__uniqueID?this.__uniqueID:this._super()}})}),define("xdk-ext-device-playstation/TvKey",["xdk-base/device/shared/browser/TvKey","xdk-base/class","xdk-base/device/vKey","xdk-base/util","xdk-base/device/shared/browser/keyMap","xdk-ext-device-playstation/Id"],function(e,t,i,n,s,r){"use strict";return t.create(e,{R1:{id:"playstation:vkey:r1"},R2:{id:"playstation:vkey:r2"},R3:{id:"playstation:vkey:r3"},L1:{id:"playstation:vkey:l1"},L2:{id:"playstation:vkey:l2"},L3:{id:"playstation:vkey:l3"},TRIANGLE:{id:"playstation:vkey:triangle"},SQUARE:{id:"playstation:vkey:square"},START:{id:"playstation:vkey:start"},SELECT:{id:"playstation:vkey:select"},OPTIONS:{id:"playstation:vkey:options"},TOUCHPAD:{id:"playstation:vkey:touchpad"}},{init:function(){var e=new r,t=n.clone(s.REMOTE,!0);t.VKey[8]=i.BACK,t.VKey[119]=this.constructor.R2,t.VKey[118]=this.constructor.L2,t.VKey[117]=this.constructor.R1,t.VKey[116]=this.constructor.L1,t.VKey[112]=this.constructor.TRIANGLE,t.VKey[32]=this.constructor.SQUARE,t.VKey[120]=this.constructor.L3,t.VKey[121]=this.constructor.R3,"PS4"===e.getModel()?(t.VKey[114]=this.constructor.OPTIONS,t.VKey[135]=this.constructor.TOUCHPAD):(t.VKey[114]=this.constructor.START,t.VKey[115]=this.constructor.SELECT,t.VKey[96]=i.KEY_0,t.VKey[97]=i.KEY_1,t.VKey[98]=i.KEY_2,t.VKey[99]=i.KEY_3,t.VKey[100]=i.KEY_4,t.VKey[101]=i.KEY_5,t.VKey[102]=i.KEY_6,t.VKey[103]=i.KEY_7,t.VKey[104]=i.KEY_8,t.VKey[105]=i.KEY_9),t.VKey[127]=i.RW,t.VKey[126]=i.FF,t.VKey[128]=i.PLAY,t.VKey[122]=i.PREV,t.VKey[123]=i.NEXT,t.VKey[129]=i.STOP,t.VKey[125]=i.RW,t.VKey[124]=i.FF,t.VKey[130]=i.PAUSE,this.initKeyMapping(t)}})}),define("xdk-base/device/AbstractSystem",["xdk-base/class","xdk-base/util","xdk-base/config","xdk-base/device/shared/ConnectionPoller","xdk-base/console","xdk-base/core","xdk-base/ajax","xdk-base/device/interface/System","xdk-base/EventDispatcher","xdk-base/promise"],function(e,t,i,n,s,r,a,o,l,c){"use strict";return e.createAbstract(l,[o],{},{_internetPoller:null,__networkStatus:!0,init:function(){this._super(),this._postInit()},setScreenSaver:function(e){return!1},setSystemMute:function(e){return!1},powerOff:function(){return!1},exit:function(){return!1},hasMouse:function(){return!1},hasFixedKeyboard:function(){return!1},getDisplayResolution:function(){return{width:0,height:0}},supportSSL:function(){return!1},hasSOP:function(){return!0},getNetworkStatus:function(){var e;return this._internetPoller&&this._internetPoller.isPolling()?c.resolve(this._internetPoller.isConnected()):(e=i.get("device.ajax-network-check.url",null),e?a.request(e,{timeOut:i.get("device.ajax-network-check.timeout",10)}).then(function(){return s.info("[System]Successfully sent the ajax via "+e),!0},function(){return s.info("[System]Unsuccessfully sent the ajax via "+e),!1}):c.reject())},_postInit:function(){var e,l,c=i.get("device.ajax-network-check.url",null);c&&(e=t.bind(function(e){if(!c)throw r.createException("PollingUrlNotSet","You must set polling URL using setPollingUrl().");a.request(c,{timeOut:i.get("device.ajax-network-check.timeout",10)}).then(function(){s.info("[System]Successfully sent the ajax via "+c),e(!0)},function(){s.info("[System]Unsuccessfully sent the ajax via "+c),e(!1)}).done()},this),l=t.bind(function(e){this.dispatchEvent(o.EVT_NETWORK_STATUS_CHANGED,e)},this),this._internetPoller=new n(e,l,{consecFailureThreshold:i.get("device.ajax-network-check.consec-failure-threshold"),pollingInterval:i.get("device.ajax-network-check.interval")}))},addEventListener:function(e,t,i){var n=this._super(e,t,i);return this._internetPoller&&e===o.EVT_NETWORK_STATUS_CHANGED&&this._internetPoller.startPolling(),n},removeEventListener:function(e,t){return this._internetPoller&&e===o.EVT_NETWORK_STATUS_CHANGED&&this._internetPoller.stopPolling(),this._super(e,t)},redraw:function(e){}})});define("xdk-ext-device-playstation/System",["xdk-base/class","xdk-base/device/AbstractSystem","xdk-base/device/shared/ConnectionPoller","xdk-base/util","xdk-base/console","xdk-ext-device-playstation/webmaf","xdk-base/device/interface/System","xdk-base/promise"],function(e,t,i,n,s,r,a,o){"use strict";return e.create(t,{},{__online:!0,init:function(){this.__visibilityHandler(),this._super()},__visibilityHandler:function(){var e=require("xdk-base/device"),t=e.getDeviceHandler();r.addNativeEventListener("applicationStatusChange",function(e){if(e)switch(s.info("[PlayStation] Received the application status change callback:"+e.applicationStatus),e.applicationStatus){case"foreground":t.onDeviceResume();break;case"background":t.onDevicePause()}})},getDisplayResolution:function(){return{width:null!==window.innerWidth?window.innerWidth:null!==document.body?document.body.clientWidth:null,height:null!==window.innerHeight?window.innerHeight:null!==document.body?document.body.clientHeight:null}},getNetworkStatus:function(){return o.resolve(this._isInternetConnected())},_isInternetConnected:function(){return s.info("[PlayStation] checking the internetConnected"+this.__online),this.__online},_postInit:function(){r.addNativeEventListener("networkStatusChange",n.bind(function(e){e&&e.newState&&(s.debug("[PlayStation] Received the network status change callback"+e.newState),"connected"===e.newState?(this.__online=!0,this.dispatchEvent(a.EVT_NETWORK_STATUS_CHANGED,this.__online)):"disconnected"===e.newState&&(this.__online=!1,this.dispatchEvent(a.EVT_NETWORK_STATUS_CHANGED,this.__online)))},this))}})}),define("xdk-ext-device-playstation/DevicePackage",["xdk-base/device/AbstractDevicePackage","xdk-base/device/shared/CookiesStorage","xdk-ext-device-playstation/TvKey","xdk-ext-device-playstation/Id","xdk-ext-device-playstation/System","xdk-base/device/Media","xdk-base/class","xdk-base/util","xdk-base/config","xdk-base/console","xdk-ext-device-playstation/webmaf"],function(e,t,i,n,s,r,a,o,l,c,d){"use strict";var u=r.singleton();return a.create(e,{},{_shouldSetup:!0,__callbacks:{},getId:function(){return"playstation"},setup:function(e){var t,i;this._super(e),t=this.getInterfaceTypes(),o.each(t,o.bind(function(e){this.addInterfaceType(e.key,e.value.handle,e.value.interfaceObj)},this)),i=o.bind(function(){d.command("dismissSplash",null,o.bind(function(){c.info("[PlayStation] Dismiss the Splash Screen and the apps is ready"),this.ready()},this),!0)},this),this._preparePlayerList(i)},getDefaultPlayer:function(){return["xdk-ext-device-playstation/PSPlayer"]},getInterfaceTypes:function(){var r={};return r[e.STORAGE]={handle:e.STORAGE_HANDLE,interfaceObj:new t},r[e.MEDIA_PLAYER]={handle:e.MEDIA_PLAYER_HANDLE,interfaceObj:u},r[e.TV_KEY]={handle:e.TV_KEY_HANDLE,interfaceObj:new i},r[e.ID]={handle:e.ID_HANDLE,interfaceObj:new n},r[e.SYSTEM]={handle:e.SYSTEM_HANDLE,interfaceObj:new s},r}})}),define("xdk-ext-device-playstation/Html5Player",["xdk-base/class","xdk-base/device/shared/Html5Player","xdk-base/util","xdk-base/console","xdk-base/device","xdk-base/device/Media"],function(e,t,i,n,s,r){"use strict";var a=r.singleton(),o="[Playstation Html5Player] ";return e.create(t,{},{seek:function(e){e>=this.getDuration()+-3&&(e=this.getDuration()+-3),e>=0&&e<=1?(this._playerObject.currentTime=e,i.delay(.3).then(i.bind(function(){this._playerObject.currentTime=e},this)).done()):this._playerObject.currentTime=e},_onFinished:function(){n.info(o+": finished"),a._onTimeUpdate(this.getDuration()),this._playerObject.autoplay=!1,this._stopPlayback(),this.__hasFinished=!0,a._onFinish()},_stopPlayback:function(){this._playerObject.pause(),this._playerObject.load(),this._onLoaded=!1,this.hide(),this._removeConnectionTimeOut(),this._connected=!1},reset:function(){n.info(o+"reset: stop playback + deinit"),this._stopPlayback(),this.deinit()},deinit:function(){n.debug(o+"deinit: removing listeners"),this._removeVideoEventListeners(this._playerObject)},_onWaiting:function(){a.isState(a.CONNECTING)||this.__needBlockStateChange()||a.isState(a.PLAYING)||(n.info(o+"waiting"),a._onBufferingStart(),a._onBufferingProgress())},_onPlaying:function(){this.__needBlockStateChange()||a.isState(a.PLAYING)||(n.info(o+"onplaying event"),this._removeConnectionTimeOut(),this._pausedVideo?a._onPause():a._onPlaying(),a.isState(a.BUFFERING)&&a._onBufferingFinish())},_onTimeUpdate:function(){if(this._connected){var e=this.getCurTime();if(e>=this.getDuration()||i.isNaN(e))return void this._onFinished();a._onTimeUpdate(e)}}})}),define("xdk-ext-device-playstation/PSPlayer",["xdk-base/class","xdk-base/device","xdk-base/device/Media","xdk-base/util","xdk-base/console","xdk-base/config","xdk-ext-device-playstation/webmaf","xdk-base/core","xdk-base/device/AbstractPlayer","xdk-base/device/interface/Player","require"],function(e,t,i,n,s,r,a,o,l,c,d){"use strict";var u=i.singleton(),h=null,_=function(){return h||(h=d("xdk-base/device").system.getDisplayResolution())},g=c.PLAYBACK_ERRORS;return e.create(l,{},{_prepared:!1,_duration:0,_connectionTimeLimit:90,_connectionTimeOut:null,_connected:!1,_supportHLS:!1,_support:!0,_seek:!1,_seekTime:0,_isSeeking:!1,_enableRunningTimeUnblock:!0,_prevElapsedTime:0,_prevPausedElapsedTime:0,_url:null,_bandwidth:null,_currentBitrate:null,_availableBitrates:[],_updatePlaybackStateFn:null,__timeInterval:null,__logPrefix:"[XDK] [PSPlayer] ",prepare:function(e){this._mediaOpts=e,this._prepared||(s.info(this.__logPrefix+"Native player is not a DOM object and unable to place into another node"),this._prepared=!0,this._addPlaybackEventListeners())},__onLoad:function(e){this._onLoaded=!0,this._clearConnectionTimeout(),this._isVideoMetricsAvailable()?(s.info(this.__logPrefix+"_updatePlaybackStateFn: Using videometrics"),this._updatePlaybackStateFn=n.bind(function(){var e=this.getVideoMetrics();this.__onTimeUpdate({elapsedTime:e.elapsed/1e3}),this._setDuration(e.duration/1e3);var t={bitrate:e.currentBitrate,bitrates:e.bitrates,bandwidth:e.bandwidth};this.__setBitrateData(t)},this)):(this._setDuration(e.totalLength),this._updatePlaybackStateFn=n.bind(function(){s.info(this.__logPrefix+"_updatePlaybackStateFn: Using WebMaf commands"),a.command("getPlaybackTime"),a.command("getBitrate",null,this.__setBitrateData)},this)),this.__enableTimeInterval(!0),this._seek&&this._seekTime>0&&(this.seek(this._seekTime),this._seek=!1),this._connected&&(s.info(this.__logPrefix+"onload event"),u._onBufferingStart(),u._onBufferingProgress())},reset:function(){this._prepared&&(this._prepared=!1,this._isSeeking=!1,this._prevPausedElapsedTime=0,this._prevElapsedTime=0,this._removePlaybackEventListeners(),this._stopPlayback(),this.deinit())},__onStatusChange:function(e){var t=e.playerState;switch(s.info(this.__logPrefix+"receive the status change "+t),t.toLowerCase()){case"buffering":u._onBufferingStart(),u._onBufferingProgress(),
this._resetConnectionTimeout();break;case"endofstream":this.__onFinished();break;case"notready":break;case"opening":u.isState(u.STOPPED)&&u._onConnecting(),this._resetConnectionTimeout();break;case"paused":this._clearConnectionTimeout(),this._isSeeking=!1,u._onPause(),this._updatePlaybackStateFn();break;case"playing":if(this._clearConnectionTimeout(),this.__witholdSkip)return;this._seek&&this._seekTime>0&&(this.seek(this._seekTime),this._seek=!1),this._isSeeking=!1,u.isState(u.BUFFERING)&&u._onBufferingFinish(),u._onPlaying()}s.log(this.__logPrefix+"update the state"+t)},deinit:function(){this._prepared&&(this._prepared=!1,s.info(this.__logPrefix+"player deinit successfull."))},play:function(e){if(s.info(this.__logPrefix+"Play requested."),!this._support)return this._stopPlayback(),void u._onError(g.RENDER.UNSUPPORTED,this.__logPrefix+"unsupport format in the playstation video player");if(u.isState(u.STOPPED)){this._onLoaded=!1;var t=this._mediaOpts,i={contentUri:this.url};"playready"===t.drm&&(t.drmUrl&&(i.licenseUri=t.drmUrl),t.customData&&(i.customData=t.customData));var n={bitratesFrom:0,bitratesTo:0};t.hasOwnProperty("bitratesFrom")&&(n.bitratesFrom=t.bitratesFrom),t.hasOwnProperty("bitratesTo")&&(n.bitratesTo=t.bitratesTo),this.setFixVideoRepresentations(n),a.command("load",i),u._onConnecting(),this._resetConnectionTimeout()}else this.__enableTimeInterval(!0);this._seek=!1,e&&e.sec&&(this._seek=!0,this._seekTime=e.sec),a.command("play")},__enableTimeInterval:function(e){this.__timeInterval&&(clearInterval(this.__timeInterval),this.__timeInterval=null),this._updatePlaybackStateFn(),e&&(this.__timeInterval=setInterval(this._updatePlaybackStateFn,500))},pause:function(){if(this._isSeeking)return void s.info(this.__logPrefix+"The playback is in seeking state, block pause action.");s.info(this.__logPrefix+"Pausing video."),a.command("pause"),u._onPause(),this.__enableTimeInterval(!1),n.delay(.2).done(this._updatePlaybackStateFn)},stop:function(){s.info(this.__logPrefix+"Stopping video"),this._stopPlayback(),u._onStopped()},_stopPlayback:function(){this._clearConnectionTimeout(),this.__enableTimeInterval(!1),this._currentBitrate=null,this._availableBitrates=null,this._bandwidth=null,a.command("stop")},resume:function(){if(u.isState(u.PAUSED)&&this._isSeeking)return void s.info(this.__logPrefix+"The paused playback is in seeking state, block resume action.");this.__enableTimeInterval(!0),s.info(this.__logPrefix+"Resuming..."),a.command("play"),u._onPlaying()},skip:function(e){if(this._isSeeking)return void s.info(this.__logPrefix+"The playback is in seeking state, block skip action.");var t=this.getCurTime()+e;u.isState(u.PAUSED)?(this.__witholdSkip=!0,this.__setCurTime(t),u._onTimeUpdate(t),a.command("setPlayTime",{playTime:Math.floor(t)},n.bind(function(){this.__witholdSkip=!1},this),!0)):this.seek(t)},seek:function(e){0===e&&(e=1),this._mediaOpts&&("hls"===this._mediaOpts.type||"aes128"===this._mediaOpts.drm)&&e>this.getDuration()-5?e=this.getDuration()-5:e===this.getDuration()&&(e=this.getDuration()-1),e=Math.max(0,e),a.command("setPlayTime",{playTime:Math.floor(e)})},getBitrates:function(){return null!==this._currentBitrate&&{currentBitrate:this._currentBitrate,availableBitrates:this._availableBitrates}},getBandwidth:function(){return null!==this._bandwidth&&this._bandwidth},setFixVideoRepresentations:function(e){var t={minBitrate:0,maxBitrate:0,minLumaSample:0,maxLumaSample:0};e.minBitrate&&(t.minBitrate=e.minBitrate),e.maxBitrate&&(t.maxBitrate=e.maxBitrate),e.minLumaSample&&(t.minLumaSample=e.minLumaSample),e.maxLumaSample&&(t.maxLumaSample=e.maxLumaSample),a.command("setFixVideoRepresentations",t)},getCurTime:function(){return this._currentTime},__setCurTime:function(e){this._currentTime=e},_setDuration:function(e){this._duration=e},getDuration:function(){return this._duration},getCapabilities:function(){return{type:["mp4","hls","dash"],drms:["playready","aes128"]}},load:function(e,t){return this.url=e,!!this._prepared&&e},setWindowSize:function(e){var t=_(),i=t.height/2,n=t.width/2,s=e.left/n-1,r=-(e.top/i-1),o=(e.left+e.width)/n-1,l=-((e.top+e.height)/i-1);a.command("setVideoPortalSize",{ltx:s,lty:r,rbx:o,rby:l}),this._currentWindowSize=e},setFullscreen:function(){var e=_();this.setWindowSize({top:0,left:0,height:e.height,width:e.width})},getVideoMetrics:function(){return videometrics.poll(),videometrics},_isVideoMetricsAvailable:function(){return!n.isUndefined(videometrics)},_addPlaybackEventListeners:function(){this.__bindedOnStatusChange=n.bind(this.__onStatusChange,this),a.addNativeEventListener("playerStatusChange",this.__bindedOnStatusChange),this.__bindedOnLoad=n.bind(this.__onLoad,this),a.addNativeEventListener("contentAvailable",this.__bindedOnLoad),this.__bindedOnTimeUpdate=n.bind(this.__onTimeUpdate,this),a.addNativeEventListener("getPlaybackTime",this.__bindedOnTimeUpdate),this.__bindedOnSetPlayTime=n.bind(this.__onSetPlayTime,this),a.addNativeEventListener("setPlayTime",this.__bindedOnSetPlayTime),this.__bindedOnPlayerMessage=n.bind(this.__onPlayerMessage,this),a.addNativeEventListener("playerMessage",this.__bindedOnPlayerMessage),this.__bindedOnStreamError=n.bind(this.__onStreamingError,this),a.addNativeEventListener("playerStreamingError",this.__bindedOnStreamError),this.__bindedOnError=n.bind(this.__onError,this),a.addNativeEventListener("playerError",this.__bindedOnError)},_removePlaybackEventListeners:function(){a.removeNativeEventListener("playerStatusChange",this.__bindedOnStatusChange),a.removeNativeEventListener("contentAvailable",this.__bindedOnLoad),a.removeNativeEventListener("getPlaybackTime",this.__bindedOnTimeUpdate),a.removeNativeEventListener("setPlayTime",this.__bindedOnSetPlayTime),a.removeNativeEventListener("playerMessage",this.__bindedOnPlayerMessage),a.removeNativeEventListener("playerStreamingError",this.__bindedOnStreamError),a.removeNativeEventListener("playerError",this.__bindedOnError)},_onConnectionTimeout:function(){this._stopPlayback(),u._onError(g.NETWORK.FAILED,"Connection error"),s.info(this.__logPrefix+"Connection error: _onConnectionTimeout")},_clearConnectionTimeout:function(){n.clearDelay(this._connectionTimeOut)},_resetConnectionTimeout:function(){this._clearConnectionTimeout(),this._connectionTimeOut=o.getGuid(),n.delay(this._connectionTimeLimit,this._connectionTimeOut).then(n.bind(this._onConnectionTimeout,this)).done()},__onTimeUpdate:function(e){var t=e.elapsedTime;if(this._enableRunningTimeUnblock&&this._isSeeking)return void(u.isState(u.PAUSED)?this._prevPausedElapsedTime>0&&t!==this._prevPausedElapsedTime&&t!==this._prevPausedElapsedTime+1?(this._isSeeking=!1,this._prevPausedElapsedTime=0):this._prevPausedElapsedTime=t:(this._prevElapsedTime>0&&t===this._prevElapsedTime+1&&(this._isSeeking=!1),this._prevElapsedTime=t));this.__setCurTime(t),u._onTimeUpdate(t)},__onSetPlayTime:function(e){e&&"ok"===e.status&&(this._isSeeking=!0,this._enableRunningTimeUnblock&&u.isState(u.PAUSED)&&this.__enableTimeInterval(!0))},__onPlayerMessage:function(e){e&&"setPlayTimeSuccess"===e.msg_info&&(this._enableRunningTimeUnblock&&(this._enableRunningTimeUnblock=!1,u.isState(u.PAUSED)&&this.__enableTimeInterval(!1)),this._updatePlaybackStateFn(),this._isSeeking=!1)},__setBitrateData:function(e){this._availableBitrates=e.bitrates,this._currentBitrate=e.bitrate,this._bandwidth=e.bandwidth},__onFinished:function(){s.info(this.__logPrefix+"finished event"),this.__setCurTime(this.getDuration()),u._onTimeUpdate(this.getCurTime()),this._stopPlayback(),u._onFinish()},__onStreamingError:function(e){if(this.__enableTimeInterval(!1),this._clearConnectionTimeout(),!u.isState(u.STOPPED))if(e.error&&e.status_code){switch(e.error){case"http_connection":u._onError(g.NETWORK.FAILED,{code:e.status_code,msg:e.error},e);break;case"http_status_code":u._onError(g.RENDER.FAILED,{code:e.status_code,msg:e.error},e)}s.error(this.__logPrefix+"onRenderError : "+e.error+"with error Code"+e.status_code)}else e.status?(u._onError(g.RENDER.FAILED,{code:e.status_code,msg:e.error},e),s.error(this.__logPrefix+"onRenderError : with status "+e.status)):u._onError(g.GENERIC.UNKNOWN,null,e)},__onError:function(e){if(e&&e.error_info&&e.error_info.indexOf("sceAvPlayerJumpToTime")>0)return void s.info("Ignore sceAvPlayerJumpToTime error as it won't affect anything of playback.");if(this.__enableTimeInterval(!1),this._clearConnectionTimeout(),e.error&&e.error_code_hexa){switch(e.error){case"video_error":u._onError(g.RENDER.FAILED,{code:e.error_code_hexa,msg:e.error},e);break;case"drm_error":u._onError(g.DRM.FAILED,{code:e.error_code_hexa,msg:e.error},e)}s.error(this.__logPrefix+"onRenderError : "+e.error+"with error code: "+e.error_code_hexa)}else e.status?(u._onError(g.RENDER.FAILED,{code:e.status_code,error:e.error},e),s.error(this.__logPrefix+"onRenderError : with status "+e.status)):(u._onError(g.GENERIC.UNKNOWN,{code:e.status_code,error:e.error},e),s.error(this.__logPrefix+"onRenderError : unknown "))}})}),define("xdk-base/device/interface/MultipleAudioTrackStgy",["xdk-base/Interface"],function(e){"use strict";var t=e.create("MultipleAudioTrackStgy",{getAudioTracks:[],setAudioTrack:["id"],getAudioTrackAttr:["id","attr","defaultValue"],getCurrentAudioTrackId:[]});return t.LANGCODE="LANGCODE",t}),define("xdk-ext-device-playstation/PSPlayerMultiAudioTracksStgy",["xdk-base/class","xdk-base/console","xdk-base/device/interface/MultipleAudioTrackStgy","xdk-base/promise","xdk-base/core","xdk-base/exception","xdk-base/util","xdk-ext-device-playstation/webmaf","xdk-base/device/Media"],function(e,t,i,n,s,r,a,o,l){"use strict";var c=l.singleton();return e.create([i],{},{__player:null,init:function(e){this.__player=e},getAudioTracks:function(){if(c.isState(c.STOPPED))return n.reject(s.createException(r.UNSUPPORTED_OPERATION,"Unable to get the audio track when the player is stopped."));if(!this.__player._onLoaded)return t.info("[XDK playstation] Delay 10s to get the audio track info again"),a.delay(10).then(a.bind(this.getAudioTracks,this));var e,i=[],l=[],d=n.defer();return o.command("getAudioTracks",{},function(n){if(t.info("[XDK playstation]Audio Tracks: "+n),n.audioTracks)for(i=n.audioTracks.split(","),e=0;e<i.length;e++)l.push(i[e]),t.info("[XDK playstation] Available audio track is "+i[e]);d.resolve(l)},!0),d.promise},setAudioTrack:function(e){return this.__player._onLoaded?(t.info("[XDK playstation]Set stream ID to: "+e),o.command("setAudioTrack",{audioTrack:e}),n.resolve(!0)):n.reject(s.createException(r.UNSUPPORTED_OPERATION,"PSPlayer is not ready yet."))},getAudioTrackAttr:function(e,t,o){if(!this.__player._onLoaded)return n.reject(s.createException(r.UNSUPPORTED_OPERATION,"PSPlayer is not ready yet."));switch(t){case i.LANGCODE:return n.resolve(e);default:if(!a.isUndefined(o))return n.resolve(o)}return n.reject(s.createException(r.ILLEGAL_ARGUMENT,"No valid argument and unable to obtain the audio track attritbue."))},getCurrentAudioTrackId:function(){if(!this.__player._onLoaded)return t.info("[XDK playstation] Delay 10s to get the audio track info again"),a.delay(10).then(a.bind(this.getAudioTracks,this));var e=n.defer(),i=null;return o.command("getAudioTracks",{},function(n){t.info("[XDK playstation]Audio Tracks: "+n),n.currentAudioTrack&&(i=n.currentAudioTrack),e.resolve(i)},!0),e.promise}})}),define("tvedemo/ext/device/playstation/PSPlayer",["xdk-base/class","xdk-base/device","xdk-base/device/Media","xdk-base/util","xdk-base/console","xdk-ext-device-playstation/webmaf","xdk-ext-device-playstation/PSPlayer","require","tvedemo/wgt/vLoading"],function(e,t,i,n,s,r,a,o,l){"use strict";var c=i.singleton();return e.create(a,{},{_isSeeking:!1,_enableRunningTimeUnblock:!0,_prevElapsedTime:0,_prevPausedElapsedTime:0,__enableTimeInterval:function(e){this.__timeInterval&&(clearInterval(this.__timeInterval),this.__timeInterval=null),e&&(this.__timeInterval=setInterval(n.bind(function(){this._enableRunningTimeUnblock&&this._isSeeking?r.command("getPlaybackTime",null,this.__bindedOnTimeUpdate):n.isFunction(this._updatePlaybackStateFn)&&this._updatePlaybackStateFn()},this),1e3))},play:function(e){this._isSeeking=!1,l.close(),this._setDuration(0),this.__setCurTime(0),this._super(e)},pause:function(){if(this._isSeeking)return void s.warn("The playback is in seeking state, block pause action.");this.__enableTimeInterval(!1),r.command("pause"),c._onPause()},skip:function(e){if(this._isSeeking)return void s.warn("The playback is in seeking state, block skip action.");this._super(e)},_addPlaybackEventListeners:function(){this.__bindedOnStatusChange=n.bind(this.__onStatusChange,this),r.addNativeEventListener("playerStatusChange",this.__bindedOnStatusChange),this.__bindedOnLoad=n.bind(this.__onLoad,this),r.addNativeEventListener("contentAvailable",this.__bindedOnLoad),this.__bindedOnTimeUpdate=n.bind(this.__onTimeUpdate,this),r.addNativeEventListener("getPlaybackTime",this.__bindedOnTimeUpdate),this.__bindedOnStreamError=n.bind(this.__onStreamingError,this),r.addNativeEventListener("playerStreamingError",this.__bindedOnStreamError),this.__bindedOnError=n.bind(this.__onError,this),r.addNativeEventListener("playerError",this.__bindedOnError),"PS4"===t.id.getModel()&&(this.__bindedOnPlayerMessage=n.bind(this.__onPlayerMessage,this),r.addNativeEventListener("playerMessage",this.__bindedOnPlayerMessage),this.__bindedOnSetPlayTime=n.bind(this.__onSetPlayTime,this),r.addNativeEventListener("setPlayTime",this.__bindedOnSetPlayTime))},_removePlaybackEventListeners:function(){r.removeNativeEventListener("playerStatusChange",this.__bindedOnStatusChange),r.removeNativeEventListener("contentAvailable",this.__bindedOnLoad),r.removeNativeEventListener("getPlaybackTime",this.__bindedOnTimeUpdate),r.removeNativeEventListener("playerStreamingError",this.__bindedOnStreamError),r.removeNativeEventListener("playerError",this.__bindedOnError),"PS4"===t.id.getModel()&&(r.removeNativeEventListener("playerMessage",this.__bindedOnPlayerMessage),r.removeNativeEventListener("setPlayTime",this.__bindedOnSetPlayTime)),this._prevPausedElapsedTime=0,this._prevElapsedTime=0,this._isSeeking=!1,l.close()},__onTimeUpdate:function(e){if(!c.isState(c.STOPPED)){var t=e.elapsedTime;this._enableRunningTimeUnblock&&this._isSeeking&&(c.isState(c.PAUSED)?this._prevPausedElapsedTime>0&&t!==this._prevPausedElapsedTime&&t!==this._prevPausedElapsedTime+1?(s.warn("Time skipped, paused seek should be done. So unblock seeking process."),this._isSeeking=!1,l.close(),this._prevPausedElapsedTime=0):this._prevPausedElapsedTime=t:(this._prevElapsedTime>0&&t===this._prevElapsedTime+1&&(s.warn("Time is running again, seek should be completed. So unblock seeking process."),this._isSeeking=!1,l.close()),this._prevElapsedTime=t)),this.__setCurTime(t),c._onTimeUpdate(this.getCurTime())}},__onFinished:function(){this._isSeeking=!1,l.close(),this._super()},__onSetPlayTime:function(e){e&&"ok"===e.status&&(s.warn("The playback state changes to seeking."),this._enableRunningTimeUnblock&&c.isState(c.PAUSED)&&this.__enableTimeInterval(!0),this._isSeeking=!0,l.open())},__onPlayerMessage:function(e){e&&"setPlayTimeSuccess"===e.msg_info&&(this._enableRunningTimeUnblock&&(this._enableRunningTimeUnblock=!1),s.warn("The playback finishes seeking."),this._isSeeking=!1,l.close())},__onError:function(e){if(e&&e.error_info&&e.error_info.indexOf("sceAvPlayerJumpToTime")>0)return void s.warn("Suppress and ignore sceAvPlayerJumpToTime error as it won't affect the playback.");this.__enableTimeInterval(!1),this._clearConnectionTimeout(),c._onError("onRenderError",n.stringify(e)),s.error("[XDK playstation] onRenderError : "+e.error+"with error Code"+e.error_code)}})}),define("tvedemo/ext/device/playstation/PSPlayerMultiAudioTracksStgy",["xdk-base/class","xdk-base/console","xdk-base/device/interface/MultipleAudioTrackStgy","xdk-base/promise","xdk-base/core","xdk-base/exception","xdk-base/util","xdk-ext-device-playstation/webmaf","xdk-base/device/Media"],function(e,t,i,n,s,r,a,o,l){"use strict";var c,d,u=l.singleton();return e.create([i],{},{__player:null,__setAudioDelayId:"psAudioTrackDelay",init:function(e){this.__player=e},getAudioTracks:function(){if(u.isState(u.STOPPED))return n.reject(s.createException(r.UNSUPPORTED_OPERATION,"Unable to get the audio track when the player is stopped."));if(!this.__player._onLoaded)return t.info("[XDK playstation] Delay 10s to get the audio track info again"),a.delay(10).then(a.bind(this.getAudioTracks,this));var e,i=[],l=[],h=n.defer();return o.command("getAudioTracks",{},function(n){if(t.info("[XDK playstation]Audio Tracks: "+n),c=Date.now(),d=0,n.audioTracks)for(i=n.audioTracks.split(","),e=0;e<i.length;e++)l.push(i[e]),t.info("[XDK playstation] Available audio track is "+i[e]);h.resolve(l)},!0),h.promise},setAudioTrack:function(e){if(!this.__player._onLoaded)return n.reject(s.createException(r.UNSUPPORTED_OPERATION,"PSPlayer is not ready yet."));var i=Date.now();if(d&&i-d<2e3)return t.warn("[XDK playstation] setAudioTrack was done too soon since last operation"),n.reject(s.createException(r.UNSUPPORTED_OPERATION,"Too early since last setAudioTrack operation"));if(!0===u._isSeeking)return t.warn("[XDK playstation] setAudioTrack can't be done during seek operation"),n.reject(s.createException(r.UNSUPPORTED_OPERATION,"Can't change audio during seek"));var l=i-c>5e3,h=n.defer();return d=i,a.clearDelay(this.__setAudioDelayId),a.delay(.5,this.__setAudioDelayId).then(function(){o.command("setAudioTrack",{audioTrack:e}),l&&u.skip(-1),h.resolve(!0)}),h.promise},getAudioTrackAttr:function(e,t,o){if(!this.__player._onLoaded)return n.reject(s.createException(r.UNSUPPORTED_OPERATION,"PSPlayer is not ready yet."));switch(t){case i.LANGCODE:return n.resolve(e);default:if(!a.isUndefined(o))return n.resolve(o)}return n.reject(s.createException(r.ILLEGAL_ARGUMENT,"No valid argument and unable to obtain the audio track attritbue."))},getCurrentAudioTrackId:function(){if(!this.__player._onLoaded)return t.info("[XDK playstation] Delay 10s to get the audio track info again"),a.delay(10).then(a.bind(this.getAudioTracks,this));var e=n.defer(),i=null;return o.command("getAudioTracks",{},function(n){t.info("[XDK playstation]Audio Tracks: "+n),n.currentAudioTrack&&(i=n.currentAudioTrack),e.resolve(i)},!0),e.promise}})});